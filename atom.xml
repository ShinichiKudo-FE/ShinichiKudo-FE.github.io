<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é»˜é»˜é»˜é»˜ç‡ƒ</title>
  
  <subtitle>è·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œå¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://zhanghao-web.github.io/"/>
  <updated>2020-03-18T12:52:56.005Z</updated>
  <id>https://zhanghao-web.github.io/</id>
  
  <author>
    <name>å¼ ç™½å‘Šä¸¶</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ä½ ä¸çŸ¥é“çš„ç®­å¤´å‡½æ•°</title>
    <link href="https://zhanghao-web.github.io/2020/03/15/Js/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0/"/>
    <id>https://zhanghao-web.github.io/2020/03/15/Js/ä½ ä¸çŸ¥é“çš„ç®­å¤´å‡½æ•°/</id>
    <published>2020-03-15T10:31:16.000Z</published>
    <updated>2020-03-18T12:52:56.005Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç®€è¨€"><a href="#ç®€è¨€" class="headerlink" title="ç®€è¨€"></a>ç®€è¨€</h1><p>ES6çš„ç®­å¤´å‡½æ•°ï¼Œæˆ‘ä»¬ä¼šåœ¨å·¥ä½œä¸­ç»å¸¸çŸ¥é“ï¼Œä½†æ˜¯ä½ çŸ¥é“ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œä»€ä¹ˆæ—¶å€™ä¸èƒ½ä½¿ç”¨ç®­å¤´å‡½æ•°å—ï¼Ÿ</p><h2 id="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ"><a href="#ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ"></a>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ</h2><blockquote><p>ä¸ºå•¥å¤§å¤šæ•°æƒ…å†µéƒ½ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ</p></blockquote><p>ä½œç”¨åŸŸå®‰å…¨æ€§:å½“ç®­å¤´å‡½æ•°è¢«ä¸€è‡´ä½¿ç”¨æ—¶ï¼Œæ‰€æœ‰ä¸œè¥¿éƒ½ä¿è¯ä½¿ç”¨ä¸æ ¹å¯¹è±¡ç›¸åŒçš„thisã€‚å¦‚æœä¸€ä¸ªæ ‡å‡†å‡½æ•°å›è°ƒä¸ä¸€å †ç®­å¤´å‡½æ•°æ··åˆåœ¨ä¸€èµ·ï¼Œé‚£ä¹ˆä½œç”¨åŸŸå°±æœ‰å¯èƒ½å˜å¾—æ··ä¹±ã€‚</p><p>ç´§å‡‘æ€§:ç®­å¤´å‡½æ•°æ›´å®¹æ˜“è¯»å†™ã€‚</p><p>æ¸…æ™°åº¦:ä½¿ç”¨ç®­å¤´å‡½æ•°å¯æ˜ç¡®çŸ¥é“å½“å‰ this æŒ‡å‘</p><p>å…¶å®ƒæƒ…å†µä½¿ç”¨ç®­å¤´å‡½æ•°ã€‚</p><h2 id="ä»€ä¹ˆæ—¶å€™ä¸èƒ½ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ"><a href="#ä»€ä¹ˆæ—¶å€™ä¸èƒ½ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ä¸èƒ½ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ"></a>ä»€ä¹ˆæ—¶å€™ä¸èƒ½ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Ÿ</h2><h3 id="å®šä¹‰å¯¹è±¡æ–¹æ³•"><a href="#å®šä¹‰å¯¹è±¡æ–¹æ³•" class="headerlink" title="å®šä¹‰å¯¹è±¡æ–¹æ³•"></a>å®šä¹‰å¯¹è±¡æ–¹æ³•</h3><h4 id="å®šä¹‰å­—é¢é‡çš„æ–¹æ³•"><a href="#å®šä¹‰å­—é¢é‡çš„æ–¹æ³•" class="headerlink" title="å®šä¹‰å­—é¢é‡çš„æ–¹æ³•"></a>å®šä¹‰å­—é¢é‡çš„æ–¹æ³•</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> calculator = &#123;</span><br><span class="line">    array: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">    sum: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span> === <span class="built_in">window</span>); <span class="comment">// =&gt; true</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.array.reduce(<span class="function">(<span class="params">result, item</span>) =&gt;</span> result + item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">this</span> === <span class="built_in">window</span>); <span class="comment">// =&gt; true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Throws "TypeError: Cannot read property 'reduce' of undefined"</span></span><br><span class="line">calculator.sum();</span><br></pre></td></tr></table></figure><p>calculator.sum ä½¿ç”¨ç®­å¤´å‡½æ•°æ¥å®šä¹‰ï¼Œä½†æ˜¯è°ƒç”¨çš„æ—¶å€™ä¼šæŠ›å‡º TypeErrorï¼Œå› ä¸ºè¿è¡Œæ—¶ this.array æ˜¯æœªå®šä¹‰çš„ï¼Œè°ƒç”¨ calculator.sum çš„æ—¶å€™ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡é‡Œé¢çš„ this ä»ç„¶æŒ‡å‘çš„æ˜¯ windowï¼ŒåŸå› æ˜¯ç®­å¤´å‡½æ•°æŠŠå‡½æ•°ä¸Šä¸‹æ–‡ç»‘å®šåˆ°äº† window ä¸Šï¼Œthis.array ç­‰ä»·äº window.arrayï¼Œæ˜¾ç„¶åè€…æ˜¯æœªå®šä¹‰çš„ã€‚</p><p><strong>è§£å†³çš„åŠæ³•</strong>æ˜¯ï¼Œä½¿ç”¨å‡½æ•°è¡¨è¾¾å¼æˆ–è€…æ–¹æ³•ç®€å†™ï¼ˆES6 ä¸­å·²ç»æ”¯æŒï¼‰æ¥å®šä¹‰æ–¹æ³•ï¼Œè¿™æ ·èƒ½ç¡®ä¿ this æ˜¯åœ¨è¿è¡Œæ—¶æ˜¯ç”±åŒ…å«å®ƒçš„ä¸Šä¸‹æ–‡å†³å®šçš„ï¼Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> calculator = &#123;</span><br><span class="line">    array: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">    sum() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span> === calculator); <span class="comment">// =&gt; true</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.array.reduce(<span class="function">(<span class="params">result, item</span>) =&gt;</span> result + item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">calculator.sum(); <span class="comment">// =&gt; 6</span></span><br></pre></td></tr></table></figure><h4 id="å®šä¹‰åŸå‹æ–¹æ³•"><a href="#å®šä¹‰åŸå‹æ–¹æ³•" class="headerlink" title="å®šä¹‰åŸå‹æ–¹æ³•"></a>å®šä¹‰åŸå‹æ–¹æ³•</h4><p>åŒæ ·çš„è§„åˆ™é€‚ç”¨äºåŸå‹æ–¹æ³•ï¼ˆprototype methodï¼‰çš„å®šä¹‰ï¼Œä½¿ç”¨ç®­å¤´å‡½æ•°ä¼šå¯¼è‡´è¿è¡Œæ—¶çš„æ‰§è¡Œä¸Šä¸‹æ–‡é”™è¯¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Cat</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Cat.prototype.sayCatName = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span> === <span class="built_in">window</span>); <span class="comment">// =&gt; true</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cat = <span class="keyword">new</span> Cat(<span class="string">'Mew'</span>);</span><br><span class="line">cat.sayCatName(); <span class="comment">// =&gt; undefined</span></span><br></pre></td></tr></table></figure><p><strong>è§£å†³æ–¹æ³•</strong>:ä½¿ç”¨ä¼ ç»Ÿçš„å‡½æ•°è¡¨è¾¾å¼å°±èƒ½è§£å†³é—®é¢˜</p><h3 id="å®šä¹‰äº‹ä»¶å›è°ƒå‡½æ•°"><a href="#å®šä¹‰äº‹ä»¶å›è°ƒå‡½æ•°" class="headerlink" title="å®šä¹‰äº‹ä»¶å›è°ƒå‡½æ•°"></a>å®šä¹‰äº‹ä»¶å›è°ƒå‡½æ•°</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> button = <span class="built_in">document</span>.getElementById(<span class="string">'myButton'</span>);</span><br><span class="line">button.addEventListener(<span class="string">'click'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span> === <span class="built_in">window</span>); <span class="comment">// =&gt; true</span></span><br><span class="line">    <span class="keyword">this</span>.innerHTML = <span class="string">'Clicked button'</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>åœ¨å…¨å±€ä¸Šä¸‹æ–‡ä¸‹å®šä¹‰çš„ç®­å¤´å‡½æ•°æ‰§è¡Œæ—¶ this ä¼šæŒ‡å‘ windowï¼Œå½“å•å‡»äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæµè§ˆå™¨ä¼šå°è¯•ç”¨ button ä½œä¸ºä¸Šä¸‹æ–‡æ¥æ‰§è¡Œäº‹ä»¶å›è°ƒå‡½æ•°ï¼Œä½†æ˜¯ç®­å¤´å‡½æ•°é¢„å®šä¹‰çš„ä¸Šä¸‹æ–‡æ˜¯ä¸èƒ½è¢«ä¿®æ”¹çš„ï¼Œè¿™æ · this.innerHTML å°±ç­‰ä»·äº window.innerHTMLï¼Œè€Œåè€…æ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„ã€‚</p><p><strong>è§£å†³æ–¹æ³•</strong>:ä½¿ç”¨ä¼ ç»Ÿçš„å‡½æ•°è¡¨è¾¾å¼å°±èƒ½è§£å†³é—®é¢˜</p><h3 id="å®šä¹‰æ„é€ å‡½æ•°"><a href="#å®šä¹‰æ„é€ å‡½æ•°" class="headerlink" title="å®šä¹‰æ„é€ å‡½æ•°"></a>å®šä¹‰æ„é€ å‡½æ•°</h3><p>æ„é€ å‡½æ•°ä¸­çš„ this æŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œå½“æ‰§è¡Œ new Car() çš„æ—¶å€™ï¼Œæ„é€ å‡½æ•° Car çš„ä¸Šä¸‹æ–‡å°±æ˜¯æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ this instanceof Car === trueã€‚æ˜¾ç„¶ï¼Œç®­å¤´å‡½æ•°æ˜¯ä¸èƒ½ç”¨æ¥åšæ„é€ å‡½æ•°ï¼Œ å®é™…ä¸Š JS ä¼šç¦æ­¢ä½ è¿™ä¹ˆåšï¼Œå¦‚æœä½ è¿™ä¹ˆåšäº†ï¼Œå®ƒå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Message = <span class="function">(<span class="params">text</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.text = text;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// Throws "TypeError: Message is not a constructor"</span></span><br><span class="line"><span class="keyword">const</span> helloMessage = <span class="keyword">new</span> Message(<span class="string">'Hello World!'</span>);</span><br></pre></td></tr></table></figure><h3 id="è¿½æ±‚è¿‡çŸ­çš„ä»£ç "><a href="#è¿½æ±‚è¿‡çŸ­çš„ä»£ç " class="headerlink" title="è¿½æ±‚è¿‡çŸ­çš„ä»£ç "></a>è¿½æ±‚è¿‡çŸ­çš„ä»£ç </h3><p>åœ¨ä»£ç å¯è¯»æ€§æ–¹é¢ï¼Œæœ€çŸ­çš„ä»£ç å¯èƒ½å¹¶ä¸æ€»æ˜¯æœ€å¥½çš„ã€‚ä¸€å®šç¨‹åº¦ä¸Šï¼Œå‹ç¼©äº†å¤ªå¤šé€»è¾‘çš„ç®€çŸ­ä»£ç ï¼Œé˜…è¯»èµ·æ¥å°±æ²¡æœ‰é‚£ä¹ˆç›´è§‚ï¼Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> multiply = <span class="function">(<span class="params">a, b</span>) =&gt;</span> b === <span class="literal">undefined</span> ? <span class="function"><span class="params">b</span> =&gt;</span> a * b : a * b;</span><br><span class="line"><span class="keyword">const</span> double = multiply(<span class="number">2</span>);</span><br><span class="line">double(<span class="number">3</span>);      <span class="comment">// =&gt; 6</span></span><br><span class="line">multiply(<span class="number">2</span>, <span class="number">3</span>); <span class="comment">// =&gt; 6</span></span><br></pre></td></tr></table></figure><p>multiply å‡½æ•°ä¼šè¿”å›ä¸¤ä¸ªæ•°å­—çš„ä¹˜ç§¯æˆ–è€…è¿”å›ä¸€ä¸ªå¯ä»¥ç»§ç»­è°ƒç”¨çš„å›ºå®šäº†ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ã€‚ä»£ç çœ‹èµ·æ¥å¾ˆç®€çŸ­ï¼Œä½†å¤§å¤šæ•°äººç¬¬ä¸€çœ¼çœ‹ä¸Šå»å¯èƒ½æ— æ³•ç«‹å³ææ¸…æ¥šå®ƒå¹²äº†ä»€ä¹ˆï¼Œæ€ä¹ˆè®©è¿™æ®µä»£ç å¯è¯»æ€§æ›´é«˜å‘¢ï¼Ÿæœ‰å¾ˆå¤šåŠæ³•ï¼Œå¯ä»¥åœ¨ç®­å¤´å‡½æ•°ä¸­åŠ ä¸Šæ‹¬å·ã€æ¡ä»¶åˆ¤æ–­ã€è¿”å›è¯­å¥ï¼Œæˆ–è€…</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">multiply</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">b</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> a * b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a * b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> double = multiply(<span class="number">2</span>);</span><br><span class="line">double(<span class="number">3</span>); <span class="comment">// =&gt; 6</span></span><br><span class="line">multiply(<span class="number">2</span>, <span class="number">3</span>); <span class="comment">// =&gt; 6</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ç®€è¨€&quot;&gt;&lt;a href=&quot;#ç®€è¨€&quot; class=&quot;headerlink&quot; title=&quot;ç®€è¨€&quot;&gt;&lt;/a&gt;ç®€è¨€&lt;/h1&gt;&lt;p&gt;ES6çš„ç®­å¤´å‡½æ•°ï¼Œæˆ‘ä»¬ä¼šåœ¨å·¥ä½œä¸­ç»å¸¸çŸ¥é“ï¼Œä½†æ˜¯ä½ çŸ¥é“ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œä»€ä¹ˆæ—¶å€™ä¸èƒ½ä½¿ç”¨ç®­å¤´å‡½æ•°å—ï¼Ÿ&lt;/p&gt;
&lt;h2 id=&quot;ä»€ä¹ˆæ—¶å€™ä½¿ç”¨
      
    
    </summary>
    
      <category term="Js" scheme="https://zhanghao-web.github.io/categories/Js/"/>
    
    
      <category term="ES6" scheme="https://zhanghao-web.github.io/tags/ES6/"/>
    
  </entry>
  
  <entry>
    <title>ä½ ä¸çŸ¥é“çš„ JSON.stringify() çš„å¨åŠ›</title>
    <link href="https://zhanghao-web.github.io/2019/12/12/Js/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84-JSON-stringify-%E7%9A%84%E5%A8%81%E5%8A%9B/"/>
    <id>https://zhanghao-web.github.io/2019/12/12/Js/ä½ ä¸çŸ¥é“çš„-JSON-stringify-çš„å¨åŠ›/</id>
    <published>2019-12-12T08:17:03.000Z</published>
    <updated>2020-01-28T10:04:15.036Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://juejin.im/post/5decf09de51d45584d238319#heading-4" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a></p><h2 id="é€šè¿‡éœ€æ±‚å­¦ä¹ JSON-stringify"><a href="#é€šè¿‡éœ€æ±‚å­¦ä¹ JSON-stringify" class="headerlink" title="é€šè¿‡éœ€æ±‚å­¦ä¹ JSON.stringify()"></a>é€šè¿‡éœ€æ±‚å­¦ä¹ JSON.stringify()</h2><p>é¦–å…ˆæˆ‘ä»¬åœ¨å¼€å‘çš„è¿‡ç¨‹å½“ä¸­é‡åˆ°è¿™æ ·ä¸€ä¸ªå¤„ç†æ•°æ®çš„éœ€æ±‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> todayILearn = &#123;</span><br><span class="line">  _id: <span class="number">1</span>,</span><br><span class="line">  content: <span class="string">'ä»Šå¤©å­¦ä¹  JSON.stringify()ï¼Œæˆ‘å¾ˆå¼€å¿ƒï¼'</span>,</span><br><span class="line">  created_at: <span class="string">'Mon Nov 25 2019 14:03:55 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)'</span>,</span><br><span class="line">  updated_at: <span class="string">'Mon Nov 25 2019 16:03:55 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦å°†ä¸Šé¢è¿™ä¸ªå¯¹è±¡å¤„ç†æˆä¸‹é¢è¿™ä¸ªå¯¹è±¡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> todayILearn = &#123;</span><br><span class="line">  id: <span class="number">1</span>,</span><br><span class="line">  content: <span class="string">'ä»Šå¤©å­¦ä¹  JSON.stringify()ï¼Œæˆ‘å¾ˆå¼€å¿ƒï¼'</span>,</span><br><span class="line">  createdAt: <span class="string">'Mon Nov 25 2019 14:03:55 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)'</span>,</span><br><span class="line">  updatedAt: <span class="string">'Mon Nov 25 2019 16:03:55 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯åœ¨ä¸æ”¹å˜å±æ€§çš„å€¼çš„å‰æä¸‹ï¼Œå°†å¯¹è±¡å±æ€§ä¿®æ”¹ä¸€ä¸‹ã€‚ æŠŠ_id  æ”¹æˆ idï¼ŒæŠŠ updated_at æ”¹æˆ updatedAtï¼ŒæŠŠ created_at æ”¹æˆ createdAtã€‚æˆ‘ä»¬ç°åœ¨é€šè¿‡è¿™ä¸ªå°å°çš„éœ€æ±‚æ¥è§è¯†ä¸€ä¸‹ JSON.stringify() çš„å¼ºå¤§å§ã€‚</p><p>é¦–å…ˆè¦è§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ä»¬æœ‰å¾ˆå¤šç§è§£å†³æ–¹å¼ï¼Œæˆ‘ä»¬å…ˆæä¾›ä¸¤ç§ä¸ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼š</p><p><strong>æ–¹æ¡ˆä¸€ï¼šä¸€æ¬¡éå†+å¤šå£°æ˜ä¸€ä¸ªå˜é‡</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤šä¸€ä¸ªå˜é‡å­˜å‚¨</span></span><br><span class="line"><span class="keyword">const</span> todayILearnTemp = &#123;&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [key, value] <span class="keyword">of</span> <span class="built_in">Object</span>.entries(todayILearn)) &#123;</span><br><span class="line">  <span class="keyword">if</span> (key === <span class="string">"_id"</span>) todayILearnTemp[<span class="string">"id"</span>] = value;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (key === <span class="string">"created_at"</span>) todayILearnTemp[<span class="string">"createdAt"</span>] = value;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (key === <span class="string">"updatedAt"</span>) todayILearnTemp[<span class="string">"updatedAt"</span>] = value;</span><br><span class="line">  <span class="keyword">else</span> todayILearnTemp[key] = value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(todayILearnTemp);</span><br><span class="line"><span class="comment">// ç»“æœï¼š</span></span><br><span class="line"><span class="comment">// &#123; id: 1,</span></span><br><span class="line"><span class="comment">//  content: 'ä»Šå¤©å­¦ä¹  JSON.stringify()ï¼Œæˆ‘å¾ˆå¼€å¿ƒï¼',</span></span><br><span class="line"><span class="comment">//  createdAt: 'Mon Nov 25 2019 14:03:55 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)',</span></span><br><span class="line"><span class="comment">//  updated_at: 'Mon Nov 25 2019 16:03:55 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)' </span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure><p>æ–¹æ¡ˆä¸€å®Œå…¨æ²¡æœ‰é—®é¢˜ï¼Œå¯ä»¥å®ç°ã€‚ä½†æ˜¯å¤šå£°æ˜äº†ä¸€ä¸ªå˜é‡åˆåŠ ä¸Šä¸€å±‚å¾ªç¯å¹¶ä¸”è¿˜æœ‰å¾ˆå¤šçš„ if else è¯­å¥ï¼Œæ€ä¹ˆéƒ½æ˜¾å¾—ä¸å¤ªä¼˜é›…ã€‚</p><p><strong>æ–¹æ¡ˆäºŒï¼šæš´åŠ› delete å±æ€§å’Œå¢åŠ å±æ€§</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æè‡´çš„æš´åŠ›ç¾å­¦</span></span><br><span class="line">todayILearn.id = todayILearn._id;</span><br><span class="line">todayILearn.createdAt = todayILearn.created_at;</span><br><span class="line">todayILearn.updatedAt = todayILearn.updated_at;</span><br><span class="line"><span class="keyword">delete</span> todayILearn._id;</span><br><span class="line"><span class="keyword">delete</span> todayILearn.created_at;</span><br><span class="line"><span class="keyword">delete</span> todayILearn.updated_at;</span><br><span class="line"><span class="built_in">console</span>.log(todayILearn);</span><br><span class="line"><span class="comment">// å¤ªæš´åŠ›ğŸ˜¢</span></span><br><span class="line"><span class="comment">//&#123; </span></span><br><span class="line"><span class="comment">//  content: 'ä»Šå¤©å­¦ä¹  JSON.stringify()ï¼Œæˆ‘å¾ˆå¼€å¿ƒï¼',</span></span><br><span class="line"><span class="comment">//  id: 1,</span></span><br><span class="line"><span class="comment">//  createdAt: 'Mon Nov 25 2019 14:03:55 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)',</span></span><br><span class="line"><span class="comment">//  updatedAt: 'Mon Nov 25 2019 16:03:55 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)' </span></span><br><span class="line"><span class="comment">//&#125;</span></span><br></pre></td></tr></table></figure><p>ç›´æ¥ delete æš´åŠ›è§£å†³å¤ªç²—é²äº†ï¼Œè€Œä¸”æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå±æ€§çš„é¡ºåºå˜äº†ã€‚</p><p><strong>æ–¹æ¡ˆä¸‰ï¼šåºåˆ—åŒ–+ replace ç¾å­¦å…¸èŒƒ</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapObj = &#123;</span><br><span class="line">  _id: <span class="string">"id"</span>,</span><br><span class="line">  created_at: <span class="string">"createdAt"</span>,</span><br><span class="line">  updated_at: <span class="string">"updatedAt"</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">JSON</span>.parse(</span><br><span class="line">  <span class="built_in">JSON</span>.stringify(todayILearn).replace(</span><br><span class="line">    /_id|created_at|updated_at/gi,</span><br><span class="line">    matched =&gt; mapObj[matched])</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#123; </span></span><br><span class="line"><span class="comment">// id: 1,</span></span><br><span class="line"><span class="comment">//  content: 'ä»Šå¤©å­¦ä¹  JSON.stringify()ï¼Œæˆ‘å¾ˆå¼€å¿ƒï¼',</span></span><br><span class="line"><span class="comment">//  createdAt: 'Mon Nov 25 2019 14:03:55 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)',</span></span><br><span class="line"><span class="comment">//  updatedAt: 'Mon Nov 25 2019 16:03:55 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)' </span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure><p><img src="https://user-gold-cdn.xitu.io/2019/12/8/16ee5ace18ca5dbb?imageslim" alt="Json.Stringify"></p><a id="more"></a><h2 id="JSON-stringify-ä¹å¤§ç‰¹æ€§"><a href="#JSON-stringify-ä¹å¤§ç‰¹æ€§" class="headerlink" title="JSON.stringify() ä¹å¤§ç‰¹æ€§"></a>JSON.stringify() ä¹å¤§ç‰¹æ€§</h2><h3 id="JSON-stringify-ç¬¬ä¸€å¤§ç‰¹æ€§"><a href="#JSON-stringify-ç¬¬ä¸€å¤§ç‰¹æ€§" class="headerlink" title="JSON.stringify()ç¬¬ä¸€å¤§ç‰¹æ€§"></a>JSON.stringify()ç¬¬ä¸€å¤§ç‰¹æ€§</h3><p><strong>å¯¹äº undefinedã€ä»»æ„çš„å‡½æ•°ä»¥åŠ symbol ä¸‰ä¸ªç‰¹æ®Šçš„å€¼åˆ†åˆ«ä½œä¸ºå¯¹è±¡å±æ€§çš„å€¼ã€æ•°ç»„å…ƒç´ ã€å•ç‹¬çš„å€¼æ—¶ JSON.stringify()å°†è¿”å›ä¸åŒçš„ç»“æœ</strong>ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥å¤ä¹ ä¸€ä¸‹çŸ¥è¯†ç‚¹ï¼Œçœ‹ä¸€é“éå¸¸ç®€å•çš„é¢è¯•é¢˜ç›®ï¼šè¯·é—®ä¸‹é¢ä»£ç ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">  a: <span class="string">"aaa"</span>,</span><br><span class="line">  b: <span class="literal">undefined</span>,</span><br><span class="line">  c: <span class="built_in">Symbol</span>(<span class="string">"dd"</span>),</span><br><span class="line">  fn: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">JSON</span>.stringify(data); <span class="comment">// è¾“å‡ºï¼šï¼Ÿ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// "&#123;"a":"aaa"&#125;"</span></span><br></pre></td></tr></table></figure><p>å¾ˆç®€å•è¿™é“é¢˜ç›®é¢è¯•å®˜ä¸»è¦è€ƒå¯Ÿçš„çŸ¥è¯†ç‚¹æ˜¯ï¼š</p><ul><li>undefinedã€ä»»æ„çš„å‡½æ•°ä»¥åŠ symbol ä½œä¸ºå¯¹è±¡å±æ€§å€¼æ—¶ JSON.stringify() å°†è·³è¿‡ï¼ˆå¿½ç•¥ï¼‰å¯¹å®ƒä»¬è¿›è¡Œåºåˆ—åŒ–</li></ul><p>é¢è¯•å®˜è¿½é—®ï¼šå‡è®¾ undefinedã€ä»»æ„çš„å‡½æ•°ä»¥åŠ symbol å€¼ä½œä¸ºæ•°ç»„å…ƒç´ ä¼šæ˜¯æ€æ ·å‘¢ï¼Ÿ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.stringify([<span class="string">"aaa"</span>, <span class="literal">undefined</span>, <span class="function"><span class="keyword">function</span> <span class="title">aa</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;, <span class="built_in">Symbol</span>(<span class="string">'dd'</span>)])  <span class="comment">// è¾“å‡ºï¼šï¼Ÿ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// "["aaa",null,null,null]"</span></span><br></pre></td></tr></table></figure><p>çŸ¥è¯†ç‚¹æ˜¯ï¼š</p><ul><li>undefinedã€ä»»æ„çš„å‡½æ•°ä»¥åŠ symbol ä½œä¸ºæ•°ç»„å…ƒç´ å€¼æ—¶ï¼ŒJSON.stringify() ä¼šå°†å®ƒä»¬åºåˆ—åŒ–ä¸º null</li></ul><p>æˆ‘ä»¬ç¨å¾®å†åŠ¨ä¸‹è„‘ç­‹ï¼Œå¦‚æœå•ç‹¬åºåˆ—åŒ–è¿™äº›å€¼ä¼šæ˜¯ä»€ä¹ˆæ ·çš„ç»“æœå‘¢ï¼Ÿ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.stringify(<span class="function"><span class="keyword">function</span> <span class="title">a</span> (<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">'a'</span>)&#125;)</span><br><span class="line"><span class="comment">// undefined</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify(<span class="literal">undefined</span>)</span><br><span class="line"><span class="comment">// undefined</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify(<span class="built_in">Symbol</span>(<span class="string">'dd'</span>))</span><br><span class="line"><span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><p>å•ç‹¬è½¬æ¢çš„ç»“æœå°±æ˜¯ï¼š</p><p>undefinedã€ä»»æ„çš„å‡½æ•°ä»¥åŠ symbol è¢« JSON.stringify() ä½œä¸ºå•ç‹¬çš„å€¼è¿›è¡Œåºåˆ—åŒ–æ—¶éƒ½ä¼šè¿”å› undefined</p><blockquote><p>JSON.stringify() ç¬¬ä¸€å¤§ç‰¹æ€§æ€»ç»“<br>undefinedã€ä»»æ„çš„å‡½æ•°ä»¥åŠ symbol ä½œä¸ºå¯¹è±¡å±æ€§å€¼æ—¶ JSON.stringify() å¯¹è·³è¿‡ï¼ˆå¿½ç•¥ï¼‰å®ƒä»¬è¿›è¡Œåºåˆ—åŒ–<br>undefinedã€ä»»æ„çš„å‡½æ•°ä»¥åŠ symbol ä½œä¸ºæ•°ç»„å…ƒç´ å€¼æ—¶ï¼ŒJSON.stringify() å°†ä¼šå°†å®ƒä»¬åºåˆ—åŒ–ä¸º null<br>undefinedã€ä»»æ„çš„å‡½æ•°ä»¥åŠ symbol è¢« JSON.stringify() ä½œä¸ºå•ç‹¬çš„å€¼è¿›è¡Œåºåˆ—åŒ–æ—¶ï¼Œéƒ½ä¼šè¿”å› undefined</p></blockquote><h3 id="JSON-stringify-ç¬¬äºŒå¤§ç‰¹æ€§"><a href="#JSON-stringify-ç¬¬äºŒå¤§ç‰¹æ€§" class="headerlink" title="JSON.stringify() ç¬¬äºŒå¤§ç‰¹æ€§"></a>JSON.stringify() ç¬¬äºŒå¤§ç‰¹æ€§</h3><p><strong>éæ•°ç»„å¯¹è±¡çš„å±æ€§ä¸èƒ½ä¿è¯ä»¥ç‰¹å®šçš„é¡ºåºå‡ºç°åœ¨åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ä¸­ã€‚</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">  a: <span class="string">"aaa"</span>,</span><br><span class="line">  b: <span class="literal">undefined</span>,</span><br><span class="line">  c: <span class="built_in">Symbol</span>(<span class="string">"dd"</span>),</span><br><span class="line">  fn: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  d: <span class="string">"ddd"</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">JSON</span>.stringify(data); <span class="comment">// è¾“å‡ºï¼šï¼Ÿ</span></span><br><span class="line"><span class="comment">// "&#123;"a":"aaa","d":"ddd"&#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">JSON</span>.stringify([<span class="string">"aaa"</span>, <span class="literal">undefined</span>, <span class="function"><span class="keyword">function</span> <span class="title">aa</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;, <span class="built_in">Symbol</span>(<span class="string">'dd'</span>),<span class="string">"eee"</span>])  <span class="comment">// è¾“å‡ºï¼šï¼Ÿ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// "["aaa",null,null,null,"eee"]"</span></span><br></pre></td></tr></table></figure><p>æ­£å¦‚æˆ‘ä»¬åœ¨ç¬¬ä¸€ç‰¹æ€§æ‰€è¯´ï¼ŒJSON.stringify() åºåˆ—åŒ–æ—¶<strong>ä¼šå¿½ç•¥ä¸€äº›ç‰¹æ®Šçš„å€¼</strong>ï¼Œæ‰€ä»¥ä¸èƒ½ä¿è¯åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²è¿˜æ˜¯ä»¥ç‰¹å®šçš„é¡ºåºå‡ºç°ï¼ˆæ•°ç»„é™¤å¤–ï¼‰ã€‚</p><h3 id="JSON-stringify-ç¬¬ä¸‰å¤§ç‰¹æ€§"><a href="#JSON-stringify-ç¬¬ä¸‰å¤§ç‰¹æ€§" class="headerlink" title="JSON.stringify() ç¬¬ä¸‰å¤§ç‰¹æ€§"></a>JSON.stringify() ç¬¬ä¸‰å¤§ç‰¹æ€§</h3><ul><li>è½¬æ¢å€¼å¦‚æœ<strong>æœ‰ toJSON() å‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›ä»€ä¹ˆå€¼ï¼Œåºåˆ—åŒ–ç»“æœå°±æ˜¯ä»€ä¹ˆå€¼ï¼Œå¹¶ä¸”å¿½ç•¥å…¶ä»–å±æ€§çš„å€¼</strong>ã€‚</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">    say: <span class="string">"hello JSON.stringify"</span>,</span><br><span class="line">    toJSON: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"today i learn"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"><span class="comment">// "today i learn"</span></span><br></pre></td></tr></table></figure><h3 id="JSON-stringify-ç¬¬å››å¤§ç‰¹æ€§"><a href="#JSON-stringify-ç¬¬å››å¤§ç‰¹æ€§" class="headerlink" title="JSON.stringify()ç¬¬å››å¤§ç‰¹æ€§"></a>JSON.stringify()ç¬¬å››å¤§ç‰¹æ€§</h3><p>JSON.stringify() å°†ä¼š<strong>æ­£å¸¸åºåˆ—åŒ– Date</strong> çš„å€¼ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.stringify(&#123; <span class="attr">now</span>: <span class="keyword">new</span> <span class="built_in">Date</span>() &#125;);</span><br><span class="line"><span class="comment">// "&#123;"now":"2019-12-08T07:42:11.973Z"&#125;"</span></span><br></pre></td></tr></table></figure><p>å®é™…ä¸Š Date å¯¹è±¡è‡ªå·±éƒ¨ç½²äº† toJSON() æ–¹æ³•ï¼ˆåŒDate.toISOString()ï¼‰ï¼Œå› æ­¤ Date å¯¹è±¡ä¼šè¢«å½“åšå­—ç¬¦ä¸²å¤„ç†ã€‚</p><h3 id="JSON-stringify-ç¬¬äº”å¤§ç‰¹æ€§"><a href="#JSON-stringify-ç¬¬äº”å¤§ç‰¹æ€§" class="headerlink" title="JSON.stringify() ç¬¬äº”å¤§ç‰¹æ€§"></a>JSON.stringify() ç¬¬äº”å¤§ç‰¹æ€§</h3><p><strong>NaN å’Œ Infinity æ ¼å¼çš„æ•°å€¼åŠ null éƒ½ä¼šè¢«å½“åš nullã€‚</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.stringify(<span class="literal">NaN</span>)</span><br><span class="line"><span class="comment">// "null"</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify(<span class="literal">null</span>)</span><br><span class="line"><span class="comment">// "null"</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify(<span class="literal">Infinity</span>)</span><br><span class="line"><span class="comment">// "null"</span></span><br></pre></td></tr></table></figure><h3 id="JSON-stringify-ç¬¬å…­å¤§ç‰¹æ€§"><a href="#JSON-stringify-ç¬¬å…­å¤§ç‰¹æ€§" class="headerlink" title="JSON.stringify() ç¬¬å…­å¤§ç‰¹æ€§"></a>JSON.stringify() ç¬¬å…­å¤§ç‰¹æ€§</h3><p><strong>å¸ƒå°”å€¼ã€æ•°å­—ã€å­—ç¬¦ä¸²çš„åŒ…è£…å¯¹è±¡åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨è½¬æ¢æˆå¯¹åº”çš„åŸå§‹å€¼ã€‚</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.stringify([<span class="keyword">new</span> <span class="built_in">Number</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">"false"</span>), <span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">false</span>)]);</span><br><span class="line"><span class="comment">// "[1,"false",false]"</span></span><br></pre></td></tr></table></figure><h3 id="JSON-stringify-ç¬¬ä¸ƒå¤§ç‰¹æ€§"><a href="#JSON-stringify-ç¬¬ä¸ƒå¤§ç‰¹æ€§" class="headerlink" title="JSON.stringify() ç¬¬ä¸ƒå¤§ç‰¹æ€§"></a>JSON.stringify() ç¬¬ä¸ƒå¤§ç‰¹æ€§</h3><p>å…³äºå¯¹è±¡å±æ€§çš„æ˜¯å¦å¯æšä¸¾ï¼š</p><p><strong>å…¶ä»–ç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬ Map/Set/WeakMap/WeakSetï¼Œä»…ä¼šåºåˆ—åŒ–å¯æšä¸¾çš„å±æ€§ã€‚</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸å¯æšä¸¾çš„å±æ€§é»˜è®¤ä¼šè¢«å¿½ç•¥ï¼š</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify( </span><br><span class="line">    <span class="built_in">Object</span>.create(</span><br><span class="line">        <span class="literal">null</span>, </span><br><span class="line">        &#123; </span><br><span class="line">            x: &#123; <span class="attr">value</span>: <span class="string">'json'</span>, <span class="attr">enumerable</span>: <span class="literal">false</span> &#125;, </span><br><span class="line">            y: &#123; <span class="attr">value</span>: <span class="string">'stringify'</span>, <span class="attr">enumerable</span>: <span class="literal">true</span> &#125; </span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">);</span><br><span class="line"><span class="comment">// "&#123;"y":"stringify"&#125;"</span></span><br></pre></td></tr></table></figure><h3 id="JSON-stringify-ç¬¬å…«å¤§ç‰¹æ€§"><a href="#JSON-stringify-ç¬¬å…«å¤§ç‰¹æ€§" class="headerlink" title="JSON.stringify() ç¬¬å…«å¤§ç‰¹æ€§"></a>JSON.stringify() ç¬¬å…«å¤§ç‰¹æ€§</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“å®ç°æ·±æ‹·è´æœ€ç®€å•ç²—æš´çš„æ–¹å¼å°±æ˜¯åºåˆ—åŒ–ï¼š<code>JSON.parse(JSON.stringify())</code>ï¼Œè¿™ä¸ªæ–¹å¼å®ç°æ·±æ‹·è´ä¼šå› ä¸ºåºåˆ—åŒ–çš„è¯¸å¤šç‰¹æ€§ä»è€Œå¯¼è‡´è¯¸å¤šçš„å‘ç‚¹ï¼šæ¯”å¦‚ç°åœ¨æˆ‘ä»¬è¦è¯´çš„å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¹åŒ…å«å¾ªç¯å¼•ç”¨çš„å¯¹è±¡ï¼ˆå¯¹è±¡ä¹‹é—´ç›¸äº’å¼•ç”¨ï¼Œå½¢æˆæ— é™å¾ªç¯ï¼‰æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œä¼šæŠ›å‡ºé”™è¯¯ã€‚ </span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  name: <span class="string">"loopObj"</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> loopObj = &#123;</span><br><span class="line">  obj</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// å¯¹è±¡ä¹‹é—´å½¢æˆå¾ªç¯å¼•ç”¨ï¼Œå½¢æˆé—­ç¯</span></span><br><span class="line">obj.loopObj = loopObj;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°è£…ä¸€ä¸ªæ·±æ‹·è´çš„å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(obj));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰§è¡Œæ·±æ‹·è´ï¼ŒæŠ›å‡ºé”™è¯¯</span></span><br><span class="line">deepClone(obj)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> VM44:9 Uncaught TypeError: Converting circular structure to JSON</span></span><br><span class="line"><span class="comment">    --&gt; starting at object with constructor 'Object'</span></span><br><span class="line"><span class="comment">    |     property 'loopObj' -&gt; object with constructor 'Object'</span></span><br><span class="line"><span class="comment">    --- property 'obj' closes the circle</span></span><br><span class="line"><span class="comment">    at JSON.stringify (&lt;anonymous&gt;)</span></span><br><span class="line"><span class="comment">    at deepClone (&lt;anonymous&gt;:9:26)</span></span><br><span class="line"><span class="comment">    at &lt;anonymous&gt;:11:13</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><ul><li>å¯¹åŒ…å«å¾ªç¯å¼•ç”¨çš„å¯¹è±¡ï¼ˆå¯¹è±¡ä¹‹é—´ç›¸äº’å¼•ç”¨ï¼Œå½¢æˆæ— é™å¾ªç¯ï¼‰æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œä¼šæŠ›å‡ºé”™è¯¯ã€‚</li></ul><p>è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆç”¨åºåˆ—åŒ–å»å®ç°æ·±æ‹·è´æ—¶ï¼Œé‡åˆ°å¾ªç¯å¼•ç”¨çš„å¯¹è±¡ä¼šæŠ›å‡ºé”™è¯¯çš„åŸå› </p><h3 id="JSON-stringify-ç¬¬ä¹å¤§ç‰¹æ€§"><a href="#JSON-stringify-ç¬¬ä¹å¤§ç‰¹æ€§" class="headerlink" title="JSON.stringify() ç¬¬ä¹å¤§ç‰¹æ€§"></a>JSON.stringify() ç¬¬ä¹å¤§ç‰¹æ€§</h3><p><strong>æ‰€æœ‰ä»¥ symbol ä¸ºå±æ€§é”®çš„å±æ€§éƒ½ä¼šè¢«å®Œå…¨å¿½ç•¥æ‰ï¼Œå³ä¾¿ replacer å‚æ•°ä¸­å¼ºåˆ¶æŒ‡å®šåŒ…å«äº†å®ƒä»¬ã€‚</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.stringify(&#123; [<span class="built_in">Symbol</span>.for(<span class="string">"json"</span>)]: <span class="string">"stringify"</span> &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">k, v</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> k === <span class="string">"symbol"</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> v;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><p><code>replacer</code> æ˜¯ <code>JSON.stringify()</code> çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œæˆ‘ä»¬æ¯”è¾ƒå°‘ç”¨åˆ°ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¼šå¿˜è®° <code>JSON.stringify()</code> ç¬¬äºŒä¸ªã€ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œåœºæ™¯ä¸å¤šï¼Œä½†æ˜¯ç”¨çš„å¥½çš„è¯ä¼šéå¸¸æ–¹ä¾¿ï¼Œå…³äº <code>JSON.stringify()</code> ç¬¬ä¹å¤§ç‰¹æ€§çš„ä¾‹å­ä¸­å¯¹ replacer å‚æ•°ä¸æ˜ç™½çš„åŒå­¦å…ˆåˆ«æ€¥ï¼Œå…¶å®å¾ˆç®€å•ï¼Œæˆ‘ä»¬é©¬ä¸Šå°±ä¼šåœ¨ä¸‹é¢çš„å­¦ä¹ ä¸­å¼„æ‡‚ã€‚</p><h2 id="ç¬¬äºŒä¸ªå‚æ•°å’Œç¬¬ä¸‰ä¸ªå‚æ•°"><a href="#ç¬¬äºŒä¸ªå‚æ•°å’Œç¬¬ä¸‰ä¸ªå‚æ•°" class="headerlink" title="ç¬¬äºŒä¸ªå‚æ•°å’Œç¬¬ä¸‰ä¸ªå‚æ•°"></a>ç¬¬äºŒä¸ªå‚æ•°å’Œç¬¬ä¸‰ä¸ªå‚æ•°</h2><p>JSON.stringify() ç¬¬äºŒä¸ªå‚æ•°å’Œç¬¬ä¸‰ä¸ªå‚æ•°</p><h3 id="å¼ºå¤§çš„ç¬¬äºŒä¸ªå‚æ•°ï¼š"><a href="#å¼ºå¤§çš„ç¬¬äºŒä¸ªå‚æ•°ï¼š" class="headerlink" title="å¼ºå¤§çš„ç¬¬äºŒä¸ªå‚æ•°ï¼š"></a>å¼ºå¤§çš„ç¬¬äºŒä¸ªå‚æ•°ï¼š</h3><p>ä½œä¸ºå‡½æ•°æ—¶ï¼Œå®ƒæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œé”®ï¼ˆkeyï¼‰å’Œå€¼ï¼ˆvalueï¼‰ï¼Œå‡½æ•°ç±»ä¼¼å°±æ˜¯æ•°ç»„æ–¹æ³• mapã€filter ç­‰æ–¹æ³•çš„å›è°ƒå‡½æ•°ï¼Œå¯¹æ¯ä¸€ä¸ªå±æ€§å€¼éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡è¯¥å‡½æ•°ï¼ˆæœŸé—´æˆ‘ä»¬è¿˜ç®€å•å®ç°è¿‡ä¸€ä¸ª map å‡½æ•°ï¼‰ã€‚<br>å¦‚æœ replacer æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„å€¼ä»£è¡¨å°†è¢«åºåˆ—åŒ–æˆ JSON å­—ç¬¦ä¸²çš„å±æ€§åã€‚</p><h3 id="åä¸½çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼š"><a href="#åä¸½çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼š" class="headerlink" title="åä¸½çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼š"></a>åä¸½çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼š</h3><p>å¦‚æœæ˜¯ä¸€ä¸ªæ•°å­—, åˆ™åœ¨å­—ç¬¦ä¸²åŒ–æ—¶æ¯ä¸€çº§åˆ«ä¼šæ¯”ä¸Šä¸€çº§åˆ«ç¼©è¿›å¤šè¿™ä¸ªæ•°å­—å€¼çš„ç©ºæ ¼ï¼ˆæœ€å¤š10ä¸ªç©ºæ ¼ï¼‰ï¼›</p><p>å¦‚æœæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ™æ¯ä¸€çº§åˆ«ä¼šæ¯”ä¸Šä¸€çº§åˆ«å¤šç¼©è¿›è¯¥å­—ç¬¦ä¸²ï¼ˆæˆ–è¯¥å­—ç¬¦ä¸²çš„å‰10ä¸ªå­—ç¬¦ï¼‰ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://juejin.im/post/5decf09de51d45584d238319#heading-4&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;é€šè¿‡éœ€æ±‚å­¦ä¹ JSON-stringify&quot;&gt;&lt;a href=&quot;#é€šè¿‡éœ€æ±‚å­¦ä¹ JSON-stringify&quot; class=&quot;headerlink&quot; title=&quot;é€šè¿‡éœ€æ±‚å­¦ä¹ JSON.stringify()&quot;&gt;&lt;/a&gt;é€šè¿‡éœ€æ±‚å­¦ä¹ JSON.stringify()&lt;/h2&gt;&lt;p&gt;é¦–å…ˆæˆ‘ä»¬åœ¨å¼€å‘çš„è¿‡ç¨‹å½“ä¸­é‡åˆ°è¿™æ ·ä¸€ä¸ªå¤„ç†æ•°æ®çš„éœ€æ±‚&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; todayILearn = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  _id: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  content: &lt;span class=&quot;string&quot;&gt;&#39;ä»Šå¤©å­¦ä¹  JSON.stringify()ï¼Œæˆ‘å¾ˆå¼€å¿ƒï¼&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  created_at: &lt;span class=&quot;string&quot;&gt;&#39;Mon Nov 25 2019 14:03:55 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  updated_at: &lt;span class=&quot;string&quot;&gt;&#39;Mon Nov 25 2019 16:03:55 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘ä»¬éœ€è¦å°†ä¸Šé¢è¿™ä¸ªå¯¹è±¡å¤„ç†æˆä¸‹é¢è¿™ä¸ªå¯¹è±¡&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; todayILearn = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  id: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  content: &lt;span class=&quot;string&quot;&gt;&#39;ä»Šå¤©å­¦ä¹  JSON.stringify()ï¼Œæˆ‘å¾ˆå¼€å¿ƒï¼&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  createdAt: &lt;span class=&quot;string&quot;&gt;&#39;Mon Nov 25 2019 14:03:55 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  updatedAt: &lt;span class=&quot;string&quot;&gt;&#39;Mon Nov 25 2019 16:03:55 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯åœ¨ä¸æ”¹å˜å±æ€§çš„å€¼çš„å‰æä¸‹ï¼Œå°†å¯¹è±¡å±æ€§ä¿®æ”¹ä¸€ä¸‹ã€‚ æŠŠ_id  æ”¹æˆ idï¼ŒæŠŠ updated_at æ”¹æˆ updatedAtï¼ŒæŠŠ created_at æ”¹æˆ createdAtã€‚æˆ‘ä»¬ç°åœ¨é€šè¿‡è¿™ä¸ªå°å°çš„éœ€æ±‚æ¥è§è¯†ä¸€ä¸‹ JSON.stringify() çš„å¼ºå¤§å§ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆè¦è§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ä»¬æœ‰å¾ˆå¤šç§è§£å†³æ–¹å¼ï¼Œæˆ‘ä»¬å…ˆæä¾›ä¸¤ç§ä¸ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ–¹æ¡ˆä¸€ï¼šä¸€æ¬¡éå†+å¤šå£°æ˜ä¸€ä¸ªå˜é‡&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å¤šä¸€ä¸ªå˜é‡å­˜å‚¨&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; todayILearnTemp = &amp;#123;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; [key, value] &lt;span class=&quot;keyword&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Object&lt;/span&gt;.entries(todayILearn)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (key === &lt;span class=&quot;string&quot;&gt;&quot;_id&quot;&lt;/span&gt;) todayILearnTemp[&lt;span class=&quot;string&quot;&gt;&quot;id&quot;&lt;/span&gt;] = value;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (key === &lt;span class=&quot;string&quot;&gt;&quot;created_at&quot;&lt;/span&gt;) todayILearnTemp[&lt;span class=&quot;string&quot;&gt;&quot;createdAt&quot;&lt;/span&gt;] = value;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (key === &lt;span class=&quot;string&quot;&gt;&quot;updatedAt&quot;&lt;/span&gt;) todayILearnTemp[&lt;span class=&quot;string&quot;&gt;&quot;updatedAt&quot;&lt;/span&gt;] = value;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; todayILearnTemp[key] = value;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(todayILearnTemp);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ç»“æœï¼š&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// &amp;#123; id: 1,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//  content: &#39;ä»Šå¤©å­¦ä¹  JSON.stringify()ï¼Œæˆ‘å¾ˆå¼€å¿ƒï¼&#39;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//  createdAt: &#39;Mon Nov 25 2019 14:03:55 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)&#39;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//  updated_at: &#39;Mon Nov 25 2019 16:03:55 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)&#39; &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// &amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ–¹æ¡ˆä¸€å®Œå…¨æ²¡æœ‰é—®é¢˜ï¼Œå¯ä»¥å®ç°ã€‚ä½†æ˜¯å¤šå£°æ˜äº†ä¸€ä¸ªå˜é‡åˆåŠ ä¸Šä¸€å±‚å¾ªç¯å¹¶ä¸”è¿˜æœ‰å¾ˆå¤šçš„ if else è¯­å¥ï¼Œæ€ä¹ˆéƒ½æ˜¾å¾—ä¸å¤ªä¼˜é›…ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ–¹æ¡ˆäºŒï¼šæš´åŠ› delete å±æ€§å’Œå¢åŠ å±æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// æè‡´çš„æš´åŠ›ç¾å­¦&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;todayILearn.id = todayILearn._id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;todayILearn.createdAt = todayILearn.created_at;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;todayILearn.updatedAt = todayILearn.updated_at;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;delete&lt;/span&gt; todayILearn._id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;delete&lt;/span&gt; todayILearn.created_at;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;delete&lt;/span&gt; todayILearn.updated_at;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(todayILearn);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 	å¤ªæš´åŠ›ğŸ˜¢&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//&amp;#123; &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//  content: &#39;ä»Šå¤©å­¦ä¹  JSON.stringify()ï¼Œæˆ‘å¾ˆå¼€å¿ƒï¼&#39;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//  id: 1,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//  createdAt: &#39;Mon Nov 25 2019 14:03:55 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)&#39;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//  updatedAt: &#39;Mon Nov 25 2019 16:03:55 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)&#39; &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç›´æ¥ delete æš´åŠ›è§£å†³å¤ªç²—é²äº†ï¼Œè€Œä¸”æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå±æ€§çš„é¡ºåºå˜äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ–¹æ¡ˆä¸‰ï¼šåºåˆ—åŒ–+ replace ç¾å­¦å…¸èŒƒ&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; mapObj = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  _id: &lt;span class=&quot;string&quot;&gt;&quot;id&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  created_at: &lt;span class=&quot;string&quot;&gt;&quot;createdAt&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  updated_at: &lt;span class=&quot;string&quot;&gt;&quot;updatedAt&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;JSON&lt;/span&gt;.parse(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;JSON&lt;/span&gt;.stringify(todayILearn).replace(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    /_id|created_at|updated_at/gi,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    matched =&amp;gt; mapObj[matched])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    )&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// &amp;#123; &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// id: 1,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//  content: &#39;ä»Šå¤©å­¦ä¹  JSON.stringify()ï¼Œæˆ‘å¾ˆå¼€å¿ƒï¼&#39;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//  createdAt: &#39;Mon Nov 25 2019 14:03:55 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)&#39;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//  updatedAt: &#39;Mon Nov 25 2019 16:03:55 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)&#39; &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// &amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;https://user-gold-cdn.xitu.io/2019/12/8/16ee5ace18ca5dbb?imageslim&quot; alt=&quot;Json.Stringify&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Js" scheme="https://zhanghao-web.github.io/categories/Js/"/>
    
    
      <category term="Js" scheme="https://zhanghao-web.github.io/tags/Js/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨vueé«˜é˜¶ç»„ä»¶</title>
    <link href="https://zhanghao-web.github.io/2019/11/25/Vue/%E4%BD%BF%E7%94%A8vue%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6/"/>
    <id>https://zhanghao-web.github.io/2019/11/25/Vue/ä½¿ç”¨vueé«˜é˜¶ç»„ä»¶/</id>
    <published>2019-11-25T02:48:54.000Z</published>
    <updated>2020-01-28T10:04:15.071Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰æ–‡"><a href="#å‰æ–‡" class="headerlink" title="å‰æ–‡"></a>å‰æ–‡</h1><p><code>é«˜é˜¶ç»„ä»¶(HOC)</code>æ˜¯ä¸€ç§æ¶æ„æ¨¡å¼ï¼Œåœ¨ React ä¸­éå¸¸å¸¸è§ï¼Œä½†ä¹Ÿå¯ä»¥åœ¨ Vue ä¸­ä½¿ç”¨ã€‚å®ƒå¯ä»¥è¢«æè¿°ä¸ºä¸€ç§<strong>åœ¨ç»„ä»¶ä¹‹é—´å…±äº«å…¬å…±åŠŸèƒ½è€Œä¸éœ€è¦é‡å¤ä»£ç </strong>çš„æ–¹æ³•ã€‚HOC çš„ç›®çš„æ˜¯å¢å¼ºç»„ä»¶çš„åŠŸèƒ½ã€‚å®ƒå…è®¸åœ¨é¡¹ç›®ä¸­å®ç°å¯é‡ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><ul><li>åªè¦ä½ å‘ä¸€ä¸ªæ–¹æ³•ä¼ å…¥ç»„ä»¶ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶ï¼Œè¿™å°±æ˜¯ä¸€ä¸ª HOCã€‚</li></ul><blockquote><p>é«˜é˜¶ç»„ä»¶åœ¨ä»¥ä¸‹æ–¹é¢éå¸¸æœ‰ç”¨: 1.æ“ä½œå±æ€§ã€‚ 2.æ“ä½œæ•°æ®å’Œæ•°æ®æŠ½è±¡ã€‚ 3.ä»£ç é‡ç”¨</p></blockquote><h2 id="é¢„å¤‡çŸ¥è¯†"><a href="#é¢„å¤‡çŸ¥è¯†" class="headerlink" title="é¢„å¤‡çŸ¥è¯†"></a>é¢„å¤‡çŸ¥è¯†</h2><p>åœ¨æˆ‘ä»¬å¼€å§‹æ•™ç¨‹ä¹‹å‰ï¼Œéœ€è¦äº†è§£ä»¥ä¸‹å‡ ç‚¹ï¼š</p><p>ä½¿ç”¨ Vue æ¡†æ¶çš„ç»éªŒã€‚<br>çŸ¥é“å¦‚ä½•ä½¿ç”¨ vue-cli è®¾ç½®åº”ç”¨ç¨‹åºã€‚<br>JavaScript å’Œ Vue çš„åŸºæœ¬çŸ¥è¯†<br>Node (8)<br>npm (5.2.0)</p><h2 id="Vue-ä¸­çš„é«˜é˜¶ç»„ä»¶æ¨¡å¼"><a href="#Vue-ä¸­çš„é«˜é˜¶ç»„ä»¶æ¨¡å¼" class="headerlink" title="Vue ä¸­çš„é«˜é˜¶ç»„ä»¶æ¨¡å¼"></a>Vue ä¸­çš„é«˜é˜¶ç»„ä»¶æ¨¡å¼</h2><p>è™½ç„¶é«˜é˜¶ç»„ä»¶é€šå¸¸ä¸ React ç›¸å…³è”ï¼Œä½†æ˜¯ä¸º Vue ç»„ä»¶åˆ›å»ºé«˜é˜¶ç»„ä»¶æ˜¯å¾ˆæœ‰å¯èƒ½çš„ã€‚åœ¨ Vue ä¸­åˆ›å»ºé«˜é˜¶ç»„ä»¶çš„æ¨¡å¼å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hoccomponent.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">"vue"</span></span><br><span class="line"><span class="keyword">import</span> ComponentExample <span class="keyword">from</span> <span class="string">'@/components/ComponentExample.vue'</span></span><br><span class="line"><span class="keyword">const</span> HoComponent = <span class="function">(<span class="params">component</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Vue.component(<span class="string">'withSubscription'</span>, &#123;</span><br><span class="line">        render(createElement) &#123;</span><br><span class="line">            <span class="keyword">return</span> createElement(component)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> HoComponentEnhanced = HoComponent(ComponentExample);</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šé¢çš„ä»£ç å—æ‰€ç¤ºï¼Œ<code>HoComponent</code> å‡½æ•°æ¥å—ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°ç»„ä»¶æ¥æ¸²æŸ“ä¼ è¿›æ¥çš„ç»„ä»¶ã€‚</p><h2 id="ä¸€ä¸ªç®€å•çš„-HOC-ç¤ºä¾‹"><a href="#ä¸€ä¸ªç®€å•çš„-HOC-ç¤ºä¾‹" class="headerlink" title="ä¸€ä¸ªç®€å•çš„ HOC ç¤ºä¾‹"></a>ä¸€ä¸ªç®€å•çš„ HOC ç¤ºä¾‹</h2><p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸€ä¸ªä½¿ç”¨é«˜é˜¶ç»„ä»¶çš„ç¤ºä¾‹ã€‚åœ¨ä»‹ç»é«˜é˜¶ç»„ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬å°†äº†è§£åœ¨æ²¡æœ‰é«˜é˜¶ç»„ä»¶çš„æƒ…å†µä¸‹ï¼Œå½“å‰çš„ä»£ç åº“æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œç„¶åäº†è§£å¦‚ä½•è¿›è¡ŒæŠ½è±¡ã€‚</p><p><a href="https://codesandbox.io/embed/llvq04nx4l" target="_blank" rel="noopener">https://codesandbox.io/embed/llvq04nx4l</a></p><p>æ­£å¦‚ä¸Šé¢çš„ CodeSandbox æ‰€ç¤ºï¼Œè¯¥åº”ç”¨ç¨‹åºä¼šæ˜¾ç¤ºä¸€ä¸ªçº¸ä¸šå…¬å¸åŠå…¶å‡€èµ„äº§çš„åˆ—è¡¨ï¼Œä»¥åŠã€ŠåŠå…¬å®¤ã€‹(ç¾å›½)ä¸­çš„äººç‰©åŠå…¶è·å¥–æƒ…å†µã€‚</p><p>æˆ‘ä»¬è·å¾—åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰æ•°æ®æ¥æºåªæœ‰ä¸€ä¸ªï¼Œé‚£å°±æ˜¯<code>mockData.js</code>æ–‡ä»¶ã€‚</p><a id="more"></a><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/components/mockData.js</span></span><br><span class="line"><span class="keyword">const</span> staff = [</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">"Michael Scott"</span>,</span><br><span class="line">    id: <span class="number">0</span>,</span><br><span class="line">    awards: <span class="number">2</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">"Toby Flenderson"</span>,</span><br><span class="line">    id: <span class="number">1</span>,</span><br><span class="line">    awards: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">"Dwight K. Schrute"</span>,</span><br><span class="line">    id: <span class="number">2</span>,</span><br><span class="line">    awards: <span class="number">10</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">"Jim Halpert"</span>,</span><br><span class="line">    id: <span class="number">3</span>,</span><br><span class="line">    awards: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">"Andy Bernard"</span>,</span><br><span class="line">    id: <span class="number">4</span>,</span><br><span class="line">    awards: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">"Phyllis Vance"</span>,</span><br><span class="line">    id: <span class="number">5</span>,</span><br><span class="line">    awards: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">"Stanley Hudson"</span>,</span><br><span class="line">    id: <span class="number">6</span>,</span><br><span class="line">    awards: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"><span class="keyword">const</span> paperCompanies = [</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="number">0</span>,</span><br><span class="line">    name: <span class="string">"Staples"</span>,</span><br><span class="line">    net: <span class="number">10000000</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="number">1</span>,</span><br><span class="line">    name: <span class="string">"Dundler Mufflin"</span>,</span><br><span class="line">    net: <span class="number">5000000</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="number">2</span>,</span><br><span class="line">    name: <span class="string">"Michael Scott Paper Company"</span>,</span><br><span class="line">    net: <span class="number">300000</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="number">3</span>,</span><br><span class="line">    name: <span class="string">"Prince Family Paper"</span>,</span><br><span class="line">    net: <span class="number">30000</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  getStaff() &#123;</span><br><span class="line">    <span class="keyword">return</span> staff;</span><br><span class="line">  &#125;,</span><br><span class="line">  getCompanies() &#123;</span><br><span class="line">    <span class="keyword">return</span> paperCompanies;</span><br><span class="line">  &#125;,</span><br><span class="line">  increaseAward(id) &#123;</span><br><span class="line">    staff[id].awards++;</span><br><span class="line">  &#125;,</span><br><span class="line">  decreaseAward(id) &#123;</span><br><span class="line">    staff[id].awards--;</span><br><span class="line">  &#125;,</span><br><span class="line">  setNetWorth(id) &#123;</span><br><span class="line">    paperCompanies[id].net = <span class="built_in">Math</span>.random() * (<span class="number">5000000</span> - <span class="number">50000</span>) + <span class="number">50000</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæœ‰å‡ ä¸ª const å˜é‡ä¿å­˜äº†å…¬å¸å’Œå‘˜å·¥åˆ—è¡¨çš„ä¿¡æ¯ã€‚æˆ‘ä»¬ä¹Ÿå¯¼å‡ºäº†ä¸€äº›å‡½æ•°ï¼Œ</p><blockquote><p>å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š<br>è¿”å›å‘˜å·¥åˆ—è¡¨<br>è¿”å›å…¬å¸åˆ—è¡¨<br>å¢åŠ å’Œå‡å°‘å¯¹ç‰¹å®šå‘˜å·¥çš„å¥–åŠ±ï¼Œæœ€å<br>æœ€åï¼Œè®¾å®šå…¬å¸çš„å‡€å€¼</p></blockquote><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹ <code>Staff.vue</code> å’Œ <code>Companies.vue</code> ç»„ä»¶ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">// src/components/Staff.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Staff List<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">"(staff, i) in staffList"</span> <span class="attr">:key</span>=<span class="string">"i"</span>&gt;</span></span><br><span class="line">      &#123;&#123; staff.name &#125;&#125;: &#123;&#123; staff.awards &#125;&#125; Salesman of the year Award ğŸ‰</span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"increaseAwards(staff.id);"</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"decreaseAwards(staff.id);"</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> mockData <span class="keyword">from</span> <span class="string">"./mockData.js"</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    data() &#123;</span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">        staffList: mockData.getStaff()</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      increaseAwards(id) &#123;</span><br><span class="line">        mockData.increaseAward(id);</span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.staffList = mockData.getStaff();</span></span><br><span class="line">      &#125;,</span><br><span class="line">      decreaseAwards(id) &#123;</span><br><span class="line">        mockData.decreaseAward(id);</span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.staffList = mockData.getStaff();</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæ•°æ®å®ä¾‹å˜é‡staffListè¢«èµ‹å€¼ä¸ºå‡½æ•°mockData.getStaff()è¿”å›çš„å†…å®¹ã€‚æˆ‘ä»¬ä¹Ÿæœ‰increaseAwardså’ŒdecreaseAwardså‡½æ•°ï¼Œåˆ†åˆ«è°ƒç”¨mockData.increaseAward å’Œ mockData.decreaseAwardã€‚ä¼ é€’ç»™è¿™äº›å‡½æ•°çš„id æ˜¯ä»æ¸²æŸ“çš„æ¨¡æ¿ä¸­è·å¾—çš„ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">// src/components/Companies.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Paper Companies<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">"(companies, i) in companies"</span> <span class="attr">:key</span>=<span class="string">"i"</span>&gt;</span></span><br><span class="line">      &#123;&#123; companies.name &#125;&#125; - $&#123;&#123; companies.net</span><br><span class="line">      &#125;&#125;<span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"setWorth(companies.id);"</span>&gt;</span>Set Company Value<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> mockData <span class="keyword">from</span> <span class="string">"./mockData.js"</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    data() &#123;</span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">        companies: mockData.getCompanies()</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      setWorth(id) &#123;</span><br><span class="line">        mockData.setNetWorth(id);</span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.companies = mockData.getCompanies();</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæ•°æ®å®ä¾‹å˜é‡companies è¢«èµ‹å€¼ä¸ºå‡½æ•°mockData.getCompanies()çš„è¿”å›å†…å®¹ã€‚æˆ‘ä»¬è¿˜æœ‰setWorthå‡½æ•°ï¼Œå®ƒé€šè¿‡å°†å…¬å¸çš„ id ä¼ é€’ç»™mockData.setNetWorthæ¥è®¾ç½®ä¸€ä¸ªéšæœºå€¼ä½œä¸ºå‡€å€¼ã€‚ä¼ é€’ç»™å‡½æ•°çš„idæ˜¯ä»æ¸²æŸ“çš„æ¨¡æ¿ä¸­è·å¾—çš„ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†è¿™ä¸¤ä¸ªç»„ä»¶æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œæˆ‘ä»¬å¯ä»¥</p><blockquote><p>æ‰¾å‡ºå®ƒä»¬ä¹‹é—´çš„å…±åŒç‚¹ï¼Œå¹¶å°†å…¶æŠ½è±¡å¦‚ä¸‹ï¼š</p></blockquote><p>ä»æ•°æ®æºè·å–æ•°æ® (mockData.js)<br>onClick å‡½æ•°</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å°†ä¸Šé¢çš„æ“ä½œæ”¾åˆ°é«˜é˜¶ç»„ä»¶ä¸­ï¼Œä»¥é¿å…ä»£ç é‡å¤å¹¶ç¡®ä¿å¯é‡ç”¨æ€§ã€‚</p><p>HoComponent å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªç»„ä»¶å’ŒfetchDataã€‚fetchDataæ–¹æ³•ç”¨äºç¡®å®šè¦åœ¨è¡¨ç¤ºç»„ä»¶ä¸­æ˜¾ç¤ºä»€ä¹ˆã€‚è¿™æ„å‘³ç€æ— è®ºåœ¨å“ªé‡Œä½¿ç”¨é«˜é˜¶ç»„ä»¶ï¼Œä½œä¸ºfetchData ä¼ é€’çš„å‡½æ•°éƒ½å°†è¢«ç”¨æ¥ä»mockData ä¸­è·å–æ•°æ®ã€‚</p><p>ç„¶åå°†æ•°æ®å®ä¾‹returnedData è®¾ç½®ä¸ºfetchDataçš„å†…å®¹ï¼Œç„¶åä½œä¸ºprops ä¼ é€’ç»™åœ¨é«˜é˜¶ç»„ä»¶ä¸­åˆ›å»ºçš„æ–°ç»„ä»¶ã€‚</p><p>è®©æˆ‘ä»¬çœ‹çœ‹æ–°åˆ›å»ºçš„é«˜é˜¶ç»„ä»¶å¦‚ä½•åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ã€‚æˆ‘ä»¬éœ€è¦ç¼–è¾‘Staff.vue å’ŒCompanies.vueã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// src/components/Staff.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Staff List<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">"(staff, i) in returnedData"</span> <span class="attr">:key</span>=<span class="string">"i"</span>&gt;</span></span><br><span class="line">      &#123;&#123; staff.name &#125;&#125;: &#123;&#123; staff.awards &#125;&#125; Salesman of the year Award ğŸ‰</span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"increaseAwards(staff.id);"</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"decreaseAwards(staff.id);"</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">    props: [<span class="string">"returnedData"</span>]</span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// src/components/Companies.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Paper Companies<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">"(companies, i) in returnedData"</span> <span class="attr">:key</span>=<span class="string">"i"</span>&gt;</span></span><br><span class="line">      &#123;&#123; companies.name &#125;&#125; - $&#123;&#123; companies.net</span><br><span class="line">      &#125;&#125;<span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"setWorth(companies.id);"</span>&gt;</span>Set Company Value<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">    props: [<span class="string">"returnedData"</span>]</span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ­£å¦‚ä½ åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­çœ‹åˆ°çš„ï¼Œå¯¹äºè¿™ä¸¤ä¸ªç»„ä»¶ï¼Œæˆ‘ä»¬å»æ‰äº†å‡½æ•°å’Œæ•°æ®å®ä¾‹å˜é‡ï¼Œæ˜¾ç¤ºå†…å®¹æ‰€éœ€çš„æ‰€æœ‰æ•°æ®ç°åœ¨éƒ½å°†ä»è¿™äº›propsä¸­è·å¾—ã€‚å¯¹äºåˆ æ‰çš„å‡½æ•°ï¼Œæˆ‘ä»¬å°†å¾ˆå¿«ä¼šè®²åˆ°ã€‚</p><p>åœ¨ App.vue ç»„ä»¶ä¸­ï¼Œç”¨ä»¥ä¸‹ä»£ç ç¼–è¾‘script æ ‡ç­¾ä¸­çš„ç°æœ‰å†…å®¹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">// src/App.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">  <span class="comment">// import the Companies component</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Companies <span class="keyword">from</span> <span class="string">"./components/Companies"</span>;</span></span><br><span class="line"><span class="actionscript">  <span class="comment">// import the Staff component</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Staff <span class="keyword">from</span> <span class="string">"./components/Staff"</span>;</span></span><br><span class="line"><span class="actionscript">  <span class="comment">// import the higher order component</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> HoComponent <span class="keyword">from</span> <span class="string">"./components/HoComponent.js"</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">  <span class="comment">// Create a const variable which contains the Companies component wrapped in the higher order component</span></span></span><br><span class="line"><span class="actionscript">  <span class="keyword">const</span> CompaniesComponent = HoComponent(Companies, mockData =&gt; mockData.getCompanies()</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line"><span class="actionscript">  <span class="comment">// Create a const variable which contains the Staff component wrapped in the higher order component</span></span></span><br><span class="line"><span class="actionscript">  <span class="keyword">const</span> StaffComponent = HoComponent(Staff, mockData =&gt; mockData.getStaff());</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">    name: <span class="string">"App"</span>,</span></span><br><span class="line">    components: &#123;</span><br><span class="line">      CompaniesComponent,</span><br><span class="line">      StaffComponent</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼ŒHoComponentç”¨äºåŒ…è£… Staff å’Œ Companies ç»„ä»¶ã€‚</p><p>æ¯ä¸ªç»„ä»¶ä½œä¸ºHoComponent çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒè¿”å›å¦ä¸€ä¸ªå‡½æ•°ï¼ŒæŒ‡å®šåº”è¯¥ä»mockDataè·å–ä»€ä¹ˆæ•°æ®ã€‚è¿™æ˜¯æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„é«˜é˜¶ç»„ä»¶(HoComponent.js)ä¸­çš„fetchData å‡½æ•°ã€‚</p><p>å¦‚æœä½ ç°åœ¨åˆ·æ–°åº”ç”¨ç¨‹åºï¼Œä½ åº”è¯¥ä»ç„¶å¯ä»¥çœ‹åˆ°æ¥è‡ªmockData æ–‡ä»¶çš„æ•°æ®åƒå¾€å¸¸ä¸€æ ·å‘ˆç°ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œè¿™äº›æŒ‰é’®æ— æ³•å·¥ä½œï¼Œå› ä¸ºå®ƒä»¬è¿˜æ²¡æœ‰ç»‘å®šåˆ°ä»»ä½•å‡½æ•°ã€‚è®©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">// src/App.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">CompaniesComponent</span> @<span class="attr">click</span>=<span class="string">"onEventHappen"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">StaffComponent</span> @<span class="attr">click</span>=<span class="string">"onEventHappen"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">  <span class="comment">// import the Companies component</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Companies <span class="keyword">from</span> <span class="string">"./components/Companies"</span>;</span></span><br><span class="line"><span class="actionscript">  <span class="comment">// import the Staff component</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Staff <span class="keyword">from</span> <span class="string">"./components/Staff"</span>;</span></span><br><span class="line"><span class="actionscript">  <span class="comment">// import the higher order component</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> HoComponent <span class="keyword">from</span> <span class="string">"./components/HoComponent.js"</span>;</span></span><br><span class="line"><span class="actionscript">  <span class="comment">// import the source data from mockData only to be used for event handlers</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> sourceData <span class="keyword">from</span> <span class="string">"./components/mockData.js"</span>;</span></span><br><span class="line"><span class="actionscript">  <span class="comment">// Create a const variable which contains the Companies component wrapped in the higher order component</span></span></span><br><span class="line"><span class="actionscript">  <span class="keyword">const</span> CompaniesComponent = HoComponent(Companies, mockData =&gt;</span></span><br><span class="line">  mockData.getCompanies()</span><br><span class="line">  );</span><br><span class="line"><span class="actionscript">  <span class="comment">// Create a const variable which contains the Staff component wrapped in the higher order component</span></span></span><br><span class="line"><span class="actionscript">  <span class="keyword">const</span> StaffComponent = HoComponent(Staff, mockData =&gt; mockData.getStaff());</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">    name: <span class="string">"App"</span>,</span></span><br><span class="line">    components: &#123;</span><br><span class="line">      CompaniesComponent,</span><br><span class="line">      StaffComponent</span><br><span class="line">      &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      onEventHappen(value) &#123;</span><br><span class="line"><span class="actionscript">        <span class="comment">// set the variable setFunction to the name of the function that was passed iin the value emitted from child component i.e. if value.name is 'increaseAward', setFunction is set to increaseAward()</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> setFunction = sourceData[value.name];</span></span><br><span class="line"><span class="actionscript">        <span class="comment">// call the corresponding function with the id passed as an argument.</span></span></span><br><span class="line">        setFunction(value.id);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-id">#app</span> &#123;</span></span><br><span class="line">  font-family: "Avenir", Helvetica, Arial, sans-serif;</span><br><span class="line">  -webkit-font-smoothing: antialiased;</span><br><span class="line">  -moz-osx-font-smoothing: grayscale;</span><br><span class="line">  text-align: center;</span><br><span class="line"><span class="css">  <span class="selector-tag">color</span>: <span class="selector-id">#2c3e50</span>;</span></span><br><span class="line">  margin-top: 60px;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬åœ¨App.vueç»„ä»¶ä¸­æ·»åŠ äº†ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ã€‚</p><p>vueçš„ç»„ä»¶ã€‚æ¯å½“Staff.vue æˆ–Companies.vue ç»„ä»¶è¢«ç‚¹å‡»æ—¶ï¼ŒonEventHappen æ–¹æ³•å°†ä¼šè¢«è°ƒç”¨ã€‚</p><p>åœ¨onEventHappenæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å°†å˜é‡setFunction è®¾ç½®ä¸ºä»å­ç»„ä»¶å‘å‡ºçš„å€¼ä¸­ä¼ é€’çš„å‡½æ•°åï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœvalue.nameæ˜¯â€™increaseAwardâ€™ï¼Œé‚£ä¹ˆsetFunctionè®¾ç½®ä¸ºincreaseAward()ã€‚setFunction å°†ä»¥idä½œä¸ºå‚æ•°æ‰§è¡Œã€‚</p><p>æœ€åï¼Œä¸ºäº†å°†äº‹ä»¶ç›‘å¬å™¨ä¼ é€’ç»™å°è£…åœ¨é«˜é˜¶ç»„ä»¶ä¸­çš„ç»„ä»¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ HoComponent.jsæ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢è¿™è¡Œä»£ç ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">props: &#123;</span><br><span class="line">returnedData: <span class="keyword">this</span>.returnedData</span><br><span class="line">&#125;,</span><br><span class="line">on: &#123; ...this.$listeners &#125;</span><br></pre></td></tr></table></figure><h2 id="vue-hoc"><a href="#vue-hoc" class="headerlink" title="vue-hoc"></a>vue-hoc</h2><p>æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<a href="https://github.com/jackmellis/vue-hoc" target="_blank" rel="noopener">vue-hoc</a>åº“æ¥å¸®åŠ©åˆ›å»ºé«˜é˜¶ç»„ä»¶ã€‚vue-hocå¸®åŠ©ä½ è½»æ¾åœ°åˆ›å»ºé«˜é˜¶ç»„ä»¶ï¼Œä½ è¦åšçš„å°±æ˜¯ä¼ é€’åŸºæœ¬ç»„ä»¶ã€åº”ç”¨äºHOCçš„ä¸€ç³»åˆ—ç»„ä»¶é€‰é¡¹å’Œåœ¨æ¸²æŸ“é˜¶æ®µä¼ é€’ç»™ç»„ä»¶çš„æ•°æ®å±æ€§ã€‚<br>vue-hoc å¯ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…ï¼š<br>    <code>npm install --save vue-hoc</code></p><p>å¤åˆ¶ä»£ç vue-hocæ’ä»¶æœ‰ä¸€äº›ä¾‹å­å¯ä»¥è®©ä½ å¼€å§‹åˆ›å»ºæ›´é«˜é˜¶çš„ç»„ä»¶ï¼Œä½ å¯ä»¥<a href="https://github.com/jackmellis/vue-hoc/blob/master/packages/vue-hoc/README.md" target="_blank" rel="noopener">æŸ¥çœ‹è¿™é‡Œ</a>.</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å‰æ–‡&quot;&gt;&lt;a href=&quot;#å‰æ–‡&quot; class=&quot;headerlink&quot; title=&quot;å‰æ–‡&quot;&gt;&lt;/a&gt;å‰æ–‡&lt;/h1&gt;&lt;p&gt;&lt;code&gt;é«˜é˜¶ç»„ä»¶(HOC)&lt;/code&gt;æ˜¯ä¸€ç§æ¶æ„æ¨¡å¼ï¼Œåœ¨ React ä¸­éå¸¸å¸¸è§ï¼Œä½†ä¹Ÿå¯ä»¥åœ¨ Vue ä¸­ä½¿ç”¨ã€‚å®ƒå¯ä»¥è¢«æè¿°ä¸ºä¸€ç§&lt;strong&gt;åœ¨ç»„ä»¶ä¹‹é—´å…±äº«å…¬å…±åŠŸèƒ½è€Œä¸éœ€è¦é‡å¤ä»£ç &lt;/strong&gt;çš„æ–¹æ³•ã€‚HOC çš„ç›®çš„æ˜¯å¢å¼ºç»„ä»¶çš„åŠŸèƒ½ã€‚å®ƒå…è®¸åœ¨é¡¹ç›®ä¸­å®ç°å¯é‡ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åªè¦ä½ å‘ä¸€ä¸ªæ–¹æ³•ä¼ å…¥ç»„ä»¶ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶ï¼Œè¿™å°±æ˜¯ä¸€ä¸ª HOCã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;é«˜é˜¶ç»„ä»¶åœ¨ä»¥ä¸‹æ–¹é¢éå¸¸æœ‰ç”¨: 1.æ“ä½œå±æ€§ã€‚ 2.æ“ä½œæ•°æ®å’Œæ•°æ®æŠ½è±¡ã€‚ 3.ä»£ç é‡ç”¨&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;é¢„å¤‡çŸ¥è¯†&quot;&gt;&lt;a href=&quot;#é¢„å¤‡çŸ¥è¯†&quot; class=&quot;headerlink&quot; title=&quot;é¢„å¤‡çŸ¥è¯†&quot;&gt;&lt;/a&gt;é¢„å¤‡çŸ¥è¯†&lt;/h2&gt;&lt;p&gt;åœ¨æˆ‘ä»¬å¼€å§‹æ•™ç¨‹ä¹‹å‰ï¼Œéœ€è¦äº†è§£ä»¥ä¸‹å‡ ç‚¹ï¼š&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ Vue æ¡†æ¶çš„ç»éªŒã€‚&lt;br&gt;çŸ¥é“å¦‚ä½•ä½¿ç”¨ vue-cli è®¾ç½®åº”ç”¨ç¨‹åºã€‚&lt;br&gt;JavaScript å’Œ Vue çš„åŸºæœ¬çŸ¥è¯†&lt;br&gt;Node (8)&lt;br&gt;npm (5.2.0)&lt;/p&gt;
&lt;h2 id=&quot;Vue-ä¸­çš„é«˜é˜¶ç»„ä»¶æ¨¡å¼&quot;&gt;&lt;a href=&quot;#Vue-ä¸­çš„é«˜é˜¶ç»„ä»¶æ¨¡å¼&quot; class=&quot;headerlink&quot; title=&quot;Vue ä¸­çš„é«˜é˜¶ç»„ä»¶æ¨¡å¼&quot;&gt;&lt;/a&gt;Vue ä¸­çš„é«˜é˜¶ç»„ä»¶æ¨¡å¼&lt;/h2&gt;&lt;p&gt;è™½ç„¶é«˜é˜¶ç»„ä»¶é€šå¸¸ä¸ React ç›¸å…³è”ï¼Œä½†æ˜¯ä¸º Vue ç»„ä»¶åˆ›å»ºé«˜é˜¶ç»„ä»¶æ˜¯å¾ˆæœ‰å¯èƒ½çš„ã€‚åœ¨ Vue ä¸­åˆ›å»ºé«˜é˜¶ç»„ä»¶çš„æ¨¡å¼å¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// hoccomponent.js&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; Vue &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;vue&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; ComponentExample &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;@/components/ComponentExample.vue&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; HoComponent = &lt;span class=&quot;function&quot;&gt;(&lt;span class=&quot;params&quot;&gt;component&lt;/span&gt;) =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; Vue.component(&lt;span class=&quot;string&quot;&gt;&#39;withSubscription&#39;&lt;/span&gt;, &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        render(createElement) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; createElement(component)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; HoComponentEnhanced = HoComponent(ComponentExample);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¦‚ä¸Šé¢çš„ä»£ç å—æ‰€ç¤ºï¼Œ&lt;code&gt;HoComponent&lt;/code&gt; å‡½æ•°æ¥å—ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°ç»„ä»¶æ¥æ¸²æŸ“ä¼ è¿›æ¥çš„ç»„ä»¶ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ä¸€ä¸ªç®€å•çš„-HOC-ç¤ºä¾‹&quot;&gt;&lt;a href=&quot;#ä¸€ä¸ªç®€å•çš„-HOC-ç¤ºä¾‹&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ä¸ªç®€å•çš„ HOC ç¤ºä¾‹&quot;&gt;&lt;/a&gt;ä¸€ä¸ªç®€å•çš„ HOC ç¤ºä¾‹&lt;/h2&gt;&lt;p&gt;åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸€ä¸ªä½¿ç”¨é«˜é˜¶ç»„ä»¶çš„ç¤ºä¾‹ã€‚åœ¨ä»‹ç»é«˜é˜¶ç»„ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬å°†äº†è§£åœ¨æ²¡æœ‰é«˜é˜¶ç»„ä»¶çš„æƒ…å†µä¸‹ï¼Œå½“å‰çš„ä»£ç åº“æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œç„¶åäº†è§£å¦‚ä½•è¿›è¡ŒæŠ½è±¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://codesandbox.io/embed/llvq04nx4l&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://codesandbox.io/embed/llvq04nx4l&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ­£å¦‚ä¸Šé¢çš„ CodeSandbox æ‰€ç¤ºï¼Œè¯¥åº”ç”¨ç¨‹åºä¼šæ˜¾ç¤ºä¸€ä¸ªçº¸ä¸šå…¬å¸åŠå…¶å‡€èµ„äº§çš„åˆ—è¡¨ï¼Œä»¥åŠã€ŠåŠå…¬å®¤ã€‹(ç¾å›½)ä¸­çš„äººç‰©åŠå…¶è·å¥–æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è·å¾—åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰æ•°æ®æ¥æºåªæœ‰ä¸€ä¸ªï¼Œé‚£å°±æ˜¯&lt;code&gt;mockData.js&lt;/code&gt;æ–‡ä»¶ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Vue" scheme="https://zhanghao-web.github.io/categories/Vue/"/>
    
    
      <category term="Vue" scheme="https://zhanghao-web.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€å¼ å›¾ç†æ¸… Vue 3.0 çš„å“åº”å¼ç³»ç»Ÿ</title>
    <link href="https://zhanghao-web.github.io/2019/10/29/Vue/%E4%B8%80%E5%BC%A0%E5%9B%BE%E7%90%86%E6%B8%85-Vue-3-0-%E7%9A%84%E5%93%8D%E5%BA%94%E5%BC%8F%E7%B3%BB%E7%BB%9F/"/>
    <id>https://zhanghao-web.github.io/2019/10/29/Vue/ä¸€å¼ å›¾ç†æ¸…-Vue-3-0-çš„å“åº”å¼ç³»ç»Ÿ/</id>
    <published>2019-10-29T09:03:11.000Z</published>
    <updated>2020-01-28T10:04:15.071Z</updated>
    
    <content type="html"><![CDATA[<p>è½¬è‡ª</p><p>ä½œè€…ï¼šJrain<br><a href="https://juejin.im/post/5d9da45af265da5b8072de5d" target="_blank" rel="noopener">é“¾æ¥</a></p><p><img src="https://user-gold-cdn.xitu.io/2019/10/9/16dafca37b2e0534?imageslim" alt="vue reactive"></p><h2 id="ä¸€ä¸ªåŸºæœ¬çš„ä¾‹å­"><a href="#ä¸€ä¸ªåŸºæœ¬çš„ä¾‹å­" class="headerlink" title="ä¸€ä¸ªåŸºæœ¬çš„ä¾‹å­"></a>ä¸€ä¸ªåŸºæœ¬çš„ä¾‹å­</h2><p>Vue 3.0 çš„å“åº”å¼ç³»ç»Ÿæ˜¯ç‹¬ç«‹çš„æ¨¡å—ï¼Œå¯ä»¥å®Œå…¨è„±ç¦» Vue è€Œä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ clone äº†æºç ä¸‹æ¥ä»¥åï¼Œå¯ä»¥ç›´æ¥åœ¨ <code>packages/reactivity</code> æ¨¡å—ä¸‹è°ƒè¯•ã€‚</p><p>1.åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ <code>yarn dev reactivity</code>ï¼Œç„¶åè¿›å…¥ <code>packages/reactivity</code> ç›®å½•æ‰¾åˆ°äº§å‡ºçš„ <code>dist/reactivity.global.js</code> æ–‡ä»¶ã€‚<br>2.æ–°å»ºä¸€ä¸ª <code>index.html</code>ï¼Œå†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./dist/reactivity.global.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">const</span> &#123; reactive, effect &#125; = VueObserver</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="keyword">const</span> origin = &#123;</span></span><br><span class="line">  count: 0</span><br><span class="line">&#125;</span><br><span class="line"><span class="actionscript"><span class="keyword">const</span> state = reactive(origin)</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> fn = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="actionscript">  <span class="keyword">const</span> count = state.count</span></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.log(<span class="string">`set count to <span class="subst">$&#123;count&#125;</span>`</span>)</span></span><br><span class="line">&#125;</span><br><span class="line">effect(fn)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>åœ¨æµè§ˆå™¨æ‰“å¼€è¯¥æ–‡ä»¶ï¼Œäºæ§åˆ¶å°æ‰§è¡Œ <code>state.count++</code>ï¼Œä¾¿å¯çœ‹åˆ°è¾“å‡º <code>set count to 1</code>ã€‚</li></ol><p>åœ¨ä¸Šè¿°çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>reactive()</code> å‡½æ•°æŠŠ <code>origin</code> å¯¹è±¡è½¬åŒ–æˆäº†<code>Proxy</code> å¯¹è±¡ <code>state</code>ï¼›ä½¿ç”¨ <code>effect()</code> å‡½æ•°æŠŠ <code>fn()</code> ä½œä¸ºå“åº”å¼å›è°ƒã€‚å½“ <code>state.count</code> å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¾¿è§¦å‘äº† <code>fn()</code>ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†ä»¥è¿™ä¸ªä¾‹å­ç»“åˆä¸Šæ–‡çš„æµç¨‹å›¾ï¼Œæ¥è®²è§£è¿™å¥—å“åº”å¼ç³»ç»Ÿæ˜¯æ€ä¹ˆè¿è¡Œçš„ã€‚</p><h3 id="åˆå§‹åŒ–é˜¶æ®µ"><a href="#åˆå§‹åŒ–é˜¶æ®µ" class="headerlink" title="åˆå§‹åŒ–é˜¶æ®µ"></a>åˆå§‹åŒ–é˜¶æ®µ</h3><blockquote><p>åœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œä¸»è¦åšäº†ä¸¤ä»¶äº‹ã€‚</p></blockquote><p>1.æŠŠ origin å¯¹è±¡è½¬åŒ–æˆå“åº”å¼çš„ Proxy å¯¹è±¡ stateã€‚<br>2.æŠŠå‡½æ•° fn() ä½œä¸ºä¸€ä¸ªå“åº”å¼çš„ effect å‡½æ•°ã€‚</p><p>å¤§å®¶éƒ½çŸ¥é“ï¼ŒVue 3.0 ä½¿ç”¨äº† <code>Proxy</code> æ¥ä»£æ›¿ä¹‹å‰çš„ <code>Object.defineProperty()</code>ï¼Œæ”¹å†™äº†å¯¹è±¡çš„ <code>getter/setter</code>ï¼Œå®Œæˆä¾èµ–æ”¶é›†å’Œå“åº”è§¦å‘ã€‚ä½†æ˜¯åœ¨è¿™ä¸€é˜¶æ®µä¸­ï¼Œæˆ‘ä»¬æš‚æ—¶å…ˆä¸ç®¡å®ƒæ˜¯å¦‚ä½•æ”¹å†™å¯¹è±¡çš„ <code>getter/setter</code> çš„ï¼Œè¿™ä¸ªåœ¨åç»­çš„â€<strong>ä¾èµ–æ”¶é›†é˜¶æ®µ</strong>â€œä¼šè¯¦ç»†è¯´æ˜ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™éƒ¨åˆ†çš„å†…å®¹æµ“ç¼©æˆä¸€ä¸ªåªæœ‰ä¸¤è¡Œä»£ç çš„ <code>reactive()</code> å‡½æ•°ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> reactive (target)&#123;</span><br><span class="line">    <span class="keyword">const</span> observed = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target,handler);</span><br><span class="line">    <span class="keyword">return</span> observed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ä¸€ä¸ªæ™®é€šçš„å‡½æ•° <code>fn()</code> è¢« <code>effect()</code> åŒ…è£¹ä¹‹åï¼Œå°±ä¼šå˜æˆä¸€ä¸ªå“åº”å¼çš„ effect å‡½æ•°ï¼Œè€Œ <code>fn()</code> ä¹Ÿä¼šè¢«ç«‹å³æ‰§è¡Œä¸€æ¬¡ã€‚</p><p><strong>ç”±äºåœ¨ fn() é‡Œé¢æœ‰å¼•ç”¨åˆ° Proxy å¯¹è±¡çš„å±æ€§ï¼Œæ‰€ä»¥è¿™ä¸€æ­¥ä¼šè§¦å‘å¯¹è±¡çš„ getterï¼Œä»è€Œå¯åŠ¨ä¾èµ–æ”¶é›†</strong>ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿™ä¸ª effect å‡½æ•°ä¹Ÿä¼šè¢«å‹å…¥ä¸€ä¸ªåä¸ºâ€<code>activeReactiveEffectStack</code>â€œï¼ˆæ­¤å¤„ä¸º <code>effectStack</code>ï¼‰çš„æ ˆä¸­ï¼Œä¾›åç»­ä¾èµ–æ”¶é›†çš„æ—¶å€™ä½¿ç”¨ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">effect</span> (<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æ„é€ ä¸€ä¸ª effect</span></span><br><span class="line">  <span class="keyword">const</span> effect = <span class="function"><span class="keyword">function</span> <span class="title">effect</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> run(effect, fn, args)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç«‹å³æ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">  effect()</span><br><span class="line">  <span class="keyword">return</span> effect</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params">effect, fn, args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (effectStack.indexOf(effect) === <span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// å¾€æ± å­é‡Œæ”¾å…¥å½“å‰ effect</span></span><br><span class="line">      effectStack.push(effect)</span><br><span class="line">      <span class="comment">// ç«‹å³æ‰§è¡Œä¸€é fn()</span></span><br><span class="line">      <span class="comment">// fn() æ‰§è¡Œè¿‡ç¨‹ä¼šå®Œæˆä¾èµ–æ”¶é›†ï¼Œä¼šç”¨åˆ° effect</span></span><br><span class="line">      <span class="keyword">return</span> fn(...args)</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">// å®Œæˆä¾èµ–æ”¶é›†åä»æ± å­ä¸­æ‰”æ‰è¿™ä¸ª effect</span></span><br><span class="line">      effectStack.pop()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œåˆå§‹åŒ–é˜¶æ®µå·²ç»å®Œæˆã€‚æ¥ä¸‹æ¥å°±æ˜¯æ•´ä¸ªç³»ç»Ÿæœ€å…³é”®çš„ä¸€æ­¥â€”â€”ä¾èµ–æ”¶é›†é˜¶æ®µã€‚<br><a id="more"></a></p><h3 id="ä¾èµ–æ”¶é›†é˜¶æ®µ"><a href="#ä¾èµ–æ”¶é›†é˜¶æ®µ" class="headerlink" title="ä¾èµ–æ”¶é›†é˜¶æ®µ"></a>ä¾èµ–æ”¶é›†é˜¶æ®µ</h3><p>è¿™ä¸ªé˜¶æ®µçš„è§¦å‘æ—¶æœºï¼Œå°±æ˜¯åœ¨ <code>effect</code> è¢«ç«‹å³æ‰§è¡Œï¼Œå…¶å†…éƒ¨çš„ <code>fn()</code> è§¦å‘äº† <code>Proxy</code> å¯¹è±¡çš„ <code>getter</code> çš„æ—¶å€™ã€‚ç®€å•æ¥è¯´ï¼Œåªè¦æ‰§è¡Œåˆ°ç±»ä¼¼ <code>state.count</code> çš„è¯­å¥ï¼Œå°±ä¼šè§¦å‘ <code>state çš„ getter</code>ã€‚</p><p>ä¾èµ–æ”¶é›†é˜¶æ®µæœ€é‡è¦çš„ç›®çš„ï¼Œå°±æ˜¯å»ºç«‹ä¸€ä»½â€ä¾èµ–æ”¶é›†è¡¨â€œï¼Œä¹Ÿå°±æ˜¯å›¾ç¤ºçš„â€<code>targetMap</code>â€œã€‚<code>targetMap</code> æ˜¯ä¸€ä¸ª <code>WeakMap</code>ï¼Œå…¶ key å€¼æ˜¯<del>å½“å‰çš„ <code>Prox</code>y å¯¹è±¡ <code>state</code></del>ä»£ç†å‰çš„å¯¹è±¡originï¼Œè€Œ value åˆ™æ˜¯è¯¥å¯¹è±¡æ‰€å¯¹åº”çš„ <code>depsMap</code>ã€‚</p><p><code>depsMap</code> æ˜¯ä¸€ä¸ª Mapï¼Œkey å€¼ä¸ºè§¦å‘ <code>getter</code> æ—¶çš„å±æ€§å€¼ï¼ˆæ­¤å¤„ä¸º countï¼‰ï¼Œè€Œ value åˆ™æ˜¯è§¦å‘è¿‡è¯¥å±æ€§å€¼æ‰€å¯¹åº”çš„å„ä¸ª effectã€‚</p><p>è¿˜æ˜¯æœ‰ç‚¹ç»•ï¼Ÿé‚£ä¹ˆæˆ‘ä»¬å†ä¸¾ä¸ªä¾‹å­ã€‚å‡è®¾æœ‰ä¸ª Proxy å¯¹è±¡å’Œ effect å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> state = reactive(&#123;</span><br><span class="line">  count: <span class="number">0</span>,</span><br><span class="line">  age: <span class="number">18</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> effect1 = effect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'effect1: '</span> + state.count)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> effect2 = effect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'effect2: '</span> + state.age)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> effect3 = effect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'effect3: '</span> + state.count, state.age)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œ<code>{ target -&gt; key -&gt; dep }</code> çš„å¯¹åº”å…³ç³»å°±å»ºç«‹èµ·æ¥äº†ï¼Œä¾èµ–æ”¶é›†ä¹Ÿå°±å®Œæˆäº†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">track</span> (<span class="params">target, operationType, key</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> effect = effectStack[effectStack.length - <span class="number">1</span>]</span><br><span class="line">  <span class="keyword">if</span> (effect) &#123;</span><br><span class="line">    <span class="keyword">let</span> depsMap = targetMap.get(target)</span><br><span class="line">    <span class="keyword">if</span> (depsMap === <span class="keyword">void</span> <span class="number">0</span>) &#123;</span><br><span class="line">      targetMap.set(target, (depsMap = <span class="keyword">new</span> <span class="built_in">Map</span>()))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> dep = depsMap.get(key)</span><br><span class="line">    <span class="keyword">if</span> (dep === <span class="keyword">void</span> <span class="number">0</span>) &#123;</span><br><span class="line">      depsMap.set(key, (dep = <span class="keyword">new</span> <span class="built_in">Set</span>()))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!dep.has(effect)) &#123;</span><br><span class="line">      dep.add(effect)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼„æ˜ç™½ä¾èµ–æ”¶é›†è¡¨ targetMap æ˜¯éå¸¸é‡è¦çš„ï¼Œå› ä¸ºè¿™æ˜¯æ•´ä¸ªå“åº”å¼ç³»ç»Ÿæ ¸å¿ƒä¸­çš„æ ¸å¿ƒã€‚</p><h3 id="å“åº”é˜¶æ®µ"><a href="#å“åº”é˜¶æ®µ" class="headerlink" title="å“åº”é˜¶æ®µ"></a>å“åº”é˜¶æ®µ</h3><p>å›é¡¾ä¸Šä¸€ç« èŠ‚çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ª <code>{ count: 0, age: 18 }</code> çš„ Proxyï¼Œå¹¶æ„é€ äº†ä¸‰ä¸ª effectã€‚åœ¨æ§åˆ¶å°ä¸Šçœ‹çœ‹æ•ˆæœï¼š</p><p><img src="https://user-gold-cdn.xitu.io/2019/10/9/16dafca37dadf75d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="effect"></p><p>å½“ä¿®æ”¹å¯¹è±¡çš„æŸä¸ªå±æ€§å€¼çš„æ—¶å€™ï¼Œä¼šè§¦å‘å¯¹åº”çš„ <code>setter</code>ã€‚</p><p>setter é‡Œé¢çš„ <code>trigger()</code> å‡½æ•°ä¼šä»ä¾èµ–æ”¶é›†è¡¨é‡Œæ‰¾åˆ°å½“å‰å±æ€§å¯¹åº”çš„å„ä¸ª <code>dep</code>ï¼Œç„¶åæŠŠå®ƒä»¬æ¨å…¥åˆ° <code>effects</code> å’Œ <code>computedEffects</code>ï¼ˆè®¡ç®—å±æ€§ï¼‰ é˜Ÿåˆ—ä¸­ï¼Œæœ€åé€šè¿‡ <code>scheduleRun()</code> æŒ¨ä¸ªæ‰§è¡Œé‡Œé¢çš„ effectã€‚</p><p>ç”±äºå·²ç»å»ºç«‹äº†ä¾èµ–æ”¶é›†è¡¨ï¼Œæ‰€ä»¥è¦æ‰¾åˆ°å±æ€§æ‰€å¯¹åº”çš„ dep ä¹Ÿå°±è½»è€Œæ˜“ä¸¾äº†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">trigger</span> (<span class="params">target, operationType, key</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å–å¾—å¯¹åº”çš„ depsMap</span></span><br><span class="line">  <span class="keyword">const</span> depsMap = targetMap.get(target)</span><br><span class="line">  <span class="keyword">if</span> (depsMap === <span class="keyword">void</span> <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å–å¾—å¯¹åº”çš„å„ä¸ª dep</span></span><br><span class="line">  <span class="keyword">const</span> effects = <span class="keyword">new</span> <span class="built_in">Set</span>()</span><br><span class="line">  <span class="keyword">if</span> (key !== <span class="keyword">void</span> <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> dep = depsMap.get(key)</span><br><span class="line">    dep &amp;&amp; dep.forEach(<span class="function"><span class="params">effect</span> =&gt;</span> &#123;</span><br><span class="line">      effects.add(effect)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç®€åŒ–ç‰ˆ scheduleRunï¼ŒæŒ¨ä¸ªæ‰§è¡Œ effect</span></span><br><span class="line">  effects.forEach(<span class="function"><span class="params">effect</span> =&gt;</span> &#123;</span><br><span class="line">    effect()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œå“åº”å¼é˜¶æ®µå®Œæˆã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è½¬è‡ª&lt;/p&gt;
&lt;p&gt;ä½œè€…ï¼šJrain&lt;br&gt;&lt;a href=&quot;https://juejin.im/post/5d9da45af265da5b8072de5d&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;é“¾æ¥&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://user-gold-cdn.xitu.io/2019/10/9/16dafca37b2e0534?imageslim&quot; alt=&quot;vue reactive&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;ä¸€ä¸ªåŸºæœ¬çš„ä¾‹å­&quot;&gt;&lt;a href=&quot;#ä¸€ä¸ªåŸºæœ¬çš„ä¾‹å­&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ä¸ªåŸºæœ¬çš„ä¾‹å­&quot;&gt;&lt;/a&gt;ä¸€ä¸ªåŸºæœ¬çš„ä¾‹å­&lt;/h2&gt;&lt;p&gt;Vue 3.0 çš„å“åº”å¼ç³»ç»Ÿæ˜¯ç‹¬ç«‹çš„æ¨¡å—ï¼Œå¯ä»¥å®Œå…¨è„±ç¦» Vue è€Œä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ clone äº†æºç ä¸‹æ¥ä»¥åï¼Œå¯ä»¥ç›´æ¥åœ¨ &lt;code&gt;packages/reactivity&lt;/code&gt; æ¨¡å—ä¸‹è°ƒè¯•ã€‚&lt;/p&gt;
&lt;p&gt;1.åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ &lt;code&gt;yarn dev reactivity&lt;/code&gt;ï¼Œç„¶åè¿›å…¥ &lt;code&gt;packages/reactivity&lt;/code&gt; ç›®å½•æ‰¾åˆ°äº§å‡ºçš„ &lt;code&gt;dist/reactivity.global.js&lt;/code&gt; æ–‡ä»¶ã€‚&lt;br&gt;2.æ–°å»ºä¸€ä¸ª &lt;code&gt;index.html&lt;/code&gt;ï¼Œå†™å…¥å¦‚ä¸‹ä»£ç ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;src&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;./dist/reactivity.global.js&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;actionscript&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &amp;#123; reactive, effect &amp;#125; = VueObserver&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;actionscript&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; origin = &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  count: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;actionscript&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; state = reactive(origin)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;javascript&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; fn = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;actionscript&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; count = state.count&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;javascript&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;`set count to &lt;span class=&quot;subst&quot;&gt;$&amp;#123;count&amp;#125;&lt;/span&gt;`&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;effect(fn)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨æµè§ˆå™¨æ‰“å¼€è¯¥æ–‡ä»¶ï¼Œäºæ§åˆ¶å°æ‰§è¡Œ &lt;code&gt;state.count++&lt;/code&gt;ï¼Œä¾¿å¯çœ‹åˆ°è¾“å‡º &lt;code&gt;set count to 1&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨ä¸Šè¿°çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ &lt;code&gt;reactive()&lt;/code&gt; å‡½æ•°æŠŠ &lt;code&gt;origin&lt;/code&gt; å¯¹è±¡è½¬åŒ–æˆäº†&lt;code&gt;Proxy&lt;/code&gt; å¯¹è±¡ &lt;code&gt;state&lt;/code&gt;ï¼›ä½¿ç”¨ &lt;code&gt;effect()&lt;/code&gt; å‡½æ•°æŠŠ &lt;code&gt;fn()&lt;/code&gt; ä½œä¸ºå“åº”å¼å›è°ƒã€‚å½“ &lt;code&gt;state.count&lt;/code&gt; å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¾¿è§¦å‘äº† &lt;code&gt;fn()&lt;/code&gt;ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†ä»¥è¿™ä¸ªä¾‹å­ç»“åˆä¸Šæ–‡çš„æµç¨‹å›¾ï¼Œæ¥è®²è§£è¿™å¥—å“åº”å¼ç³»ç»Ÿæ˜¯æ€ä¹ˆè¿è¡Œçš„ã€‚&lt;/p&gt;
&lt;h3 id=&quot;åˆå§‹åŒ–é˜¶æ®µ&quot;&gt;&lt;a href=&quot;#åˆå§‹åŒ–é˜¶æ®µ&quot; class=&quot;headerlink&quot; title=&quot;åˆå§‹åŒ–é˜¶æ®µ&quot;&gt;&lt;/a&gt;åˆå§‹åŒ–é˜¶æ®µ&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;åœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œä¸»è¦åšäº†ä¸¤ä»¶äº‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;1.æŠŠ origin å¯¹è±¡è½¬åŒ–æˆå“åº”å¼çš„ Proxy å¯¹è±¡ stateã€‚&lt;br&gt;2.æŠŠå‡½æ•° fn() ä½œä¸ºä¸€ä¸ªå“åº”å¼çš„ effect å‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;å¤§å®¶éƒ½çŸ¥é“ï¼ŒVue 3.0 ä½¿ç”¨äº† &lt;code&gt;Proxy&lt;/code&gt; æ¥ä»£æ›¿ä¹‹å‰çš„ &lt;code&gt;Object.defineProperty()&lt;/code&gt;ï¼Œæ”¹å†™äº†å¯¹è±¡çš„ &lt;code&gt;getter/setter&lt;/code&gt;ï¼Œå®Œæˆä¾èµ–æ”¶é›†å’Œå“åº”è§¦å‘ã€‚ä½†æ˜¯åœ¨è¿™ä¸€é˜¶æ®µä¸­ï¼Œæˆ‘ä»¬æš‚æ—¶å…ˆä¸ç®¡å®ƒæ˜¯å¦‚ä½•æ”¹å†™å¯¹è±¡çš„ &lt;code&gt;getter/setter&lt;/code&gt; çš„ï¼Œè¿™ä¸ªåœ¨åç»­çš„â€&lt;strong&gt;ä¾èµ–æ”¶é›†é˜¶æ®µ&lt;/strong&gt;â€œä¼šè¯¦ç»†è¯´æ˜ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™éƒ¨åˆ†çš„å†…å®¹æµ“ç¼©æˆä¸€ä¸ªåªæœ‰ä¸¤è¡Œä»£ç çš„ &lt;code&gt;reactive()&lt;/code&gt; å‡½æ•°ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt; reactive (target)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; observed = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Proxy&lt;/span&gt;(target,handler);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; observed;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å½“ä¸€ä¸ªæ™®é€šçš„å‡½æ•° &lt;code&gt;fn()&lt;/code&gt; è¢« &lt;code&gt;effect()&lt;/code&gt; åŒ…è£¹ä¹‹åï¼Œå°±ä¼šå˜æˆä¸€ä¸ªå“åº”å¼çš„ effect å‡½æ•°ï¼Œè€Œ &lt;code&gt;fn()&lt;/code&gt; ä¹Ÿä¼šè¢«ç«‹å³æ‰§è¡Œä¸€æ¬¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç”±äºåœ¨ fn() é‡Œé¢æœ‰å¼•ç”¨åˆ° Proxy å¯¹è±¡çš„å±æ€§ï¼Œæ‰€ä»¥è¿™ä¸€æ­¥ä¼šè§¦å‘å¯¹è±¡çš„ getterï¼Œä»è€Œå¯åŠ¨ä¾èµ–æ”¶é›†&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é™¤æ­¤ä¹‹å¤–ï¼Œè¿™ä¸ª effect å‡½æ•°ä¹Ÿä¼šè¢«å‹å…¥ä¸€ä¸ªåä¸ºâ€&lt;code&gt;activeReactiveEffectStack&lt;/code&gt;â€œï¼ˆæ­¤å¤„ä¸º &lt;code&gt;effectStack&lt;/code&gt;ï¼‰çš„æ ˆä¸­ï¼Œä¾›åç»­ä¾èµ–æ”¶é›†çš„æ—¶å€™ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;effect&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;fn&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// æ„é€ ä¸€ä¸ª effect&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; effect = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;effect&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;...args&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; run(effect, fn, args)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// ç«‹å³æ‰§è¡Œä¸€æ¬¡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  effect()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; effect&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;effect, fn, args&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (effectStack.indexOf(effect) === &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// å¾€æ± å­é‡Œæ”¾å…¥å½“å‰ effect&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      effectStack.push(effect)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// ç«‹å³æ‰§è¡Œä¸€é fn()&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// fn() æ‰§è¡Œè¿‡ç¨‹ä¼šå®Œæˆä¾èµ–æ”¶é›†ï¼Œä¼šç”¨åˆ° effect&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; fn(...args)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// å®Œæˆä¾èµ–æ”¶é›†åä»æ± å­ä¸­æ‰”æ‰è¿™ä¸ª effect&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      effectStack.pop()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è‡³æ­¤ï¼Œåˆå§‹åŒ–é˜¶æ®µå·²ç»å®Œæˆã€‚æ¥ä¸‹æ¥å°±æ˜¯æ•´ä¸ªç³»ç»Ÿæœ€å…³é”®çš„ä¸€æ­¥â€”â€”ä¾èµ–æ”¶é›†é˜¶æ®µã€‚&lt;br&gt;
    
    </summary>
    
      <category term="Vue3.x" scheme="https://zhanghao-web.github.io/categories/Vue3-x/"/>
    
    
      <category term="Vue" scheme="https://zhanghao-web.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>æ·±å…¥ç†è§£Node.jsä¸­çš„è¿›ç¨‹ä¸çº¿ç¨‹</title>
    <link href="https://zhanghao-web.github.io/2019/09/30/Node/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Node-js%E4%B8%AD%E7%9A%84%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B/"/>
    <id>https://zhanghao-web.github.io/2019/09/30/Node/æ·±å…¥ç†è§£Node-jsä¸­çš„è¿›ç¨‹ä¸çº¿ç¨‹/</id>
    <published>2019-09-30T05:30:38.000Z</published>
    <updated>2020-01-28T10:04:15.049Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://juejin.im/post/5d43017be51d4561f40adcf9" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a></p><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p><code>è¿›ç¨‹</code>ä¸<code>çº¿ç¨‹</code>æ˜¯ä¸€ä¸ªç¨‹åºå‘˜çš„å¿…çŸ¥æ¦‚å¿µï¼Œé¢è¯•ç»å¸¸è¢«é—®åŠï¼Œä½†æ˜¯ä¸€äº›æ–‡ç« å†…å®¹åªæ˜¯è®²è®²ç†è®ºçŸ¥è¯†ï¼Œå¯èƒ½ä¸€äº›å°ä¼™ä¼´å¹¶æ²¡æœ‰çœŸçš„ç†è§£ï¼Œåœ¨å®é™…å¼€å‘ä¸­åº”ç”¨ä¹Ÿæ¯”è¾ƒå°‘ã€‚æœ¬ç¯‡æ–‡ç« é™¤äº†ä»‹ç»æ¦‚å¿µï¼Œé€šè¿‡Node.js çš„è§’åº¦è®²è§£<code>è¿›ç¨‹</code>ä¸<code>çº¿ç¨‹</code>ï¼Œå¹¶ä¸”è®²è§£ä¸€äº›åœ¨é¡¹ç›®ä¸­çš„å®æˆ˜çš„åº”ç”¨ï¼Œè®©ä½ ä¸ä»…èƒ½è¿æˆ˜é¢è¯•å®˜è¿˜å¯ä»¥åœ¨å®æˆ˜ä¸­å®Œç¾åº”ç”¨</p><h2 id="æ–‡ç« å¯¼è§ˆ"><a href="#æ–‡ç« å¯¼è§ˆ" class="headerlink" title="æ–‡ç« å¯¼è§ˆ"></a>æ–‡ç« å¯¼è§ˆ</h2><p><img src="https://user-gold-cdn.xitu.io/2019/8/8/16c6cf612c275894?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="è¿›ç¨‹ä¸çº¿ç¨‹"></p><h2 id="é¢è¯•ä¼šé—®"><a href="#é¢è¯•ä¼šé—®" class="headerlink" title="é¢è¯•ä¼šé—®"></a>é¢è¯•ä¼šé—®</h2><ul><li>Node.jsæ˜¯å•çº¿ç¨‹å—ï¼Ÿ</li></ul><ul><li>Node.js åšè€—æ—¶çš„è®¡ç®—æ—¶å€™ï¼Œå¦‚ä½•é¿å…é˜»å¡ï¼Ÿ</li></ul><ul><li>Node.jså¦‚ä½•å®ç°å¤šè¿›ç¨‹çš„å¼€å¯å’Œå…³é—­ï¼Ÿ</li></ul><ul><li>Node.jså¯ä»¥åˆ›å»ºçº¿ç¨‹å—ï¼Ÿ</li></ul><ul><li>ä½ ä»¬å¼€å‘è¿‡ç¨‹ä¸­å¦‚ä½•å®ç°è¿›ç¨‹å®ˆæŠ¤çš„ï¼Ÿ</li></ul><ul><li>é™¤äº†ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œä½ ä»¬è‡ªå·±æ˜¯å¦å°è£…è¿‡ä¸€ä¸ªå¤šè¿›ç¨‹æ¶æ„?</li></ul><h2 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h2><p>è¿›ç¨‹<code>Process</code>æ˜¯è®¡ç®—æœºä¸­çš„ç¨‹åºå…³äºæŸæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ˜¯æ“ä½œç³»ç»Ÿç»“æ„çš„åŸºç¡€ï¼Œè¿›ç¨‹æ˜¯çº¿ç¨‹çš„å®¹å™¨ï¼ˆæ¥è‡ªç™¾ç§‘ï¼‰ã€‚è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„æœ€å°å•ä½ã€‚æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªæœåŠ¡ã€è¿è¡Œä¸€ä¸ªå®ä¾‹ï¼Œå°±æ˜¯å¼€ä¸€ä¸ªæœåŠ¡è¿›ç¨‹ï¼Œä¾‹å¦‚ Java é‡Œçš„ JVM æœ¬èº«å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼ŒNode.js é‡Œé€šè¿‡ node app.js å¼€å¯ä¸€ä¸ªæœåŠ¡è¿›ç¨‹ï¼Œå¤šè¿›ç¨‹å°±æ˜¯è¿›ç¨‹çš„å¤åˆ¶ï¼ˆforkï¼‰ï¼Œfork å‡ºæ¥çš„<strong>æ¯ä¸ªè¿›ç¨‹éƒ½æ‹¥æœ‰è‡ªå·±çš„ç‹¬ç«‹ç©ºé—´åœ°å€ã€æ•°æ®æ ˆï¼Œä¸€ä¸ªè¿›ç¨‹æ— æ³•è®¿é—®å¦å¤–ä¸€ä¸ªè¿›ç¨‹é‡Œå®šä¹‰çš„å˜é‡ã€æ•°æ®ç»“æ„ï¼Œåªæœ‰å»ºç«‹äº† IPC é€šä¿¡ï¼Œè¿›ç¨‹ä¹‹é—´æ‰å¯æ•°æ®å…±äº«</strong>ã€‚</p><ul><li>Node.jså¼€å¯æœåŠ¡è¿›ç¨‹ä¾‹å­</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer();</span><br><span class="line">server.listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    process.title=<span class="string">'ç¨‹åºå‘˜æˆé•¿æŒ‡åŒ—æµ‹è¯•è¿›ç¨‹'</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'è¿›ç¨‹id'</span>,process.pid)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸Šé¢ä»£ç åï¼Œä»¥ä¸‹ä¸º Mac ç³»ç»Ÿè‡ªå¸¦çš„ç›‘æ§å·¥å…· â€œæ´»åŠ¨ç›‘è§†å™¨â€ æ‰€å±•ç¤ºçš„æ•ˆæœï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆšå¼€å¯çš„ Nodejs è¿›ç¨‹ 7663</p><p><img src="https://user-gold-cdn.xitu.io/2019/8/1/16c4dc0ca13fec40?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="è¿›ç¨‹1"></p><h2 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h2><p>çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿèƒ½å¤Ÿè¿›è¡Œè¿ç®—è°ƒåº¦çš„æœ€å°å•ä½ï¼Œé¦–å…ˆæˆ‘ä»¬è¦æ¸…æ¥šçº¿ç¨‹æ˜¯éš¶å±äºè¿›ç¨‹çš„ï¼Œè¢«åŒ…å«äºè¿›ç¨‹ä¹‹ä¸­ã€‚<strong>ä¸€ä¸ªçº¿ç¨‹åªèƒ½éš¶å±äºä¸€ä¸ªè¿›ç¨‹ï¼Œä½†æ˜¯ä¸€ä¸ªè¿›ç¨‹æ˜¯å¯ä»¥æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹çš„</strong>ã€‚</p><h3 id="å•çº¿ç¨‹"><a href="#å•çº¿ç¨‹" class="headerlink" title="å•çº¿ç¨‹"></a>å•çº¿ç¨‹</h3><p><strong>å•çº¿ç¨‹å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹åªå¼€ä¸€ä¸ªçº¿ç¨‹</strong></p><p>Javascript å°±æ˜¯å±äºå•çº¿ç¨‹ï¼Œç¨‹åºé¡ºåºæ‰§è¡Œ(è¿™é‡Œæš‚ä¸”ä¸æJSå¼‚æ­¥)ï¼Œå¯ä»¥æƒ³è±¡ä¸€ä¸‹é˜Ÿåˆ—ï¼Œå‰é¢ä¸€ä¸ªæ‰§è¡Œå®Œä¹‹åï¼Œåé¢æ‰å¯ä»¥æ‰§è¡Œï¼Œå½“ä½ åœ¨ä½¿ç”¨å•çº¿ç¨‹è¯­è¨€ç¼–ç æ—¶åˆ‡å‹¿æœ‰è¿‡å¤šè€—æ—¶çš„åŒæ­¥æ“ä½œï¼Œå¦åˆ™çº¿ç¨‹ä¼šé€ æˆé˜»å¡ï¼Œå¯¼è‡´åç»­å“åº”æ— æ³•å¤„ç†ã€‚ä½ å¦‚æœé‡‡ç”¨ Javascript è¿›è¡Œç¼–ç æ—¶å€™ï¼Œè¯·å°½å¯èƒ½çš„åˆ©ç”¨Javascriptå¼‚æ­¥æ“ä½œçš„ç‰¹æ€§ã€‚</p><p><strong>ç»å…¸è®¡ç®—è€—æ—¶é€ æˆçº¿ç¨‹é˜»å¡çš„ä¾‹å­</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> longComputation = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1e10</span>; i++) &#123;</span><br><span class="line">    sum += i;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> server = http.createServer();</span><br><span class="line">server.on(<span class="string">'request'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.url === <span class="string">'/compute'</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.info(<span class="string">'è®¡ç®—å¼€å§‹'</span>,<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line">    <span class="keyword">const</span> sum = longComputation();</span><br><span class="line">    <span class="built_in">console</span>.info(<span class="string">'è®¡ç®—ç»“æŸ'</span>,<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line">    <span class="keyword">return</span> res.end(<span class="string">`Sum is <span class="subst">$&#123;sum&#125;</span>`</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.end(<span class="string">'Ok'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="comment">//æ‰“å°ç»“æœ</span></span><br><span class="line"><span class="comment">//è®¡ç®—å¼€å§‹ 2019-07-28T07:08:49.849Z</span></span><br><span class="line"><span class="comment">//è®¡ç®—ç»“æŸ 2019-07-28T07:09:04.522Z</span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ‰“å°ç»“æœï¼Œå½“æˆ‘ä»¬è°ƒç”¨<code>127.0.0.1:3000/compute</code><br>çš„æ—¶å€™ï¼Œå¦‚æœæƒ³è¦è°ƒç”¨å…¶ä»–çš„è·¯ç”±åœ°å€æ¯”å¦‚<code>127.0.0.1/</code>å¤§çº¦éœ€è¦15ç§’æ—¶é—´ï¼Œä¹Ÿå¯ä»¥è¯´ä¸€ä¸ªç”¨æˆ·è¯·æ±‚å®Œç¬¬ä¸€ä¸ªcomputeæ¥å£åéœ€è¦ç­‰å¾…15ç§’ï¼Œè¿™å¯¹äºç”¨æˆ·æ¥è¯´æ˜¯æå…¶ä¸å‹å¥½çš„ã€‚ä¸‹æ–‡æˆ‘ä¼šé€šè¿‡åˆ›å»ºå¤šè¿›ç¨‹çš„æ–¹å¼child_process.fork å’Œcluster æ¥è§£å†³è§£å†³è¿™ä¸ªé—®é¢˜ã€‚<br><a id="more"></a></p><blockquote><p>å•çº¿ç¨‹çš„ä¸€äº›è¯´æ˜</p><ul><li>Node.js è™½ç„¶æ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œä½†æ˜¯å…¶åŸºäºäº‹ä»¶é©±åŠ¨ã€å¼‚æ­¥éé˜»å¡æ¨¡å¼ï¼Œå¯ä»¥åº”ç”¨äºé«˜å¹¶å‘åœºæ™¯ï¼Œé¿å…äº†çº¿ç¨‹åˆ›å»ºã€çº¿ç¨‹ä¹‹é—´ä¸Šä¸‹æ–‡åˆ‡æ¢æ‰€äº§ç”Ÿçš„èµ„æºå¼€é”€ã€‚</li><li>å½“ä½ çš„é¡¹ç›®ä¸­éœ€è¦æœ‰å¤§é‡è®¡ç®—ï¼ŒCPU è€—æ—¶çš„æ“ä½œæ—¶å€™ï¼Œè¦æ³¨æ„è€ƒè™‘å¼€å¯å¤šè¿›ç¨‹æ¥å®Œæˆäº†ã€‚</li><li>Node.js å¼€å‘è¿‡ç¨‹ä¸­ï¼Œé”™è¯¯ä¼šå¼•èµ·æ•´ä¸ªåº”ç”¨é€€å‡ºï¼Œåº”ç”¨çš„å¥å£®æ€§å€¼å¾—è€ƒéªŒï¼Œå°¤å…¶æ˜¯é”™è¯¯çš„å¼‚å¸¸æŠ›å‡ºï¼Œä»¥åŠè¿›ç¨‹å®ˆæŠ¤æ˜¯å¿…é¡»è¦åšçš„ã€‚</li><li>å•çº¿ç¨‹æ— æ³•åˆ©ç”¨å¤šæ ¸CPUï¼Œä½†æ˜¯åæ¥Node.js æä¾›çš„APIä»¥åŠä¸€äº›ç¬¬ä¸‰æ–¹å·¥å…·ç›¸åº”éƒ½å¾—åˆ°äº†è§£å†³ï¼Œæ–‡ç« åé¢éƒ½ä¼šè®²åˆ°ã€‚</li></ul></blockquote><h2 id="Node-js-ä¸­çš„è¿›ç¨‹ä¸çº¿ç¨‹"><a href="#Node-js-ä¸­çš„è¿›ç¨‹ä¸çº¿ç¨‹" class="headerlink" title="Node.js ä¸­çš„è¿›ç¨‹ä¸çº¿ç¨‹"></a>Node.js ä¸­çš„è¿›ç¨‹ä¸çº¿ç¨‹</h2><p>Node.js æ˜¯ Javascript åœ¨æœåŠ¡ç«¯çš„è¿è¡Œç¯å¢ƒï¼Œæ„å»ºåœ¨ chrome çš„ V8 å¼•æ“ä¹‹ä¸Šï¼ŒåŸºäºäº‹ä»¶é©±åŠ¨ã€éé˜»å¡I/Oæ¨¡å‹ï¼Œå……åˆ†åˆ©ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„å¼‚æ­¥ I/O è¿›è¡Œå¤šä»»åŠ¡çš„æ‰§è¡Œï¼Œé€‚åˆäº I/O å¯†é›†å‹çš„åº”ç”¨åœºæ™¯ï¼Œå› ä¸ºå¼‚æ­¥ï¼Œç¨‹åºæ— éœ€é˜»å¡ç­‰å¾…ç»“æœè¿”å›ï¼Œè€Œæ˜¯åŸºäºå›è°ƒé€šçŸ¥çš„æœºåˆ¶ï¼ŒåŸæœ¬åŒæ­¥æ¨¡å¼ç­‰å¾…çš„æ—¶é—´ï¼Œåˆ™å¯ä»¥ç”¨æ¥å¤„ç†å…¶å®ƒä»»åŠ¡</p><blockquote><p>ç§‘æ™®ï¼šåœ¨ Web æœåŠ¡å™¨æ–¹é¢ï¼Œè‘—åçš„ Nginx ä¹Ÿæ˜¯é‡‡ç”¨æ­¤æ¨¡å¼ï¼ˆäº‹ä»¶é©±åŠ¨ï¼‰ï¼Œé¿å…äº†å¤šçº¿ç¨‹çš„çº¿ç¨‹åˆ›å»ºã€çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ï¼ŒNginx é‡‡ç”¨ C è¯­è¨€è¿›è¡Œç¼–å†™ï¼Œä¸»è¦ç”¨æ¥åšé«˜æ€§èƒ½çš„ Web æœåŠ¡å™¨ï¼Œä¸é€‚åˆåšä¸šåŠ¡ã€‚</p></blockquote><p>Webä¸šåŠ¡å¼€å‘ä¸­ï¼Œå¦‚æœä½ æœ‰é«˜å¹¶å‘åº”ç”¨åœºæ™¯é‚£ä¹ˆ Node.js ä¼šæ˜¯ä½ ä¸é”™çš„é€‰æ‹©ã€‚</p><p>åœ¨å•æ ¸ CPU ç³»ç»Ÿä¹‹ä¸Šæˆ‘ä»¬é‡‡ç”¨ å•è¿›ç¨‹ + å•çº¿ç¨‹ çš„æ¨¡å¼æ¥å¼€å‘ã€‚åœ¨å¤šæ ¸ CPU ç³»ç»Ÿä¹‹ä¸Šï¼Œå¯ä»¥é€šè¿‡ <code>child_process.fork</code> å¼€å¯å¤šä¸ªè¿›ç¨‹ï¼ˆNode.js åœ¨ v0.8 ç‰ˆæœ¬ä¹‹åæ–°å¢äº†Cluster æ¥å®ç°å¤šè¿›ç¨‹æ¶æ„ï¼‰ ï¼Œå³ å¤šè¿›ç¨‹ + å•çº¿ç¨‹ æ¨¡å¼ã€‚æ³¨æ„ï¼šå¼€å¯å¤šè¿›ç¨‹ä¸æ˜¯ä¸ºäº†è§£å†³é«˜å¹¶å‘ï¼Œä¸»è¦æ˜¯è§£å†³äº†å•è¿›ç¨‹æ¨¡å¼ä¸‹ Node.js CPU åˆ©ç”¨ç‡ä¸è¶³çš„æƒ…å†µï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸ CPU çš„æ€§èƒ½ã€‚</p><h3 id="Node-js-ä¸­çš„è¿›ç¨‹"><a href="#Node-js-ä¸­çš„è¿›ç¨‹" class="headerlink" title="Node.js ä¸­çš„è¿›ç¨‹"></a>Node.js ä¸­çš„è¿›ç¨‹</h3><h4 id="process-æ¨¡å—"><a href="#process-æ¨¡å—" class="headerlink" title="process æ¨¡å—"></a>process æ¨¡å—</h4><p>Node.js ä¸­çš„è¿›ç¨‹ Process æ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œæ— éœ€ require ç›´æ¥ä½¿ç”¨ï¼Œç»™æˆ‘ä»¬æä¾›äº†å½“å‰è¿›ç¨‹ä¸­çš„ç›¸å…³ä¿¡æ¯ã€‚å®˜æ–¹æ–‡æ¡£æä¾›äº†è¯¦ç»†çš„è¯´æ˜ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥äº²è‡ªå®è·µä¸‹ Process æ–‡æ¡£ã€‚</p><ul><li>process.envï¼šç¯å¢ƒå˜é‡ï¼Œä¾‹å¦‚é€šè¿‡  process.env.NODE_ENV è·å–ä¸åŒç¯å¢ƒé¡¹ç›®é…ç½®ä¿¡æ¯</li><li>process.nextTickï¼šè¿™ä¸ªåœ¨è°ˆåŠ Event Loop æ—¶ç»å¸¸ä¸ºä¼šæåˆ°</li><li>process.pidï¼šè·å–å½“å‰è¿›ç¨‹id</li><li>process.ppidï¼šå½“å‰è¿›ç¨‹å¯¹åº”çš„çˆ¶è¿›ç¨‹</li><li>process.cwd()ï¼šè·å–å½“å‰è¿›ç¨‹å·¥ä½œç›®å½•ï¼Œ</li><li>process.platformï¼šè·å–å½“å‰è¿›ç¨‹è¿è¡Œçš„æ“ä½œç³»ç»Ÿå¹³å°</li><li>process.uptime()ï¼šå½“å‰è¿›ç¨‹å·²è¿è¡Œæ—¶é—´ï¼Œä¾‹å¦‚ï¼špm2 å®ˆæŠ¤è¿›ç¨‹çš„ uptime å€¼</li><li>è¿›ç¨‹äº‹ä»¶ï¼šprocess.on(â€˜uncaughtExceptionâ€™, cb) æ•è·å¼‚å¸¸ä¿¡æ¯ã€process.on(â€˜exitâ€™, cbï¼‰è¿›ç¨‹æ¨å‡ºç›‘å¬</li><li>ä¸‰ä¸ªæ ‡å‡†æµï¼šprocess.stdout æ ‡å‡†è¾“å‡ºã€process.stdin æ ‡å‡†è¾“å…¥ã€process.stderr æ ‡å‡†é”™è¯¯è¾“å‡º</li><li>process.title æŒ‡å®šè¿›ç¨‹åç§°ï¼Œæœ‰çš„æ—¶å€™éœ€è¦ç»™è¿›ç¨‹æŒ‡å®šä¸€ä¸ªåç§°</li></ul><p>ä»¥ä¸Šä»…åˆ—ä¸¾äº†éƒ¨åˆ†å¸¸ç”¨åˆ°åŠŸèƒ½ç‚¹ï¼Œé™¤äº† Process ä¹‹å¤– Node.js è¿˜æä¾›äº† child_process æ¨¡å—ç”¨æ¥å¯¹å­è¿›ç¨‹è¿›è¡Œæ“ä½œï¼Œåœ¨ä¸‹æ–‡ Nodejsè¿›ç¨‹åˆ›å»ºä¼šç»§ç»­è®²è¿°ã€‚</p><h3 id="Node-js-è¿›ç¨‹åˆ›å»º"><a href="#Node-js-è¿›ç¨‹åˆ›å»º" class="headerlink" title="Node.js è¿›ç¨‹åˆ›å»º"></a>Node.js è¿›ç¨‹åˆ›å»º</h3><p>è¿›ç¨‹åˆ›å»ºæœ‰å¤šç§æ–¹å¼ï¼Œæœ¬ç¯‡æ–‡ç« ä»¥child_processæ¨¡å—å’Œclusteræ¨¡å—è¿›è¡Œè®²è§£ã€‚</p><h4 id="child-processæ¨¡å—"><a href="#child-processæ¨¡å—" class="headerlink" title="child_processæ¨¡å—"></a>child_processæ¨¡å—</h4><p>child_process æ˜¯ Node.js çš„å†…ç½®æ¨¡å—ï¼Œå®˜ç½‘åœ°å€ï¼š</p><blockquote><p>child_process å®˜ç½‘åœ°å€ï¼š<a href="https://link.juejin.im/?target=http%3A%2F%2Fnodejs.cn%2Fapi%2Fchild_process.html%23child_process_child_process">nodejs.cn/api/child_pâ€¦</a></p></blockquote><p>å‡ ä¸ªå¸¸ç”¨å‡½æ•°ï¼š å››ç§æ–¹å¼</p><ul><li><code>child_process.spawn()</code>ï¼šé€‚ç”¨äºè¿”å›å¤§é‡æ•°æ®ï¼Œä¾‹å¦‚å›¾åƒå¤„ç†ï¼ŒäºŒè¿›åˆ¶æ•°æ®å¤„ç†ã€‚</li><li><code>child_process.exec()</code>ï¼šé€‚ç”¨äºå°é‡æ•°æ®ï¼ŒmaxBuffer é»˜è®¤å€¼ä¸º 200 * 1024 è¶…å‡ºè¿™ä¸ªé»˜è®¤å€¼å°†ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼Œæ•°æ®é‡è¿‡å¤§å¯é‡‡ç”¨ spawnã€‚</li><li><code>child_process.execFile()</code>ï¼šç±»ä¼¼ child_process.exec()ï¼ŒåŒºåˆ«æ˜¯ä¸èƒ½é€šè¿‡ shell æ¥æ‰§è¡Œï¼Œä¸æ”¯æŒåƒ I/O é‡å®šå‘å’Œæ–‡ä»¶æŸ¥æ‰¾è¿™æ ·çš„è¡Œä¸º</li><li><code>child_process.fork()</code>ï¼š è¡ç”Ÿæ–°çš„è¿›ç¨‹ï¼Œè¿›ç¨‹ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„ V8 å®ä¾‹ã€å†…å­˜ï¼Œç³»ç»Ÿèµ„æºæ˜¯æœ‰é™çš„ï¼Œä¸å»ºè®®è¡ç”Ÿå¤ªå¤šçš„å­è¿›ç¨‹å‡ºæ¥ï¼Œé€šé•¿æ ¹æ®ç³»ç»Ÿ<strong> CPU æ ¸å¿ƒæ•°</strong>è®¾ç½®ã€‚</li></ul><blockquote><p>CPU æ ¸å¿ƒæ•°è¿™é‡Œç‰¹åˆ«è¯´æ˜ä¸‹ï¼Œfork ç¡®å®å¯ä»¥å¼€å¯å¤šä¸ªè¿›ç¨‹ï¼Œä½†æ˜¯å¹¶ä¸å»ºè®®è¡ç”Ÿå‡ºæ¥å¤ªå¤šçš„è¿›ç¨‹ï¼Œcpuæ ¸å¿ƒæ•°çš„è·å–æ–¹å¼<code>const cpus = require(&#39;os&#39;).cpus()</code>;,è¿™é‡Œ cpus è¿”å›ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼ŒåŒ…å«æ‰€å®‰è£…çš„æ¯ä¸ª CPU/å†…æ ¸çš„ä¿¡æ¯ï¼ŒäºŒè€…æ€»å’Œçš„æ•°ç»„å“¦ã€‚å‡è®¾ä¸»æœºè£…æœ‰ä¸¤ä¸ªcpuï¼Œæ¯ä¸ªcpuæœ‰4ä¸ªæ ¸ï¼Œé‚£ä¹ˆæ€»æ ¸æ•°å°±æ˜¯8ã€‚</p></blockquote><p><em>forkå¼€å¯å­è¿›ç¨‹ Demo</em></p><p>forkå¼€å¯å­è¿›ç¨‹è§£å†³æ–‡ç« èµ·åˆçš„è®¡ç®—è€—æ—¶é€ æˆçº¿ç¨‹é˜»å¡ã€‚ åœ¨è¿›è¡Œ compute è®¡ç®—æ—¶åˆ›å»ºå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹è®¡ç®—å®Œæˆé€šè¿‡ send æ–¹æ³•å°†ç»“æœå‘é€ç»™ä¸»è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹é€šè¿‡ message ç›‘å¬åˆ°ä¿¡æ¯åå¤„ç†å¹¶é€€å‡ºã€‚</p><blockquote><p>fork_app.js</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> fork = <span class="built_in">require</span>(<span class="string">'child_process'</span>).fork;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(req.url == <span class="string">'/compute'</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> compute = fork(<span class="string">'./fork_compute.js'</span>);</span><br><span class="line">        compute.send(<span class="string">'å¼€å¯ä¸€ä¸ªæ–°çš„å­è¿›ç¨‹'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å½“ä¸€ä¸ªå­è¿›ç¨‹ä½¿ç”¨ process.send() å‘é€æ¶ˆæ¯æ—¶ä¼šè§¦å‘ 'message' äº‹ä»¶</span></span><br><span class="line">        compute.on(<span class="string">'message'</span>, sum =&gt; &#123;</span><br><span class="line">            res.end(<span class="string">`Sum is <span class="subst">$&#123;sum&#125;</span>`</span>);</span><br><span class="line">            compute.kill();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å­è¿›ç¨‹ç›‘å¬åˆ°ä¸€äº›é”™è¯¯æ¶ˆæ¯é€€å‡º</span></span><br><span class="line">        compute.on(<span class="string">'close'</span>, (code, signal) =&gt; &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`æ”¶åˆ°closeäº‹ä»¶ï¼Œå­è¿›ç¨‹æ”¶åˆ°ä¿¡å· <span class="subst">$&#123;signal&#125;</span> è€Œç»ˆæ­¢ï¼Œé€€å‡ºç  <span class="subst">$&#123;code&#125;</span>`</span>);</span><br><span class="line">            compute.kill();</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        res.end(<span class="string">`ok`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`server started at http://<span class="subst">$&#123;<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>&#125;</span>:<span class="subst">$&#123;<span class="number">3000</span>&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p>fork_compute.js</p></blockquote><p>é’ˆå¯¹æ–‡åˆéœ€è¦è¿›è¡Œè®¡ç®—çš„çš„ä¾‹å­æˆ‘ä»¬åˆ›å»ºå­è¿›ç¨‹æ‹†åˆ†å‡ºæ¥å•ç‹¬è¿›è¡Œè¿ç®—ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> computation = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">console</span>.info(<span class="string">'è®¡ç®—å¼€å§‹'</span>);</span><br><span class="line">    <span class="built_in">console</span>.time(<span class="string">'è®¡ç®—è€—æ—¶'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1e10</span>; i++) &#123;</span><br><span class="line">        sum += i</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.info(<span class="string">'è®¡ç®—ç»“æŸ'</span>);</span><br><span class="line">    <span class="built_in">console</span>.timeEnd(<span class="string">'è®¡ç®—è€—æ—¶'</span>);</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">process.on(<span class="string">'message'</span>, msg =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(msg, <span class="string">'process.pid'</span>, process.pid); <span class="comment">// å­è¿›ç¨‹id</span></span><br><span class="line">    <span class="keyword">const</span> sum = computation();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœNode.jsè¿›ç¨‹æ˜¯é€šè¿‡è¿›ç¨‹é—´é€šä¿¡äº§ç”Ÿçš„ï¼Œé‚£ä¹ˆï¼Œprocess.send()æ–¹æ³•å¯ä»¥ç”¨æ¥ç»™çˆ¶è¿›ç¨‹å‘é€æ¶ˆæ¯</span></span><br><span class="line">    process.send(sum);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="clusteræ¨¡å—"><a href="#clusteræ¨¡å—" class="headerlink" title="clusteræ¨¡å—"></a>clusteræ¨¡å—</h4><p>cluster å¼€å¯å­è¿›ç¨‹Demo</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> numCPUs = <span class="built_in">require</span>(<span class="string">'os'</span>).cpus().length;</span><br><span class="line"><span class="keyword">const</span> cluster = <span class="built_in">require</span>(<span class="string">'cluster'</span>);</span><br><span class="line"><span class="keyword">if</span>(cluster.isMaster)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Master proces id is'</span>,process.pid);</span><br><span class="line">    <span class="comment">// fork workers</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i= <span class="number">0</span>;i&lt;numCPUs;i++)&#123;</span><br><span class="line">        cluster.fork();</span><br><span class="line">    &#125;</span><br><span class="line">    cluster.on(<span class="string">'exit'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">worker,code,signal</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'worker process died,id'</span>,worker.process.pid)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">// Workerå¯ä»¥å…±äº«åŒä¸€ä¸ªTCPè¿æ¥</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œæ˜¯ä¸€ä¸ªhttpæœåŠ¡å™¨</span></span><br><span class="line">    http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">        res.writeHead(<span class="number">200</span>);</span><br><span class="line">        res.end(<span class="string">'hello word'</span>);</span><br><span class="line">    &#125;).listen(<span class="number">8000</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>clusteråŸç†åˆ†æ</p><p><img src="https://user-gold-cdn.xitu.io/2019/8/3/16c5658b2e97e9b2?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="clusteråŸç†åˆ†æ"></p><p>clusteræ¨¡å—è°ƒç”¨forkæ–¹æ³•æ¥åˆ›å»ºå­è¿›ç¨‹ï¼Œè¯¥æ–¹æ³•ä¸child_processä¸­çš„forkæ˜¯åŒä¸€ä¸ªæ–¹æ³•ã€‚</p><p>clusteræ¨¡å—é‡‡ç”¨çš„æ˜¯ç»å…¸çš„ä¸»ä»æ¨¡å‹ï¼ŒClusterä¼šåˆ›å»ºä¸€ä¸ªmasterï¼Œç„¶åæ ¹æ®ä½ æŒ‡å®šçš„æ•°é‡å¤åˆ¶å‡ºå¤šä¸ªå­è¿›ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨cluster.isMasterå±æ€§åˆ¤æ–­å½“å‰è¿›ç¨‹æ˜¯masterè¿˜æ˜¯worker(å·¥ä½œè¿›ç¨‹)ã€‚ç”±masterè¿›ç¨‹æ¥ç®¡ç†æ‰€æœ‰çš„å­è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹ä¸è´Ÿè´£å…·ä½“çš„ä»»åŠ¡å¤„ç†ï¼Œä¸»è¦å·¥ä½œæ˜¯è´Ÿè´£è°ƒåº¦å’Œç®¡ç†ã€‚</p><p>clusteræ¨¡å—ä½¿ç”¨å†…ç½®çš„è´Ÿè½½å‡è¡¡æ¥æ›´å¥½åœ°å¤„ç†çº¿ç¨‹ä¹‹é—´çš„å‹åŠ›ï¼Œè¯¥è´Ÿè½½å‡è¡¡ä½¿ç”¨äº†Round-robinç®—æ³•ï¼ˆä¹Ÿè¢«ç§°ä¹‹ä¸ºå¾ªç¯ç®—æ³•ï¼‰ã€‚å½“ä½¿ç”¨Round-robinè°ƒåº¦ç­–ç•¥æ—¶ï¼Œmaster accepts()æ‰€æœ‰ä¼ å…¥çš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†ç›¸åº”çš„TCPè¯·æ±‚å¤„ç†å‘é€ç»™é€‰ä¸­çš„å·¥ä½œè¿›ç¨‹ï¼ˆè¯¥æ–¹å¼ä»ç„¶é€šè¿‡IPCæ¥è¿›è¡Œé€šä¿¡ï¼‰ã€‚</p><p>å¼€å¯å¤šè¿›ç¨‹æ—¶å€™ç«¯å£ç–‘é—®è®²è§£ï¼šå¦‚æœå¤šä¸ªNodeè¿›ç¨‹ç›‘å¬åŒä¸€ä¸ªç«¯å£æ—¶ä¼šå‡ºç° Error:listen EADDRIUNSçš„é”™è¯¯ï¼Œè€Œclusteræ¨¡å—ä¸ºä»€ä¹ˆå¯ä»¥è®©å¤šä¸ªå­è¿›ç¨‹ç›‘å¬åŒä¸€ä¸ªç«¯å£å‘¢?åŸå› æ˜¯masterè¿›ç¨‹å†…éƒ¨å¯åŠ¨äº†ä¸€ä¸ªTCPæœåŠ¡å™¨ï¼Œè€ŒçœŸæ­£ç›‘å¬ç«¯å£çš„åªæœ‰è¿™ä¸ªæœåŠ¡å™¨ï¼Œå½“æ¥è‡ªå‰ç«¯çš„è¯·æ±‚è§¦å‘æœåŠ¡å™¨çš„connectionäº‹ä»¶åï¼Œmasterä¼šå°†å¯¹åº”çš„socketå…·æŸ„å‘é€ç»™å­è¿›ç¨‹ã€‚</p><h4 id="child-process-æ¨¡å—ä¸cluster-æ¨¡å—æ€»ç»“"><a href="#child-process-æ¨¡å—ä¸cluster-æ¨¡å—æ€»ç»“" class="headerlink" title="child_process æ¨¡å—ä¸cluster æ¨¡å—æ€»ç»“"></a>child_process æ¨¡å—ä¸cluster æ¨¡å—æ€»ç»“</h4><p>æ— è®ºæ˜¯ child_process æ¨¡å—è¿˜æ˜¯ cluster æ¨¡å—ï¼Œä¸ºäº†è§£å†³ Node.js å®ä¾‹å•çº¿ç¨‹è¿è¡Œï¼Œæ— æ³•åˆ©ç”¨å¤šæ ¸ CPU çš„é—®é¢˜è€Œå‡ºç°çš„ã€‚æ ¸å¿ƒå°±æ˜¯<strong>çˆ¶è¿›ç¨‹ï¼ˆå³ master è¿›ç¨‹ï¼‰è´Ÿè´£ç›‘å¬ç«¯å£ï¼Œæ¥æ”¶åˆ°æ–°çš„è¯·æ±‚åå°†å…¶åˆ†å‘ç»™ä¸‹é¢çš„ worker è¿›ç¨‹</strong>ã€‚</p><p>clusteræ¨¡å—çš„ä¸€ä¸ªå¼Šç«¯ï¼š</p><p><img src="https://user-gold-cdn.xitu.io/2019/8/3/16c565aaeb065b4a?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="clusterå¼Šç«¯"></p><p>clusterå†…éƒ¨éšæ—¶çš„æ„å»ºTCPæœåŠ¡å™¨çš„æ–¹å¼æ¥è¯´å¯¹ä½¿ç”¨è€…ç¡®å®ç®€å•å’Œé€æ˜äº†å¾ˆå¤šï¼Œä½†æ˜¯è¿™ç§æ–¹å¼æ— æ³•åƒä½¿ç”¨child_processé‚£æ ·çµæ´»ï¼Œå› ä¸ºä¸€ç›´ä¸»è¿›ç¨‹åªèƒ½ç®¡ç†ä¸€ç»„ç›¸åŒçš„å·¥ä½œè¿›ç¨‹ï¼Œè€Œè‡ªè¡Œé€šè¿‡child_processæ¥åˆ›å»ºå·¥ä½œè¿›ç¨‹ï¼Œä¸€ä¸ªä¸»è¿›ç¨‹å¯ä»¥æ§åˆ¶å¤šç»„è¿›ç¨‹ã€‚åŸå› æ˜¯child_processæ“ä½œå­è¿›ç¨‹æ—¶ï¼Œå¯ä»¥éšå¼çš„åˆ›å»ºå¤šä¸ªTCPæœåŠ¡å™¨ï¼Œå¯¹æ¯”ä¸Šé¢çš„ä¸¤å¹…å›¾åº”è¯¥èƒ½ç†è§£æˆ‘è¯´çš„å†…å®¹ã€‚</p><h4 id="Node-jsè¿›ç¨‹é€šä¿¡åŸç†"><a href="#Node-jsè¿›ç¨‹é€šä¿¡åŸç†" class="headerlink" title="Node.jsè¿›ç¨‹é€šä¿¡åŸç†"></a>Node.jsè¿›ç¨‹é€šä¿¡åŸç†</h4><p>å‰é¢è®²è§£çš„æ— è®ºæ˜¯child_processæ¨¡å—ï¼Œè¿˜æ˜¯clusteræ¨¡å—ï¼Œéƒ½éœ€è¦ä¸»è¿›ç¨‹å’Œå·¥ä½œè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚é€šè¿‡fork()æˆ–è€…å…¶ä»–APIï¼Œåˆ›å»ºäº†å­è¿›ç¨‹ä¹‹åï¼Œä¸ºäº†å®ç°çˆ¶å­è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼Œçˆ¶å­è¿›ç¨‹ä¹‹é—´æ‰èƒ½é€šè¿‡messageå’Œsend()ä¼ é€’ä¿¡æ¯ã€‚</p><p>IPCè¿™ä¸ªè¯æˆ‘æƒ³å¤§å®¶å¹¶ä¸é™Œç”Ÿï¼Œä¸ç®¡é‚£ä¸€å¼ å¼€å‘è¯­è¨€åªè¦æåˆ°è¿›ç¨‹é€šä¿¡ï¼Œéƒ½ä¼šæåˆ°å®ƒã€‚IPCçš„å…¨ç§°æ˜¯Inter-Process Communication,å³è¿›ç¨‹é—´é€šä¿¡ã€‚å®ƒçš„ç›®çš„æ˜¯ä¸ºäº†è®©ä¸åŒçš„è¿›ç¨‹èƒ½å¤Ÿäº’ç›¸è®¿é—®èµ„æºå¹¶è¿›è¡Œåè°ƒå·¥ä½œã€‚å®ç°è¿›ç¨‹é—´é€šä¿¡çš„æŠ€æœ¯æœ‰å¾ˆå¤šï¼Œå¦‚å‘½åç®¡é“ï¼ŒåŒ¿åç®¡é“ï¼Œsocketï¼Œä¿¡å·é‡ï¼Œå…±äº«å†…å­˜ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ç­‰ã€‚Nodeä¸­å®ç°IPCé€šé“æ˜¯ä¾èµ–äºlibuvã€‚windowsä¸‹ç”±å‘½åç®¡é“(name pipe)å®ç°ï¼Œ*nixç³»ç»Ÿåˆ™é‡‡ç”¨Unix Domain Socketå®ç°ã€‚è¡¨ç°åœ¨åº”ç”¨å±‚ä¸Šçš„è¿›ç¨‹é—´é€šä¿¡åªæœ‰ç®€å•çš„messageäº‹ä»¶å’Œsend()æ–¹æ³•ï¼Œæ¥å£ååˆ†ç®€æ´å’Œæ¶ˆæ¯åŒ–ã€‚</p><p>IPCåˆ›å»ºå’Œå®ç°ç¤ºæ„å›¾</p><p><img src="https://user-gold-cdn.xitu.io/2019/8/4/16c5b379ad12199e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="IPC"></p><p>IPCé€šä¿¡ç®¡é“æ˜¯å¦‚ä½•åˆ›å»ºçš„</p><p><img src="https://user-gold-cdn.xitu.io/2019/8/4/16c5b3812e3bb7d9?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="IPCé€šä¿¡"></p><p>çˆ¶è¿›ç¨‹åœ¨å®é™…åˆ›å»ºå­è¿›ç¨‹ä¹‹å‰ï¼Œä¼šåˆ›å»ºIPCé€šé“å¹¶ç›‘å¬å®ƒï¼Œç„¶åæ‰çœŸæ­£çš„åˆ›å»ºå‡ºå­è¿›ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿä¼šé€šè¿‡ç¯å¢ƒå˜é‡ï¼ˆNODE_CHANNEL_FDï¼‰å‘Šè¯‰å­è¿›ç¨‹è¿™ä¸ªIPCé€šé“çš„æ–‡ä»¶æè¿°ç¬¦ã€‚å­è¿›ç¨‹åœ¨å¯åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®æ–‡ä»¶æè¿°ç¬¦å»è¿æ¥è¿™ä¸ªå·²å­˜åœ¨çš„IPCé€šé“ï¼Œä»è€Œå®Œæˆçˆ¶å­è¿›ç¨‹ä¹‹é—´çš„è¿æ¥</p><h4 id="Node-jså¥æŸ„ä¼ é€’"><a href="#Node-jså¥æŸ„ä¼ é€’" class="headerlink" title="Node.jså¥æŸ„ä¼ é€’"></a>Node.jså¥æŸ„ä¼ é€’</h4><p>è®²å¥æŸ„ä¹‹å‰ï¼Œå…ˆæƒ³ä¸€ä¸ªé—®é¢˜ï¼Œsendå¥æŸ„å‘é€çš„æ—¶å€™ï¼ŒçœŸçš„æ˜¯å°†æœåŠ¡å™¨å¯¹è±¡å‘é€ç»™äº†å­è¿›ç¨‹ï¼Ÿ</p><h4 id="å­è¿›ç¨‹å¯¹è±¡send-æ–¹æ³•å¯ä»¥å‘é€çš„å¥æŸ„ç±»å‹"><a href="#å­è¿›ç¨‹å¯¹è±¡send-æ–¹æ³•å¯ä»¥å‘é€çš„å¥æŸ„ç±»å‹" class="headerlink" title="å­è¿›ç¨‹å¯¹è±¡send()æ–¹æ³•å¯ä»¥å‘é€çš„å¥æŸ„ç±»å‹"></a>å­è¿›ç¨‹å¯¹è±¡send()æ–¹æ³•å¯ä»¥å‘é€çš„å¥æŸ„ç±»å‹</h4><p>net.Socket TCPå¥—æ¥å­—<br>net.Server TCPæœåŠ¡å™¨ï¼Œä»»æ„å»ºç«‹åœ¨TCPæœåŠ¡ä¸Šçš„åº”ç”¨å±‚æœåŠ¡éƒ½å¯ä»¥äº«å—å®ƒå¸¦æ¥çš„å¥½å¤„<br>net.Native C++å±‚é¢çš„TCPå¥—æ¥å­—æˆ–IPCç®¡é“<br>dgram.Socket UDPå¥—æ¥å­—<br>dgram.Native C++å±‚é¢çš„UDPå¥—æ¥å­—</p><h4 id="sendå¥æŸ„å‘é€åŸç†åˆ†æ"><a href="#sendå¥æŸ„å‘é€åŸç†åˆ†æ" class="headerlink" title="sendå¥æŸ„å‘é€åŸç†åˆ†æ"></a>sendå¥æŸ„å‘é€åŸç†åˆ†æ</h4><p>ç»“åˆå¥æŸ„çš„å‘é€ä¸è¿˜åŸç¤ºæ„å›¾æ›´å®¹æ˜“ç†è§£ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2019/8/4/16c5b52b15d87bbe?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="sendå¥"></p><p>send()æ–¹æ³•åœ¨å°†æ¶ˆæ¯å‘é€åˆ°IPCç®¡é“å‰ï¼Œå®é™…å°†æ¶ˆæ¯ç»„è£…æˆäº†ä¸¤ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªå‚æ•°æ˜¯hadlerï¼Œå¦ä¸€ä¸ªæ˜¯messageã€‚messageå‚æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    cmd:<span class="string">'NODE_HANDLE'</span>,</span><br><span class="line">    type:<span class="string">'net.Server'</span>,</span><br><span class="line">    msg:message</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘é€åˆ°IPCç®¡é“ä¸­çš„å®é™…ä¸Šæ˜¯æˆ‘ä»¬è¦å‘é€çš„å¥æŸ„æ–‡ä»¶æè¿°ç¬¦ã€‚è¿™ä¸ªmessageå¯¹è±¡åœ¨å†™å…¥åˆ°IPCç®¡é“æ—¶ï¼Œä¹Ÿä¼šé€šè¿‡<code>JSON.stringfy()</code>è¿›è¡Œåºåˆ—åŒ–ã€‚æ‰€ä»¥æœ€ç»ˆå‘é€åˆ°IPCé€šé“ä¸­çš„ä¿¡æ¯éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œsend()æ–¹æ³•èƒ½å‘é€æ¶ˆæ¯å’Œå¥æŸ„å¹¶ä¸æ„å‘³ç€å®ƒèƒ½å‘é€ä»»ä½•å¯¹è±¡ã€‚</p><p>è¿æ¥äº†IPCé€šé“çš„å­çº¿ç¨‹å¯ä»¥è¯»å–çˆ¶è¿›ç¨‹å‘æ¥çš„æ¶ˆæ¯ï¼Œå°†å­—ç¬¦ä¸²é€šè¿‡<code>JSON.parse()</code>è§£æè¿˜åŸä¸ºå¯¹è±¡åï¼Œæ‰è§¦å‘messageäº‹ä»¶å°†æ¶ˆæ¯ä¼ é€’ç»™åº”ç”¨å±‚ä½¿ç”¨ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ¶ˆæ¯å¯¹è±¡è¿˜è¦è¢«è¿›è¡Œè¿‡æ»¤å¤„ç†ï¼Œmessage.cmdçš„å€¼å¦‚æœä»¥NODE_ä¸ºå‰ç¼€ï¼Œå®ƒå°†å“åº”ä¸€ä¸ªå†…éƒ¨äº‹ä»¶internalMessageï¼Œå¦‚æœmessage.cmdå€¼ä¸ºNODE_HANDLE,å®ƒå°†å–å‡º<code>message.type</code>å€¼å’Œå¾—åˆ°çš„æ–‡ä»¶æè¿°ç¬¦ä¸€èµ·è¿˜åŸå‡ºä¸€ä¸ªå¯¹åº”çš„å¯¹è±¡ã€‚</p><p>ä»¥å‘é€çš„TCPæœåŠ¡å™¨å¥æŸ„ä¸ºä¾‹ï¼Œå­è¿›ç¨‹æ”¶åˆ°æ¶ˆæ¯åçš„è¿˜åŸè¿‡ç¨‹ä»£ç å¦‚ä¸‹:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">message,handle,emit</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> server = <span class="keyword">new</span> net.Server();</span><br><span class="line">    server.listen(handler,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      emit(server);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¤šè¿›ç¨‹ vs å¤šçº¿ç¨‹</p><p>å±æ€§<br>å¤šè¿›ç¨‹<br>å¤šçº¿ç¨‹<br>æ¯”è¾ƒ</p><p>æ•°æ®<br>æ•°æ®å…±äº«å¤æ‚ï¼Œéœ€è¦ç”¨IPCï¼›æ•°æ®æ˜¯åˆ†å¼€çš„ï¼ŒåŒæ­¥ç®€å•<br>å› ä¸ºå…±äº«è¿›ç¨‹æ•°æ®ï¼Œæ•°æ®å…±äº«ç®€å•ï¼ŒåŒæ­¥å¤æ‚<br>å„æœ‰åƒç§‹</p><p>CPUã€å†…å­˜<br>å ç”¨å†…å­˜å¤šï¼Œåˆ‡æ¢å¤æ‚ï¼ŒCPUåˆ©ç”¨ç‡ä½<br>å ç”¨å†…å­˜å°‘ï¼Œåˆ‡æ¢ç®€å•ï¼ŒCPUåˆ©ç”¨ç‡é«˜<br>å¤šçº¿ç¨‹æ›´å¥½</p><p>é”€æ¯ã€åˆ‡æ¢<br>åˆ›å»ºé”€æ¯ã€åˆ‡æ¢å¤æ‚ï¼Œé€Ÿåº¦æ…¢<br>åˆ›å»ºé”€æ¯ã€åˆ‡æ¢ç®€å•ï¼Œé€Ÿåº¦å¾ˆå¿«<br>å¤šçº¿ç¨‹æ›´å¥½</p><p>coding<br>ç¼–ç ç®€å•ã€è°ƒè¯•æ–¹ä¾¿<br>ç¼–ç ã€è°ƒè¯•å¤æ‚<br>ç¼–ç ã€è°ƒè¯•å¤æ‚</p><p>å¯é æ€§<br>è¿›ç¨‹ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¼šç›¸äº’å½±å“<br>çº¿ç¨‹åŒå‘¼å¸å…±å‘½è¿<br>å¤šè¿›ç¨‹æ›´å¥½</p><p>åˆ†å¸ƒå¼<br>å¯ç”¨äºå¤šæœºå¤šæ ¸åˆ†å¸ƒå¼ï¼Œæ˜“äºæ‰©å±•<br>åªèƒ½ç”¨äºå¤šæ ¸åˆ†å¸ƒå¼<br>å¤šè¿›ç¨‹æ›´å¥½</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://juejin.im/post/5d43017be51d4561f40adcf9&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;&lt;code&gt;è¿›ç¨‹&lt;/code&gt;ä¸&lt;code&gt;çº¿ç¨‹&lt;/code&gt;æ˜¯ä¸€ä¸ªç¨‹åºå‘˜çš„å¿…çŸ¥æ¦‚å¿µï¼Œé¢è¯•ç»å¸¸è¢«é—®åŠï¼Œä½†æ˜¯ä¸€äº›æ–‡ç« å†…å®¹åªæ˜¯è®²è®²ç†è®ºçŸ¥è¯†ï¼Œå¯èƒ½ä¸€äº›å°ä¼™ä¼´å¹¶æ²¡æœ‰çœŸçš„ç†è§£ï¼Œåœ¨å®é™…å¼€å‘ä¸­åº”ç”¨ä¹Ÿæ¯”è¾ƒå°‘ã€‚æœ¬ç¯‡æ–‡ç« é™¤äº†ä»‹ç»æ¦‚å¿µï¼Œé€šè¿‡Node.js çš„è§’åº¦è®²è§£&lt;code&gt;è¿›ç¨‹&lt;/code&gt;ä¸&lt;code&gt;çº¿ç¨‹&lt;/code&gt;ï¼Œå¹¶ä¸”è®²è§£ä¸€äº›åœ¨é¡¹ç›®ä¸­çš„å®æˆ˜çš„åº”ç”¨ï¼Œè®©ä½ ä¸ä»…èƒ½è¿æˆ˜é¢è¯•å®˜è¿˜å¯ä»¥åœ¨å®æˆ˜ä¸­å®Œç¾åº”ç”¨&lt;/p&gt;
&lt;h2 id=&quot;æ–‡ç« å¯¼è§ˆ&quot;&gt;&lt;a href=&quot;#æ–‡ç« å¯¼è§ˆ&quot; class=&quot;headerlink&quot; title=&quot;æ–‡ç« å¯¼è§ˆ&quot;&gt;&lt;/a&gt;æ–‡ç« å¯¼è§ˆ&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;https://user-gold-cdn.xitu.io/2019/8/8/16c6cf612c275894?imageView2/0/w/1280/h/960/format/webp/ignore-error/1&quot; alt=&quot;è¿›ç¨‹ä¸çº¿ç¨‹&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;é¢è¯•ä¼šé—®&quot;&gt;&lt;a href=&quot;#é¢è¯•ä¼šé—®&quot; class=&quot;headerlink&quot; title=&quot;é¢è¯•ä¼šé—®&quot;&gt;&lt;/a&gt;é¢è¯•ä¼šé—®&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Node.jsæ˜¯å•çº¿ç¨‹å—ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;Node.js åšè€—æ—¶çš„è®¡ç®—æ—¶å€™ï¼Œå¦‚ä½•é¿å…é˜»å¡ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;Node.jså¦‚ä½•å®ç°å¤šè¿›ç¨‹çš„å¼€å¯å’Œå…³é—­ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;Node.jså¯ä»¥åˆ›å»ºçº¿ç¨‹å—ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;ä½ ä»¬å¼€å‘è¿‡ç¨‹ä¸­å¦‚ä½•å®ç°è¿›ç¨‹å®ˆæŠ¤çš„ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;é™¤äº†ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œä½ ä»¬è‡ªå·±æ˜¯å¦å°è£…è¿‡ä¸€ä¸ªå¤šè¿›ç¨‹æ¶æ„?&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;è¿›ç¨‹&quot;&gt;&lt;a href=&quot;#è¿›ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;è¿›ç¨‹&quot;&gt;&lt;/a&gt;è¿›ç¨‹&lt;/h2&gt;&lt;p&gt;è¿›ç¨‹&lt;code&gt;Process&lt;/code&gt;æ˜¯è®¡ç®—æœºä¸­çš„ç¨‹åºå…³äºæŸæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ˜¯æ“ä½œç³»ç»Ÿç»“æ„çš„åŸºç¡€ï¼Œè¿›ç¨‹æ˜¯çº¿ç¨‹çš„å®¹å™¨ï¼ˆæ¥è‡ªç™¾ç§‘ï¼‰ã€‚è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„æœ€å°å•ä½ã€‚æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªæœåŠ¡ã€è¿è¡Œä¸€ä¸ªå®ä¾‹ï¼Œå°±æ˜¯å¼€ä¸€ä¸ªæœåŠ¡è¿›ç¨‹ï¼Œä¾‹å¦‚ Java é‡Œçš„ JVM æœ¬èº«å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼ŒNode.js é‡Œé€šè¿‡ node app.js å¼€å¯ä¸€ä¸ªæœåŠ¡è¿›ç¨‹ï¼Œå¤šè¿›ç¨‹å°±æ˜¯è¿›ç¨‹çš„å¤åˆ¶ï¼ˆforkï¼‰ï¼Œfork å‡ºæ¥çš„&lt;strong&gt;æ¯ä¸ªè¿›ç¨‹éƒ½æ‹¥æœ‰è‡ªå·±çš„ç‹¬ç«‹ç©ºé—´åœ°å€ã€æ•°æ®æ ˆï¼Œä¸€ä¸ªè¿›ç¨‹æ— æ³•è®¿é—®å¦å¤–ä¸€ä¸ªè¿›ç¨‹é‡Œå®šä¹‰çš„å˜é‡ã€æ•°æ®ç»“æ„ï¼Œåªæœ‰å»ºç«‹äº† IPC é€šä¿¡ï¼Œè¿›ç¨‹ä¹‹é—´æ‰å¯æ•°æ®å…±äº«&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Node.jså¼€å¯æœåŠ¡è¿›ç¨‹ä¾‹å­&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; http = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;http&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; server = http.createServer();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;server.listen(&lt;span class=&quot;number&quot;&gt;3000&lt;/span&gt;,()=&amp;gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    process.title=&lt;span class=&quot;string&quot;&gt;&#39;ç¨‹åºå‘˜æˆé•¿æŒ‡åŒ—æµ‹è¯•è¿›ç¨‹&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&#39;è¿›ç¨‹id&#39;&lt;/span&gt;,process.pid)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿è¡Œä¸Šé¢ä»£ç åï¼Œä»¥ä¸‹ä¸º Mac ç³»ç»Ÿè‡ªå¸¦çš„ç›‘æ§å·¥å…· â€œæ´»åŠ¨ç›‘è§†å™¨â€ æ‰€å±•ç¤ºçš„æ•ˆæœï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆšå¼€å¯çš„ Nodejs è¿›ç¨‹ 7663&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://user-gold-cdn.xitu.io/2019/8/1/16c4dc0ca13fec40?imageView2/0/w/1280/h/960/format/webp/ignore-error/1&quot; alt=&quot;è¿›ç¨‹1&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;çº¿ç¨‹&quot;&gt;&lt;a href=&quot;#çº¿ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;çº¿ç¨‹&quot;&gt;&lt;/a&gt;çº¿ç¨‹&lt;/h2&gt;&lt;p&gt;çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿèƒ½å¤Ÿè¿›è¡Œè¿ç®—è°ƒåº¦çš„æœ€å°å•ä½ï¼Œé¦–å…ˆæˆ‘ä»¬è¦æ¸…æ¥šçº¿ç¨‹æ˜¯éš¶å±äºè¿›ç¨‹çš„ï¼Œè¢«åŒ…å«äºè¿›ç¨‹ä¹‹ä¸­ã€‚&lt;strong&gt;ä¸€ä¸ªçº¿ç¨‹åªèƒ½éš¶å±äºä¸€ä¸ªè¿›ç¨‹ï¼Œä½†æ˜¯ä¸€ä¸ªè¿›ç¨‹æ˜¯å¯ä»¥æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹çš„&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å•çº¿ç¨‹&quot;&gt;&lt;a href=&quot;#å•çº¿ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;å•çº¿ç¨‹&quot;&gt;&lt;/a&gt;å•çº¿ç¨‹&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;å•çº¿ç¨‹å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹åªå¼€ä¸€ä¸ªçº¿ç¨‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Javascript å°±æ˜¯å±äºå•çº¿ç¨‹ï¼Œç¨‹åºé¡ºåºæ‰§è¡Œ(è¿™é‡Œæš‚ä¸”ä¸æJSå¼‚æ­¥)ï¼Œå¯ä»¥æƒ³è±¡ä¸€ä¸‹é˜Ÿåˆ—ï¼Œå‰é¢ä¸€ä¸ªæ‰§è¡Œå®Œä¹‹åï¼Œåé¢æ‰å¯ä»¥æ‰§è¡Œï¼Œå½“ä½ åœ¨ä½¿ç”¨å•çº¿ç¨‹è¯­è¨€ç¼–ç æ—¶åˆ‡å‹¿æœ‰è¿‡å¤šè€—æ—¶çš„åŒæ­¥æ“ä½œï¼Œå¦åˆ™çº¿ç¨‹ä¼šé€ æˆé˜»å¡ï¼Œå¯¼è‡´åç»­å“åº”æ— æ³•å¤„ç†ã€‚ä½ å¦‚æœé‡‡ç”¨ Javascript è¿›è¡Œç¼–ç æ—¶å€™ï¼Œè¯·å°½å¯èƒ½çš„åˆ©ç”¨Javascriptå¼‚æ­¥æ“ä½œçš„ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç»å…¸è®¡ç®—è€—æ—¶é€ æˆçº¿ç¨‹é˜»å¡çš„ä¾‹å­&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; http = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;http&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; longComputation = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; sum = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&quot;number&quot;&gt;1e10&lt;/span&gt;; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sum += i;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; sum;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; server = http.createServer();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;server.on(&lt;span class=&quot;string&quot;&gt;&#39;request&#39;&lt;/span&gt;, (req, res) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (req.url === &lt;span class=&quot;string&quot;&gt;&#39;/compute&#39;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.info(&lt;span class=&quot;string&quot;&gt;&#39;è®¡ç®—å¼€å§‹&#39;&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Date&lt;/span&gt;());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; sum = longComputation();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.info(&lt;span class=&quot;string&quot;&gt;&#39;è®¡ç®—ç»“æŸ&#39;&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Date&lt;/span&gt;());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; res.end(&lt;span class=&quot;string&quot;&gt;`Sum is &lt;span class=&quot;subst&quot;&gt;$&amp;#123;sum&amp;#125;&lt;/span&gt;`&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    res.end(&lt;span class=&quot;string&quot;&gt;&#39;Ok&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;server.listen(&lt;span class=&quot;number&quot;&gt;3000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//æ‰“å°ç»“æœ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//è®¡ç®—å¼€å§‹ 2019-07-28T07:08:49.849Z&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//è®¡ç®—ç»“æŸ 2019-07-28T07:09:04.522Z&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æŸ¥çœ‹æ‰“å°ç»“æœï¼Œå½“æˆ‘ä»¬è°ƒç”¨&lt;code&gt;127.0.0.1:3000/compute&lt;/code&gt;&lt;br&gt;çš„æ—¶å€™ï¼Œå¦‚æœæƒ³è¦è°ƒç”¨å…¶ä»–çš„è·¯ç”±åœ°å€æ¯”å¦‚&lt;code&gt;127.0.0.1/&lt;/code&gt;å¤§çº¦éœ€è¦15ç§’æ—¶é—´ï¼Œä¹Ÿå¯ä»¥è¯´ä¸€ä¸ªç”¨æˆ·è¯·æ±‚å®Œç¬¬ä¸€ä¸ªcomputeæ¥å£åéœ€è¦ç­‰å¾…15ç§’ï¼Œè¿™å¯¹äºç”¨æˆ·æ¥è¯´æ˜¯æå…¶ä¸å‹å¥½çš„ã€‚ä¸‹æ–‡æˆ‘ä¼šé€šè¿‡åˆ›å»ºå¤šè¿›ç¨‹çš„æ–¹å¼child_process.fork å’Œcluster æ¥è§£å†³è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="Node" scheme="https://zhanghao-web.github.io/categories/Node/"/>
    
    
      <category term="Node" scheme="https://zhanghao-web.github.io/tags/Node/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨17é“é¢˜ä¸­ç†è§£javascriptçš„ç±»å‹è½¬æ¢</title>
    <link href="https://zhanghao-web.github.io/2019/08/08/Js/%E5%9C%A817%E9%81%93%E9%A2%98%E4%B8%AD%E7%90%86%E8%A7%A3javascript%E7%9A%84%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/"/>
    <id>https://zhanghao-web.github.io/2019/08/08/Js/åœ¨17é“é¢˜ä¸­ç†è§£javascriptçš„ç±»å‹è½¬æ¢/</id>
    <published>2019-08-08T07:50:44.000Z</published>
    <updated>2020-01-28T10:04:15.039Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://juejin.im/post/5d4999fff265da038f47f5c7" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a></p><p>ç±»å‹è½¬æ¢æ˜¯å°†å€¼ä»ä¸€ç§ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹çš„è¿‡ç¨‹ï¼ˆæ¯”å¦‚å­—ç¬¦ä¸²è½¬æ•°å­—ï¼Œå¯¹è±¡è½¬å¸ƒå°”å€¼ç­‰ï¼‰ã€‚ä»»ä½•ç±»å‹ä¸è®ºæ˜¯åŸå§‹ç±»å‹è¿˜æ˜¯å¯¹è±¡ç±»å‹éƒ½å¯ä»¥è¿›è¡Œç±»å‹è½¬æ¢ï¼ŒJavaScript çš„åŸå§‹ç±»å‹æœ‰ï¼š<code>number, string, boolean, null, undefined, Symbol</code>ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">true</span> + <span class="literal">false</span></span><br><span class="line"><span class="number">12</span> / <span class="string">"6"</span></span><br><span class="line"><span class="string">"number"</span> + <span class="number">15</span> + <span class="number">3</span></span><br><span class="line"><span class="number">15</span> + <span class="number">3</span> + <span class="string">"number"</span></span><br><span class="line">[<span class="number">1</span>] &gt; <span class="literal">null</span></span><br><span class="line"><span class="string">"foo"</span> + + <span class="string">"bar"</span></span><br><span class="line"><span class="string">"true"</span> == <span class="literal">true</span></span><br><span class="line"><span class="literal">false</span> == <span class="string">"false"</span></span><br><span class="line"><span class="literal">null</span> == <span class="string">""</span></span><br><span class="line">!!<span class="string">"false"</span> == !!<span class="string">"true"</span></span><br><span class="line">[<span class="string">"x"</span>] == <span class="string">"x"</span></span><br><span class="line">[] + <span class="literal">null</span> + <span class="number">1</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>] == [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">&#123;&#125; + [] + &#123;&#125; + [<span class="number">1</span>]</span><br><span class="line">! + [] + [] + ![]</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">0</span>) - <span class="number">0</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">0</span>) + <span class="number">0</span></span><br></pre></td></tr></table></figure><p>ç±»ä¼¼äºä¸Šé¢çš„è¿™äº›é—®é¢˜å¤§æ¦‚ç‡ä¹Ÿä¼šåœ¨ JS é¢è¯•ä¸­è¢«é—®åˆ°, æ‰€ä»¥ç»§ç»­å¾€ä¸‹è¯»ã€‚</p><h2 id="éšå¼è½¬æ¢VSæ˜¾ç¤ºè½¬æ¢"><a href="#éšå¼è½¬æ¢VSæ˜¾ç¤ºè½¬æ¢" class="headerlink" title="éšå¼è½¬æ¢VSæ˜¾ç¤ºè½¬æ¢"></a>éšå¼è½¬æ¢VSæ˜¾ç¤ºè½¬æ¢</h2><p>ç±»å‹è½¬æ¢å¯ä»¥åˆ†ä¸º<strong>éšå¼ç±»å‹è½¬æ¢</strong>å’Œ<strong>æ˜¾å¼ç±»å‹è½¬æ¢</strong>ã€‚</p><p>å½“å¼€å‘äººå‘˜é€šè¿‡ç¼–å†™é€‚å½“çš„ä»£ç (å¦‚Number(value))ç”¨äºåœ¨ç±»å‹ä¹‹é—´è¿›è¡Œè½¬æ¢æ—¶ï¼Œå°±ç§°ä¸º<code>æ˜¾å¼ç±»å‹å¼ºåˆ¶è½¬æ¢(æˆ–å¼ºåˆ¶ç±»å‹è½¬æ¢)</code>ã€‚</p><p>ç„¶è€Œ JavaScript æ˜¯å¼±ç±»å‹è¯­è¨€ï¼Œåœ¨æŸäº›æ“ä½œä¸‹ï¼Œå€¼å¯ä»¥åœ¨ä¸¤ç§ç±»å‹ä¹‹é—´è‡ªåŠ¨çš„è½¬æ¢ï¼Œè¿™å«åš<code>éšå¼ç±»å‹è½¬æ¢</code>ã€‚åœ¨å¯¹ä¸åŒç±»å‹çš„å€¼ä½¿ç”¨è¿ç®—ç¬¦æ—¶é€šå¸¸ä¼šå‘ç”Ÿéšå¼ç±»å‹è½¬æ¢ã€‚æ¯”å¦‚ 1 == null, 2 / â€œ5â€, null + new Date()ã€‚å½“å€¼è¢« if è¯­å¥åŒ…è£¹æ—¶ä¹Ÿæœ‰å¯èƒ½å‘ç”Ÿï¼Œæ¯”å¦‚ if(value) {} ä¼šå°† value è½¬æ¢ä¸º booleanç±»å‹ã€‚</p><p><code>ä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦</code>ï¼ˆ===ï¼‰ä¸ä¼šè§¦å‘ç±»å‹éšå¼è½¬æ¢ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç”¨æ¥æ¯”è¾ƒå€¼å’Œç±»å‹æ˜¯å¦éƒ½ç›¸ç­‰ã€‚</p><p><strong>éšå¼ç±»å‹è½¬æ¢æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ï¼Œä½¿ç”¨å®ƒè™½ç„¶å¯ä»¥å†™æ›´å°‘çš„ä»£ç ä½†æœ‰æ—¶å€™ä¼šå‡ºç°éš¾ä»¥è¢«å‘ç°çš„bug</strong>ã€‚</p><h2 id="ä¸‰ç§ç±»å‹è½¬æ¢"><a href="#ä¸‰ç§ç±»å‹è½¬æ¢" class="headerlink" title="ä¸‰ç§ç±»å‹è½¬æ¢"></a>ä¸‰ç§ç±»å‹è½¬æ¢</h2><p>æˆ‘ä»¬éœ€è¦çŸ¥é“çš„ç¬¬ä¸€ä¸ªè§„åˆ™æ˜¯ï¼š<strong>åœ¨ JS ä¸­åªæœ‰ 3 ç§ç±»å‹çš„è½¬æ¢</strong></p><ul><li>to string</li><li>to boolean</li><li>to number</li></ul><p>ç¬¬äºŒï¼Œ<strong>ç±»å‹è½¬æ¢çš„é€»è¾‘åœ¨åŸå§‹ç±»å‹å’Œå¯¹è±¡ç±»å‹ä¸Šæ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯ä»–ä»¬éƒ½åªä¼šè½¬æ¢æˆä¸Šé¢ 3 ç§ç±»å‹ä¹‹ä¸€</strong>ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆåˆ†æä¸€ä¸‹åŸå§‹ç±»å‹è½¬æ¢ã€‚</p><h2 id="String-ç±»å‹è½¬æ¢"><a href="#String-ç±»å‹è½¬æ¢" class="headerlink" title="String ç±»å‹è½¬æ¢"></a>String ç±»å‹è½¬æ¢</h2><p><code>String()</code> æ–¹æ³•å¯ä»¥ç”¨æ¥æ˜¾å¼å°†å€¼è½¬ä¸ºå­—ç¬¦ä¸²ï¼Œéšå¼è½¬æ¢é€šå¸¸åœ¨æœ‰ <code>+</code> è¿ç®—ç¬¦å¹¶ä¸”æœ‰ä¸€ä¸ªæ“ä½œæ•°æ˜¯ <code>string</code> ç±»å‹æ—¶è¢«è§¦å‘ï¼Œå¦‚ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>(<span class="number">123</span>) <span class="comment">// æ˜¾å¼ç±»å‹è½¬æ¢</span></span><br><span class="line"></span><br><span class="line"><span class="number">123</span> + <span class="string">''</span> <span class="comment">// éšå¼ç±»å‹è½¬æ¢</span></span><br></pre></td></tr></table></figure><p>æ‰€æœ‰åŸå§‹ç±»å‹è½¬ String ç±»å‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>(<span class="number">123</span>)  <span class="comment">// '123'</span></span><br><span class="line"><span class="built_in">String</span>(<span class="number">-12.3</span>)  <span class="comment">// '-12.3'</span></span><br><span class="line"><span class="built_in">String</span>(<span class="literal">null</span>)  <span class="comment">// 'null'</span></span><br><span class="line"><span class="built_in">String</span>(<span class="literal">undefined</span>)  <span class="comment">// 'undefined'</span></span><br><span class="line"><span class="built_in">String</span>(<span class="literal">true</span>)  <span class="comment">// 'true'</span></span><br></pre></td></tr></table></figure><p>Symbol ç±»å‹è½¬ String ç±»å‹æ˜¯æ¯”è¾ƒä¸¥æ ¼çš„ï¼Œå®ƒåªèƒ½è¢«æ˜¾å¼çš„è½¬æ¢</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>(<span class="built_in">Symbol</span>(<span class="string">'symbol'</span>))  <span class="comment">// 'Symbol(symbol)'</span></span><br><span class="line"></span><br><span class="line"><span class="string">''</span> + <span class="built_in">Symbol</span>(<span class="string">'symbol'</span>)  <span class="comment">// TypeError is thrown</span></span><br></pre></td></tr></table></figure><h2 id="Boolean-ç±»å‹è½¬æ¢"><a href="#Boolean-ç±»å‹è½¬æ¢" class="headerlink" title="Boolean ç±»å‹è½¬æ¢"></a>Boolean ç±»å‹è½¬æ¢</h2><p><code>Boolean()</code> æ–¹æ³•å¯ä»¥ç”¨æ¥æ˜¾å¼å°†å€¼è½¬æ¢æˆ boolean å‹ã€‚</p><p>éšå¼ç±»å‹è½¬æ¢é€šå¸¸åœ¨é€»è¾‘åˆ¤æ–­æˆ–è€…æœ‰é€»è¾‘è¿ç®—ç¬¦æ—¶è¢«è§¦å‘<code>ï¼ˆ|| &amp;&amp; !ï¼‰</code>ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Boolean</span>(<span class="number">2</span>)    <span class="comment">// æ˜¾ç¤ºç±»å‹è½¬æ¢</span></span><br><span class="line"><span class="keyword">if</span>(<span class="number">2</span>) &#123;&#125;      <span class="comment">// é€»è¾‘åˆ¤æ–­è§¦å‘éšå¼ç±»å‹è½¬æ¢</span></span><br><span class="line">!!<span class="number">2</span>           <span class="comment">// é€»è¾‘è¿ç®—ç¬¦è§¦å‘éšå¼ç±»å‹è½¬æ¢</span></span><br><span class="line"><span class="number">2</span> || <span class="string">'hello'</span>  <span class="comment">// é€»è¾‘è¿ç®—ç¬¦è§¦å‘éšå¼ç±»å‹è½¬æ¢</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>æ³¨æ„: é€»è¾‘è¿ç®—ç¬¦ï¼ˆæ¯”å¦‚ || å’Œ &amp;&amp;ï¼‰æ˜¯åœ¨å†…éƒ¨åšäº† boolean ç±»å‹è½¬æ¢ï¼Œä½†å®é™…ä¸Šè¿”å›çš„æ˜¯<code>åŸå§‹æ“ä½œæ•°çš„å€¼</code>ï¼Œå³ä½¿ä»–ä»¬éƒ½ä¸æ˜¯ boolean ç±»å‹ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿”å› number ç±»å‹ 123ï¼Œè€Œä¸æ˜¯ boolean å‹ true</span></span><br><span class="line"><span class="comment">// 'hello' å’Œ '123' ä»ç„¶åœ¨å†…éƒ¨ä¼šè½¬æ¢æˆ boolean å‹æ¥è®¡ç®—è¡¨è¾¾å¼</span></span><br><span class="line"><span class="keyword">let</span> x = <span class="string">'hello'</span> &amp;&amp; <span class="number">123</span>  <span class="comment">// x === 123</span></span><br></pre></td></tr></table></figure><p>boolean ç±»å‹è½¬æ¢åªä¼šæœ‰ true æˆ–è€… false ä¸¤ç§ç»“æœã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Boolean</span>(<span class="string">''</span>)           <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Boolean</span>(<span class="number">0</span>)            <span class="comment">// false  </span></span><br><span class="line"><span class="built_in">Boolean</span>(<span class="number">-0</span>)           <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Boolean</span>(<span class="literal">NaN</span>)          <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Boolean</span>(<span class="literal">null</span>)         <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Boolean</span>(<span class="literal">undefined</span>)     <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Boolean</span>(<span class="literal">false</span>)        <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p><strong>ä»»ä½•ä¸åœ¨ä¸Šé¢åˆ—è¡¨ä¸­çš„å€¼éƒ½ä¼šè½¬æ¢ä¸º true</strong>, åŒ…æ‹¬ <code>object, function, Array, Date</code> ç­‰ï¼Œ<code>Symbol</code> ç±»å‹æ˜¯çœŸå€¼ï¼Œç©ºå¯¹è±¡å’Œç©ºæ•°ç»„ä¹Ÿæ˜¯çœŸå€¼ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Boolean</span>(&#123;&#125;)             <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Boolean</span>([])             <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Boolean</span>(<span class="built_in">Symbol</span>())       <span class="comment">// true</span></span><br><span class="line">!!<span class="built_in">Symbol</span>()              <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Boolean</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;)  <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h2 id="Number-ç±»å‹è½¬æ¢"><a href="#Number-ç±»å‹è½¬æ¢" class="headerlink" title="Number ç±»å‹è½¬æ¢"></a>Number ç±»å‹è½¬æ¢</h2><p>å’Œ <code>Boolean()</code>ã€<code>String()</code> æ–¹æ³•ä¸€æ ·ï¼Œ <code>Number()</code> æ–¹æ³•å¯ä»¥ç”¨æ¥æ˜¾å¼å°†å€¼è½¬æ¢æˆ number ç±»å‹ã€‚<br>number çš„éšå¼ç±»å‹è½¬æ¢æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå› ä¸ºå®ƒå¯ä»¥åœ¨ä¸‹é¢å¤šç§æƒ…å†µä¸‹è¢«è§¦å‘ã€‚</p><ul><li>æ¯”è¾ƒæ“ä½œï¼ˆ&gt;, &lt;, &lt;=, &gt;=ï¼‰</li><li>æŒ‰ä½æ“ä½œï¼ˆ| &amp; ^ ~ï¼‰</li><li>ç®—æ•°æ“ä½œï¼ˆ- + * / %ï¼‰ï¼Œ æ³¨æ„ï¼Œå½“ + æ“ä½œå­˜åœ¨ä»»æ„çš„æ“ä½œæ•°æ˜¯ string ç±»å‹æ—¶ï¼Œä¸ä¼šè§¦å‘ number ç±»å‹çš„éšå¼è½¬æ¢</li><li>ä¸€ å…ƒ + æ“ä½œ</li><li>éä¸¥æ ¼ç›¸ç­‰æ“ä½œï¼ˆ== æˆ–è€… != ï¼‰ï¼Œæ³¨æ„ï¼Œ== æ“ä½œä¸¤ä¸ªæ“ä½œæ•°éƒ½æ˜¯ string ç±»å‹æ—¶ï¼Œä¸ä¼šå‘ç”Ÿ number ç±»å‹çš„éšå¼è½¬æ¢</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Number</span>(<span class="string">'123'</span>)    <span class="comment">// æ˜¾ç¤ºç±»å‹è½¬æ¢</span></span><br><span class="line">+ <span class="string">'123'</span>          <span class="comment">//  éšå¼ç±»å‹è½¬æ¢</span></span><br><span class="line"><span class="number">123</span> != <span class="string">"456"</span>    <span class="comment">//  éšå¼ç±»å‹è½¬æ¢</span></span><br><span class="line"><span class="number">4</span> &gt; <span class="string">"5"</span>        <span class="comment">//  éšå¼ç±»å‹è½¬æ¢</span></span><br><span class="line"><span class="number">5</span> / <span class="literal">null</span>      <span class="comment">//  éšå¼ç±»å‹è½¬æ¢</span></span><br><span class="line"><span class="literal">true</span> | <span class="number">0</span>      <span class="comment">//  éšå¼ç±»å‹è½¬æ¢</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹åŸå§‹ç±»å‹æ˜¾ç¤ºè½¬æ¢ number ç±»å‹ä¼šå‘ç”Ÿä»€ä¹ˆ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Number</span>(<span class="literal">null</span>)                   <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="literal">undefined</span>)              <span class="comment">// NaN</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="literal">true</span>)                   <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="literal">false</span>)                  <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="string">" 12 "</span>)                 <span class="comment">// 12</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="string">"-12.34"</span>)               <span class="comment">// -12.34</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="string">"\n"</span>)                   <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="string">" 12s "</span>)                <span class="comment">// NaN</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="number">123</span>)                    <span class="comment">// 123</span></span><br></pre></td></tr></table></figure><p>å½“å°†ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—æ—¶ï¼Œå¼•æ“é¦–å…ˆåˆ é™¤å‰å°¾ç©ºæ ¼ã€<code>\nã€\t</code> å­—ç¬¦ï¼Œå¦‚æœè¢«ä¿®å‰ªçš„å­—ç¬¦ä¸²ä¸æˆä¸ºä¸€ä¸ªæœ‰æ•ˆçš„æ•°å­—ï¼Œåˆ™è¿”å› NaNã€‚å¦‚æœå­—ç¬¦ä¸²ä¸ºç©ºï¼Œåˆ™è¿”å› 0ã€‚</p><p>Number() æ–¹æ³•å¯¹äº null å’Œ undefined çš„å¤„ç†æ˜¯ä¸åŒçš„ï¼Œ null ä¼šè½¬æ¢ä¸º 0, undefined ä¼šè½¬æ¢ä¸º NaN</p><p><strong>ä¸ç®¡æ˜¯æ˜¾å¼è¿˜æ˜¯éšå¼è½¬æ¢éƒ½ä¸èƒ½å°† Symbol ç±»å‹è½¬ä¸º number ç±»å‹ï¼Œå½“è¯•å›¾è¿™æ ·æ“ä½œæ—¶ï¼Œä¼šæŠ›å‡ºé”™è¯¯</strong>ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Number</span>(<span class="built_in">Symbol</span>(<span class="string">'my symbol'</span>))    <span class="comment">// TypeError is thrown</span></span><br><span class="line">+<span class="built_in">Symbol</span>(<span class="string">'123'</span>)                 <span class="comment">// TypeError is thrown</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œ<strong>æœ‰ 2 ä¸ªç‰¹æ®Šçš„è§„åˆ™</strong>éœ€è¦è®°ä½ï¼š</p><ol><li>å½“å°† == åº”ç”¨äº null æˆ– undefined æ—¶ï¼Œä¸ä¼šå‘ç”Ÿæ•°å€¼è½¬æ¢ã€‚null åªç­‰äº null æˆ– undefinedï¼Œä¸ç­‰äºå…¶ä»–ä»»ä½•å€¼ã€‚<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">null</span> == <span class="number">0</span>               <span class="comment">// false, null is not converted to 0</span></span><br><span class="line"><span class="literal">null</span> == <span class="literal">null</span>            <span class="comment">// true</span></span><br><span class="line"><span class="literal">undefined</span> == <span class="literal">undefined</span>  <span class="comment">// true</span></span><br><span class="line"><span class="literal">null</span> == <span class="literal">undefined</span>       <span class="comment">// true</span></span><br><span class="line"><span class="literal">undefined</span> == <span class="number">0</span>          <span class="comment">// false</span></span><br></pre></td></tr></table></figure></li><li>NaN ä¸ç­‰äºä»»ä½•å€¼ï¼ŒåŒ…æ‹¬å®ƒè‡ªå·±</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">NaN</span> === <span class="literal">NaN</span>  <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(value !== value) &#123; <span class="built_in">console</span>.log(<span class="string">'the value is NaN'</span>) &#125;</span><br></pre></td></tr></table></figure><h2 id="object-ç±»å‹è½¬æ¢"><a href="#object-ç±»å‹è½¬æ¢" class="headerlink" title="object ç±»å‹è½¬æ¢"></a>object ç±»å‹è½¬æ¢</h2><p>åˆ°è¿™é‡Œæˆ‘ä»¬å·²ç»æ·±å…¥äº†è§£äº†åŸå§‹ç±»å‹çš„è½¬æ¢ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ object ç±»å‹çš„è½¬æ¢ã€‚</p><p>å½“æ¶‰åŠåˆ°å¯¹è±¡çš„æ“ä½œæ¯”å¦‚ï¼š<code>[1] + [2,3]</code>ï¼Œå¼•æ“é¦–å…ˆä¼šå°è¯•å°† object ç±»å‹è½¬ä¸ºåŸå§‹ç±»å‹ï¼Œç„¶ååœ¨å°†åŸå§‹ç±»å‹è½¬ä¸ºæœ€ç»ˆéœ€è¦çš„ç±»å‹ï¼Œè€Œä¸”ä»ç„¶åªæœ‰ 3 ç§ç±»å‹çš„è½¬æ¢ï¼š<code>number, string, boolean</code></p><p>æœ€ç®€å•çš„æƒ…å†µæ˜¯ boolean ç±»å‹çš„è½¬æ¢ï¼Œä»»ä½•éåŸå§‹ç±»å‹æ€»æ˜¯ä¼šè½¬æ¢æˆ true,æ— è®ºå¯¹è±¡æˆ–æ•°ç»„æ˜¯å¦ä¸ºç©ºã€‚</p><p>å¯¹è±¡é€šè¿‡å†…éƒ¨ <code>[[ToPrimitive]]</code> æ–¹æ³•è½¬æ¢ä¸ºåŸå§‹ç±»å‹ï¼Œè¯¥æ–¹æ³•è´Ÿè´£æ•°å­—å’Œå­—ç¬¦ä¸²è½¬æ¢ã€‚</p><p><code>[[ToPrimitive]]</code> æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ä¸€ä¸ªè¾“å…¥å€¼å’Œä¸€ä¸ªéœ€è¦è½¬æ¢çš„ç±»å‹<code>ï¼ˆNumer or Stringï¼‰</code><br>number å’Œ stringçš„è½¬æ¢éƒ½ä½¿ç”¨äº†å¯¹è±¡çš„ä¸¤ä¸ªæ–¹æ³•ï¼š <code>valueOf</code> å’Œ <code>toString</code>ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½åœ¨ <code>Object.prototype</code> ä¸Šè¢«å£°æ˜ï¼Œå› æ­¤å¯ç”¨äºä»»ä½•æ´¾ç”Ÿç±»ï¼Œæ¯”å¦‚ <code>Date, Array</code>ç­‰ã€‚</p><blockquote><p>é€šå¸¸ä¸Š [[ToPrimitive]] ç®—æ³•å¦‚ä¸‹ï¼š</p></blockquote><ul><li>å¦‚æœè¾“å…¥çš„å€¼å·²ç»æ˜¯åŸå§‹ç±»å‹ï¼Œç›´æ¥è¿”å›è¿™ä¸ªå€¼ã€‚</li><li>è¾“å…¥çš„å€¼è°ƒç”¨ toString() æ–¹æ³•ï¼Œå¦‚æœç»“æœæ˜¯åŸå§‹ç±»å‹ï¼Œåˆ™è¿”å›ã€‚</li><li>è¾“å…¥çš„å€¼è°ƒç”¨ valueOf() æ–¹æ³•ï¼Œå¦‚æœç»“æœæ˜¯åŸå§‹ç±»å‹ï¼Œåˆ™è¿”å›ã€‚</li><li>å¦‚æœä¸Šé¢ 3 ä¸ªæ­¥éª¤ä¹‹åï¼Œè½¬æ¢åçš„å€¼ä»ç„¶ä¸æ˜¯åŸå§‹ç±»å‹ï¼Œåˆ™æŠ›å‡º TypeError é”™è¯¯ã€‚</li></ul><p>number ç±»å‹çš„è½¬æ¢é¦–å…ˆä¼šè°ƒç”¨ <code>valueOf()</code> æ–¹æ³•ï¼Œå¦‚æœä¸æ˜¯åŸå§‹å€¼åœ¨è°ƒç”¨ <code>toString()</code> æ–¹æ³•ã€‚ string ç±»å‹çš„è½¬æ¢åˆ™ç›¸åã€‚</p><p>å¤§å¤šæ•° JS å†…ç½®å¯¹è±¡ç±»å‹çš„ valueOf() è¿”å›è¿™ä¸ªå¯¹è±¡æœ¬èº«ï¼Œå…¶ç»“æœç»å¸¸è¢«å¿½ç•¥ï¼Œå› ä¸ºå®ƒä¸æ˜¯ä¸€ä¸ªåŸå§‹ç±»å‹ã€‚æ‰€ä»¥å¤§å¤šæ•°æƒ…å†µä¸‹å½“ object éœ€è¦è½¬æ¢æˆ number æˆ– string ç±»å‹æ—¶æœ€ç»ˆéƒ½è°ƒç”¨äº† <code>toString()</code> æ–¹æ³•ã€‚</p><p>å½“è¿ç®—ç¬¦ä¸åŒæ—¶ï¼Œ<code>[[ToPrimitive]]</code> æ–¹æ³•æ¥å—çš„è½¬æ¢ç±»å‹å‚æ•°ä¹Ÿä¸ç›¸åŒã€‚å½“å­˜åœ¨ == æˆ–è€… + è¿ç®—ç¬¦æ—¶ä¸€èˆ¬ä¼šå…ˆè§¦å‘ number ç±»å‹çš„è½¬æ¢å†è§¦å‘ string ç±»å‹è½¬æ¢ã€‚</p><p>åœ¨ JS ä¸­ä½ å¯ä»¥é€šè¿‡é‡å†™å¯¹è±¡çš„ <code>toString å’Œ valueOf</code> æ–¹æ³•æ¥ä¿®æ”¹å¯¹è±¡åˆ°åŸå§‹ç±»å‹è½¬æ¢çš„é€»è¾‘ã€‚</p><h2 id="ç­”æ¡ˆè§£æ"><a href="#ç­”æ¡ˆè§£æ" class="headerlink" title="ç­”æ¡ˆè§£æ"></a>ç­”æ¡ˆè§£æ</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">true</span> + <span class="literal">false</span> <span class="comment">// 1  </span></span><br><span class="line"><span class="comment">// '+' è¿ç®—ç¬¦ä¼šè§¦å‘ number ç±»å‹è½¬æ¢å¯¹äº true å’Œ false</span></span><br><span class="line"></span><br><span class="line"><span class="number">12</span> / <span class="string">"6"</span> <span class="comment">// 2       </span></span><br><span class="line"><span class="comment">//ç®—æ•°è¿ç®—ç¬¦ä¼šæŠŠå­—ç¬¦ä¸² â€˜6â€™ è½¬ä¸º number ç±»å‹</span></span><br><span class="line"></span><br><span class="line"><span class="string">"number"</span> + <span class="number">15</span> + <span class="number">3</span> <span class="comment">// 'number153'</span></span><br><span class="line"><span class="comment">// '+' è¿ç®—ç¬¦æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºçš„æ‰§è¡Œï¼Œæ‰€ä»¥ä¼˜å…ˆæ‰§è¡Œ â€œnumberâ€ + 15, æŠŠ 15 è½¬ä¸º string ç±»å‹ï¼Œå¾—åˆ° â€œnumber15â€ ç„¶ååŒç†æ‰§è¡Œ â€œnumber15â€ + 3</span></span><br><span class="line"></span><br><span class="line"><span class="number">15</span> + <span class="number">3</span> + <span class="string">"number"</span>  <span class="comment">// "18number"</span></span><br><span class="line"><span class="comment">// 15 + 3 å…ˆæ‰§è¡Œï¼Œè¿ç®—ç¬¦ä¸¤è¾¹éƒ½æ˜¯ number ç±»å‹ ï¼Œä¸ç”¨è½¬æ¢ï¼Œç„¶åæ‰§è¡Œ 18 + â€œnumberâ€ æœ€ç»ˆå¾—åˆ° â€œ18numberâ€</span></span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>] &gt; <span class="literal">null</span> <span class="comment">// true</span></span><br><span class="line"><span class="comment">// ==&gt; '1' &gt; 0</span></span><br><span class="line"><span class="comment">// ==&gt; 1 &gt; 0</span></span><br><span class="line"><span class="comment">// ==&gt; true</span></span><br><span class="line"><span class="comment">// æ¯”è¾ƒè¿ç®—ç¬¦ &gt; æ‰§è¡Œ number ç±»å‹éšå¼è½¬æ¢ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="string">"foo"</span> + + <span class="string">"bar"</span> <span class="comment">// "fooNaN"</span></span><br><span class="line"><span class="comment">// ==&gt; "foo" + (+"bar")</span></span><br><span class="line"><span class="comment">// ==&gt; "foo" + NaN</span></span><br><span class="line"><span class="comment">// ==&gt; "fooNaN"</span></span><br><span class="line"><span class="comment">// ä¸€å…ƒ + è¿ç®—ç¬¦æ¯”äºŒå…ƒ + è¿ç®—ç¬¦å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚æ‰€ä»¥ + barè¡¨è¾¾å¼å…ˆæ±‚å€¼ã€‚ä¸€å…ƒåŠ å·æ‰§è¡Œå­—ç¬¦ä¸²â€œbarâ€ çš„ number ç±»å‹è½¬æ¢ã€‚å› ä¸ºå­—ç¬¦ä¸²ä¸ä»£è¡¨ä¸€ä¸ªæœ‰æ•ˆçš„æ•°å­—ï¼Œæ‰€ä»¥ç»“æœæ˜¯NaNã€‚åœ¨ç¬¬äºŒæ­¥ä¸­ï¼Œè®¡ç®—è¡¨è¾¾å¼'foo' + NaNã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="string">"true"</span> == <span class="literal">true</span> <span class="comment">// false</span></span><br><span class="line"><span class="literal">false</span> == <span class="string">"false"</span> <span class="comment">// false</span></span><br><span class="line"><span class="comment">// == è¿ç®—ç¬¦æ‰§è¡Œ number ç±»å‹è½¬æ¢ï¼Œ'true' è½¬æ¢ä¸º NaNï¼Œ boolean ç±»å‹ true è½¬æ¢ä¸º 1</span></span><br><span class="line"></span><br><span class="line"><span class="literal">null</span> == <span class="string">""</span> <span class="comment">// false</span></span><br><span class="line"><span class="comment">// null ä¸ç­‰äºä»»ä½•å€¼é™¤äº† null å’Œ undefined</span></span><br><span class="line"></span><br><span class="line">!!<span class="string">"false"</span> == !!<span class="string">"true"</span> <span class="comment">// true</span></span><br><span class="line"><span class="comment">// !! è¿ç®—ç¬¦å°†å­—ç¬¦ä¸² 'true' å’Œ 'false' è½¬ä¸º boolean ç±»å‹ true, å› ä¸ºä¸æ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œç„¶åä¸¤è¾¹éƒ½æ˜¯ boolean å‹ä¸åœ¨æ‰§è¡Œéšå¼è½¬æ¢æ“ä½œã€‚</span></span><br><span class="line"></span><br><span class="line">[<span class="string">"x"</span>] == <span class="string">"x"</span> <span class="comment">// true</span></span><br><span class="line"><span class="comment">// == è¿ç®—ç¬¦å¯¹æ•°ç»„ç±»å‹æ‰§è¡Œ number è½¬æ¢ï¼Œå…ˆè°ƒç”¨å¯¹è±¡çš„ valueOf() æ–¹æ³•ï¼Œç»“æœæ˜¯æ•°ç»„æœ¬èº«ï¼Œä¸æ˜¯åŸå§‹ç±»å‹å€¼ï¼Œæ‰€ä»¥æ‰§è¡Œå¯¹è±¡çš„ toString() æ–¹æ³•ï¼Œå¾—åˆ°å­—ç¬¦ä¸² 'x'</span></span><br><span class="line"></span><br><span class="line">[] + <span class="literal">null</span> + <span class="number">1</span> <span class="comment">// 'null1'</span></span><br><span class="line"><span class="comment">// '+' è¿ç®—ç¬¦æ‰§è¡Œ number ç±»å‹è½¬æ¢ï¼Œå…ˆè°ƒç”¨å¯¹è±¡çš„ valueOf() æ–¹æ³•ï¼Œç»“æœæ˜¯æ•°ç»„æœ¬èº«ï¼Œä¸æ˜¯åŸå§‹ç±»å‹å€¼ï¼Œæ‰€ä»¥æ‰§è¡Œå¯¹è±¡çš„ toString() æ–¹æ³•ï¼Œå¾—åˆ°å­—ç¬¦ä¸² ''ï¼Œ æ¥ä¸‹æ¥æ‰§è¡Œè¡¨è¾¾å¼ '' + null + 1ã€‚</span></span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>] == [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>] <span class="comment">// false</span></span><br><span class="line"><span class="comment">// å½“è¿ç®—ç¬¦ä¸¤è¾¹ç±»å‹ç›¸åŒæ—¶ï¼Œä¸ä¼šæ‰§è¡Œç±»å‹è½¬æ¢ï¼Œä¸¤ä¸ªæ•°ç»„çš„å†…å­˜åœ°å€ä¸ä¸€æ ·ï¼Œæ‰€ä»¥è¿”å› false</span></span><br><span class="line"></span><br><span class="line"><span class="number">0</span> || <span class="string">"0"</span> &amp;&amp; &#123;&#125;  <span class="comment">// &#123;&#125;</span></span><br><span class="line"><span class="comment">// é€»è¾‘è¿ç®—ç¬¦ || å’Œ &amp;&amp; å°†å€¼è½¬ä¸º boolean å‹ï¼Œä½†æ˜¯ä¼šè¿”å›åŸå§‹å€¼ï¼ˆä¸æ˜¯ booleanï¼‰ã€‚</span></span><br><span class="line"></span><br><span class="line">&#123;&#125; + [] + &#123;&#125; + [<span class="number">1</span>] <span class="comment">// '0[object Object]1'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰€æœ‰çš„æ“ä½œæ•°éƒ½ä¸æ˜¯åŸå§‹ç±»å‹ï¼Œæ‰€ä»¥ä¼šæŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºæ‰§è¡Œ number ç±»å‹çš„éšå¼è½¬æ¢ï¼Œ object å’Œ array ç±»å‹çš„ valueOf() æ–¹æ³•è¿”å›å®ƒä»¬æœ¬èº«ï¼Œæ‰€ä»¥ç›´æ¥å¿½ç•¥ï¼Œæ‰§è¡Œ toString() æ–¹æ³•ã€‚ è¿™é‡Œçš„æŠ€å·§æ˜¯ï¼Œç¬¬ä¸€ä¸ª &#123;&#125; ä¸è¢«è§†ä¸º objectï¼Œè€Œæ˜¯å—å£°æ˜è¯­å¥ï¼Œå› æ­¤å®ƒè¢«å¿½ç•¥ã€‚è®¡ç®—ä» +[] è¡¨è¾¾å¼å¼€å§‹ï¼Œè¯¥è¡¨è¾¾å¼é€šè¿‡toString()æ–¹æ³•è½¬æ¢ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œç„¶åè½¬æ¢ä¸º0ã€‚</span></span><br><span class="line"></span><br><span class="line">! + [] + [] + ![] <span class="comment">// 'truefalse'</span></span><br><span class="line"><span class="comment">// ä¸€å…ƒè¿ç®—ç¬¦ä¼˜å…ˆæ‰§è¡Œï¼Œ+[] è½¬ä¸º number ç±»å‹ 0ï¼Œ![] è½¬ä¸º boolean å‹ falseã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">0</span>) - <span class="number">0</span> <span class="comment">// 0</span></span><br><span class="line"><span class="comment">// '-' è¿ç®—ç¬¦æ‰§è¡Œ number ç±»å‹éšå¼è½¬æ¢å¯¹äº Date å‹çš„å€¼ï¼ŒDate.valueOf() è¿”å›åˆ°æ¯«ç§’çš„æ—¶é—´æˆ³ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">0</span>) + <span class="number">0</span> <span class="comment">//"Thu Jan 01 1970 08:00:00 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)0"</span></span><br><span class="line"><span class="comment">// +' è¿ç®—ç¬¦è§¦å‘é»˜è®¤è½¬æ¢ï¼Œå› æ­¤ä½¿ç”¨ toString() æ–¹æ³•ï¼Œè€Œä¸æ˜¯ valueOf()ã€‚</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://juejin.im/post/5d4999fff265da038f47f5c7&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ç±»å‹è½¬æ¢æ˜¯å°†å€¼ä»ä¸€ç§ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹çš„è¿‡ç¨‹ï¼ˆæ¯”å¦‚å­—ç¬¦ä¸²è½¬æ•°å­—ï¼Œå¯¹è±¡è½¬å¸ƒå°”å€¼ç­‰ï¼‰ã€‚ä»»ä½•ç±»å‹ä¸è®ºæ˜¯åŸå§‹ç±»å‹è¿˜æ˜¯å¯¹è±¡ç±»å‹éƒ½å¯ä»¥è¿›è¡Œç±»å‹è½¬æ¢ï¼ŒJavaScript çš„åŸå§‹ç±»å‹æœ‰ï¼š&lt;code&gt;number, string, boolean, null, undefined, Symbol&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt; + &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;12&lt;/span&gt; / &lt;span class=&quot;string&quot;&gt;&quot;6&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;number&quot;&lt;/span&gt; + &lt;span class=&quot;number&quot;&gt;15&lt;/span&gt; + &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;15&lt;/span&gt; + &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt; + &lt;span class=&quot;string&quot;&gt;&quot;number&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;] &amp;gt; &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;foo&quot;&lt;/span&gt; + + &lt;span class=&quot;string&quot;&gt;&quot;bar&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt; == &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt; == &lt;span class=&quot;string&quot;&gt;&quot;false&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt; == &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;!!&lt;span class=&quot;string&quot;&gt;&quot;false&quot;&lt;/span&gt; == !!&lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;string&quot;&gt;&quot;x&quot;&lt;/span&gt;] == &lt;span class=&quot;string&quot;&gt;&quot;x&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[] + &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt; + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;] == [&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&amp;#125; + [] + &amp;#123;&amp;#125; + [&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;! + [] + [] + ![]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Date&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) - &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Date&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) + &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç±»ä¼¼äºä¸Šé¢çš„è¿™äº›é—®é¢˜å¤§æ¦‚ç‡ä¹Ÿä¼šåœ¨ JS é¢è¯•ä¸­è¢«é—®åˆ°, æ‰€ä»¥ç»§ç»­å¾€ä¸‹è¯»ã€‚&lt;/p&gt;
&lt;h2 id=&quot;éšå¼è½¬æ¢VSæ˜¾ç¤ºè½¬æ¢&quot;&gt;&lt;a href=&quot;#éšå¼è½¬æ¢VSæ˜¾ç¤ºè½¬æ¢&quot; class=&quot;headerlink&quot; title=&quot;éšå¼è½¬æ¢VSæ˜¾ç¤ºè½¬æ¢&quot;&gt;&lt;/a&gt;éšå¼è½¬æ¢VSæ˜¾ç¤ºè½¬æ¢&lt;/h2&gt;&lt;p&gt;ç±»å‹è½¬æ¢å¯ä»¥åˆ†ä¸º&lt;strong&gt;éšå¼ç±»å‹è½¬æ¢&lt;/strong&gt;å’Œ&lt;strong&gt;æ˜¾å¼ç±»å‹è½¬æ¢&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å½“å¼€å‘äººå‘˜é€šè¿‡ç¼–å†™é€‚å½“çš„ä»£ç (å¦‚Number(value))ç”¨äºåœ¨ç±»å‹ä¹‹é—´è¿›è¡Œè½¬æ¢æ—¶ï¼Œå°±ç§°ä¸º&lt;code&gt;æ˜¾å¼ç±»å‹å¼ºåˆ¶è½¬æ¢(æˆ–å¼ºåˆ¶ç±»å‹è½¬æ¢)&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œ JavaScript æ˜¯å¼±ç±»å‹è¯­è¨€ï¼Œåœ¨æŸäº›æ“ä½œä¸‹ï¼Œå€¼å¯ä»¥åœ¨ä¸¤ç§ç±»å‹ä¹‹é—´è‡ªåŠ¨çš„è½¬æ¢ï¼Œè¿™å«åš&lt;code&gt;éšå¼ç±»å‹è½¬æ¢&lt;/code&gt;ã€‚åœ¨å¯¹ä¸åŒç±»å‹çš„å€¼ä½¿ç”¨è¿ç®—ç¬¦æ—¶é€šå¸¸ä¼šå‘ç”Ÿéšå¼ç±»å‹è½¬æ¢ã€‚æ¯”å¦‚ 1 == null, 2 / â€œ5â€, null + new Date()ã€‚å½“å€¼è¢« if è¯­å¥åŒ…è£¹æ—¶ä¹Ÿæœ‰å¯èƒ½å‘ç”Ÿï¼Œæ¯”å¦‚ if(value) {} ä¼šå°† value è½¬æ¢ä¸º booleanç±»å‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦&lt;/code&gt;ï¼ˆ===ï¼‰ä¸ä¼šè§¦å‘ç±»å‹éšå¼è½¬æ¢ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç”¨æ¥æ¯”è¾ƒå€¼å’Œç±»å‹æ˜¯å¦éƒ½ç›¸ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;éšå¼ç±»å‹è½¬æ¢æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ï¼Œä½¿ç”¨å®ƒè™½ç„¶å¯ä»¥å†™æ›´å°‘çš„ä»£ç ä½†æœ‰æ—¶å€™ä¼šå‡ºç°éš¾ä»¥è¢«å‘ç°çš„bug&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ä¸‰ç§ç±»å‹è½¬æ¢&quot;&gt;&lt;a href=&quot;#ä¸‰ç§ç±»å‹è½¬æ¢&quot; class=&quot;headerlink&quot; title=&quot;ä¸‰ç§ç±»å‹è½¬æ¢&quot;&gt;&lt;/a&gt;ä¸‰ç§ç±»å‹è½¬æ¢&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬éœ€è¦çŸ¥é“çš„ç¬¬ä¸€ä¸ªè§„åˆ™æ˜¯ï¼š&lt;strong&gt;åœ¨ JS ä¸­åªæœ‰ 3 ç§ç±»å‹çš„è½¬æ¢&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;to string&lt;/li&gt;
&lt;li&gt;to boolean&lt;/li&gt;
&lt;li&gt;to number&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¬¬äºŒï¼Œ&lt;strong&gt;ç±»å‹è½¬æ¢çš„é€»è¾‘åœ¨åŸå§‹ç±»å‹å’Œå¯¹è±¡ç±»å‹ä¸Šæ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯ä»–ä»¬éƒ½åªä¼šè½¬æ¢æˆä¸Šé¢ 3 ç§ç±»å‹ä¹‹ä¸€&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬é¦–å…ˆåˆ†æä¸€ä¸‹åŸå§‹ç±»å‹è½¬æ¢ã€‚&lt;/p&gt;
&lt;h2 id=&quot;String-ç±»å‹è½¬æ¢&quot;&gt;&lt;a href=&quot;#String-ç±»å‹è½¬æ¢&quot; class=&quot;headerlink&quot; title=&quot;String ç±»å‹è½¬æ¢&quot;&gt;&lt;/a&gt;String ç±»å‹è½¬æ¢&lt;/h2&gt;&lt;p&gt;&lt;code&gt;String()&lt;/code&gt; æ–¹æ³•å¯ä»¥ç”¨æ¥æ˜¾å¼å°†å€¼è½¬ä¸ºå­—ç¬¦ä¸²ï¼Œéšå¼è½¬æ¢é€šå¸¸åœ¨æœ‰ &lt;code&gt;+&lt;/code&gt; è¿ç®—ç¬¦å¹¶ä¸”æœ‰ä¸€ä¸ªæ“ä½œæ•°æ˜¯ &lt;code&gt;string&lt;/code&gt; ç±»å‹æ—¶è¢«è§¦å‘ï¼Œå¦‚ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;String&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;123&lt;/span&gt;) &lt;span class=&quot;comment&quot;&gt;// æ˜¾å¼ç±»å‹è½¬æ¢&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;123&lt;/span&gt; + &lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;// éšå¼ç±»å‹è½¬æ¢&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ‰€æœ‰åŸå§‹ç±»å‹è½¬ String ç±»å‹&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;String&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;123&lt;/span&gt;)  &lt;span class=&quot;comment&quot;&gt;// &#39;123&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;String&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;-12.3&lt;/span&gt;)  &lt;span class=&quot;comment&quot;&gt;// &#39;-12.3&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;String&lt;/span&gt;(&lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;)  &lt;span class=&quot;comment&quot;&gt;// &#39;null&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;String&lt;/span&gt;(&lt;span class=&quot;literal&quot;&gt;undefined&lt;/span&gt;)  &lt;span class=&quot;comment&quot;&gt;// &#39;undefined&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;String&lt;/span&gt;(&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;)  &lt;span class=&quot;comment&quot;&gt;// &#39;true&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;Symbol ç±»å‹è½¬ String ç±»å‹æ˜¯æ¯”è¾ƒä¸¥æ ¼çš„ï¼Œå®ƒåªèƒ½è¢«æ˜¾å¼çš„è½¬æ¢&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;String&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;Symbol&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;symbol&#39;&lt;/span&gt;))  &lt;span class=&quot;comment&quot;&gt;// &#39;Symbol(symbol)&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt; + &lt;span class=&quot;built_in&quot;&gt;Symbol&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;symbol&#39;&lt;/span&gt;)  &lt;span class=&quot;comment&quot;&gt;// TypeError is thrown&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;Boolean-ç±»å‹è½¬æ¢&quot;&gt;&lt;a href=&quot;#Boolean-ç±»å‹è½¬æ¢&quot; class=&quot;headerlink&quot; title=&quot;Boolean ç±»å‹è½¬æ¢&quot;&gt;&lt;/a&gt;Boolean ç±»å‹è½¬æ¢&lt;/h2&gt;&lt;p&gt;&lt;code&gt;Boolean()&lt;/code&gt; æ–¹æ³•å¯ä»¥ç”¨æ¥æ˜¾å¼å°†å€¼è½¬æ¢æˆ boolean å‹ã€‚&lt;/p&gt;
&lt;p&gt;éšå¼ç±»å‹è½¬æ¢é€šå¸¸åœ¨é€»è¾‘åˆ¤æ–­æˆ–è€…æœ‰é€»è¾‘è¿ç®—ç¬¦æ—¶è¢«è§¦å‘&lt;code&gt;ï¼ˆ|| &amp;amp;&amp;amp; !ï¼‰&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;Boolean&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;)    &lt;span class=&quot;comment&quot;&gt;// æ˜¾ç¤ºç±»å‹è½¬æ¢&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;) &amp;#123;&amp;#125;      &lt;span class=&quot;comment&quot;&gt;// é€»è¾‘åˆ¤æ–­è§¦å‘éšå¼ç±»å‹è½¬æ¢&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;!!&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;           &lt;span class=&quot;comment&quot;&gt;// é€»è¾‘è¿ç®—ç¬¦è§¦å‘éšå¼ç±»å‹è½¬æ¢&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; || &lt;span class=&quot;string&quot;&gt;&#39;hello&#39;&lt;/span&gt;  &lt;span class=&quot;comment&quot;&gt;// é€»è¾‘è¿ç®—ç¬¦è§¦å‘éšå¼ç±»å‹è½¬æ¢&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Js" scheme="https://zhanghao-web.github.io/categories/Js/"/>
    
    
      <category term="Js" scheme="https://zhanghao-web.github.io/tags/Js/"/>
    
  </entry>
  
  <entry>
    <title>JavaScriptå¼‚æ­¥ç¼–ç¨‹å›è°ƒåœ°ç‹±çš„ä¸€äº›è§£å†³æ–¹æ¡ˆ</title>
    <link href="https://zhanghao-web.github.io/2019/08/01/Js/JavaScript%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E5%9B%9E%E8%B0%83%E5%9C%B0%E7%8B%B1%E7%9A%84%E4%B8%80%E4%BA%9B%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <id>https://zhanghao-web.github.io/2019/08/01/Js/JavaScriptå¼‚æ­¥ç¼–ç¨‹å›è°ƒåœ°ç‹±çš„ä¸€äº›è§£å†³æ–¹æ¡ˆ/</id>
    <published>2019-08-01T01:36:56.000Z</published>
    <updated>2020-01-28T10:04:15.032Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://www.jianshu.com/p/bc7b8d542dcd" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a></p><blockquote><p>å¼‚æ­¥ç¼–ç¨‹åœ¨JavaScriptä¸­éå¸¸é‡è¦ã€‚è¿‡å¤šçš„å¼‚æ­¥ç¼–ç¨‹ä¹Ÿå¸¦äº†å›è°ƒåµŒå¥—çš„é—®é¢˜ï¼Œæœ¬æ–‡ä¼šæä¾›ä¸€äº›è§£å†³â€œå›è°ƒåœ°ç‹±â€çš„æ–¹æ³•ã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"å»¶æ—¶è§¦å‘"</span>)</span><br><span class="line">&#125;,<span class="number">2000</span>)</span><br><span class="line">fs.readFile(<span class="string">'./samp.txt'</span>,<span class="string">'utf-8'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">res,error</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å°±æ˜¯å…¸å‹çš„å›è°ƒå‡½æ•°ï¼Œä¸è®ºæ˜¯åœ¨æµè§ˆå™¨ä¸­ï¼Œè¿˜æ˜¯åœ¨nodeä¸­ï¼ŒJavaScriptæœ¬èº«æ˜¯å•çº¿ç¨‹ï¼Œå› æ­¤ï¼Œä¸ºäº†åº”å¯¹ä¸€äº›å•çº¿ç¨‹å¸¦æ¥çš„é—®é¢˜ï¼Œå¼‚æ­¥ç¼–ç¨‹æˆä¸ºäº†JavaScriptä¸­éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ã€‚</p><p>ä¸è®ºæ˜¯æµè§ˆå™¨ä¸­æœ€ä¸ºå¸¸è§çš„<strong>ajaxã€äº‹ä»¶ç›‘å¬ï¼Œè¿˜æ˜¯nodeä¸­æ–‡ä»¶è¯»å–ã€ç½‘ç»œç¼–ç¨‹ã€æ•°æ®åº“ç­‰æ“ä½œ</strong>ï¼Œéƒ½ç¦»ä¸å¼€å¼‚æ­¥ç¼–ç¨‹ã€‚åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­ï¼Œè®¸å¤šæ“ä½œéƒ½ä¼šæ”¾<strong>åœ¨å›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰</strong>ä¸­ã€‚åŒæ­¥ä¸å¼‚æ­¥çš„æ··æ‚ã€è¿‡å¤šçš„å›è°ƒåµŒå¥—éƒ½ä¼šä½¿å¾—ä»£ç å˜å¾—éš¾ä»¥ç†è§£ä¸ç»´æŠ¤ï¼Œè¿™ä¹Ÿæ˜¯å¸¸å—äººè¯Ÿç—…çš„åœ°æ–¹ã€‚</p><p>å…ˆçœ‹ä¸‹é¢è¿™æ®µä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fs.readFile(<span class="string">'./sample.txt'</span>, <span class="string">'utf-8'</span>, (err, content) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> keyword = content.substring(<span class="number">0</span>, <span class="number">5</span>);</span><br><span class="line">    db.find(<span class="string">`select * from sample where kw = <span class="subst">$&#123;keyword&#125;</span>`</span>, (err, res) =&gt; &#123;</span><br><span class="line">        <span class="keyword">get</span>(`/sampleget?count=$&#123;res.length&#125;<span class="string">`, data =&gt; &#123;</span></span><br><span class="line"><span class="string">           console.log(data);</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">&#125;);</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆæˆ‘ä»¬è¯»å–çš„ä¸€ä¸ªæ–‡ä»¶ä¸­çš„å…³é”®å­—keywordï¼Œç„¶åæ ¹æ®è¯¥keywordè¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼Œæœ€åä¾æ®æŸ¥è¯¢ç»“æœè¯·æ±‚æ•°æ®ã€‚</p><ul><li>æ–‡ä»¶è¯»å–ï¼šfs.readFile</li><li>æ•°æ®åº“æŸ¥è¯¢ï¼šdb.find</li><li>httpè¯·æ±‚ï¼šget</li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æ²¡å¢åŠ ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚ï¼Œå°±ä¼šå¤šæ·»åŠ ä¸€å±‚å›è°ƒå‡½æ•°çš„åµŒå¥—ï¼Œè¿™æ®µä»£ç ä¸­ä¸‰ä¸ªå¼‚æ­¥å‡½æ•°çš„åµŒå¥—å·²ç»å¼€å§‹ä½¿ä¸€æ®µæœ¬å¯ä»¥è¯­è¨€æ˜ç¡®çš„ä»£ç ç¼–ç¨‹ä¸æ˜“é˜…è¯»ä¸ç»´æŠ¤äº†ã€‚</p><p>æŠ½è±¡å‡ºæ¥è¿™ç§ä»£ç ä¼šå˜æˆä¸‹é¢è¿™æ ·ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">asyncFunc1(opt, (...args1) =&gt; &#123;</span><br><span class="line">    asyncFunc2(opt, (...args2) =&gt; &#123;</span><br><span class="line">        asyncFunc3(opt, (...args3) =&gt; &#123;</span><br><span class="line">            asyncFunc4(opt, (...args4) =&gt; &#123;</span><br><span class="line">                <span class="comment">// some operation</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å·¦ä¾§æ˜æ˜¾å‡ºç°äº†ä¸€ä¸ªä¸‰è§’å½¢çš„ç¼©è¿›åŒºåŸŸï¼Œè¿‡å¤šçš„å›è°ƒä¹Ÿå°±è®©æˆ‘ä»¬é™·å…¥<code>â€œå›è°ƒåœ°ç‹±â€</code>ã€‚æ¥ä¸‹æ¥ä¼šä»‹ç»ä¸€äº›æ–¹æ³•æ¥è§„é¿å›è°ƒåœ°ç‹±ã€‚</p><h2 id="ä¸€ã€æ‹†è§£function"><a href="#ä¸€ã€æ‹†è§£function" class="headerlink" title="ä¸€ã€æ‹†è§£function"></a>ä¸€ã€æ‹†è§£function</h2><p>å›è°ƒåµŒå¥—æ‰€å¸¦æ¥çš„ä¸€ä¸ªé‡è¦é—®é¢˜å°±æ˜¯ä»£ç ä¸æ˜“é˜…è¯»ä¸ç»´æŠ¤ã€‚å› ä¸ºæ™®éæ¥è¯´ï¼Œè¿‡å¤šçš„ç¼©è¿›ï¼ˆåµŒå¥—ï¼‰ä¼šæå¤§çš„å½±å“ä»£ç çš„å¯è¯»æ€§ã€‚åŸºäºè¿™ä¸€ç‚¹ï¼Œå¯ä»¥è¿›è¡Œä¸€ä¸ªæœ€ç®€å•çš„ä¼˜åŒ–â€”â€”å°†å„æ­¥æ‹†è§£ä¸ºå•ä¸ªçš„<code>function</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params">count</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">get</span>(`/sampleget?count=$&#123;count&#125;<span class="string">`, data =&gt; &#123;</span></span><br><span class="line"><span class="string">        console.log(data);</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function queryDB(kw) &#123;</span></span><br><span class="line"><span class="string">    db.find(`</span>select * <span class="keyword">from</span> sample where kw = $&#123;kw&#125;<span class="string">`, (err, res) =&gt; &#123;</span></span><br><span class="line"><span class="string">        getData(res.length);</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function readFile(filepath) &#123;</span></span><br><span class="line"><span class="string">    fs.readFile(filepath, 'utf-8', (err, content) =&gt; &#123;</span></span><br><span class="line"><span class="string">        let keyword = content.substring(0, 5);</span></span><br><span class="line"><span class="string">        queryDB(keyword);</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">readFile('./sample.txt');</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ä¸Šé¢çš„æ”¹å†™æ–¹å¼ï¼Œä»£ç æ¸…æ™°äº†è®¸å¤šã€‚è¯¥æ–¹æ³•éå¸¸ç®€å•ï¼Œå…·æœ‰ä¸€å®šçš„æ•ˆæœï¼Œä½†æ˜¯ç¼ºå°‘é€šç”¨æ€§ã€‚</p><h2 id="äºŒã€äº‹ä»¶å‘å¸ƒ-ç›‘å¬æ¨¡å¼"><a href="#äºŒã€äº‹ä»¶å‘å¸ƒ-ç›‘å¬æ¨¡å¼" class="headerlink" title="äºŒã€äº‹ä»¶å‘å¸ƒ/ç›‘å¬æ¨¡å¼"></a>äºŒã€äº‹ä»¶å‘å¸ƒ/ç›‘å¬æ¨¡å¼</h2><p>å¦‚æœåœ¨æµè§ˆå™¨ä¸­å†™è¿‡äº‹ä»¶ç›‘å¬<code>addEventListener</code>ï¼Œé‚£ä¹ˆä½ å¯¹è¿™ç§äº‹ä»¶å‘å¸ƒ/ç›‘å¬çš„æ¨¡å¼ä¸€å®šä¸é™Œç”Ÿã€‚</p><p>å€Ÿé‰´è¿™ç§æ€æƒ³ï¼Œä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥ç›‘å¬æŸä¸€äº‹ä»¶ï¼Œå½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè¿›è¡Œç›¸åº”å›è°ƒæ“ä½œï¼›å¦ä¸€æ–¹é¢ï¼Œå½“æŸäº›æ“ä½œå®Œæˆåï¼Œé€šè¿‡å‘å¸ƒäº‹ä»¶è§¦å‘å›è°ƒã€‚è¿™æ ·å°±å¯ä»¥å°†åŸæœ¬æ†ç»‘åœ¨ä¸€èµ·çš„ä»£ç è§£è€¦ã€‚<br><a id="more"></a><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> events = <span class="built_in">require</span>(<span class="string">'events'</span>);</span><br><span class="line"><span class="keyword">const</span> eventEmitter = <span class="keyword">new</span> events.EventEmitter();</span><br><span class="line"></span><br><span class="line">eventEmitter.on(<span class="string">'db'</span>, (err, kw) =&gt; &#123;</span><br><span class="line">    db.find(<span class="string">`select * from sample where kw = <span class="subst">$&#123;kw&#125;</span>`</span>, (err, res) =&gt; &#123;</span><br><span class="line">        eventEmitter(<span class="string">'get'</span>, res.length);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">eventEmitter.on(<span class="string">'get'</span>, (err, count) =&gt; &#123;</span><br><span class="line">    <span class="keyword">get</span>(`/sampleget?count=$&#123;count&#125;<span class="string">`, data =&gt; &#123;</span></span><br><span class="line"><span class="string">        console.log(data);</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">fs.readFile('./sample.txt', 'utf-8', (err, content) =&gt; &#123;</span></span><br><span class="line"><span class="string">    let keyword = content.substring(0, 5);</span></span><br><span class="line"><span class="string">    eventEmitter. emit('db', keyword);</span></span><br><span class="line"><span class="string">&#125;);</span></span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨è¿™ç§æ¨¡å¼çš„å®ç°éœ€è¦ä¸€ä¸ªäº‹ä»¶å‘å¸ƒ/ç›‘å¬çš„åº“ã€‚ä¸Šé¢ä»£ç ä¸­ä½¿ç”¨nodeåŸç”Ÿçš„eventsæ¨¡å—ï¼Œå½“ç„¶ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä½ å–œæ¬¢çš„åº“ã€‚</p><h2 id="ä¸‰ã€Promise"><a href="#ä¸‰ã€Promise" class="headerlink" title="ä¸‰ã€Promise"></a>ä¸‰ã€Promise</h2><p><code>Promise</code>æ˜¯ä¸€ç§å¼‚æ­¥è§£å†³æ–¹æ¡ˆï¼Œæœ€æ—©ç”±ç¤¾åŒºæå‡ºå¹¶å®ç°ï¼Œåæ¥å†™è¿›äº†es6è§„èŒƒã€‚</p><p>ç›®å‰ä¸€äº›ä¸»æµçš„æµè§ˆå™¨å·²ç»åŸç”Ÿå®ç°äº†Promiseçš„APIï¼Œå¯ä»¥åœ¨Can I useé‡ŒæŸ¥çœ‹æµè§ˆå™¨çš„æ”¯æŒæƒ…å†µã€‚å½“ç„¶ï¼Œå¦‚æœæƒ³è¦åšæµè§ˆå™¨çš„å…¼å®¹ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸€äº›<code>Promise</code>çš„å®ç°åº“ï¼Œä¾‹å¦‚bluebirdã€ Qç­‰ã€‚ä¸‹é¢ä»¥bluebirdä¸ºä¾‹ï¼š</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å°†å¼‚æ­¥æ–¹æ³•æ”¹å†™ä¸º<code>Promise</code>ï¼Œå¯¹äºç¬¦åˆnodeè§„èŒƒçš„å›è°ƒå‡½æ•°ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯Errorï¼‰ï¼Œå¯ä»¥ä½¿ç”¨<code>bluebird</code>çš„promisifyæ–¹æ³•ã€‚è¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ªæ ‡å‡†çš„å¼‚æ­¥æ–¹æ³•å¹¶è¿”å›ä¸€ä¸ª<code>Promise</code>å¯¹è±¡ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bluebird = <span class="built_in">require</span>(<span class="string">'bluebird'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">const</span> readFile = bluebird.promisify(fs.readFile);</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼ŒreadFileå°±å˜æˆäº†ä¸€ä¸ªPromiseå¯¹è±¡ã€‚</p><p>ä½†æ˜¯ï¼Œæœ‰çš„å¼‚æ­¥æ–¹æ³•æ— æ³•è¿›è¡Œè½¬æ¢ï¼Œæˆ–è€…æˆ‘ä»¬éœ€è¦ä½¿ç”¨åŸç”Ÿ<code>Promise</code>ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è¿›è¡Œä¸€äº›æ”¹é€ ã€‚ä¸‹é¢æä¾›ä¸€ç§æ”¹é€ çš„æ–¹æ³•ã€‚</p><p>ä»¥fs.readFileä¸ºä¾‹ï¼Œå€ŸåŠ©åŸç”Ÿ<code>Promise</code>æ¥æ”¹é€ è¯¥æ–¹æ³•ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> readFile = <span class="function"><span class="keyword">function</span> (<span class="params">filepath</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> resolve,</span><br><span class="line">        reject;</span><br><span class="line">    <span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">_resolve, _reject</span>) =&gt;</span> &#123;</span><br><span class="line">        resolve = _resolve;</span><br><span class="line">        reject = _reject;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">let</span> deferred = &#123;</span><br><span class="line">        resolve,</span><br><span class="line">        reject,</span><br><span class="line">        promise</span><br><span class="line">    &#125;;</span><br><span class="line">    fs.readFile(filepath, <span class="string">'utf-8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, ...args</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            deferred.reject(err);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            deferred.resolve(...args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> deferred.promise;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨æ–¹æ³•ä¸­åˆ›å»ºäº†ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œå¹¶åœ¨å¼‚æ­¥å›è°ƒä¸­æ ¹æ®ä¸åŒçš„æƒ…å†µä½¿ç”¨rejectä¸resolveæ¥æ”¹å˜Promiseå¯¹è±¡çš„çŠ¶æ€ã€‚è¯¥æ–¹æ³•è¿”å›è¿™ä¸ªPromiseå¯¹è±¡ã€‚å…¶ä»–çš„ä¸€äº›å¼‚æ­¥æ–¹æ³•ä¹Ÿå¯ä»¥å‚ç…§è¿™ç§æ–¹å¼è¿›è¡Œæ”¹é€ ã€‚</p><p>å‡è®¾é€šè¿‡æ”¹é€ ï¼ŒreadFileã€queryDBä¸getDataæ–¹æ³•å‡ä¼šè¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ã€‚ä»£ç å°±å˜ä¸ºäº†:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">readFile(<span class="string">'./sample.txt'</span>).then(<span class="function"><span class="params">content</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> keyword = content.substring(<span class="number">0</span>, <span class="number">5</span>);</span><br><span class="line">    <span class="keyword">return</span> queryDB(keyword);</span><br><span class="line">&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> getData(res.length);</span><br><span class="line">&#125;).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.warn(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä¹‹å‰çš„åµŒå¥—æ“ä½œç¼–ç¨‹äº†é€šè¿‡thenè¿æ¥çš„é“¾å¼æ“ä½œã€‚ä»£ç çš„æ•´æ´åº¦ä¸Šæœ‰äº†ä¸€ä¸ªè¾ƒå¤§çš„æé«˜ã€‚</p><h2 id="å››ã€generator"><a href="#å››ã€generator" class="headerlink" title="å››ã€generator"></a>å››ã€generator</h2><p><code>generator</code>æ˜¯es6ä¸­çš„ä¸€ä¸ªæ–°çš„è¯­æ³•ã€‚åœ¨functionå…³é”®å­—åæ·»åŠ *å³å¯å°†å‡½æ•°å˜ä¸º<code>generator</code>ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> gen = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ<code>generator</code>å°†ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œç”¨äºéå†<code>generator</code>å†…éƒ¨çš„çŠ¶æ€</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> g = gen();</span><br><span class="line">g.next(); <span class="comment">// &#123; value: 1, done: false &#125;</span></span><br><span class="line">g.next(); <span class="comment">// &#123; value: 2, done: false &#125;</span></span><br><span class="line">g.next(); <span class="comment">// &#123; value: 3, done: true &#125;</span></span><br><span class="line">g.next(); <span class="comment">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>generator</code>å‡½æ•°æœ‰ä¸€ä¸ªæœ€å¤§çš„ç‰¹ç‚¹ï¼Œå¯ä»¥åœ¨å†…éƒ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­äº¤å‡ºç¨‹åºçš„æ§åˆ¶æƒï¼Œ<code>yield</code>ç›¸å½“äºèµ·åˆ°äº†ä¸€ä¸ªæš‚åœçš„ä½œç”¨ï¼›è€Œå½“ä¸€å®šæƒ…å†µä¸‹ï¼Œå¤–éƒ¨åˆå°†æ§åˆ¶æƒå†ç§»äº¤å›æ¥ã€‚</p><p>æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬ç”¨<code>generator</code>æ¥å°è£…ä»£ç ï¼Œåœ¨å¼‚æ­¥ä»»åŠ¡å¤„ä½¿ç”¨<code>yield</code>å…³é”®è¯ï¼Œæ­¤æ—¶<code>generator</code>ä¼šå°†ç¨‹åºæ‰§è¡Œæƒäº¤ç»™å…¶ä»–ä»£ç ï¼Œè€Œåœ¨å¼‚æ­¥ä»»åŠ¡å®Œæˆåï¼Œè°ƒç”¨nextæ–¹æ³•æ¥æ¢å¤<code>yield</code>ä¸‹æ–¹ä»£ç çš„æ‰§è¡Œã€‚ä»¥readFileä¸ºä¾‹ï¼Œå¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æˆ‘ä»¬çš„ä¸»ä»»åŠ¡â€”â€”æ˜¾ç¤ºå…³é”®å­—</span></span><br><span class="line"><span class="comment">// ä½¿ç”¨yieldæš‚æ—¶ä¸­æ–­ä¸‹æ–¹ä»£ç æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">// yieldåé¢ä¸ºpromiseå¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> showKeyword = <span class="function"><span class="keyword">function</span>* (<span class="params">filepath</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'å¼€å§‹è¯»å–'</span>);</span><br><span class="line">    <span class="keyword">let</span> keyword = <span class="keyword">yield</span> readFile(filepath);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`å…³é”®å­—ä¸º<span class="subst">$&#123;filepath&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// generatorçš„æµç¨‹æ§åˆ¶</span></span><br><span class="line"><span class="keyword">let</span> gen = showKeyword();</span><br><span class="line"><span class="keyword">let</span> res = gen.next();</span><br><span class="line">res.value.then(<span class="function"><span class="params">res</span> =&gt;</span> gen.next(res));</span><br></pre></td></tr></table></figure><p>åœ¨ä¸»ä»»åŠ¡éƒ¨åˆ†ï¼ŒåŸæœ¬<code>readFile</code>å¼‚æ­¥çš„éƒ¨åˆ†å˜æˆäº†ç±»ä¼¼åŒæ­¥çš„å†™æ³•ï¼Œä»£ç å˜å¾—éå¸¸æ¸…æ™°ã€‚è€Œåœ¨ä¸‹åŠéƒ¨åˆ†ï¼Œåˆ™æ˜¯å¯¹äºä»€ä¹ˆæ—¶å€™éœ€è¦ç§»äº¤å›æ§åˆ¶æƒç»™<code>generator</code>çš„æµç¨‹æ§åˆ¶ã€‚</p><p>ç„¶è€Œï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ§åˆ¶<code>generator</code>çš„æµç¨‹ï¼Œå¦‚æœèƒ½å¤Ÿè‡ªåŠ¨æ‰§è¡Œ<code>generator</code>â€”â€”åœ¨éœ€è¦çš„æ—¶å€™è‡ªåŠ¨ç§»äº¤æ§åˆ¶æƒï¼Œé‚£ä¹ˆä¼šæ›´åŠ å…·æœ‰å®ç”¨æ€§ã€‚<br>ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ co è¿™ä¸ªåº“ã€‚å®ƒå¯ä»¥æ˜¯çœå»æˆ‘ä»¬å¯¹äº<code>generator</code>æµç¨‹æ§åˆ¶çš„ä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> co = reuqire(<span class="string">'co'</span>);</span><br><span class="line"><span class="comment">// æˆ‘ä»¬çš„ä¸»ä»»åŠ¡â€”â€”æ˜¾ç¤ºå…³é”®å­—</span></span><br><span class="line"><span class="comment">// ä½¿ç”¨yieldæš‚æ—¶ä¸­æ–­ä¸‹æ–¹ä»£ç æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">// yieldåé¢ä¸ºpromiseå¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> showKeyword = <span class="function"><span class="keyword">function</span>* (<span class="params">filepath</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'å¼€å§‹è¯»å–'</span>);</span><br><span class="line">    <span class="keyword">let</span> keyword = <span class="keyword">yield</span> readFile(filepath);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`å…³é”®å­—ä¸º<span class="subst">$&#123;filepath&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨co</span></span><br><span class="line">co(showKeyword);</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œyeildå…³é”®å­—åé¢éœ€è¦æ˜¯<code>functio, promise, generator, arrayæˆ–object</code>ã€‚å¯ä»¥æ”¹å†™æ–‡ç« ä¸€å¼€å§‹çš„ä¾‹å­ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> co = reuqire(<span class="string">'co'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> task = <span class="function"><span class="keyword">function</span>* (<span class="params">filepath</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">let</span> keyword = <span class="keyword">yield</span> readFile(filepath);</span><br><span class="line">   <span class="keyword">let</span> count = <span class="keyword">yield</span> queryDB(keyword);</span><br><span class="line">   <span class="keyword">let</span> data = <span class="keyword">yield</span> getData(res.length);</span><br><span class="line">   <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">co(task, <span class="string">'./sample.txt'</span>);</span><br></pre></td></tr></table></figure><p>äº”ã€async/await</p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„æ–¹æ³•è™½ç„¶éƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†å¼‚æ­¥ç¼–ç¨‹ä¸­å›è°ƒå¸¦æ¥çš„é—®é¢˜ã€‚ç„¶è€Œ</p><ul><li>functionæ‹†åˆ†çš„æ–¹å¼å…¶å®ä»…ä»…åªæ˜¯æ‹†åˆ†ä»£ç å—ï¼Œæ—¶å¸¸ä¼šä¸åˆ©äºåç»­ç»´æŠ¤ï¼›</li><li>äº‹ä»¶å‘å¸ƒ/ç›‘å¬æ–¹å¼æ¨¡ç³Šäº†å¼‚æ­¥æ–¹æ³•ä¹‹é—´çš„æµç¨‹å…³ç³»ï¼›</li><li>Promiseè™½ç„¶ä½¿å¾—å¤šä¸ªåµŒå¥—çš„å¼‚æ­¥è°ƒç”¨èƒ½å¤Ÿé€šè¿‡é“¾å¼çš„APIè¿›è¡Œæ“ä½œï¼Œä½†æ˜¯è¿‡å¤šçš„thenä¹Ÿå¢åŠ äº†ä»£ç çš„å†—ä½™ï¼Œä¹Ÿå¯¹é˜…è¯»ä»£ç ä¸­å„é˜¶æ®µçš„å¼‚æ­¥ä»»åŠ¡äº§ç”Ÿäº†ä¸€å®šå¹²æ‰°ï¼›</li><li>é€šè¿‡generatorè™½ç„¶èƒ½æä¾›è¾ƒå¥½çš„è¯­æ³•ç»“æ„ï¼Œä½†æ˜¯æ¯•ç«Ÿgeneratorä¸yieldçš„è¯­å¢ƒç”¨åœ¨è¿™é‡Œå¤šå°‘è¿˜æœ‰äº›ä¸å¤ªè´´åˆ‡ã€‚</li></ul><p>å› æ­¤ï¼Œè¿™é‡Œå†ä»‹ç»ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒå°±æ˜¯es7ä¸­çš„async/awaitã€‚</p><p>ç®€å•ä»‹ç»ä¸€ä¸‹async/awaitã€‚åŸºæœ¬ä¸Šï¼Œä»»ä½•ä¸€ä¸ªå‡½æ•°éƒ½å¯ä»¥æˆä¸ºasyncå‡½æ•°ï¼Œä»¥ä¸‹éƒ½æ˜¯åˆæ³•çš„ä¹¦å†™å½¢å¼ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> foo = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> foo = <span class="keyword">async</span> () =&gt; &#123;&#125;;</span><br></pre></td></tr></table></figure><p>åœ¨asyncå‡½æ•°ä¸­å¯ä»¥ä½¿ç”¨awaitè¯­å¥ã€‚awaitåä¸€èˆ¬æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'å¼€å§‹'</span>);</span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> post(data);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`postå·²å®Œæˆï¼Œç»“æœä¸ºï¼š<span class="subst">$&#123;res&#125;</span>`</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å½“ä¸Šé¢çš„å‡½æ•°æ‰§è¡Œåˆ°awaitæ—¶ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºï¼Œå‡½æ•°æŒ‚èµ·ï¼Œç­‰å¾…<code>await</code>åçš„<code>Promise</code>è¿”å›ï¼Œå†æ‰§è¡Œä¸‹é¢çš„è¯­å¥ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™æ®µå¼‚æ­¥æ“ä½œçš„ä»£ç ï¼Œçœ‹èµ·æ¥å°±åƒæ˜¯â€œåŒæ­¥æ“ä½œâ€ã€‚è¿™å°±å¤§å¤§æ–¹ä¾¿äº†å¼‚æ­¥ä»£ç çš„ç¼–å†™ä¸é˜…è¯»ã€‚ä¸‹é¢æ”¹å†™æˆ‘ä»¬çš„ä¾‹å­ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> printData = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params">filepath</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">let</span> keyword = <span class="keyword">await</span> readFile(filepath);</span><br><span class="line">   <span class="keyword">let</span> count = <span class="keyword">await</span> queryDB(keyword);</span><br><span class="line">   <span class="keyword">let</span> data = <span class="keyword">await</span> getData(res.length);</span><br><span class="line">   <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">printData(<span class="string">'./sample.txt'</span>);</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä»£ç ç®€æ´æ¸…æ™°ï¼Œå¼‚æ­¥ä»£ç ä¹Ÿå…·æœ‰äº†â€œåŒæ­¥â€ä»£ç çš„ç»“æ„ã€‚</p><p>æ³¨æ„ï¼Œå…¶ä¸­<code>readFileã€queryDBä¸getData</code>æ–¹æ³•éƒ½éœ€è¦è¿”å›ä¸€ä¸ª<code>Promise</code>å¯¹è±¡ã€‚è¿™å¯ä»¥é€šè¿‡åœ¨ç¬¬ä¸‰éƒ¨åˆ†Promiseé‡Œæä¾›çš„æ–¹å¼è¿›è¡Œæ”¹å†™ã€‚</p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>å¼‚æ­¥ç¼–ç¨‹ä½œä¸ºJavaScriptä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå…·æœ‰éå¸¸é‡è¦çš„ä½ç½®ï¼Œå®ƒå¸®åŠ©æˆ‘ä»¬é¿å…åŒæ­¥ä»£ç å¸¦æ¥çš„çº¿ç¨‹é˜»å¡çš„åŒæ—¶ï¼Œä¹Ÿä¸ºç¼–ç ä¸é˜…è¯»å¸¦æ¥äº†ä¸€å®šçš„å›°éš¾ã€‚è¿‡å¤šçš„å›è°ƒåµŒå¥—å¾ˆå®¹æ˜“ä¼šè®©æˆ‘ä»¬é™·å…¥â€œå›è°ƒåœ°ç‹±â€ä¸­ï¼Œä½¿ä»£ç å˜æˆä¸€å›¢ä¹±éº»ã€‚ä¸ºäº†è§£å†³â€œå›è°ƒåœ°ç‹±â€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–‡ä¸­æ‰€è¿°çš„è¿™äº”ç§å¸¸ç”¨æ–¹æ³•ï¼š</p><ul><li>functionæ‹†è§£</li><li>äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼</li><li>Promise</li><li>Generator</li><li>async / await</li></ul><p>ç†è§£å„ç±»æ–¹æ³•çš„åŸç†ä¸å®ç°æ–¹å¼ï¼Œäº†è§£å…¶ä¸­åˆ©å¼Šï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½å¾—è¿›è¡Œå¼‚æ­¥ç¼–ç¨‹ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://www.jianshu.com/p/bc7b8d542dcd&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¼‚æ­¥ç¼–ç¨‹åœ¨JavaScriptä¸­éå¸¸é‡è¦ã€‚è¿‡å¤šçš„å¼‚æ­¥ç¼–ç¨‹ä¹Ÿå¸¦äº†å›è°ƒåµŒå¥—çš„é—®é¢˜ï¼Œæœ¬æ–‡ä¼šæä¾›ä¸€äº›è§£å†³â€œå›è°ƒåœ°ç‹±â€çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;setTimeout(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&quot;å»¶æ—¶è§¦å‘&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;,&lt;span class=&quot;number&quot;&gt;2000&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fs.readFile(&lt;span class=&quot;string&quot;&gt;&#39;./samp.txt&#39;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&#39;utf-8&#39;&lt;/span&gt;,&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;res,error&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(res);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸Šé¢å°±æ˜¯å…¸å‹çš„å›è°ƒå‡½æ•°ï¼Œä¸è®ºæ˜¯åœ¨æµè§ˆå™¨ä¸­ï¼Œè¿˜æ˜¯åœ¨nodeä¸­ï¼ŒJavaScriptæœ¬èº«æ˜¯å•çº¿ç¨‹ï¼Œå› æ­¤ï¼Œä¸ºäº†åº”å¯¹ä¸€äº›å•çº¿ç¨‹å¸¦æ¥çš„é—®é¢˜ï¼Œå¼‚æ­¥ç¼–ç¨‹æˆä¸ºäº†JavaScriptä¸­éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è®ºæ˜¯æµè§ˆå™¨ä¸­æœ€ä¸ºå¸¸è§çš„&lt;strong&gt;ajaxã€äº‹ä»¶ç›‘å¬ï¼Œè¿˜æ˜¯nodeä¸­æ–‡ä»¶è¯»å–ã€ç½‘ç»œç¼–ç¨‹ã€æ•°æ®åº“ç­‰æ“ä½œ&lt;/strong&gt;ï¼Œéƒ½ç¦»ä¸å¼€å¼‚æ­¥ç¼–ç¨‹ã€‚åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­ï¼Œè®¸å¤šæ“ä½œéƒ½ä¼šæ”¾&lt;strong&gt;åœ¨å›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰&lt;/strong&gt;ä¸­ã€‚åŒæ­¥ä¸å¼‚æ­¥çš„æ··æ‚ã€è¿‡å¤šçš„å›è°ƒåµŒå¥—éƒ½ä¼šä½¿å¾—ä»£ç å˜å¾—éš¾ä»¥ç†è§£ä¸ç»´æŠ¤ï¼Œè¿™ä¹Ÿæ˜¯å¸¸å—äººè¯Ÿç—…çš„åœ°æ–¹ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆçœ‹ä¸‹é¢è¿™æ®µä»£ç &lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;fs.readFile(&lt;span class=&quot;string&quot;&gt;&#39;./sample.txt&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;utf-8&#39;&lt;/span&gt;, (err, content) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; keyword = content.substring(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    db.find(&lt;span class=&quot;string&quot;&gt;`select * from sample where kw = &lt;span class=&quot;subst&quot;&gt;$&amp;#123;keyword&amp;#125;&lt;/span&gt;`&lt;/span&gt;, (err, res) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;get&lt;/span&gt;(`/sampleget?count=$&amp;#123;res.length&amp;#125;&lt;span class=&quot;string&quot;&gt;`, data =&amp;gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;           console.log(data);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;        &amp;#125;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é¦–å…ˆæˆ‘ä»¬è¯»å–çš„ä¸€ä¸ªæ–‡ä»¶ä¸­çš„å…³é”®å­—keywordï¼Œç„¶åæ ¹æ®è¯¥keywordè¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼Œæœ€åä¾æ®æŸ¥è¯¢ç»“æœè¯·æ±‚æ•°æ®ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–‡ä»¶è¯»å–ï¼šfs.readFile&lt;/li&gt;
&lt;li&gt;æ•°æ®åº“æŸ¥è¯¢ï¼šdb.find&lt;/li&gt;
&lt;li&gt;httpè¯·æ±‚ï¼šget&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æ²¡å¢åŠ ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚ï¼Œå°±ä¼šå¤šæ·»åŠ ä¸€å±‚å›è°ƒå‡½æ•°çš„åµŒå¥—ï¼Œè¿™æ®µä»£ç ä¸­ä¸‰ä¸ªå¼‚æ­¥å‡½æ•°çš„åµŒå¥—å·²ç»å¼€å§‹ä½¿ä¸€æ®µæœ¬å¯ä»¥è¯­è¨€æ˜ç¡®çš„ä»£ç ç¼–ç¨‹ä¸æ˜“é˜…è¯»ä¸ç»´æŠ¤äº†ã€‚&lt;/p&gt;
&lt;p&gt;æŠ½è±¡å‡ºæ¥è¿™ç§ä»£ç ä¼šå˜æˆä¸‹é¢è¿™æ ·ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;asyncFunc1(opt, (...args1) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    asyncFunc2(opt, (...args2) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        asyncFunc3(opt, (...args3) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            asyncFunc4(opt, (...args4) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// some operation&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å·¦ä¾§æ˜æ˜¾å‡ºç°äº†ä¸€ä¸ªä¸‰è§’å½¢çš„ç¼©è¿›åŒºåŸŸï¼Œè¿‡å¤šçš„å›è°ƒä¹Ÿå°±è®©æˆ‘ä»¬é™·å…¥&lt;code&gt;â€œå›è°ƒåœ°ç‹±â€&lt;/code&gt;ã€‚æ¥ä¸‹æ¥ä¼šä»‹ç»ä¸€äº›æ–¹æ³•æ¥è§„é¿å›è°ƒåœ°ç‹±ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ä¸€ã€æ‹†è§£function&quot;&gt;&lt;a href=&quot;#ä¸€ã€æ‹†è§£function&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€æ‹†è§£function&quot;&gt;&lt;/a&gt;ä¸€ã€æ‹†è§£function&lt;/h2&gt;&lt;p&gt;å›è°ƒåµŒå¥—æ‰€å¸¦æ¥çš„ä¸€ä¸ªé‡è¦é—®é¢˜å°±æ˜¯ä»£ç ä¸æ˜“é˜…è¯»ä¸ç»´æŠ¤ã€‚å› ä¸ºæ™®éæ¥è¯´ï¼Œè¿‡å¤šçš„ç¼©è¿›ï¼ˆåµŒå¥—ï¼‰ä¼šæå¤§çš„å½±å“ä»£ç çš„å¯è¯»æ€§ã€‚åŸºäºè¿™ä¸€ç‚¹ï¼Œå¯ä»¥è¿›è¡Œä¸€ä¸ªæœ€ç®€å•çš„ä¼˜åŒ–â€”â€”å°†å„æ­¥æ‹†è§£ä¸ºå•ä¸ªçš„&lt;code&gt;function&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getData&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;count&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;get&lt;/span&gt;(`/sampleget?count=$&amp;#123;count&amp;#125;&lt;span class=&quot;string&quot;&gt;`, data =&amp;gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;        console.log(data);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;function queryDB(kw) &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;    db.find(`&lt;/span&gt;select * &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; sample where kw = $&amp;#123;kw&amp;#125;&lt;span class=&quot;string&quot;&gt;`, (err, res) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;        getData(res.length);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;function readFile(filepath) &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;    fs.readFile(filepath, &#39;utf-8&#39;, (err, content) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;        let keyword = content.substring(0, 5);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;        queryDB(keyword);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;readFile(&#39;./sample.txt&#39;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ä¸Šé¢çš„æ”¹å†™æ–¹å¼ï¼Œä»£ç æ¸…æ™°äº†è®¸å¤šã€‚è¯¥æ–¹æ³•éå¸¸ç®€å•ï¼Œå…·æœ‰ä¸€å®šçš„æ•ˆæœï¼Œä½†æ˜¯ç¼ºå°‘é€šç”¨æ€§ã€‚&lt;/p&gt;
&lt;h2 id=&quot;äºŒã€äº‹ä»¶å‘å¸ƒ-ç›‘å¬æ¨¡å¼&quot;&gt;&lt;a href=&quot;#äºŒã€äº‹ä»¶å‘å¸ƒ-ç›‘å¬æ¨¡å¼&quot; class=&quot;headerlink&quot; title=&quot;äºŒã€äº‹ä»¶å‘å¸ƒ/ç›‘å¬æ¨¡å¼&quot;&gt;&lt;/a&gt;äºŒã€äº‹ä»¶å‘å¸ƒ/ç›‘å¬æ¨¡å¼&lt;/h2&gt;&lt;p&gt;å¦‚æœåœ¨æµè§ˆå™¨ä¸­å†™è¿‡äº‹ä»¶ç›‘å¬&lt;code&gt;addEventListener&lt;/code&gt;ï¼Œé‚£ä¹ˆä½ å¯¹è¿™ç§äº‹ä»¶å‘å¸ƒ/ç›‘å¬çš„æ¨¡å¼ä¸€å®šä¸é™Œç”Ÿã€‚&lt;/p&gt;
&lt;p&gt;å€Ÿé‰´è¿™ç§æ€æƒ³ï¼Œä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥ç›‘å¬æŸä¸€äº‹ä»¶ï¼Œå½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè¿›è¡Œç›¸åº”å›è°ƒæ“ä½œï¼›å¦ä¸€æ–¹é¢ï¼Œå½“æŸäº›æ“ä½œå®Œæˆåï¼Œé€šè¿‡å‘å¸ƒäº‹ä»¶è§¦å‘å›è°ƒã€‚è¿™æ ·å°±å¯ä»¥å°†åŸæœ¬æ†ç»‘åœ¨ä¸€èµ·çš„ä»£ç è§£è€¦ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="Js" scheme="https://zhanghao-web.github.io/categories/Js/"/>
    
    
      <category term="Js" scheme="https://zhanghao-web.github.io/tags/Js/"/>
    
  </entry>
  
  <entry>
    <title>Webpack Freestyle ä¹‹ Long Term Cache(webpack å®ç°æŒä¹…æ€§ç¼“å­˜)</title>
    <link href="https://zhanghao-web.github.io/2019/07/31/Tools/Webpack-Freestyle-%E4%B9%8B-Long-Term-Cache-webpack-%E5%AE%9E%E7%8E%B0%E6%8C%81%E4%B9%85%E6%80%A7%E7%BC%93%E5%AD%98/"/>
    <id>https://zhanghao-web.github.io/2019/07/31/Tools/Webpack-Freestyle-ä¹‹-Long-Term-Cache-webpack-å®ç°æŒä¹…æ€§ç¼“å­˜/</id>
    <published>2019-07-31T06:36:29.000Z</published>
    <updated>2020-01-28T10:04:15.063Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://zhuanlan.zhihu.com/p/27710902" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a></p><h2 id="How-Browser-Cache-Works"><a href="#How-Browser-Cache-Works" class="headerlink" title="How Browser Cache Works"></a>How Browser Cache Works</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦ææ¸…æ¥šæµè§ˆå™¨ç¼“å­˜æ˜¯æ€ä¹ˆå·¥ä½œçš„ã€‚ é‚£ä¹ˆï¼Œå°±è®©æˆ‘ç”»ä¸€å¼ å›¾æ¥å‘Šè¯‰å¤§å®¶å§ï¼Œå˜»å˜»ã€‚</p><p><img src="https://pic2.zhimg.com/80/v2-5babc40038bcc8add9c5f8bcb717c7b5_hd.png" alt="pic"></p><ul><li>æµè§ˆå™¨: æˆ‘éœ€è¦ foo.js</li><li>æœåŠ¡å™¨: è®©æˆ‘æ‰¾æ‰¾ã€‚æ‰¾åˆ°äº†ï¼Œç»™ä½ ï¼Œç¼“å­˜æœ‰æ•ˆæœŸä¸º 1 å¹´ã€‚</li><li>æµè§ˆå™¨: å¥½ï¼Œæˆ‘æŠŠä»–ç¼“å­˜åˆ°ç£ç›˜é‡Œã€‚</li></ul><p>è¿‡äº† 2 å¤©ï¼Œ</p><p><img src="https://pic4.zhimg.com/80/v2-b5e4a95482e0008758b94ec96c0f60a3_hd.png" alt="pic1"></p><p>æµè§ˆå™¨: æˆ‘éœ€è¦ foo.js ï¼Œåœ¨ç¼“å­˜é‡Œæ‰¾åˆ°äº†ã€‚ç¼“å­˜è¿˜æœ‰æ•ˆï¼Œé‚£ç›´æ¥è¯»ç¼“å­˜ã€‚<br>ç”¨æˆ·ï¼šå“‡å¡ï¼Œè¿™ç½‘é¡µç§’å¼€å•Šã€‚</p><p>åˆè¿‡äº† 2 å¤©ï¼Œfoo.js çš„ä»£ç æ›´æ–°äº†ã€‚ï¼ˆå†…å®¹ä» Hello world å˜æˆäº† Goodbye world ï¼‰</p><p><img src="https://pic2.zhimg.com/80/v2-680f699d7e09991af4f6bf260559aef1_hd.png" alt="pic2"></p><p>æµè§ˆå™¨ï¼šæˆ‘éœ€è¦ foo.js ï¼Œåœ¨ç¼“å­˜é‡Œæ‰¾åˆ°äº†ã€‚ç¼“å­˜è¿˜æœ‰æ•ˆï¼Œé‚£ç›´æ¥è¯»ç¼“å­˜ã€‚<br>äº§å“ç»ç†ï¼šï¼Ÿï¼Ÿï¼Ÿè¿™é¡µé¢æ€ä¹ˆè·Ÿä»¥å‰ä¸€æ ·å•Šï¼Ÿ</p><p>å¾ˆå°´å°¬ã€‚foo.js æ˜æ˜æ›´æ–°äº†ï¼Œä½†æ˜¯æµè§ˆå™¨è¿˜æ˜¯è¯»å–åœ¨ç¼“å­˜ä¸­æ—§çš„ foo.js ï¼ŒåŸå› æ˜¯æˆ‘ä»¬ç”¨äº†ç¼“å­˜ï¼Œä¸ç”¨ç¼“å­˜å°±æ²¡è¿™äº‹å„¿äº†ã€‚?</p><p>è§£å†³åŠæ³•å˜›ï¼Œå½“ç„¶æœ‰çš„ã€‚æ¯”å¦‚æ¯æ¬¡åˆ©ç”¨ç¼“å­˜ä¹‹å‰ï¼Œ<code>å…ˆå‘æœåŠ¡å™¨ç¡®è®¤æ–‡ä»¶æ˜¯å¦æœ‰æ›´æ–°ï¼Œæœ‰æ›´æ–°åˆ™ä½¿ç”¨æ–°çš„å¦åˆ™è¯»ç¼“å­˜</code>ã€‚è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯<code>æŠŠç¼“å­˜ç ´åæ‰ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢è¦è¯´çš„*Cache Busting Technique*</code> </p><h2 id="Cache-Busting-Technique"><a href="#Cache-Busting-Technique" class="headerlink" title="Cache Busting Technique"></a>Cache Busting Technique</h2><p>å› ä¸º foo.js çš„ä»£ç å˜åŒ–äº†ï¼Œä½†æ˜¯ä»–çš„ç¼“å­˜è¿˜æ²¡å¤±æ•ˆï¼Œæ­¤æ—¶æµè§ˆå™¨è¿˜æ˜¯ä¼šè¯»å–ä»¥å‰çš„ç¼“å­˜äº†çš„ foo.js ï¼Œå¹¶ä¸ä¼šå»æœåŠ¡å™¨ä¸‹è½½æœ€æ–°çš„ã€‚è¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦ç ´åç¼“å­˜ï¼ˆ Cache Busting ï¼‰ã€‚</p><p>ç ´åç¼“å­˜å¹¶ä¸æ˜¯ç¦æ­¢ç¼“å­˜ï¼Œè€Œæ˜¯æ¢ä¸€ç§æ–¹å¼è®©ç¼“å­˜å¤±æ•ˆã€‚æ¯”å¦‚ï¼š</p><p>1.ä¿®æ”¹æ–‡ä»¶çš„åå­—ï¼šfoo.js -&gt; foo.v2.js<br>2.ä¿®æ”¹æ–‡ä»¶çš„è·¯å¾„ï¼š/static/foo.js -&gt; /static/v2/foo.js<br>3.åŠ  query string : foo.js -&gt; foo.js?v=qwer</p><p>æˆ‘ä»¬ä¸‹é¢å°†é‡‡ç”¨ç¬¬ä¸€ç§æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä¿®æ”¹æ–‡ä»¶çš„åå­—ã€‚æˆ‘ä»¬æŠŠæ›´æ–°åçš„ foo.js çš„æ–‡ä»¶åæ”¹æˆ foo.v2.js ã€‚è¿™æ ·ï¼Œæµè§ˆå™¨å°±ä¸ä¼šå»è¯»å–ç¼“å­˜é‡Œçš„æ—§çš„ foo.js ï¼Œè€Œæ˜¯å‘æœåŠ¡è¯·è¯·æ±‚ foo.v2.js ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://pic2.zhimg.com/80/v2-103471cbe5d028bc9e1122db6e4243b9_hd.png" alt="pic4"></p><p>é‚£ä¹ˆï¼Œå‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰å¾ˆå¤šå¾ˆå¤šçš„é™æ€æ–‡ä»¶ï¼Œç„¶åæ¯æ¬¡éœ€è¦æ›´æ–°å¾ˆå¤šå¾ˆå¤šçš„æ–‡ä»¶ï¼Œé‚£æ˜¯ä¸æ˜¯è¦æ‰‹åŠ¨åœ°ä¸€ä¸ªä¸€ä¸ªåœ°ä¿®æ”¹æ–‡ä»¶çš„åå­—å‘¢ï¼Ÿæˆ‘ä»¬çš„ç†æƒ³å½“ç„¶æ˜¯ï¼šå“ªä¸ªæ–‡ä»¶æ›´æ–°äº†ï¼Œå°±<strong>è‡ªåŠ¨</strong>åœ°ç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡ä»¶åã€‚</p><p>å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬æ‰“åŒ…å‡ºæ¥çš„é™æ€æ–‡ä»¶åªæœ‰ä¸€ä¸ªå•ç‹¬çš„ JavaScript æ–‡ä»¶ app.js ï¼Œé‚£ä¹ˆæ¯æ¬¡æ”¹åŠ¨ä¸€ç‚¹ä»£ç ï¼Œapp.js çš„æ–‡ä»¶åè‚¯å®šéƒ½ä¼šå˜ã€‚ä½†å®é™…ä¸Šï¼Œæˆ‘åªæ”¹åŠ¨äº†æŸä¸ªæ¨¡å—çš„ä»£ç ï¼ˆå…¶ä»–æ¨¡å—å¹¶æ²¡æœ‰ä¿®æ”¹ï¼‰ï¼Œå°±ç ´åäº†å…¶ä»–æ¨¡å—çš„ç¼“å­˜ï¼Œè¿™æ˜¾ç„¶æ²¡æœ‰å……åˆ†åˆ©ç”¨åˆ°ç¼“å­˜å•Šã€‚æˆ‘ä»¬çš„æƒ³æ³•æ˜¯ï¼šå“ªä¸ªæ¨¡å—æ›´æ–°äº†ç ´åä»–çš„ç¼“å­˜ï¼Œæ²¡æ›´æ–°çš„æ¨¡å—ç»§ç»­åˆ©ç”¨ç¼“å­˜ã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ° webpack çš„ code splittingï¼ˆå¦‚æœè¿˜ä¸ä¼šçš„è¯ï¼Œå¯ä»¥é˜…è¯» <a href="https://zhuanlan.zhihu.com/p/26710831?refer=ElemeFE" target="_blank" rel="noopener">Webpack å¤§æ³•ä¹‹ Code Splitting</a> ï¼‰ã€‚æŠŠæ•´ä¸ª App åˆ†æˆä¸€ä¸ªä¸ª chunk ï¼Œç„¶åå“ªä¸ª chunk å‘ç”Ÿæ”¹å˜ï¼Œæˆ‘å°±ç ´åä»–çš„ç¼“å­˜ï¼›æ²¡æœ‰æ›´æ–°çš„ chunk ï¼Œåˆ™ç»§ç»­åˆ©ç”¨ç¼“å­˜ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±æŠŠç¼“å­˜çš„ä½œç”¨å‘æŒ¥åˆ°æ·‹æ¼“å°½è‡´ï½</p><p>æ‰€ä»¥ï¼Œ<code>code splitting</code> çš„ä½œç”¨é™¤äº†â€å‡å°‘æ–‡ä»¶å¤§å°â€ä¹‹å¤–ï¼Œè¿˜èƒ½æ›´å……åˆ†åœ°åˆ©ç”¨ç¼“å­˜ã€‚æ‰€ä»¥ï¼Œä¸‹é¢å°±è®©æˆ‘ä»¬ç”¨ webpack æ¥å®ç°æŒä¹…æ€§ç¼“å­˜å§ã€‚</p><h2 id="Webpack-amp-Caching"><a href="#Webpack-amp-Caching" class="headerlink" title="Webpack &amp; Caching"></a>Webpack &amp; Caching</h2><p>é¦–å…ˆï¼ŒæŠŠæˆ‘ä»¬çš„ <a href="https://link.zhihu.com/?target=https%3A//github.com/lyyourc/webpack-code-splitting-demo">demo é¡¹ç›®</a>ï¼ˆå·²ç»å®ç°äº† code splitting ï¼‰ä¸‹è½½å¹¶å®‰è£…å¥½ä¾èµ–ã€‚</p><p>æ¥ç€ï¼Œä¿®æ”¹ webpack é…ç½®æ–‡ä»¶ï¼Œç»™æˆ‘ä»¬æ‰“åŒ…åçš„é™æ€æ–‡ä»¶ç”Ÿæˆéšæœºçš„å”¯ä¸€çš„åå­—ã€‚ï¼ˆ changed files ï¼‰</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  output: &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    filename: <span class="string">'[name].[chunkhash:8].js'</span>,</span><br><span class="line">    chunkFilename: <span class="string">'[name].[chunkhash:8].chunk.js'</span>,</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨äº† <code>[chunkhash]</code> è¿™ä¸ªå ä½ç¬¦ï¼Œå¹¶ä¸”ä¸ºäº†æ›´å¥½åœ°åˆ†è¾¨å’Œå±•ç¤º demo ï¼Œæˆ‘ä»¬æˆªå–äº†ä»–çš„å‰ 8 ä¸ªå­—ç¬¦ <code>[chunkhash:8]</code>ï¼Œä½†æ˜¯åœ¨å®é™…ç”Ÿäº§ä¸­æˆ‘ä»¬ä¸è¦é‚£ä¹ˆåšï¼</p><p>å¥½å’¯ï¼Œç°åœ¨æ¥çœ‹çœ‹æˆ‘ä»¬çš„æ‰“åŒ…åçš„æ–‡ä»¶ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">                    Asset            Size    Chunk Names</span><br><span class="line">common-<span class="keyword">in</span>-lazy.fa79d198.chunk.js    <span class="number">11.6</span> kB  common-<span class="keyword">in</span>-lazy</span><br><span class="line">    used-twice.c2c4927c.chunk.js    <span class="number">17.1</span> kB  used-twice</span><br><span class="line">        Photos<span class="number">.28</span>d663ec.chunk.js    <span class="number">8.57</span> kB  Photos</span><br><span class="line">         Emoji.d3ea8991.chunk.js    <span class="number">1.15</span> kB  Emoji</span><br><span class="line">                 app<span class="number">.724</span>a238a.js    <span class="number">2.53</span> kB  app</span><br><span class="line">              vendor<span class="number">.05</span>be8f94.js     <span class="number">104</span> kB  vendor</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œç°åœ¨æˆ‘ä»¬æ¥ä¿®æ”¹ä¸€ä¸‹ App.vue ï¼Œæ·»åŠ ä¸ª <code>&lt;footer&gt;</code> æ ‡ç­¾ï¼ˆ changed files ï¼‰ :</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- old codes --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">footer</span>&gt;</span> A Footer <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>æ­¤æ—¶çš„æ‰“åŒ…å˜æˆäº†ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">                        Asset       Size  Chunk Names</span><br><span class="line">common-<span class="keyword">in</span>-lazy.fa79d198.chunk.js    <span class="number">11.6</span> kB  common-<span class="keyword">in</span>-lazy</span><br><span class="line">    used-twice.c2c4927c.chunk.js    <span class="number">17.1</span> kB  used-twice</span><br><span class="line">        Photos<span class="number">.28</span>d663ec.chunk.js    <span class="number">8.57</span> kB  Photos</span><br><span class="line">         Emoji.d3ea8991.chunk.js    <span class="number">1.15</span> kB  Emoji</span><br><span class="line">                 app.fdc2eedb.js    <span class="number">2.57</span> kB  app</span><br><span class="line">              vendor.b611a5da.js     <span class="number">104</span> kB  vendor</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬çš„ app chunk çš„ hash ä» 724a238a å˜æˆäº† fdc2eedb ï¼Œè¿™æ˜¯æˆ‘ä»¬æ‰€å¸Œæœ›çœ‹åˆ°çš„ä¸œè¥¿ã€‚ä½†æ˜¯ï¼Œä¸æ­¤åŒæ—¶ vendor chunk çš„ hash ä¹Ÿå˜äº†ï¼ˆ05be8f94 -&gt; b611a5daï¼‰ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ä¿®æ”¹ vendor chunk çš„ä»£ç ï¼Œä¸ºä»€ä¹ˆä»–çš„ hash ä¹Ÿå˜äº†å‘¢ï¼Ÿ?</p><p>åŸå› æ˜¯ <code>vendor chunk</code> é‡Œé¢åŒ…å«äº† <code>webpack</code> çš„ <code>runtime</code> ä»£ç ï¼ˆç”¨æ¥è§£æå’ŒåŠ è½½æ¨¡å—ä¹‹ç±»çš„è¿è¡Œæ—¶ä»£ç ï¼‰ï¼š</p><p>è§£å†³åŠæ³•å°±æ˜¯æŠŠ webpack çš„ runtime ä»£ç æå–å‡ºæ¥ï¼ˆ changed files ï¼‰ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123; </span><br><span class="line">  name: [<span class="string">'manifast'</span>] </span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure><p>æŠŠä¹‹å‰ App.vue æ›´æ–°äº†çš„ä»£ç æš‚æ—¶å»æ‰ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æ·»åŠ çš„ <code>&lt;footer&gt;</code> æ ‡ç­¾å»æ‰ï¼š</p><p>æ¥ç€æŒ‰ç…§ä¹‹å‰çš„ï¼Œä¿®æ”¹ App.vue ï¼Œæ·»åŠ  `` æ ‡ç­¾ï¼ˆ changed files ï¼‰ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- old codes --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">footer</span>&gt;</span> A Footer <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è€Œæ­¤æ—¶çš„æ‰“åŒ…ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">                        Asset       Size  Chunk Names</span><br><span class="line">common-<span class="keyword">in</span>-lazy.fa79d198.chunk.js    <span class="number">11.6</span> kB  common-<span class="keyword">in</span>-lazy</span><br><span class="line">    used-twice.c2c4927c.chunk.js    <span class="number">17.1</span> kB  used-twice</span><br><span class="line">        Photos<span class="number">.28</span>d663ec.chunk.js    <span class="number">8.57</span> kB  Photos</span><br><span class="line">         Emoji.d3ea8991.chunk.js    <span class="number">1.15</span> kB  Emoji</span><br><span class="line">                 app.fdc2eedb.js    <span class="number">2.57</span> kB  app</span><br><span class="line">              vendor<span class="number">.3</span>b70f9d8.js     <span class="number">103</span> kB  vendor</span><br><span class="line">            manifast<span class="number">.1442e3</span>f3.js    <span class="number">1.54</span> kB  manifast</span><br></pre></td></tr></table></figure><p>å¾ˆå¼€å¿ƒï¼Œæ­¤æ—¶åªæœ‰ <code>app.js</code> å’Œ <code>manifast.js</code> è¿™ 2 ä¸ª chunk çš„æ–‡ä»¶åçš„ hash å‘ç”Ÿäº†æ”¹å˜ï¼Œvendor.js chunk å’Œå…¶ä»– chunk éƒ½æ²¡å˜ï¼Œèˆ’æœã€‚</p><p>ä½†æ˜¯ï¼Œå‡å¦‚æˆ‘ä»¬ç»™ App.vue éšä¾¿å¼•å…¥ä¸€ä¸ªæ¨¡å—çš„è¯ï¼Œæ¯”å¦‚ï¼ˆ changed files ï¼‰ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">import</span> noop <span class="keyword">from</span> <span class="string">'./shared/utils.js'</span></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>è€Œæ­¤æ—¶çš„æ‰“åŒ…ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">                        Asset       Size  Chunk Names</span><br><span class="line">common-<span class="keyword">in</span>-lazy<span class="number">.30</span>b1e9b6.chunk.js    <span class="number">11.6</span> kB  common-<span class="keyword">in</span>-lazy</span><br><span class="line">    used-twice<span class="number">.9</span>eccbe5a.chunk.js    <span class="number">17.1</span> kB  used-twice</span><br><span class="line">        Photos<span class="number">.6096611</span>c.chunk.js    <span class="number">8.57</span> kB  Photos</span><br><span class="line">         Emoji<span class="number">.6208</span>da60.chunk.js    <span class="number">1.15</span> kB  Emoji</span><br><span class="line">                 app<span class="number">.4675</span>a374.js    <span class="number">2.61</span> kB  app</span><br><span class="line">              vendor<span class="number">.8</span>b538297.js     <span class="number">103</span> kB  vendor</span><br><span class="line">            manifast<span class="number">.25580296</span>.js    <span class="number">1.54</span> kB  manifast</span><br></pre></td></tr></table></figure><p>å§æ§½å±…ç„¶æ‰€æœ‰ chunk çš„ hash éƒ½å‘ç”Ÿäº†æ”¹å˜ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ</p><p><strong>åŸå› æ˜¯åœ¨ webpack é‡Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰ä¸€ä¸ª module id </strong>ï¼Œmodule id æ˜¯è¯¥æ¨¡å—åœ¨<a href="https://link.zhihu.com/?target=https%3A//webpack.js.org/concepts/dependency-graph/">æ¨¡å—ä¾èµ–å…³ç³»å›¾</a>é‡ŒæŒ‰é¡ºåºåˆ†é…çš„åºå·ï¼Œå¦‚æœè¿™ä¸ª module id å‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆä»–çš„ chunkhash ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ã€‚ï¼ˆä¸ç¡®å®šè¿™é‡Œæ˜¯å¦æ­£ç¡®ï¼Œå¸Œæœ›å¤§ä½¬æŒ‡å‡ºé”™è¯¯ï¼‰</p><p><img src="https://pic4.zhimg.com/80/v2-5a4b6bef5809e00512873d481a3670e7_hd.png" alt="pic5"></p><p>æ‰€ä»¥å‘¢ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ä¸€ç§æ–°çš„æ–¹å¼æ¥è®¡ç®— module id ã€‚ <strong>HashedModuleIdsPlugin</strong> è¿™ä¸ªæ’ä»¶ï¼Œä»–æ˜¯æ ¹æ®æ¨¡å—æ‰€åœ¨è·¯å¾„æ¥æ˜ å°„å…¶ module id ï¼Œè¿™æ ·å°±ç®—å¼•å…¥äº†æ–°çš„æ¨¡å—ï¼Œä¹Ÿä¸ä¼šå½±å“ module id çš„å€¼ï¼Œåªè¦æ¨¡å—çš„è·¯å¾„ä¸æ”¹å˜çš„è¯ã€‚</p><p>ä¿®æ”¹æˆ‘ä»¬çš„ webpack é…ç½®ã€‚å¹¶ä¸”ï¼Œå»æ‰ä¸Šé¢ App.vue å¼•å…¥çš„ noop æ¨¡å—ã€‚ï¼ˆ changed files ï¼‰</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> webpack.HashedModuleIdsPlugin(),</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">],</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œåªæœ‰ app chunk å’Œ manifast chunk çš„ hash å‘ç”Ÿäº†æ”¹å˜ï¼Œå…¶ä»– chunk ä¸å˜æ‰€ä»¥ä»–ä»¬çš„ç¼“å­˜å°±æ²¡è¢«ç ´åã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç”¨ webpack å®ç° long term cache ï¼š</p><ul><li>ç”Ÿæˆç¨³å®šçš„ hash æ–‡ä»¶å</li><li>æå– webpack çš„ runtime ä»£ç </li><li>code splitting</li></ul><p>è¿˜æœ‰ä¸€äº›ä¸œè¥¿æˆ‘ä»¬æ˜¯æ²¡è®²åˆ°çš„ï¼Œæ¯”å¦‚ CSS çš„ cache ï¼Œå†…è” manifast chunk ç­‰ç­‰ï¼Œå°±ç•™ç»™å¤§å®¶å»æ¢ç´¢å’¯ã€‚</p><p>æœ€åéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œwebpack æ˜¯å…è®¸å…¶ä»– plugin æ¥ä¿®æ”¹ chunkhash çš„ï¼Œå¦‚æœä»–ä»¬ä¸èƒ½æ­£ç¡®åœ°å¤„ç†çš„è¯ï¼Œé‚£ä¹ˆï¼Œå‡è®¾ä½ æ›´æ–°äº†ä»£ç ï¼Œä½†æ˜¯å¯¹åº”çš„ chunkhash æ²¡å˜ï¼Œå¹¶ä¸”æ­¤æ—¶ç¼“å­˜è¿˜æ²¡å¤±æ•ˆï¼Œå°±ä¼šå¯¼è‡´çº¿ä¸Šçš„ä»£ç è¿˜æ˜¯æ—§çš„ï¼Œç”¨æˆ·çœ‹åˆ°çš„è¿˜æ˜¯ä»¥å‰çš„é¡µé¢ã€‚å› æ­¤ï¼Œä¸€å®šè¦ç‰¹åˆ«æ³¨æ„ chunkhash åˆ°åº•æ­£ä¸æ­£ç¡®ï¼ï¼</p><p>å¸Œæœ›æœ¬æ–‡å¯ä»¥å¸®åŠ©åˆ°å¤§å®¶ï¼Œè¿™æ ·æˆ‘ä¼šå¾ˆå¼€å¿ƒçš„ã€‚(<em> </em>)</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/27710902&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;How-Browser-Cache-Works&quot;&gt;&lt;a href=&quot;#How-Browser-Cache-Works&quot; class=&quot;headerlink&quot; title=&quot;How Browser Cache Works&quot;&gt;&lt;/a&gt;How Browser Cache Works&lt;/h2&gt;&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬è¦ææ¸…æ¥šæµè§ˆå™¨ç¼“å­˜æ˜¯æ€ä¹ˆå·¥ä½œçš„ã€‚ é‚£ä¹ˆï¼Œå°±è®©æˆ‘ç”»ä¸€å¼ å›¾æ¥å‘Šè¯‰å¤§å®¶å§ï¼Œå˜»å˜»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://pic2.zhimg.com/80/v2-5babc40038bcc8add9c5f8bcb717c7b5_hd.png&quot; alt=&quot;pic&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æµè§ˆå™¨: æˆ‘éœ€è¦ foo.js&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨: è®©æˆ‘æ‰¾æ‰¾ã€‚æ‰¾åˆ°äº†ï¼Œç»™ä½ ï¼Œç¼“å­˜æœ‰æ•ˆæœŸä¸º 1 å¹´ã€‚&lt;/li&gt;
&lt;li&gt;æµè§ˆå™¨: å¥½ï¼Œæˆ‘æŠŠä»–ç¼“å­˜åˆ°ç£ç›˜é‡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿‡äº† 2 å¤©ï¼Œ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://pic4.zhimg.com/80/v2-b5e4a95482e0008758b94ec96c0f60a3_hd.png&quot; alt=&quot;pic1&quot;&gt;&lt;/p&gt;
&lt;p&gt;æµè§ˆå™¨: æˆ‘éœ€è¦ foo.js ï¼Œåœ¨ç¼“å­˜é‡Œæ‰¾åˆ°äº†ã€‚ç¼“å­˜è¿˜æœ‰æ•ˆï¼Œé‚£ç›´æ¥è¯»ç¼“å­˜ã€‚&lt;br&gt;ç”¨æˆ·ï¼šå“‡å¡ï¼Œè¿™ç½‘é¡µç§’å¼€å•Šã€‚&lt;/p&gt;
&lt;p&gt;åˆè¿‡äº† 2 å¤©ï¼Œfoo.js çš„ä»£ç æ›´æ–°äº†ã€‚ï¼ˆå†…å®¹ä» Hello world å˜æˆäº† Goodbye world ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://pic2.zhimg.com/80/v2-680f699d7e09991af4f6bf260559aef1_hd.png&quot; alt=&quot;pic2&quot;&gt;&lt;/p&gt;
&lt;p&gt;æµè§ˆå™¨ï¼šæˆ‘éœ€è¦ foo.js ï¼Œåœ¨ç¼“å­˜é‡Œæ‰¾åˆ°äº†ã€‚ç¼“å­˜è¿˜æœ‰æ•ˆï¼Œé‚£ç›´æ¥è¯»ç¼“å­˜ã€‚&lt;br&gt;äº§å“ç»ç†ï¼šï¼Ÿï¼Ÿï¼Ÿè¿™é¡µé¢æ€ä¹ˆè·Ÿä»¥å‰ä¸€æ ·å•Šï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¾ˆå°´å°¬ã€‚foo.js æ˜æ˜æ›´æ–°äº†ï¼Œä½†æ˜¯æµè§ˆå™¨è¿˜æ˜¯è¯»å–åœ¨ç¼“å­˜ä¸­æ—§çš„ foo.js ï¼ŒåŸå› æ˜¯æˆ‘ä»¬ç”¨äº†ç¼“å­˜ï¼Œä¸ç”¨ç¼“å­˜å°±æ²¡è¿™äº‹å„¿äº†ã€‚?&lt;/p&gt;
&lt;p&gt;è§£å†³åŠæ³•å˜›ï¼Œå½“ç„¶æœ‰çš„ã€‚æ¯”å¦‚æ¯æ¬¡åˆ©ç”¨ç¼“å­˜ä¹‹å‰ï¼Œ&lt;code&gt;å…ˆå‘æœåŠ¡å™¨ç¡®è®¤æ–‡ä»¶æ˜¯å¦æœ‰æ›´æ–°ï¼Œæœ‰æ›´æ–°åˆ™ä½¿ç”¨æ–°çš„å¦åˆ™è¯»ç¼“å­˜&lt;/code&gt;ã€‚è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯&lt;code&gt;æŠŠç¼“å­˜ç ´åæ‰ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢è¦è¯´çš„*Cache Busting Technique*&lt;/code&gt; &lt;/p&gt;
&lt;h2 id=&quot;Cache-Busting-Technique&quot;&gt;&lt;a href=&quot;#Cache-Busting-Technique&quot; class=&quot;headerlink&quot; title=&quot;Cache Busting Technique&quot;&gt;&lt;/a&gt;Cache Busting Technique&lt;/h2&gt;&lt;p&gt;å› ä¸º foo.js çš„ä»£ç å˜åŒ–äº†ï¼Œä½†æ˜¯ä»–çš„ç¼“å­˜è¿˜æ²¡å¤±æ•ˆï¼Œæ­¤æ—¶æµè§ˆå™¨è¿˜æ˜¯ä¼šè¯»å–ä»¥å‰çš„ç¼“å­˜äº†çš„ foo.js ï¼Œå¹¶ä¸ä¼šå»æœåŠ¡å™¨ä¸‹è½½æœ€æ–°çš„ã€‚è¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦ç ´åç¼“å­˜ï¼ˆ Cache Busting ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ç ´åç¼“å­˜å¹¶ä¸æ˜¯ç¦æ­¢ç¼“å­˜ï¼Œè€Œæ˜¯æ¢ä¸€ç§æ–¹å¼è®©ç¼“å­˜å¤±æ•ˆã€‚æ¯”å¦‚ï¼š&lt;/p&gt;
&lt;p&gt;1.ä¿®æ”¹æ–‡ä»¶çš„åå­—ï¼šfoo.js -&amp;gt; foo.v2.js&lt;br&gt;2.ä¿®æ”¹æ–‡ä»¶çš„è·¯å¾„ï¼š/static/foo.js -&amp;gt; /static/v2/foo.js&lt;br&gt;3.åŠ  query string : foo.js -&amp;gt; foo.js?v=qwer&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä¸‹é¢å°†é‡‡ç”¨ç¬¬ä¸€ç§æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä¿®æ”¹æ–‡ä»¶çš„åå­—ã€‚æˆ‘ä»¬æŠŠæ›´æ–°åçš„ foo.js çš„æ–‡ä»¶åæ”¹æˆ foo.v2.js ã€‚è¿™æ ·ï¼Œæµè§ˆå™¨å°±ä¸ä¼šå»è¯»å–ç¼“å­˜é‡Œçš„æ—§çš„ foo.js ï¼Œè€Œæ˜¯å‘æœåŠ¡è¯·è¯·æ±‚ foo.v2.js ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://pic2.zhimg.com/80/v2-103471cbe5d028bc9e1122db6e4243b9_hd.png&quot; alt=&quot;pic4&quot;&gt;&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆï¼Œå‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰å¾ˆå¤šå¾ˆå¤šçš„é™æ€æ–‡ä»¶ï¼Œç„¶åæ¯æ¬¡éœ€è¦æ›´æ–°å¾ˆå¤šå¾ˆå¤šçš„æ–‡ä»¶ï¼Œé‚£æ˜¯ä¸æ˜¯è¦æ‰‹åŠ¨åœ°ä¸€ä¸ªä¸€ä¸ªåœ°ä¿®æ”¹æ–‡ä»¶çš„åå­—å‘¢ï¼Ÿæˆ‘ä»¬çš„ç†æƒ³å½“ç„¶æ˜¯ï¼šå“ªä¸ªæ–‡ä»¶æ›´æ–°äº†ï¼Œå°±&lt;strong&gt;è‡ªåŠ¨&lt;/strong&gt;åœ°ç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡ä»¶åã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬æ‰“åŒ…å‡ºæ¥çš„é™æ€æ–‡ä»¶åªæœ‰ä¸€ä¸ªå•ç‹¬çš„ JavaScript æ–‡ä»¶ app.js ï¼Œé‚£ä¹ˆæ¯æ¬¡æ”¹åŠ¨ä¸€ç‚¹ä»£ç ï¼Œapp.js çš„æ–‡ä»¶åè‚¯å®šéƒ½ä¼šå˜ã€‚ä½†å®é™…ä¸Šï¼Œæˆ‘åªæ”¹åŠ¨äº†æŸä¸ªæ¨¡å—çš„ä»£ç ï¼ˆå…¶ä»–æ¨¡å—å¹¶æ²¡æœ‰ä¿®æ”¹ï¼‰ï¼Œå°±ç ´åäº†å…¶ä»–æ¨¡å—çš„ç¼“å­˜ï¼Œè¿™æ˜¾ç„¶æ²¡æœ‰å……åˆ†åˆ©ç”¨åˆ°ç¼“å­˜å•Šã€‚æˆ‘ä»¬çš„æƒ³æ³•æ˜¯ï¼šå“ªä¸ªæ¨¡å—æ›´æ–°äº†ç ´åä»–çš„ç¼“å­˜ï¼Œæ²¡æ›´æ–°çš„æ¨¡å—ç»§ç»­åˆ©ç”¨ç¼“å­˜ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ° webpack çš„ code splittingï¼ˆå¦‚æœè¿˜ä¸ä¼šçš„è¯ï¼Œå¯ä»¥é˜…è¯» &lt;a href=&quot;https://zhuanlan.zhihu.com/p/26710831?refer=ElemeFE&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Webpack å¤§æ³•ä¹‹ Code Splitting&lt;/a&gt; ï¼‰ã€‚æŠŠæ•´ä¸ª App åˆ†æˆä¸€ä¸ªä¸ª chunk ï¼Œç„¶åå“ªä¸ª chunk å‘ç”Ÿæ”¹å˜ï¼Œæˆ‘å°±ç ´åä»–çš„ç¼“å­˜ï¼›æ²¡æœ‰æ›´æ–°çš„ chunk ï¼Œåˆ™ç»§ç»­åˆ©ç”¨ç¼“å­˜ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±æŠŠç¼“å­˜çš„ä½œç”¨å‘æŒ¥åˆ°æ·‹æ¼“å°½è‡´ï½&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œ&lt;code&gt;code splitting&lt;/code&gt; çš„ä½œç”¨é™¤äº†â€å‡å°‘æ–‡ä»¶å¤§å°â€ä¹‹å¤–ï¼Œè¿˜èƒ½æ›´å……åˆ†åœ°åˆ©ç”¨ç¼“å­˜ã€‚æ‰€ä»¥ï¼Œä¸‹é¢å°±è®©æˆ‘ä»¬ç”¨ webpack æ¥å®ç°æŒä¹…æ€§ç¼“å­˜å§ã€‚&lt;/p&gt;
&lt;h2 id=&quot;Webpack-amp-Caching&quot;&gt;&lt;a href=&quot;#Webpack-amp-Caching&quot; class=&quot;headerlink&quot; title=&quot;Webpack &amp;amp; Caching&quot;&gt;&lt;/a&gt;Webpack &amp;amp; Caching&lt;/h2&gt;&lt;p&gt;é¦–å…ˆï¼ŒæŠŠæˆ‘ä»¬çš„ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/lyyourc/webpack-code-splitting-demo&quot;&gt;demo é¡¹ç›®&lt;/a&gt;ï¼ˆå·²ç»å®ç°äº† code splitting ï¼‰ä¸‹è½½å¹¶å®‰è£…å¥½ä¾èµ–ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ç€ï¼Œä¿®æ”¹ webpack é…ç½®æ–‡ä»¶ï¼Œç»™æˆ‘ä»¬æ‰“åŒ…åçš„é™æ€æ–‡ä»¶ç”Ÿæˆéšæœºçš„å”¯ä¸€çš„åå­—ã€‚ï¼ˆ changed files ï¼‰&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// webpack.config.js&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;module&lt;/span&gt;.exports = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  output: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    filename: &lt;span class=&quot;string&quot;&gt;&#39;[name].[chunkhash:8].js&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    chunkFilename: &lt;span class=&quot;string&quot;&gt;&#39;[name].[chunkhash:8].chunk.js&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨äº† &lt;code&gt;[chunkhash]&lt;/code&gt; è¿™ä¸ªå ä½ç¬¦ï¼Œå¹¶ä¸”ä¸ºäº†æ›´å¥½åœ°åˆ†è¾¨å’Œå±•ç¤º demo ï¼Œæˆ‘ä»¬æˆªå–äº†ä»–çš„å‰ 8 ä¸ªå­—ç¬¦ &lt;code&gt;[chunkhash:8]&lt;/code&gt;ï¼Œä½†æ˜¯åœ¨å®é™…ç”Ÿäº§ä¸­æˆ‘ä»¬ä¸è¦é‚£ä¹ˆåšï¼&lt;/p&gt;
&lt;p&gt;å¥½å’¯ï¼Œç°åœ¨æ¥çœ‹çœ‹æˆ‘ä»¬çš„æ‰“åŒ…åçš„æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;                    Asset            Size    Chunk Names&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;common-&lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt;-lazy.fa79d198.chunk.js    &lt;span class=&quot;number&quot;&gt;11.6&lt;/span&gt; kB  common-&lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt;-lazy&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    used-twice.c2c4927c.chunk.js    &lt;span class=&quot;number&quot;&gt;17.1&lt;/span&gt; kB  used-twice&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Photos&lt;span class=&quot;number&quot;&gt;.28&lt;/span&gt;d663ec.chunk.js    &lt;span class=&quot;number&quot;&gt;8.57&lt;/span&gt; kB  Photos&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         Emoji.d3ea8991.chunk.js    &lt;span class=&quot;number&quot;&gt;1.15&lt;/span&gt; kB  Emoji&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 app&lt;span class=&quot;number&quot;&gt;.724&lt;/span&gt;a238a.js    &lt;span class=&quot;number&quot;&gt;2.53&lt;/span&gt; kB  app&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              vendor&lt;span class=&quot;number&quot;&gt;.05&lt;/span&gt;be8f94.js     &lt;span class=&quot;number&quot;&gt;104&lt;/span&gt; kB  vendor&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é‚£ä¹ˆï¼Œç°åœ¨æˆ‘ä»¬æ¥ä¿®æ”¹ä¸€ä¸‹ App.vue ï¼Œæ·»åŠ ä¸ª &lt;code&gt;&amp;lt;footer&amp;gt;&lt;/code&gt; æ ‡ç­¾ï¼ˆ changed files ï¼‰ :&lt;/p&gt;
&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;template&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;app&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;&amp;lt;!-- old codes --&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;footer&lt;/span&gt;&amp;gt;&lt;/span&gt; A Footer &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;footer&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;template&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Tools" scheme="https://zhanghao-web.github.io/categories/Tools/"/>
    
    
      <category term="Webpack" scheme="https://zhanghao-web.github.io/tags/Webpack/"/>
    
  </entry>
  
  <entry>
    <title>é€šè¿‡ä¸€ä¸ªé—®é¢˜å­¦ä¹ map,filter,reduceè¯­æ³•</title>
    <link href="https://zhanghao-web.github.io/2019/07/24/Js/%E9%80%9A%E8%BF%87%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98%E5%AD%A6%E4%B9%A0map-filter-reduce%E8%AF%AD%E6%B3%95/"/>
    <id>https://zhanghao-web.github.io/2019/07/24/Js/é€šè¿‡ä¸€ä¸ªé—®é¢˜å­¦ä¹ map-filter-reduceè¯­æ³•/</id>
    <published>2019-07-24T01:44:52.000Z</published>
    <updated>2020-01-28T10:04:15.040Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ¯”å¦‚ä¸€ä¸ªä»1-10çš„ç®€å•çš„æ•°ç»„ï¼Œéœ€è¦ä»ä¸­å–å¥‡æ•°ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ"><a href="#æ¯”å¦‚ä¸€ä¸ªä»1-10çš„ç®€å•çš„æ•°ç»„ï¼Œéœ€è¦ä»ä¸­å–å¥‡æ•°ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ" class="headerlink" title="æ¯”å¦‚ä¸€ä¸ªä»1-10çš„ç®€å•çš„æ•°ç»„ï¼Œéœ€è¦ä»ä¸­å–å¥‡æ•°ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ"></a>æ¯”å¦‚ä¸€ä¸ªä»1-10çš„ç®€å•çš„æ•°ç»„ï¼Œéœ€è¦ä»ä¸­å–å¥‡æ•°ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ</h2><p>è¿™ä¸ªé—®é¢˜ä¸éš¾ï¼Œæœ‰çš„å°‘ä¾ å¯èƒ½ä¼šä½¿ç”¨forå¾ªç¯æ¥è¿‡æ»¤å‡ºå¶æ•°ï¼ŒæŸäº›å°‘ä¾ å¯èƒ½ä¼šä½¿ç”¨whileå¾ªç¯ï¼Œåˆæˆ–æ˜¯ä½¿ç”¨æ•°ç»„è‡ªå¸¦çš„filteræ–¹æ³•ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆä¸è€ƒè™‘ä½¿ç”¨forå’Œwhileè¿™äº›è¿­ä»£æ–¹æ³•ï¼Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨æ•°ç»„è‡ªå¸¦çš„filteræ–¹æ³•ï¼Œå¦‚æœä½¿ç”¨filteræ–¹æ³•çš„è¯ï¼Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>];</span><br><span class="line"><span class="comment">// è¿‡æ»¤å‡ºæ‰€æœ‰å¥‡æ•°</span></span><br><span class="line">nums.filter(<span class="function"><span class="params">num</span> =&gt;</span> num % <span class="number">2</span> !== <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(nums);</span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯æŒºç®€å•çš„å¯¹å§ï¼Ÿ</p><p>ç›¸ä¿¡å¤§éƒ¨åˆ†å°‘ä¾ éƒ½èƒ½å¾ˆè½»æ¾å®Œæˆã€‚</p><p>åœ¨filterå‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>num % 2 !== 0</code> æ¥åˆ¤æ–­ æ˜¯å¦æ˜¯ä¸€ä¸ªå¥‡æ•°ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªå¥‡æ•°ï¼Œå°±è¿‡æ»¤å‡ºæ¥ã€‚</p><p>åœ¨è¿™é‡Œï¼Œæœ‰çš„å°‘ä¾ å¯èƒ½å°±ä¼šæƒ³åˆ°ï¼Œå¦‚æœæŠŠè¿™ä¸ªåˆ¤æ–­è¿‡ç¨‹å•ç‹¬åˆ†æˆä¸€ä¸ªå‡½æ•°ï¼Œä¼šæ–¹ä¾¿ä¸€äº›ï¼Œä¹Ÿæ–¹ä¾¿ä»¥åçš„ä¿®æ”¹æ‰©å±•ã€‚</p><p>æ¯”å¦‚å•ç‹¬å†™ä¸€ä¸ªisOddå‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isOdd = <span class="function"><span class="params">num</span> =&gt;</span> num % <span class="number">2</span> !== <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨filteré‡Œé¢ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼Œæ˜¯å§ï¼Ÿ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isOdd = <span class="function"><span class="params">num</span> =&gt;</span> num % <span class="number">2</span> !== <span class="number">0</span>;</span><br><span class="line"><span class="comment">// è¿‡æ»¤å‡ºæ‰€æœ‰å¥‡æ•°</span></span><br><span class="line"><span class="keyword">const</span> odd = nums.filter(isOdd);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(odd);</span><br></pre></td></tr></table></figure><h2 id="å¦‚æœè¦æŠŠnumsé‡Œé¢çš„æ•°å­—ç¿»å€ï¼Œç”¨mapå‡½æ•°ï¼Œåˆè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ"><a href="#å¦‚æœè¦æŠŠnumsé‡Œé¢çš„æ•°å­—ç¿»å€ï¼Œç”¨mapå‡½æ•°ï¼Œåˆè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ" class="headerlink" title="å¦‚æœè¦æŠŠnumsé‡Œé¢çš„æ•°å­—ç¿»å€ï¼Œç”¨mapå‡½æ•°ï¼Œåˆè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ"></a>å¦‚æœè¦æŠŠnumsé‡Œé¢çš„æ•°å­—ç¿»å€ï¼Œç”¨mapå‡½æ•°ï¼Œåˆè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</h2><p>èªæ˜çš„å°‘ä¾ è¿™æ¬¡è‚¯å®šä¸€ä¸‹å°±æ˜ç™½äº†ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>];</span><br><span class="line"><span class="keyword">const</span> double = <span class="function"><span class="params">num</span> =&gt;</span> num *<span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> doubleNumbers = nums.map(double);</span><br><span class="line"><span class="built_in">console</span>.log(doubleNumbers);</span><br></pre></td></tr></table></figure><h2 id="ä»numsé‡Œé¢è¿‡æ»¤å‡ºæ‰€æœ‰å¥‡æ•°ï¼Œå¹¶ç¿»å€è¿™äº›å¥‡æ•°ã€‚"><a href="#ä»numsé‡Œé¢è¿‡æ»¤å‡ºæ‰€æœ‰å¥‡æ•°ï¼Œå¹¶ç¿»å€è¿™äº›å¥‡æ•°ã€‚" class="headerlink" title="ä»numsé‡Œé¢è¿‡æ»¤å‡ºæ‰€æœ‰å¥‡æ•°ï¼Œå¹¶ç¿»å€è¿™äº›å¥‡æ•°ã€‚"></a>ä»numsé‡Œé¢è¿‡æ»¤å‡ºæ‰€æœ‰å¥‡æ•°ï¼Œå¹¶ç¿»å€è¿™äº›å¥‡æ•°ã€‚</h2><p>è¿™ä¸ªé—®é¢˜ä¹Ÿä¸éš¾æ˜¯å§ï¼Ÿ</p><p>è®©æˆ‘çŒœä¸€ä¸‹ï¼Œä¸€äº›å°‘ä¾ åº”è¯¥ä¼šå†™æˆä¸‹é¢è¿™æ ·ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isOdd = <span class="function"><span class="params">num</span> =&gt;</span> num % <span class="number">2</span> !== <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> double = <span class="function"><span class="params">num</span> =&gt;</span> num *<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> doubleNums = nums.filter(isOdd).map(double);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(doubleNums);</span><br></pre></td></tr></table></figure><h2 id="å¦‚æœæˆ‘ä»¬è¿˜æƒ³ç»§ç»­ç®—å‡ºæ‰€æœ‰å¥‡æ•°ç¿»å€åçš„å’Œçš„è¯"><a href="#å¦‚æœæˆ‘ä»¬è¿˜æƒ³ç»§ç»­ç®—å‡ºæ‰€æœ‰å¥‡æ•°ç¿»å€åçš„å’Œçš„è¯" class="headerlink" title="å¦‚æœæˆ‘ä»¬è¿˜æƒ³ç»§ç»­ç®—å‡ºæ‰€æœ‰å¥‡æ•°ç¿»å€åçš„å’Œçš„è¯"></a>å¦‚æœæˆ‘ä»¬è¿˜æƒ³ç»§ç»­ç®—å‡ºæ‰€æœ‰å¥‡æ•°ç¿»å€åçš„å’Œçš„è¯</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isOdd = <span class="function"><span class="params">num</span> =&gt;</span> num % <span class="number">2</span> !== <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> double = <span class="function"><span class="params">num</span> =&gt;</span> num *<span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">sum,num</span>) =&gt;</span> sum += num;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> doubleNums = nums.filter(isOdd).map(double).reduce(add,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(doubleNums);</span><br></pre></td></tr></table></figure><p>å—¯ï¼Œä¸€ä¸ªä¸²ä¸€ä¸ªçœ‹èµ·æ¥å¾ˆé…·æ˜¯å§ï¼Ÿ æœ€åçš„ç»“æœä¹Ÿæ˜¯æ­£ç¡®çš„ã€‚</p><p>è¿™æ ·ä¸²èµ·æ¥çš„åæœå°±æ˜¯ï¼Œæˆ‘ä»¬ä¼šéå†3æ¬¡æ•°ç»„ï¼Œfilterçš„æ—¶å€™éå†ä¸€æ¬¡ï¼Œmapçš„æ—¶å€™éå†ä¸€æ¬¡ï¼Œreduceçš„æ—¶å€™å†éå†ä¸€æ¬¡ã€‚</p><p>ç°åœ¨æ•°ç»„åªæœ‰10ä¸ªæ•°å­—ï¼Œå½±å“è¿˜ä¸å¤§ï¼Œä½†æ˜¯å¦‚æœæ˜¯å¾ˆå¤§çš„æ•°ç»„ï¼Œæ¯”å¦‚100ä¸‡ä¸ªæ•°å­—ï¼Œéå†3éçš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šå¤šè®¿é—®<strong>150ä¸‡æ¬¡</strong>ï¼Œ</p><p>æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœè®©ä½ è‡ªå·±ä»ä¸­é—´å–å‡ºæ‰€æœ‰å¥‡æ•°ï¼Œç¿»å€ï¼Œå¹¶æ±‚å’Œï¼Œä½ ä¼šè§‰å¾—æ€ä¹ˆåšç®€å•ä¸€äº›å‘¢ï¼Ÿ</p><blockquote><p>æ˜¯ä¸æ˜¯è§‰å¾—ä¸‹é¢è¿™æ ·æ‰æ¯”è¾ƒæ­£å¸¸ï¼Ÿ</p></blockquote><ul><li>é¦–å…ˆï¼Œä»ç¬¬ä¸€ä¸ªæ•°å­—å¼€å§‹ï¼Œå¦‚æœå®ƒæ˜¯å¥‡æ•°ï¼Œå°±æ‹¿å‡ºæ¥ï¼Œç¿»å€ï¼Œç„¶åæ‰¾ä¸ªåœ°æ–¹æ”¾èµ·æ¥</li><li>æ¥ç€ï¼Œç»§ç»­çœ‹ç¬¬äºŒä¸ªæ•°å­—ï¼Œå¦‚æœæ˜¯å¶æ•°ï¼Œå°±è·³è¿‡ï¼Œå¦‚æœæ˜¯å¥‡æ•°ï¼Œå°±æ‹¿å‡ºæ¥ï¼Œç¿»å€ï¼Œç„¶åå’Œå¼€å§‹çš„ç¿»å€åçš„å¥‡æ•°åŠ èµ·æ¥ï¼Œæ‰¾ä¸ªåœ°æ–¹æ”¾èµ·æ¥ã€‚</li><li>æ¥ç€çœ‹ç¬¬ä¸‰ä¸ªæ•°å­—ï¼Œä»¥æ­¤ç±»æ¨ï¼Œåªè¦æ˜¯å¥‡æ•°ï¼Œå°±ç¿»å€ï¼Œç„¶åå’Œä¹‹å‰çš„ç»“æœåŠ èµ·æ¥ã€‚</li><li>ç›´åˆ°æˆ‘ä»¬æ‰¾å¯»åˆ°æœ€åä¸€ä¸ªæ•°å­—ï¼Œå°±å¯ä»¥ç®—å‡ºæœ€ç»ˆç»“æœäº†ï¼Œ</li></ul><p>å¦‚æœä½¿ç”¨è¿­ä»£çš„è¯ï¼Œå°±æ˜¯ä¸‹é¢è¿™æ ·:<br><a id="more"></a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isOdd = <span class="function"><span class="params">num</span> =&gt;</span> num % <span class="number">2</span> !== <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> double = <span class="function"><span class="params">num</span> =&gt;</span> num *<span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">sum,num</span>) =&gt;</span> sum += num;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿å­˜æœ€ç»ˆç»“æœ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i =<span class="number">0</span>; i&lt; nums.length; i++)&#123;</span><br><span class="line">    <span class="keyword">if</span>(nums[i]%<span class="number">2</span> != <span class="number">0</span>)&#123;</span><br><span class="line">        result = result + nums[i]*<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(result); <span class="comment">// 50</span></span><br></pre></td></tr></table></figure><p>æ²¡é”™ï¼Œé€šå¸¸è¿™æ ·æ‰æ˜¯æ­£å¸¸çš„æ“ä½œã€‚</p><p>ä½†æ˜¯ï¼Œ</p><p>è¿™æ ·çš„ä»£ç ä¸å¤ªæ–¹ä¾¿ï¼Œ</p><p>å°‘ä¾ ä½ è‚¯å®šä¹Ÿä¸æƒ³æ¯æ¬¡éƒ½å†™è¿™ä¹ˆä¸€å¤§å †forå¾ªç¯è¯­å¥å§ï¼Ÿ</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆè¯•ç€ç»§ç»­ä¼˜åŒ–ä¸€ä¸‹ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆè¯•ç€ç”¨ä¸€ä¸ªå«åšmagic(é­”æ³•)çš„å‡½æ•°æŠŠè¿™äº›æ­¥éª¤åŒ…è£¹èµ·æ¥:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> magic = <span class="function"><span class="params">array</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> length = array.length,</span><br><span class="line">    <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i, i &lt; length; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(array[i] % <span class="number">2</span> !== <span class="number">0</span>)&#123;</span><br><span class="line">            sum = sum + array[i]*<span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(magic(nums)); <span class="comment">// 50</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨çœ‹èµ·æ¥å¥½å¤šäº†ï¼Œä¸è¿‡ï¼Œmagicå†…éƒ¨çš„æ“ä½œçœ‹èµ·æ¥ä¸æ˜¯å¾ˆæ¸…æ™°ï¼Œ</p><p>å…¶ä»–å°‘ä¾ çœ‹è§äº†å¯èƒ½å¾ˆéš¾ä¸€çœ¼å°±æ˜ç™½magicå‡½æ•°åœ¨åšä»€ä¹ˆ,</p><p>æˆ‘ä»¬å¯ä»¥è¯•ç€æŠŠé‡Œé¢çš„ä¸€äº›æ­¥éª¤åˆ†æˆæ›´å°çš„å‡½æ•°:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isOdd = <span class="function"><span class="params">num</span> =&gt;</span> num % <span class="number">2</span> !== <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> double = <span class="function"><span class="params">num</span> =&gt;</span> num *<span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">sum,num</span>) =&gt;</span> sum += num;</span><br><span class="line"><span class="keyword">const</span> magic = <span class="function"><span class="params">array</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> length = array.length,</span><br><span class="line">    <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i, i &lt; length; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(isOdd(array[i]))&#123;</span><br><span class="line">            sum = add(sum,double(array[i]));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(magic(nums)); <span class="comment">// 50</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨æ¯”è¾ƒç®€æ´ä¹Ÿæ¯”è¾ƒæ¸…æ™°äº†ï¼Œä¸è¿‡ï¼Œå‡å¦‚æˆ‘ä»¬ç°åœ¨è¦è®¡ç®—æ˜¯å¶æ•°è€Œä¸æ˜¯å¥‡æ•°æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>æˆ–è€…å¦‚æœæ›´å¤æ‚äº›ï¼Œå¦‚æœæ˜¯å¶æ•°ï¼Œå°±åè¿‡æ¥ï¼Œé™¤ä»¥äºŒï¼Œç„¶åæ±‚å’Œï¼Œåˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>éš¾é“æˆ‘ä»¬åˆè¦å¤åˆ¶ä¸€æ¬¡magicå‡½æ•°ï¼Œç„¶åæ”¹åŠ¨forå¾ªç¯é‡Œé¢çš„é€»è¾‘å—ï¼Ÿ</p><p>ä¹Ÿè®¸ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠforå¾ªç¯å†…éƒ¨çš„é€»è¾‘å•ç‹¬æå–æˆä¸€ä¸ªå¤–éƒ¨å‡½æ•°ï¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isOdd = <span class="function"><span class="params">num</span> =&gt;</span> num % <span class="number">2</span> !== <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> isEvent = <span class="function"><span class="params">num</span> =&gt;</span> !isOdd(num)</span><br><span class="line"><span class="keyword">const</span> double = <span class="function"><span class="params">num</span> =&gt;</span> num *<span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> part = <span class="function"><span class="params">num</span> =&gt;</span> num /<span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">sum,num</span>) =&gt;</span> sum += num;</span><br><span class="line"><span class="keyword">const</span> magic = <span class="function">(<span class="params">array,fn,sum</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> length = array.length,</span><br><span class="line">    <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i, i &lt; length; i++)&#123;</span><br><span class="line">        sum = magicFriends(sum,array[i])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">magicFriends</span>(<span class="params">sum,num</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(isOdd(num))&#123;</span><br><span class="line">        sum = add(sum,double(num));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(magic(nums,magicFriends,<span class="number">0</span>)); <span class="comment">// 50</span></span><br></pre></td></tr></table></figure><h2 id="æ¥ä¸‹æ¥å°±æ˜¯è§è¯å¥‡è¿¹çš„æ—¶åˆ»ï¼"><a href="#æ¥ä¸‹æ¥å°±æ˜¯è§è¯å¥‡è¿¹çš„æ—¶åˆ»ï¼" class="headerlink" title="æ¥ä¸‹æ¥å°±æ˜¯è§è¯å¥‡è¿¹çš„æ—¶åˆ»ï¼"></a>æ¥ä¸‹æ¥å°±æ˜¯è§è¯å¥‡è¿¹çš„æ—¶åˆ»ï¼</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬ç»™ä»£ç é‡Œé¢éƒ¨åˆ†å‡½æ•°å’Œå‚æ•°æ”¹ä¸€ä¸‹åå­—:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isOdd = <span class="function"><span class="params">num</span> =&gt;</span> num % <span class="number">2</span> !== <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> isEvent = <span class="function"><span class="params">num</span> =&gt;</span> !isOdd(num)</span><br><span class="line"><span class="keyword">const</span> double = <span class="function"><span class="params">num</span> =&gt;</span> num *<span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> part = <span class="function"><span class="params">num</span> =&gt;</span> num /<span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">sum,num</span>) =&gt;</span> sum += num;</span><br><span class="line"><span class="keyword">const</span> reduce = <span class="function">(<span class="params">array,reducer,result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> length = array.length,</span><br><span class="line">    <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i, i &lt; length; i++)&#123;</span><br><span class="line">        result = reducer(sum,array[i])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">consot magicFriends = <span class="function">(<span class="params">sum,num</span>) =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(isOdd(num))&#123;</span><br><span class="line">        sum = add(sum,double(num));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(reduce(nums,magicFriends,<span class="number">0</span>)); <span class="comment">// 50</span></span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯æœ‰ç‚¹çœ¼ç†Ÿäº†ï¼Ÿ æ¥ç€ï¼Œæˆ‘ä»¬æ¢æˆæ•°ç»„è‡ªå¸¦çš„reduceå‡½æ•°:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isOdd = <span class="function"><span class="params">num</span> =&gt;</span> num % <span class="number">2</span> !== <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> isEvent = <span class="function"><span class="params">num</span> =&gt;</span> !isOdd(num)</span><br><span class="line"><span class="keyword">const</span> double = <span class="function"><span class="params">num</span> =&gt;</span> num *<span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> part = <span class="function"><span class="params">num</span> =&gt;</span> num /<span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">sum,num</span>) =&gt;</span> sum += num;</span><br><span class="line">consot magicFriends = <span class="function">(<span class="params">sum,num</span>) =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(isOdd(num))&#123;</span><br><span class="line">        sum = add(sum,double(num));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(nums.reduce(magicFriends,<span class="number">0</span>)); <span class="comment">// 50</span></span><br></pre></td></tr></table></figure><h2 id="æœ€åå›åˆ°æˆ‘ä»¬ä¸Šé¢çš„é—®é¢˜"><a href="#æœ€åå›åˆ°æˆ‘ä»¬ä¸Šé¢çš„é—®é¢˜" class="headerlink" title="æœ€åå›åˆ°æˆ‘ä»¬ä¸Šé¢çš„é—®é¢˜:"></a>æœ€åå›åˆ°æˆ‘ä»¬ä¸Šé¢çš„é—®é¢˜:</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>];</span><br><span class="line"><span class="keyword">const</span> isOdd = <span class="function"><span class="params">num</span> =&gt;</span> num % <span class="number">2</span> !== <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> double = <span class="function"><span class="params">num</span> =&gt;</span> num *<span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">sum,num</span>) =&gt;</span> sum += num;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result = nums.reduces(<span class="function">(<span class="params">sum,num</span>)=&gt;</span> isOdd(num) ? add(sum,dobule(num) : sum,<span class="number">0</span>));</span><br><span class="line"><span class="built_in">console</span>.log(result); <span class="comment">// 50</span></span><br></pre></td></tr></table></figure><p>è¿™æ¬¡æˆ‘ä»¬ç”¨reduceåªéå†äº†ä¸€æ¬¡æ•°ç»„å°±å®Œæˆäº†ä¹‹å‰çš„æ“ä½œï¼</p><p>ç°åœ¨çŸ¥é“ä¸ºä»€ä¹ˆä¹‹å‰è¦æŠŠreduceå«åšmagic(é­”æ³•)äº†å§ï¼</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;æ¯”å¦‚ä¸€ä¸ªä»1-10çš„ç®€å•çš„æ•°ç»„ï¼Œéœ€è¦ä»ä¸­å–å¥‡æ•°ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ&quot;&gt;&lt;a href=&quot;#æ¯”å¦‚ä¸€ä¸ªä»1-10çš„ç®€å•çš„æ•°ç»„ï¼Œéœ€è¦ä»ä¸­å–å¥‡æ•°ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;æ¯”å¦‚ä¸€ä¸ªä»1-10çš„ç®€å•çš„æ•°ç»„ï¼Œéœ€è¦ä»ä¸­å–å¥‡æ•°ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ&quot;&gt;&lt;/a&gt;æ¯”å¦‚ä¸€ä¸ªä»1-10çš„ç®€å•çš„æ•°ç»„ï¼Œéœ€è¦ä»ä¸­å–å¥‡æ•°ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ&lt;/h2&gt;&lt;p&gt;è¿™ä¸ªé—®é¢˜ä¸éš¾ï¼Œæœ‰çš„å°‘ä¾ å¯èƒ½ä¼šä½¿ç”¨forå¾ªç¯æ¥è¿‡æ»¤å‡ºå¶æ•°ï¼ŒæŸäº›å°‘ä¾ å¯èƒ½ä¼šä½¿ç”¨whileå¾ªç¯ï¼Œåˆæˆ–æ˜¯ä½¿ç”¨æ•°ç»„è‡ªå¸¦çš„filteræ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆä¸è€ƒè™‘ä½¿ç”¨forå’Œwhileè¿™äº›è¿­ä»£æ–¹æ³•ï¼Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨æ•°ç»„è‡ªå¸¦çš„filteræ–¹æ³•ï¼Œå¦‚æœä½¿ç”¨filteræ–¹æ³•çš„è¯ï¼Œ&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; nums = [&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// è¿‡æ»¤å‡ºæ‰€æœ‰å¥‡æ•°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nums.filter(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;num&lt;/span&gt; =&amp;gt;&lt;/span&gt; num % &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; !== &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(nums);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿˜æ˜¯æŒºç®€å•çš„å¯¹å§ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç›¸ä¿¡å¤§éƒ¨åˆ†å°‘ä¾ éƒ½èƒ½å¾ˆè½»æ¾å®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;åœ¨filterå‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ &lt;code&gt;num % 2 !== 0&lt;/code&gt; æ¥åˆ¤æ–­ æ˜¯å¦æ˜¯ä¸€ä¸ªå¥‡æ•°ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªå¥‡æ•°ï¼Œå°±è¿‡æ»¤å‡ºæ¥ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™é‡Œï¼Œæœ‰çš„å°‘ä¾ å¯èƒ½å°±ä¼šæƒ³åˆ°ï¼Œå¦‚æœæŠŠè¿™ä¸ªåˆ¤æ–­è¿‡ç¨‹å•ç‹¬åˆ†æˆä¸€ä¸ªå‡½æ•°ï¼Œä¼šæ–¹ä¾¿ä¸€äº›ï¼Œä¹Ÿæ–¹ä¾¿ä»¥åçš„ä¿®æ”¹æ‰©å±•ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚å•ç‹¬å†™ä¸€ä¸ªisOddå‡½æ•°&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; isOdd = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;num&lt;/span&gt; =&amp;gt;&lt;/span&gt; num % &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; !== &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç„¶ååœ¨filteré‡Œé¢ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼Œæ˜¯å§ï¼Ÿ&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; nums = [&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; isOdd = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;num&lt;/span&gt; =&amp;gt;&lt;/span&gt; num % &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; !== &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// è¿‡æ»¤å‡ºæ‰€æœ‰å¥‡æ•°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; odd = nums.filter(isOdd);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(odd);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;å¦‚æœè¦æŠŠnumsé‡Œé¢çš„æ•°å­—ç¿»å€ï¼Œç”¨mapå‡½æ•°ï¼Œåˆè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ&quot;&gt;&lt;a href=&quot;#å¦‚æœè¦æŠŠnumsé‡Œé¢çš„æ•°å­—ç¿»å€ï¼Œç”¨mapå‡½æ•°ï¼Œåˆè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;å¦‚æœè¦æŠŠnumsé‡Œé¢çš„æ•°å­—ç¿»å€ï¼Œç”¨mapå‡½æ•°ï¼Œåˆè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ&quot;&gt;&lt;/a&gt;å¦‚æœè¦æŠŠnumsé‡Œé¢çš„æ•°å­—ç¿»å€ï¼Œç”¨mapå‡½æ•°ï¼Œåˆè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ&lt;/h2&gt;&lt;p&gt;èªæ˜çš„å°‘ä¾ è¿™æ¬¡è‚¯å®šä¸€ä¸‹å°±æ˜ç™½äº†ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; nums = [&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; double = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;num&lt;/span&gt; =&amp;gt;&lt;/span&gt; num *&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; doubleNumbers = nums.map(double);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(doubleNumbers);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;ä»numsé‡Œé¢è¿‡æ»¤å‡ºæ‰€æœ‰å¥‡æ•°ï¼Œå¹¶ç¿»å€è¿™äº›å¥‡æ•°ã€‚&quot;&gt;&lt;a href=&quot;#ä»numsé‡Œé¢è¿‡æ»¤å‡ºæ‰€æœ‰å¥‡æ•°ï¼Œå¹¶ç¿»å€è¿™äº›å¥‡æ•°ã€‚&quot; class=&quot;headerlink&quot; title=&quot;ä»numsé‡Œé¢è¿‡æ»¤å‡ºæ‰€æœ‰å¥‡æ•°ï¼Œå¹¶ç¿»å€è¿™äº›å¥‡æ•°ã€‚&quot;&gt;&lt;/a&gt;ä»numsé‡Œé¢è¿‡æ»¤å‡ºæ‰€æœ‰å¥‡æ•°ï¼Œå¹¶ç¿»å€è¿™äº›å¥‡æ•°ã€‚&lt;/h2&gt;&lt;p&gt;è¿™ä¸ªé—®é¢˜ä¹Ÿä¸éš¾æ˜¯å§ï¼Ÿ&lt;/p&gt;
&lt;p&gt;è®©æˆ‘çŒœä¸€ä¸‹ï¼Œä¸€äº›å°‘ä¾ åº”è¯¥ä¼šå†™æˆä¸‹é¢è¿™æ ·ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; nums = [&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; isOdd = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;num&lt;/span&gt; =&amp;gt;&lt;/span&gt; num % &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; !== &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; double = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;num&lt;/span&gt; =&amp;gt;&lt;/span&gt; num *&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; doubleNums = nums.filter(isOdd).map(double);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(doubleNums);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;å¦‚æœæˆ‘ä»¬è¿˜æƒ³ç»§ç»­ç®—å‡ºæ‰€æœ‰å¥‡æ•°ç¿»å€åçš„å’Œçš„è¯&quot;&gt;&lt;a href=&quot;#å¦‚æœæˆ‘ä»¬è¿˜æƒ³ç»§ç»­ç®—å‡ºæ‰€æœ‰å¥‡æ•°ç¿»å€åçš„å’Œçš„è¯&quot; class=&quot;headerlink&quot; title=&quot;å¦‚æœæˆ‘ä»¬è¿˜æƒ³ç»§ç»­ç®—å‡ºæ‰€æœ‰å¥‡æ•°ç¿»å€åçš„å’Œçš„è¯&quot;&gt;&lt;/a&gt;å¦‚æœæˆ‘ä»¬è¿˜æƒ³ç»§ç»­ç®—å‡ºæ‰€æœ‰å¥‡æ•°ç¿»å€åçš„å’Œçš„è¯&lt;/h2&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; nums = [&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; isOdd = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;num&lt;/span&gt; =&amp;gt;&lt;/span&gt; num % &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; !== &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; double = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;num&lt;/span&gt; =&amp;gt;&lt;/span&gt; num *&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; add = &lt;span class=&quot;function&quot;&gt;(&lt;span class=&quot;params&quot;&gt;sum,num&lt;/span&gt;) =&amp;gt;&lt;/span&gt; sum += num;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; doubleNums = nums.filter(isOdd).map(double).reduce(add,&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(doubleNums);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å—¯ï¼Œä¸€ä¸ªä¸²ä¸€ä¸ªçœ‹èµ·æ¥å¾ˆé…·æ˜¯å§ï¼Ÿ æœ€åçš„ç»“æœä¹Ÿæ˜¯æ­£ç¡®çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ ·ä¸²èµ·æ¥çš„åæœå°±æ˜¯ï¼Œæˆ‘ä»¬ä¼šéå†3æ¬¡æ•°ç»„ï¼Œfilterçš„æ—¶å€™éå†ä¸€æ¬¡ï¼Œmapçš„æ—¶å€™éå†ä¸€æ¬¡ï¼Œreduceçš„æ—¶å€™å†éå†ä¸€æ¬¡ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨æ•°ç»„åªæœ‰10ä¸ªæ•°å­—ï¼Œå½±å“è¿˜ä¸å¤§ï¼Œä½†æ˜¯å¦‚æœæ˜¯å¾ˆå¤§çš„æ•°ç»„ï¼Œæ¯”å¦‚100ä¸‡ä¸ªæ•°å­—ï¼Œéå†3éçš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šå¤šè®¿é—®&lt;strong&gt;150ä¸‡æ¬¡&lt;/strong&gt;ï¼Œ&lt;/p&gt;
&lt;p&gt;æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœè®©ä½ è‡ªå·±ä»ä¸­é—´å–å‡ºæ‰€æœ‰å¥‡æ•°ï¼Œç¿»å€ï¼Œå¹¶æ±‚å’Œï¼Œä½ ä¼šè§‰å¾—æ€ä¹ˆåšç®€å•ä¸€äº›å‘¢ï¼Ÿ&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ˜¯ä¸æ˜¯è§‰å¾—ä¸‹é¢è¿™æ ·æ‰æ¯”è¾ƒæ­£å¸¸ï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆï¼Œä»ç¬¬ä¸€ä¸ªæ•°å­—å¼€å§‹ï¼Œå¦‚æœå®ƒæ˜¯å¥‡æ•°ï¼Œå°±æ‹¿å‡ºæ¥ï¼Œç¿»å€ï¼Œç„¶åæ‰¾ä¸ªåœ°æ–¹æ”¾èµ·æ¥&lt;/li&gt;
&lt;li&gt;æ¥ç€ï¼Œç»§ç»­çœ‹ç¬¬äºŒä¸ªæ•°å­—ï¼Œå¦‚æœæ˜¯å¶æ•°ï¼Œå°±è·³è¿‡ï¼Œå¦‚æœæ˜¯å¥‡æ•°ï¼Œå°±æ‹¿å‡ºæ¥ï¼Œç¿»å€ï¼Œç„¶åå’Œå¼€å§‹çš„ç¿»å€åçš„å¥‡æ•°åŠ èµ·æ¥ï¼Œæ‰¾ä¸ªåœ°æ–¹æ”¾èµ·æ¥ã€‚&lt;/li&gt;
&lt;li&gt;æ¥ç€çœ‹ç¬¬ä¸‰ä¸ªæ•°å­—ï¼Œä»¥æ­¤ç±»æ¨ï¼Œåªè¦æ˜¯å¥‡æ•°ï¼Œå°±ç¿»å€ï¼Œç„¶åå’Œä¹‹å‰çš„ç»“æœåŠ èµ·æ¥ã€‚&lt;/li&gt;
&lt;li&gt;ç›´åˆ°æˆ‘ä»¬æ‰¾å¯»åˆ°æœ€åä¸€ä¸ªæ•°å­—ï¼Œå°±å¯ä»¥ç®—å‡ºæœ€ç»ˆç»“æœäº†ï¼Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœä½¿ç”¨è¿­ä»£çš„è¯ï¼Œå°±æ˜¯ä¸‹é¢è¿™æ ·:&lt;br&gt;
    
    </summary>
    
      <category term="Js" scheme="https://zhanghao-web.github.io/categories/Js/"/>
    
    
      <category term="Js" scheme="https://zhanghao-web.github.io/tags/Js/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•ä½¿ç”¨ vue + typescript ç¼–å†™é¡µé¢(1)</title>
    <link href="https://zhanghao-web.github.io/2019/07/15/Ts/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-vue-typescript-%E7%BC%96%E5%86%99%E9%A1%B5%E9%9D%A2-1/"/>
    <id>https://zhanghao-web.github.io/2019/07/15/Ts/å¦‚ä½•ä½¿ç”¨-vue-typescript-ç¼–å†™é¡µé¢-1/</id>
    <published>2019-07-15T09:10:33.000Z</published>
    <updated>2020-01-28T10:04:15.067Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://juejin.im/post/5c662a7de51d4562e71c4277#comment" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a></p><h1 id="èµ·æ­¥"><a href="#èµ·æ­¥" class="headerlink" title="èµ·æ­¥"></a>èµ·æ­¥</h1><p>ä½¿ç”¨ vue-cli åˆ›å»ºé¡¹ç›®</p><p><code>vue create demo</code> ï¼Œdemoå°±æ˜¯åˆ›å»ºé¡¹ç›®çš„åç§°<br>æç¤ºé€‰æ‹©é¢„è®¾ï¼Œé€‰æ‹© <code>Manually select features</code> å›è½¦ç¡®è®¤<br>é€‰æ‹©<code>typescript</code> <code>vuex</code>  <code>router</code> <code>babel</code> <code>css pre-processors</code>ï¼Œä¸ä½¿ç”¨<code>linter</code>ï¼Œä¸é€‰å•å…ƒæµ‹è¯•æœ‰éœ€è¦å¦è¯´<br>å›è½¦åæŒ‰ç…§éœ€è¦é€‰æ‹©åˆé€‚çš„é€‰é¡¹<br>é€‰æ‹©å®Œæ¯•åå›è½¦ç­‰å¾…èµ„æºå‡†å¤‡</p><h2 id="ç¼–ç å¼€å§‹"><a href="#ç¼–ç å¼€å§‹" class="headerlink" title="ç¼–ç å¼€å§‹"></a>ç¼–ç å¼€å§‹</h2><p>ç†Ÿæ‚‰å‡ ä¸ªvueçš„è£…é¥°å™¨ <code>vue-property-decorator</code></p><p>ä»¥ä¸‹çš„è£…é¥°å™¨çš„åŠŸèƒ½å’ŒåŸjsç¼–å†™çš„åŠŸèƒ½ç›¸åŒ/ç›¸ä¼¼ï¼Œå¯ä»¥å‚ç…§å®˜æ–¹æ–‡æ¡£ç±»æ¯”è§£è¯»ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Vue, Component, Inject, Provide, Prop, Model, Watch, Emit, Mixins &#125; <span class="keyword">from</span> <span class="string">'vue-property-decorator'</span></span><br></pre></td></tr></table></figure><h3 id="1-Vue-å®é™…ä¸Šå°±æ˜¯-Vue-æœ¬èº«-ç»§æ‰¿vueç›¸å…³å±æ€§å’Œå‡½æ•°"><a href="#1-Vue-å®é™…ä¸Šå°±æ˜¯-Vue-æœ¬èº«-ç»§æ‰¿vueç›¸å…³å±æ€§å’Œå‡½æ•°" class="headerlink" title="1. Vue å®é™…ä¸Šå°±æ˜¯ Vue æœ¬èº«,ç»§æ‰¿vueç›¸å…³å±æ€§å’Œå‡½æ•°"></a>1. Vue å®é™…ä¸Šå°±æ˜¯ Vue æœ¬èº«,ç»§æ‰¿vueç›¸å…³å±æ€§å’Œå‡½æ•°</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure><h3 id="2-Component-å£°æ˜æˆä¸€ä¸ªvueçš„ç»„ä»¶å®ä¾‹ï¼Œå¦‚æœä¸ä½¿ç”¨ï¼Œåˆ™ä¸èƒ½å¾—åˆ°ä¸€ä¸ªvueç»„ä»¶"><a href="#2-Component-å£°æ˜æˆä¸€ä¸ªvueçš„ç»„ä»¶å®ä¾‹ï¼Œå¦‚æœä¸ä½¿ç”¨ï¼Œåˆ™ä¸èƒ½å¾—åˆ°ä¸€ä¸ªvueç»„ä»¶" class="headerlink" title="2. @Component å£°æ˜æˆä¸€ä¸ªvueçš„ç»„ä»¶å®ä¾‹ï¼Œå¦‚æœä¸ä½¿ç”¨ï¼Œåˆ™ä¸èƒ½å¾—åˆ°ä¸€ä¸ªvueç»„ä»¶"></a>2. @Component å£°æ˜æˆä¸€ä¸ªvueçš„ç»„ä»¶å®ä¾‹ï¼Œå¦‚æœä¸ä½¿ç”¨ï¼Œåˆ™ä¸èƒ½å¾—åˆ°ä¸€ä¸ªvueç»„ä»¶</h3><p>ç¬¬ä¸€ç§æ–¹å¼ï¼Œä¸éœ€è¦å®šä¹‰é¢å¤–å†…å®¹:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§æ–¹å¼ï¼Œå®šä¹‰ç›¸å…³å†…å®¹:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@Component(&#123;</span><br><span class="line">    <span class="comment">/* è¿™é‡Œå’Œjsç‰ˆæœ¬ç¼–å†™çš„ vue ç»„ä»¶å†…å®¹ç›¸åŒï¼Œ</span></span><br><span class="line"><span class="comment">     * å‡¡æ˜¯ä¸èƒ½åœ¨tsé‡Œé¢å®Œæˆçš„éƒ½å¯ä»¥åœ¨è¿™é‡Œå®Œæˆ </span></span><br><span class="line"><span class="comment">     * æœ€ç»ˆä¼šè¢«åˆå¹¶åˆ°ä¸€ä¸ªå®ä¾‹ä¸­ã€‚</span></span><br><span class="line"><span class="comment">     * åœ¨è¿™é‡Œå®šä¹‰çš„å†…å®¹ï¼Œä¸ä¼šè¢«è¯­æ³•å™¨è·å–åˆ°ï¼Œå› æ­¤å¿…é¡»è¦åŒæ­¥åœ¨classä¸­å£°æ˜</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    data()&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">myname</span>:<span class="string">""</span>,<span class="attr">age</span>:<span class="number">18</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123;</span><br><span class="line">    private myname:string;</span><br><span class="line">    mounted()&#123;</span><br><span class="line">        <span class="keyword">this</span>.myname;    </span><br><span class="line">        <span class="keyword">this</span>.age;<span class="comment">// è¯­æ³•å™¨æŠ¥é”™ï¼Œå½“å‰ç±»æ‰¾ä¸åˆ°ageå±æ€§</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-Provide-å‘ä»»æ„å±‚çº§çš„å­ç»„ä»¶æä¾›å¯è®¿é—®çš„å±æ€§ï¼Œé»˜è®¤ä¸ºå½“å‰å±æ€§çš„åç§°ï¼Œå¯ä»¥æŒ‡å®šåç§°"><a href="#3-Provide-å‘ä»»æ„å±‚çº§çš„å­ç»„ä»¶æä¾›å¯è®¿é—®çš„å±æ€§ï¼Œé»˜è®¤ä¸ºå½“å‰å±æ€§çš„åç§°ï¼Œå¯ä»¥æŒ‡å®šåç§°" class="headerlink" title="3.@Provide å‘ä»»æ„å±‚çº§çš„å­ç»„ä»¶æä¾›å¯è®¿é—®çš„å±æ€§ï¼Œé»˜è®¤ä¸ºå½“å‰å±æ€§çš„åç§°ï¼Œå¯ä»¥æŒ‡å®šåç§°"></a>3.@Provide å‘ä»»æ„å±‚çº§çš„å­ç»„ä»¶æä¾›å¯è®¿é—®çš„å±æ€§ï¼Œé»˜è®¤ä¸ºå½“å‰å±æ€§çš„åç§°ï¼Œå¯ä»¥æŒ‡å®šåç§°</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParentComponent</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123; </span><br><span class="line">    @Provide() private info!:string;</span><br><span class="line">    @Provide(<span class="string">"next"</span>) private infoNext!:string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-Inject-è·å–çˆ¶çº§ç”±Provideæä¾›çš„å±æ€§ï¼Œé»˜è®¤ä¸ºå½“å‰å±æ€§çš„åç§°ï¼Œå¯ä»¥æŒ‡å®šåç§°ï¼Œå¤šä¸ªçˆ¶çº§æä¾›ç›¸åŒåç§°å±æ€§æ—¶ï¼Œè·å–æœ€è¿‘çˆ¶çº§çš„åç§°å±æ€§"><a href="#4-Inject-è·å–çˆ¶çº§ç”±Provideæä¾›çš„å±æ€§ï¼Œé»˜è®¤ä¸ºå½“å‰å±æ€§çš„åç§°ï¼Œå¯ä»¥æŒ‡å®šåç§°ï¼Œå¤šä¸ªçˆ¶çº§æä¾›ç›¸åŒåç§°å±æ€§æ—¶ï¼Œè·å–æœ€è¿‘çˆ¶çº§çš„åç§°å±æ€§" class="headerlink" title="4. @Inject è·å–çˆ¶çº§ç”±Provideæä¾›çš„å±æ€§ï¼Œé»˜è®¤ä¸ºå½“å‰å±æ€§çš„åç§°ï¼Œå¯ä»¥æŒ‡å®šåç§°ï¼Œå¤šä¸ªçˆ¶çº§æä¾›ç›¸åŒåç§°å±æ€§æ—¶ï¼Œè·å–æœ€è¿‘çˆ¶çº§çš„åç§°å±æ€§"></a>4. @Inject è·å–çˆ¶çº§ç”±Provideæä¾›çš„å±æ€§ï¼Œé»˜è®¤ä¸ºå½“å‰å±æ€§çš„åç§°ï¼Œå¯ä»¥æŒ‡å®šåç§°ï¼Œå¤šä¸ªçˆ¶çº§æä¾›ç›¸åŒåç§°å±æ€§æ—¶ï¼Œè·å–æœ€è¿‘çˆ¶çº§çš„åç§°å±æ€§</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123; </span><br><span class="line">    @Inject() private info!:string;</span><br><span class="line">    @Inject(<span class="string">"next"</span>) private infoNext!:string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-Prop-ç”±æ ‡ç­¾å±æ€§æ³¨å…¥ï¼Œè·å–å¯¹åº”æ ‡ç­¾å±æ€§ä¸Šå€¼-å¯é…ç½®å…·ä½“propå†…å®¹ï¼Œå‚ç…§jsç‰ˆæœ¬propså†…å®¹"><a href="#5-Prop-ç”±æ ‡ç­¾å±æ€§æ³¨å…¥ï¼Œè·å–å¯¹åº”æ ‡ç­¾å±æ€§ä¸Šå€¼-å¯é…ç½®å…·ä½“propå†…å®¹ï¼Œå‚ç…§jsç‰ˆæœ¬propså†…å®¹" class="headerlink" title="5. @Prop ç”±æ ‡ç­¾å±æ€§æ³¨å…¥ï¼Œè·å–å¯¹åº”æ ‡ç­¾å±æ€§ä¸Šå€¼,å¯é…ç½®å…·ä½“propå†…å®¹ï¼Œå‚ç…§jsç‰ˆæœ¬propså†…å®¹"></a>5. @Prop ç”±æ ‡ç­¾å±æ€§æ³¨å…¥ï¼Œè·å–å¯¹åº”æ ‡ç­¾å±æ€§ä¸Šå€¼,å¯é…ç½®å…·ä½“propå†…å®¹ï¼Œå‚ç…§jsç‰ˆæœ¬propså†…å®¹</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123; </span><br><span class="line">   @Prop() age!:number;</span><br><span class="line">   @Prop(&#123;<span class="attr">default</span>:<span class="number">1</span>&#125;) sex!:number;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">:age</span>=<span class="string">"16"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">"ts"</span>&gt;</span>  </span><br><span class="line"><span class="javascript"><span class="keyword">import</span> MyComponent <span class="keyword">from</span> <span class="string">'./MyComponent.vue'</span>;</span></span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">    components:&#123; MyComponent &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="actionscript"><span class="class"><span class="keyword">class</span> <span class="title">PComponent</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123; &#125;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="6-Model-æ˜¯v-modelçš„è£…é¥°å™¨ï¼Œå½“è‡ªå®šä¹‰ç»„ä»¶æƒ³ä½¿ç”¨v-modelæ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œé…åˆemitå¯ä»¥åŒå‘ä¼ é€’å±æ€§å€¼"><a href="#6-Model-æ˜¯v-modelçš„è£…é¥°å™¨ï¼Œå½“è‡ªå®šä¹‰ç»„ä»¶æƒ³ä½¿ç”¨v-modelæ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œé…åˆemitå¯ä»¥åŒå‘ä¼ é€’å±æ€§å€¼" class="headerlink" title="6. @Model æ˜¯v-modelçš„è£…é¥°å™¨ï¼Œå½“è‡ªå®šä¹‰ç»„ä»¶æƒ³ä½¿ç”¨v-modelæ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œé…åˆemitå¯ä»¥åŒå‘ä¼ é€’å±æ€§å€¼"></a>6. @Model æ˜¯v-modelçš„è£…é¥°å™¨ï¼Œå½“è‡ªå®šä¹‰ç»„ä»¶æƒ³ä½¿ç”¨v-modelæ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œé…åˆemitå¯ä»¥åŒå‘ä¼ é€’å±æ€§å€¼</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">:checked</span>=<span class="string">"checked"</span> @<span class="attr">change</span>=<span class="string">"changed"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">"ts"</span>&gt;</span></span><br><span class="line">@Component</span><br><span class="line"><span class="actionscript"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123; </span></span><br><span class="line"><span class="actionscript">   @Model(<span class="string">"change"</span>) checked!:number;</span></span><br><span class="line"><span class="actionscript">   changed(event:any)&#123; <span class="comment">/* è¿™é‡Œæ˜¯å·æ‡’å†™çš„anyï¼Œåœ¨å®é™…é¡¹ç›®ä¸­éœ€è¦é¿å… */</span></span></span><br><span class="line"><span class="actionscript">       <span class="keyword">this</span>.$emit(<span class="string">"change"</span>,event.target.value)</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">:age</span>=<span class="string">"16"</span> <span class="attr">v-model</span>=<span class="string">"mycheck"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">"ts"</span>&gt;</span> </span><br><span class="line"><span class="javascript"><span class="keyword">import</span> MyComponent <span class="keyword">from</span> <span class="string">'./MyComponent.vue'</span>;</span></span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">    components:&#123; MyComponent &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="actionscript"><span class="class"><span class="keyword">class</span> <span class="title">PComponent</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">private</span> mycheck:boolean = <span class="literal">false</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="7-Watch-è§‚å¯ŸæŸä¸ªå±æ€§æ›´æ–°"><a href="#7-Watch-è§‚å¯ŸæŸä¸ªå±æ€§æ›´æ–°" class="headerlink" title="7. @Watch è§‚å¯ŸæŸä¸ªå±æ€§æ›´æ–°"></a>7. @Watch è§‚å¯ŸæŸä¸ªå±æ€§æ›´æ–°</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123; </span><br><span class="line">   @Prop() age!:number;</span><br><span class="line">   @Watch(<span class="string">"age"</span>)</span><br><span class="line">   ageChange(newVal:number,<span class="attr">oldVal</span>:number)&#123;</span><br><span class="line">       <span class="comment">/*ageå±æ€§æ›´æ–°æ—¶ï¼Œå¤„ç†ç›¸å…³å†…å®¹*/</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-Emit-this-emit-çš„è£…é¥°å™¨-å¦‚æœæ²¡æœ‰æŒ‡å®šåç§°ï¼Œé»˜è®¤ä½¿ç”¨å‡½æ•°åç§°ã€‚æœ‰è¿”å›å€¼æ—¶ï¼Œä½¿ç”¨è¿”å›å€¼ï¼Œæ²¡æœ‰åˆ™ä½¿ç”¨"><a href="#8-Emit-this-emit-çš„è£…é¥°å™¨-å¦‚æœæ²¡æœ‰æŒ‡å®šåç§°ï¼Œé»˜è®¤ä½¿ç”¨å‡½æ•°åç§°ã€‚æœ‰è¿”å›å€¼æ—¶ï¼Œä½¿ç”¨è¿”å›å€¼ï¼Œæ²¡æœ‰åˆ™ä½¿ç”¨" class="headerlink" title="8. @Emit this.$emit çš„è£…é¥°å™¨,å¦‚æœæ²¡æœ‰æŒ‡å®šåç§°ï¼Œé»˜è®¤ä½¿ç”¨å‡½æ•°åç§°ã€‚æœ‰è¿”å›å€¼æ—¶ï¼Œä½¿ç”¨è¿”å›å€¼ï¼Œæ²¡æœ‰åˆ™ä½¿ç”¨"></a>8. @Emit this.$emit çš„è£…é¥°å™¨,å¦‚æœæ²¡æœ‰æŒ‡å®šåç§°ï¼Œé»˜è®¤ä½¿ç”¨å‡½æ•°åç§°ã€‚æœ‰è¿”å›å€¼æ—¶ï¼Œä½¿ç”¨è¿”å›å€¼ï¼Œæ²¡æœ‰åˆ™ä½¿ç”¨</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123; </span><br><span class="line">   private myname = <span class="string">""</span>;</span><br><span class="line">   </span><br><span class="line">   @Emit()</span><br><span class="line">   ageChangeA()&#123; <span class="comment">/* ä»…å‘é€ this.$emit('ageChangeA') */</span>   &#125;</span><br><span class="line">   </span><br><span class="line">   @Emit()</span><br><span class="line">   ageChangeB(age:number)&#123; <span class="comment">/* å‘é€ age  this.$emit('ageChangeB',age) */</span>   &#125;</span><br><span class="line">   </span><br><span class="line">   @Emit()</span><br><span class="line">   ageChangeC(age:number)&#123;  <span class="keyword">return</span> <span class="number">1</span> <span class="comment">/* this.$emit('ageChangeC',1) å‘é€return ç»“æœ*/</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-Mixins"><a href="#9-Mixins" class="headerlink" title="9. Mixins"></a>9. Mixins</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyMixin.ts</span></span><br><span class="line">@Component</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMixin</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123; </span><br><span class="line">   <span class="comment">/* å¦‚æœä½¿ç”¨private ä¿®é¥°ï¼Œåˆ™ä¸¤ä¸ªç›¸åŒçš„ ç§æœ‰å±æ€§æ··å…¥æ—¶ï¼Œä¼šäº§ç”Ÿå†²çª */</span></span><br><span class="line">   protected myname = <span class="string">"å¼ ä¸‰"</span>;</span><br><span class="line">   created()&#123;  <span class="comment">/* æ··å…¥å¯¹è±¡æœ‰è‡ªå·±çš„ ç”Ÿå‘½å‘¨æœŸå‡½æ•°*/</span> &#125;</span><br><span class="line">   getMyName()&#123; <span class="built_in">console</span>.log(<span class="string">"å¼ ä¸‰æ··å…¥"</span>) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// OtherMixin.ts</span></span><br><span class="line">@Component</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">OtherMixin</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123; </span><br><span class="line">   <span class="comment">/* å¦‚æœä½¿ç”¨private ä¿®é¥°ï¼Œåˆ™ä¸¤ä¸ªç›¸åŒçš„ ç§æœ‰å±æ€§æ··å…¥æ—¶ï¼Œä¼šäº§ç”Ÿå†²çª */</span></span><br><span class="line">   protected myname = <span class="string">"æå››"</span>;</span><br><span class="line">   created()&#123;  <span class="comment">/* æ··å…¥å¯¹è±¡æœ‰è‡ªå·±çš„ ç”Ÿå‘½å‘¨æœŸå‡½æ•°*/</span> &#125;</span><br><span class="line">   getMyName()&#123; <span class="built_in">console</span>.log(<span class="string">"æå››æ··å…¥"</span>) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Mixins</span>(<span class="title">MyMixin</span>,<span class="title">OtherMixin</span>) </span>&#123; </span><br><span class="line">   private myname = <span class="string">""</span>; <span class="comment">/* æ··å…¥å¯¹è±¡å·²ç»å®šä¹‰ï¼Œè¿™é‡Œäº§ç”Ÿå±æ€§å†²çª */</span></span><br><span class="line">   mounted()&#123;</span><br><span class="line">       <span class="keyword">this</span>.getMyName() <span class="comment">// æå››æ··å…¥</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯¹äºcomputedï¼Œä½¿ç”¨-get-æ›¿ä»£"><a href="#å¯¹äºcomputedï¼Œä½¿ç”¨-get-æ›¿ä»£" class="headerlink" title="å¯¹äºcomputedï¼Œä½¿ç”¨ get æ›¿ä»£"></a>å¯¹äºcomputedï¼Œä½¿ç”¨ get æ›¿ä»£</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123; </span><br><span class="line">   private myname = <span class="string">""</span>; <span class="comment">/* æ··å…¥å¯¹è±¡å·²ç»å®šä¹‰ï¼Œè¿™é‡Œäº§ç”Ÿå±æ€§å†²çª */</span></span><br><span class="line">   <span class="keyword">get</span> upperName()&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="string">"A"</span> + <span class="keyword">this</span>.myname</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è£…é¥°å™¨å¯ä»¥å‚ç…§ <a href="https://link.juejin.im/?target=http%3A%2F%2Fnpm.taobao.org%2Fpackage%2Fvue-property-decorator">vue-property-decorator</a></strong></p><ul><li>æ²¡æœ‰filters,æ²¡æœ‰æŒ‡ä»¤ç›¸å…³è£…é¥°å™¨ï¼Œæœ‰éœ€è¦å¯ä»¥åœ¨@Componenté‡Œé¢è¡¥å……ï¼Œæˆ–è€…å¯ä»¥ç›´æ¥å®šä¹‰å‡½æ•°è°ƒç”¨è®¡ç®—è¿”å›å€¼ åœ¨classé‡Œå®šä¹‰çš„å±æ€§å³dataå±æ€§ï¼Œéœ€è¦èµ‹å€¼åˆå§‹å€¼ã€‚</li></ul><h2 id="typescript-æ··ç”¨js"><a href="#typescript-æ··ç”¨js" class="headerlink" title="typescript æ··ç”¨js"></a>typescript æ··ç”¨js</h2><p>å½“æˆ‘ä»¬å¼•ç”¨äº†ä¸€ä¸ªjsç¼–å†™çš„æ¨¡å—æ—¶ä¼šæŠ¥é”™ï¼Œè¿™æ—¶å€™ï¼Œå¦‚æœä¸åœ¨å¼•å…¥çš„indexæ–‡ä»¶é‡Œé¢æ·»åŠ .d.tsæè¿°æ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¨¡å—å°±æ²¡æ³•åœ¨è¯­ä¹‰ä¸Šä¸€è‡´é€šè¿‡.</p><h3 id="é€šç”¨å…¼å®¹æ€§è§£å†³æ–¹æ¡ˆ"><a href="#é€šç”¨å…¼å®¹æ€§è§£å†³æ–¹æ¡ˆ" class="headerlink" title="é€šç”¨å…¼å®¹æ€§è§£å†³æ–¹æ¡ˆ"></a>é€šç”¨å…¼å®¹æ€§è§£å†³æ–¹æ¡ˆ</h3><p>å¦‚æœè¿™ä¸ªæ¨¡å—æ˜¯ç”±npmä¸‹è½½çš„ï¼Œå¹¶ä¸”æœ‰@typesç‰ˆæœ¬ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨<code>npm install @types/xx</code>ä¸‹è½½</p><p>å¯æƒœ,å¤§éƒ¨åˆ†éƒ½æ˜¯æ²¡æœ‰ç¼–å†™å£°æ˜æ–‡ä»¶çš„.ä½†æ˜¯åˆéœ€è¦ä½¿ç”¨åˆ°è¿™ä¸ªæ¨¡å—æ—¶,åº”è¯¥æ€ä¹ˆåš.</p><p><strong>è‡ªå®šä¹‰æè¿°æ–‡ä»¶</strong></p><p>åœ¨é¡¹ç›®çš„ã€æ ¹ç›®å½•ã€‘ä¸‹å®šä¹‰ã€æ¨¡å—ç›¸åŒçš„åç§°ã€‘çš„æè¿°æ–‡ä»¶A.d.ts,åœ¨æè¿°æ–‡ä»¶å†…ç¼–å†™æ¨¡å—å£°æ˜æè¿°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A.d.ts</span></span><br><span class="line">declare <span class="built_in">module</span> <span class="string">'*'</span>;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å±äºä¸€åŠ³æ°¸é€¸çš„æè¿°,ä½†æ˜¯æ— æ³•æè¿°åˆ°å…·ä½“æ¨¡å—å†…å®¹,å› æ­¤è¿™ç§æ–¹å¼ä»…ä»…å¼•å…¥çš„ç»„ä»¶æ²¡æœ‰ä»»ä½•æ“ä½œæ—¶,æ¯”å¦‚å¼•å…¥çš„æ˜¯ç¬¬ä¸‰æ–¹å¼€å‘çš„vueç»„ä»¶,å¯ä»¥ç”¨è¿™ç§æ–¹å¼å·æ‡’.</p><p><strong>è¯¦ç»†æè¿°æ–‡ä»¶</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A.d.ts</span></span><br><span class="line">declare <span class="built_in">module</span>  <span class="string">"A"</span> &#123;</span><br><span class="line">    <span class="comment">// æ·»åŠ å…·ä½“çš„æè¿°å†…å®¹</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä»è¿™é‡ŒæŸ¥è¯¢åˆ°<a href="http://microsoft.github.io/TypeSearch/" target="_blank" rel="noopener">@type</a>åŒ…æŸ¥è¯¢ï¼Œå·²ç»è¢«ç¼–å†™çš„æ–‡ä»¶å£°æ˜å¯ä»¥ç›´æ¥ä¸‹è½½</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://juejin.im/post/5c662a7de51d4562e71c4277#comment&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;èµ·æ­¥&quot;&gt;&lt;a href=&quot;#èµ·æ­¥&quot; class=&quot;headerlink&quot; title=&quot;èµ·æ­¥&quot;&gt;&lt;/a&gt;èµ·æ­¥&lt;/h1&gt;&lt;p&gt;ä½¿ç”¨ vue-cli åˆ›å»ºé¡¹ç›®&lt;/p&gt;
&lt;p&gt;&lt;code&gt;vue create demo&lt;/code&gt; ï¼Œdemoå°±æ˜¯åˆ›å»ºé¡¹ç›®çš„åç§°&lt;br&gt;æç¤ºé€‰æ‹©é¢„è®¾ï¼Œé€‰æ‹© &lt;code&gt;Manually select features&lt;/code&gt; å›è½¦ç¡®è®¤&lt;br&gt;é€‰æ‹©&lt;code&gt;typescript&lt;/code&gt; &lt;code&gt;vuex&lt;/code&gt;  &lt;code&gt;router&lt;/code&gt; &lt;code&gt;babel&lt;/code&gt; &lt;code&gt;css pre-processors&lt;/code&gt;ï¼Œä¸ä½¿ç”¨&lt;code&gt;linter&lt;/code&gt;ï¼Œä¸é€‰å•å…ƒæµ‹è¯•æœ‰éœ€è¦å¦è¯´&lt;br&gt;å›è½¦åæŒ‰ç…§éœ€è¦é€‰æ‹©åˆé€‚çš„é€‰é¡¹&lt;br&gt;é€‰æ‹©å®Œæ¯•åå›è½¦ç­‰å¾…èµ„æºå‡†å¤‡&lt;/p&gt;
&lt;h2 id=&quot;ç¼–ç å¼€å§‹&quot;&gt;&lt;a href=&quot;#ç¼–ç å¼€å§‹&quot; class=&quot;headerlink&quot; title=&quot;ç¼–ç å¼€å§‹&quot;&gt;&lt;/a&gt;ç¼–ç å¼€å§‹&lt;/h2&gt;&lt;p&gt;ç†Ÿæ‚‰å‡ ä¸ªvueçš„è£…é¥°å™¨ &lt;code&gt;vue-property-decorator&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹çš„è£…é¥°å™¨çš„åŠŸèƒ½å’ŒåŸjsç¼–å†™çš„åŠŸèƒ½ç›¸åŒ/ç›¸ä¼¼ï¼Œå¯ä»¥å‚ç…§å®˜æ–¹æ–‡æ¡£ç±»æ¯”è§£è¯»ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; &amp;#123; Vue, Component, Inject, Provide, Prop, Model, Watch, Emit, Mixins &amp;#125; &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;vue-property-decorator&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;1-Vue-å®é™…ä¸Šå°±æ˜¯-Vue-æœ¬èº«-ç»§æ‰¿vueç›¸å…³å±æ€§å’Œå‡½æ•°&quot;&gt;&lt;a href=&quot;#1-Vue-å®é™…ä¸Šå°±æ˜¯-Vue-æœ¬èº«-ç»§æ‰¿vueç›¸å…³å±æ€§å’Œå‡½æ•°&quot; class=&quot;headerlink&quot; title=&quot;1. Vue å®é™…ä¸Šå°±æ˜¯ Vue æœ¬èº«,ç»§æ‰¿vueç›¸å…³å±æ€§å’Œå‡½æ•°&quot;&gt;&lt;/a&gt;1. Vue å®é™…ä¸Šå°±æ˜¯ Vue æœ¬èº«,ç»§æ‰¿vueç›¸å…³å±æ€§å’Œå‡½æ•°&lt;/h3&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MyComponent&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Vue&lt;/span&gt; &lt;/span&gt;&amp;#123; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;2-Component-å£°æ˜æˆä¸€ä¸ªvueçš„ç»„ä»¶å®ä¾‹ï¼Œå¦‚æœä¸ä½¿ç”¨ï¼Œåˆ™ä¸èƒ½å¾—åˆ°ä¸€ä¸ªvueç»„ä»¶&quot;&gt;&lt;a href=&quot;#2-Component-å£°æ˜æˆä¸€ä¸ªvueçš„ç»„ä»¶å®ä¾‹ï¼Œå¦‚æœä¸ä½¿ç”¨ï¼Œåˆ™ä¸èƒ½å¾—åˆ°ä¸€ä¸ªvueç»„ä»¶&quot; class=&quot;headerlink&quot; title=&quot;2. @Component å£°æ˜æˆä¸€ä¸ªvueçš„ç»„ä»¶å®ä¾‹ï¼Œå¦‚æœä¸ä½¿ç”¨ï¼Œåˆ™ä¸èƒ½å¾—åˆ°ä¸€ä¸ªvueç»„ä»¶&quot;&gt;&lt;/a&gt;2. @Component å£°æ˜æˆä¸€ä¸ªvueçš„ç»„ä»¶å®ä¾‹ï¼Œå¦‚æœä¸ä½¿ç”¨ï¼Œåˆ™ä¸èƒ½å¾—åˆ°ä¸€ä¸ªvueç»„ä»¶&lt;/h3&gt;&lt;p&gt;ç¬¬ä¸€ç§æ–¹å¼ï¼Œä¸éœ€è¦å®šä¹‰é¢å¤–å†…å®¹:&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@Component&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MyComponent&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Vue&lt;/span&gt; &lt;/span&gt;&amp;#123; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç¬¬äºŒç§æ–¹å¼ï¼Œå®šä¹‰ç›¸å…³å†…å®¹:&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@Component(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/* è¿™é‡Œå’Œjsç‰ˆæœ¬ç¼–å†™çš„ vue ç»„ä»¶å†…å®¹ç›¸åŒï¼Œ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * å‡¡æ˜¯ä¸èƒ½åœ¨tsé‡Œé¢å®Œæˆçš„éƒ½å¯ä»¥åœ¨è¿™é‡Œå®Œæˆ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * æœ€ç»ˆä¼šè¢«åˆå¹¶åˆ°ä¸€ä¸ªå®ä¾‹ä¸­ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * åœ¨è¿™é‡Œå®šä¹‰çš„å†…å®¹ï¼Œä¸ä¼šè¢«è¯­æ³•å™¨è·å–åˆ°ï¼Œå› æ­¤å¿…é¡»è¦åŒæ­¥åœ¨classä¸­å£°æ˜&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    data()&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &amp;#123; &lt;span class=&quot;attr&quot;&gt;myname&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;,&lt;span class=&quot;attr&quot;&gt;age&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;18&lt;/span&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MyComponent&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Vue&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    private myname:string;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mounted()&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.myname;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.age;&lt;span class=&quot;comment&quot;&gt;// è¯­æ³•å™¨æŠ¥é”™ï¼Œå½“å‰ç±»æ‰¾ä¸åˆ°ageå±æ€§&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;3-Provide-å‘ä»»æ„å±‚çº§çš„å­ç»„ä»¶æä¾›å¯è®¿é—®çš„å±æ€§ï¼Œé»˜è®¤ä¸ºå½“å‰å±æ€§çš„åç§°ï¼Œå¯ä»¥æŒ‡å®šåç§°&quot;&gt;&lt;a href=&quot;#3-Provide-å‘ä»»æ„å±‚çº§çš„å­ç»„ä»¶æä¾›å¯è®¿é—®çš„å±æ€§ï¼Œé»˜è®¤ä¸ºå½“å‰å±æ€§çš„åç§°ï¼Œå¯ä»¥æŒ‡å®šåç§°&quot; class=&quot;headerlink&quot; title=&quot;3.@Provide å‘ä»»æ„å±‚çº§çš„å­ç»„ä»¶æä¾›å¯è®¿é—®çš„å±æ€§ï¼Œé»˜è®¤ä¸ºå½“å‰å±æ€§çš„åç§°ï¼Œå¯ä»¥æŒ‡å®šåç§°&quot;&gt;&lt;/a&gt;3.@Provide å‘ä»»æ„å±‚çº§çš„å­ç»„ä»¶æä¾›å¯è®¿é—®çš„å±æ€§ï¼Œé»˜è®¤ä¸ºå½“å‰å±æ€§çš„åç§°ï¼Œå¯ä»¥æŒ‡å®šåç§°&lt;/h3&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@Component&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ParentComponent&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Vue&lt;/span&gt; &lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Provide() private info!:string;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Provide(&lt;span class=&quot;string&quot;&gt;&quot;next&quot;&lt;/span&gt;) private infoNext!:string;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;4-Inject-è·å–çˆ¶çº§ç”±Provideæä¾›çš„å±æ€§ï¼Œé»˜è®¤ä¸ºå½“å‰å±æ€§çš„åç§°ï¼Œå¯ä»¥æŒ‡å®šåç§°ï¼Œå¤šä¸ªçˆ¶çº§æä¾›ç›¸åŒåç§°å±æ€§æ—¶ï¼Œè·å–æœ€è¿‘çˆ¶çº§çš„åç§°å±æ€§&quot;&gt;&lt;a href=&quot;#4-Inject-è·å–çˆ¶çº§ç”±Provideæä¾›çš„å±æ€§ï¼Œé»˜è®¤ä¸ºå½“å‰å±æ€§çš„åç§°ï¼Œå¯ä»¥æŒ‡å®šåç§°ï¼Œå¤šä¸ªçˆ¶çº§æä¾›ç›¸åŒåç§°å±æ€§æ—¶ï¼Œè·å–æœ€è¿‘çˆ¶çº§çš„åç§°å±æ€§&quot; class=&quot;headerlink&quot; title=&quot;4. @Inject è·å–çˆ¶çº§ç”±Provideæä¾›çš„å±æ€§ï¼Œé»˜è®¤ä¸ºå½“å‰å±æ€§çš„åç§°ï¼Œå¯ä»¥æŒ‡å®šåç§°ï¼Œå¤šä¸ªçˆ¶çº§æä¾›ç›¸åŒåç§°å±æ€§æ—¶ï¼Œè·å–æœ€è¿‘çˆ¶çº§çš„åç§°å±æ€§&quot;&gt;&lt;/a&gt;4. @Inject è·å–çˆ¶çº§ç”±Provideæä¾›çš„å±æ€§ï¼Œé»˜è®¤ä¸ºå½“å‰å±æ€§çš„åç§°ï¼Œå¯ä»¥æŒ‡å®šåç§°ï¼Œå¤šä¸ªçˆ¶çº§æä¾›ç›¸åŒåç§°å±æ€§æ—¶ï¼Œè·å–æœ€è¿‘çˆ¶çº§çš„åç§°å±æ€§&lt;/h3&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@Component&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MyComponent&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Vue&lt;/span&gt; &lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Inject() private info!:string;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Inject(&lt;span class=&quot;string&quot;&gt;&quot;next&quot;&lt;/span&gt;) private infoNext!:string;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;5-Prop-ç”±æ ‡ç­¾å±æ€§æ³¨å…¥ï¼Œè·å–å¯¹åº”æ ‡ç­¾å±æ€§ä¸Šå€¼-å¯é…ç½®å…·ä½“propå†…å®¹ï¼Œå‚ç…§jsç‰ˆæœ¬propså†…å®¹&quot;&gt;&lt;a href=&quot;#5-Prop-ç”±æ ‡ç­¾å±æ€§æ³¨å…¥ï¼Œè·å–å¯¹åº”æ ‡ç­¾å±æ€§ä¸Šå€¼-å¯é…ç½®å…·ä½“propå†…å®¹ï¼Œå‚ç…§jsç‰ˆæœ¬propså†…å®¹&quot; class=&quot;headerlink&quot; title=&quot;5. @Prop ç”±æ ‡ç­¾å±æ€§æ³¨å…¥ï¼Œè·å–å¯¹åº”æ ‡ç­¾å±æ€§ä¸Šå€¼,å¯é…ç½®å…·ä½“propå†…å®¹ï¼Œå‚ç…§jsç‰ˆæœ¬propså†…å®¹&quot;&gt;&lt;/a&gt;5. @Prop ç”±æ ‡ç­¾å±æ€§æ³¨å…¥ï¼Œè·å–å¯¹åº”æ ‡ç­¾å±æ€§ä¸Šå€¼,å¯é…ç½®å…·ä½“propå†…å®¹ï¼Œå‚ç…§jsç‰ˆæœ¬propså†…å®¹&lt;/h3&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@Component&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MyComponent&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Vue&lt;/span&gt; &lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   @Prop() age!:number;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   @Prop(&amp;#123;&lt;span class=&quot;attr&quot;&gt;default&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&amp;#125;) sex!:number;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;template&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;MyComponent&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;:age&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;16&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;template&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;lang&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;ts&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;javascript&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; MyComponent &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;./MyComponent.vue&#39;&lt;/span&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@Component(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    components:&amp;#123; MyComponent &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;actionscript&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PComponent&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Vue&lt;/span&gt; &lt;/span&gt;&amp;#123; &amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Js" scheme="https://zhanghao-web.github.io/categories/Js/"/>
    
    
      <category term="Ts" scheme="https://zhanghao-web.github.io/tags/Ts/"/>
    
  </entry>
  
  <entry>
    <title>TypeScript çš„å¥½å¤„éƒ½æœ‰å•¥ï¼Ÿå’Œ JavaScript çš„åŒºåˆ«åœ¨å“ªï¼Ÿ</title>
    <link href="https://zhanghao-web.github.io/2019/07/04/Ts/TypeScript-%E7%9A%84%E5%A5%BD%E5%A4%84%E9%83%BD%E6%9C%89%E5%95%A5%EF%BC%9F%E5%92%8C-JavaScript-%E7%9A%84%E5%8C%BA%E5%88%AB%E5%9C%A8%E5%93%AA%EF%BC%9F/"/>
    <id>https://zhanghao-web.github.io/2019/07/04/Ts/TypeScript-çš„å¥½å¤„éƒ½æœ‰å•¥ï¼Ÿå’Œ-JavaScript-çš„åŒºåˆ«åœ¨å“ªï¼Ÿ/</id>
    <published>2019-07-04T08:13:53.000Z</published>
    <updated>2020-01-28T10:04:15.066Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://zhuanlan.zhihu.com/p/38526585" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a></p><p><strong>åœ¨æˆ‘çœ‹æ¥ TypeScript ç›¸å¯¹äº JavaScript ï¼Œé™¤äº†é™æ€ç±»å‹å¤–æ²¡å¸¦æ¥ä»»ä½•ä¸œè¥¿ã€‚</strong></p><p>æ—¢ç„¶å¦‚æ­¤</p><h2 id="é™æ€ç±»å‹æœ‰ä»€ä¹ˆå¥½å¤„"><a href="#é™æ€ç±»å‹æœ‰ä»€ä¹ˆå¥½å¤„" class="headerlink" title="é™æ€ç±»å‹æœ‰ä»€ä¹ˆå¥½å¤„"></a>é™æ€ç±»å‹æœ‰ä»€ä¹ˆå¥½å¤„</h2><p>é™æ€ç±»å‹çš„å¥½å¤„åˆ°å¤„éƒ½æœ‰è¯´ï¼Œè¿™é‡Œå°±ä¸è¯´å¾—å¤ªè¯¦ç»†äº†ï¼Œéšä¾¿åˆ—ä¸€ç‚¹ã€‚</p><ul><li>æœç»æ‰‹è¯¯å¯¼è‡´çš„å˜é‡åé”™è¯¯</li><li>è‡ªåŠ¨å®Œæˆ</li><li>é‡æ„æ”¯æŒ</li><li>ç±»å‹å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šå……å½“æ–‡æ¡£</li></ul><p>é™æ€ç±»å‹è§£æ”¾è„‘å®¹é‡ï¼Œè‡ªåŠ¨å®Œæˆè®©æˆ‘ä¸éœ€è¦è®°å¿†å“ªä¸ªå˜é‡é‡Œæœ‰å“ªäº›å±æ€§ï¼Œä¹Ÿä¸éœ€è¦è®°å®Œæ•´çš„å˜é‡åã€‚</p><p>å‡½æ•°ä¸Šçš„ç±»å‹çº¦æŸå¤–åŠ å°½é‡ä¸»åŠ¨å†™çº¯å‡½æ•°è®©æˆ‘åœ¨å†™å‡½æ•°å®ç°çš„æ—¶å€™ä¸éœ€è¦å…³æ³¨å‡½æ•°ä¹‹å¤–çš„ä»»ä½•ä¸œè¥¿ï¼Œæ³¨æ„åŠ›èšç„¦åœ¨å½“å‰å‡½æ•°ã€‚</p><p>å½“ç„¶ï¼Œä¹Ÿä¸åªæœ‰å¥½å¤„ã€‚</p><h2 id="é™æ€ç±»å‹æœ‰ä»€ä¹ˆä¸è¶³"><a href="#é™æ€ç±»å‹æœ‰ä»€ä¹ˆä¸è¶³" class="headerlink" title="é™æ€ç±»å‹æœ‰ä»€ä¹ˆä¸è¶³"></a>é™æ€ç±»å‹æœ‰ä»€ä¹ˆä¸è¶³</h2><ul><li>ç±»å‹æ ‡æ³¨éº»çƒ¦ã€‚</li><li>ç°é˜¶æ®µå¤§éƒ¨åˆ†é™æ€ç±»å‹è¯­è¨€çš„ç±»å‹ç³»ç»Ÿè¿˜ä¸å¤Ÿå¼ºã€‚</li><li>eval å’Œ new Function() è¿™ç§éªšæ“ä½œç±»å‹ç³»ç»Ÿç®¡ä¸åˆ°ã€‚</li><li>éœ€è¦ç¼–è¯‘ï¼Œç±»å‹æ£€æŸ¥ä¼šå¢åŠ ç¼–è¯‘æ—¶é•¿ï¼Œè¯­æ³•å’Œç±»å‹ç³»ç»Ÿå¤æ‚çš„è¯æ—¶é—´ç‰¹åˆ«ç‰¹åˆ«é•¿ï¼Œæ¯”å¦‚ scalaã€‚</li></ul><p>æ ‡æ³¨éº»çƒ¦çš„é—®é¢˜æ— æ³•æ ¹ç»ï¼Œä½†æ˜¯ç±»å‹æ¨å¯¼èƒ½è§£å†³å¤§éƒ¨åˆ†çš„ç±»å‹æ ‡æ³¨é—®é¢˜ã€‚</p><p>ç±»å‹ç³»ç»Ÿä¸å¤Ÿå¼ºçš„é—®é¢˜ä¼šéšç€æ—¶é—´æ…¢æ…¢å˜å¥½ã€‚</p><p>ç¼–è¯‘çš„é—®é¢˜åœ¨ ts å¯èƒ½ä¹Ÿå¹¶ä¸ç®—é—®é¢˜ï¼Œts çš„ç±»å‹æ£€æŸ¥å¹¶ä¸å½±å“ ts ç¼–è¯‘æˆ jsã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´å°±ç®—ç±»å‹æ£€æŸ¥ä¸é€šè¿‡ ts ä¹Ÿèƒ½è·‘èµ·æ¥ã€‚æ‰€ä»¥å¯¹ ts æ¥è¯´ç±»å‹æ£€æŸ¥å¯ä»¥ä»ç¼–è¯‘ä¸­æå–å‡ºæ¥ï¼Œä½œä¸ºç‹¬ç«‹çš„ç¼–è¯‘å’Œç±»å‹æ£€æŸ¥ä¸¤éƒ¨åˆ†ã€‚</p><p>å…ˆç¼–è¯‘è¾“å‡ºï¼Œå†åšç±»å‹æ£€æŸ¥ï¼Œç¼–è¯‘çš„éƒ¨åˆ†ç›¸å½“äº babel è¿™ç§å·¥å…·åšçš„äº‹ã€‚</p><p>ç±»å‹æ£€æŸ¥ä¹Ÿå¯ä»¥å•ç‹¬è¿è¡Œã€‚</p><p>é‚£ä¹ˆï¼Œ</p><h2 id="TypeScript-çš„ç±»å‹ç³»ç»Ÿæœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ"><a href="#TypeScript-çš„ç±»å‹ç³»ç»Ÿæœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ" class="headerlink" title="TypeScript çš„ç±»å‹ç³»ç»Ÿæœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ"></a>TypeScript çš„ç±»å‹ç³»ç»Ÿæœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ</h2><ul><li><a href="https://link.zhihu.com/?target=https%3A//github.com/Microsoft/TypeScript/issues/14833">å›¾çµå®Œå¤‡</a>ã€‚ï¼ˆè™½ç„¶ä¸å¤ªæ¸…æ¥šè¿™æ„å‘³ç€ä»€ä¹ˆï¼‰</li><li>æ¸è¿›çš„ç±»å‹ç³»ç»Ÿï¼Œæ‰€æœ‰ç±»å‹æ ‡æ³¨éƒ½æ˜¯å¯é€‰çš„ï¼Œæ—¢æ˜¯å¤©ä½¿åˆæ˜¯æ¶é­”çš„ <a href="https://link.zhihu.com/?target=https%3A//github.com/Microsoft/TypeScript/blob/master/doc/spec.md%233.1">any</a> ç±»å‹ã€‚ï¼ˆè¢« Haskell å¤§ç‰› <a href="https://www.zhihu.com/people/axurez" target="_blank" rel="noopener">Colliot</a> ç§°ä¸º ts ç±»å‹ç³»ç»Ÿçš„æ¼æ´ï¼‰</li><li>æ”¯æŒå±€éƒ¨ç±»å‹æ¨å¯¼ã€‚</li><li>ä¸°å¯Œçš„ç±»å‹å±‚é¢çš„è®¡ç®—ï¼Œå¦‚ <a href="https://link.zhihu.com/?target=https%3A//www.typescriptlang.org/docs/handbook/advanced-types.html">index types, mapped types, conditional types</a> ç­‰ç­‰ã€‚</li><li>æ”¯æŒ<a href="">é¸­å­ç±»å‹</a>ã€‚ï¼ˆæˆ–å«ç»“æ„å­ç±»å‹ï¼Ÿï¼‰</li><li>åƒ js æ”¯æŒå¯¹è±¡å­—é¢é‡ä¸€æ ·æ”¯æŒæ–¹ä¾¿çš„å¯¹è±¡å­—é¢ç±»å‹ï¼ˆobject literal typeï¼‰ï¼Œå­—ç¬¦ä¸²å’Œæ•°å­—è¿˜æœ‰å¸ƒå°”å€¼å­—é¢ç±»å‹ã€‚</li><li>ç©ºå®‰å…¨ã€‚</li><li>åŸºäºæ§åˆ¶æµçš„ç±»å‹åˆ†æ</li></ul><p>è¿˜æœ‰è®¸å¤šæˆ‘è§‰å¾—æ¯”è¾ƒå¹³å¸¸çš„ç‚¹å°±æ²¡æœ‰åˆ—å‡ºæ¥ï¼Œæ¯”å¦‚æ”¯æŒç±»å‹åˆ«åï¼Œæ³›å‹ï¼Œåå˜é€†å˜åŒå˜ç­‰ç­‰ã€‚</p><p>ts æ˜¯ä¸€é—¨éå¸¸éå¸¸éå¸¸å·¥ç¨‹çš„è¯­è¨€ï¼Œå¾ˆå¼ºå¤§ï¼Œä½†æ˜¯å¯èƒ½å’Œä¼˜é›…æ²¾ä¸ä¸ŠåŠç‚¹å…³ç³»ã€‚</p><p>å¯é€‰çš„ç±»å‹æ ‡æ³¨æ­é…ç±»å‹æ¨å¯¼ï¼Œè®© ts çš„ç±»å‹ç³»ç»Ÿæ›´åƒæ˜¯å·¥å…·ï¼Œè€Œä¸æ˜¯æ·é”ã€‚å¥½çš„äº§å“æ˜¯ç”¨å®Œå³èµ°çš„ã€‚</p><p>æœ‰æ—¶å€™ï¼Œç¨å¾®å¼€ä¸ªæ´ï¼Œèƒ½è®©äº‹æƒ…å˜ç®€å•å¾ˆå¤šã€‚æ¯”å¦‚ anyã€‚</p><p><code>é¸­å­ç±»å‹</code>åŠ ä¸Šä¸Šé¢æåˆ°çš„ç‰¹æ€§å¯ä»¥è®©ä½ ä¾æ—§æ„Ÿè§‰å’Œ js ä¸€æ ·ï¼Œåƒå¤§æµ·é‡Œçš„é±¼ä¸€æ ·è‡ªç”±ã€‚</p><p><a href="https://link.zhihu.com/?target=https%3A//www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare">Null References: The Billion Dollar Mistake</a> ï¼Œè€Œ js é‡Œæœ‰ä¸¤ä¸ª nullï¼ˆnull å’Œ undefinedï¼‰ï¼Œè™½ç„¶å‰ç«¯é€šå¸¸ä¸ä¼šé€ æˆéå¸¸ä¸¥é‡çš„æŸå¤±ï¼Œä½†æ˜¯ js ä¹Ÿæ…¢æ…¢è¢«åº”ç”¨åˆ°ä¸ä»…ä»…æ˜¯å‰ç«¯çš„è®¸å¤šåœ°æ–¹äº†ã€‚</p><p>ts è¿™ä¹ˆå¥½ï¼Œ</p><h2 id="æ€ä¹ˆå­¦-TypeScriptï¼Ÿ"><a href="#æ€ä¹ˆå­¦-TypeScriptï¼Ÿ" class="headerlink" title="æ€ä¹ˆå­¦ TypeScriptï¼Ÿ"></a>æ€ä¹ˆå­¦ TypeScriptï¼Ÿ</h2><p>æˆä¹Ÿæ¸è¿›ï¼Œè´¥ä¹Ÿæ¸è¿›ï¼Œæœ‰éƒ¨åˆ†äººé€šè¿‡å¯é€‰çš„ç±»å‹æ ‡æ³¨ï¼Œä¸€æ­¥ä¸€æ­¥æ— ç—›åœ°è¿‡æ¸¡åˆ°å­¦ä¼š tsã€‚</p><p>è€Œå¦ä¸€éƒ¨åˆ†äººç©äº†ä¸€ä¼šå„¿ï¼Œå‘ç°å’Œå†™ js å¹¶æ²¡æœ‰ä¸€ä¸ç‚¹åŒºåˆ«ï¼Œè€Œä¸”è¿˜ç¦»å¼€äº†ç†Ÿæ‚‰çš„ç¯å¢ƒï¼Œå°±æ”¾å¼ƒäº†ã€‚</p><p>ts å¹¶ä¸ä¼šå¼ºè¿«ä½ ä½¿ç”¨ç±»å‹ï¼Œæ‰€ä»¥å°±éœ€è¦æ›´å¼ºçš„åŠ¨åŠ›æ¥æ¨åŠ¨è‡ªå·±å­¦ä¹ ã€‚</p><p>å¦‚æœèº«è¾¹æœ‰ä¼š ts çš„æœ‹å‹çš„è¯ï¼Œå¯¹å­¦ä¹  ts ä¼šæ¯”è¾ƒæœ‰å¸®åŠ©ã€‚</p><p>å¤šè®©ä¼š ts çš„æœ‹å‹çœ‹è‡ªå·±çš„ä»£ç ï¼Œæ”¹è‰¯è‡ªå·±çš„å†™æ³•ã€‚å¤šå†™ï¼Œå¾ˆå®¹æ˜“å°±èƒ½å­¦ä¼šã€‚</p><p>å¦‚æœèº«è¾¹æ²¡æœ‰ä¼š ts çš„äººï¼Œå…¶å®æˆ‘æ›´å»ºè®®å…ˆç”¨ <a href="https://github.com/Microsoft/TypeScript/wiki/JSDoc-support-in-JavaScript" target="_blank" rel="noopener">JSDoc</a>ã€‚</p><p>ä½¿ç”¨ vscode æˆ–è€… webstorm çš„æ—¶å€™ç›´æ¥å†™ JSDoc å°±è¡Œäº†ï¼Œvsc æˆ– webstorm ä¼šä¾é  ts æ¥æä¾›ç±»å‹æ¨å¯¼å’Œè‡ªåŠ¨å®Œæˆã€‚</p><p>è¿™æ ·å¯ä»¥åœ¨å·¥ä½œæˆ–è‡ªå·±å†™ä¸œè¥¿çš„æ—¶å€™æ…¢æ…¢ä¹ æƒ¯å¹¶ä¸”ä¸»åŠ¨å»ä½¿ç”¨ç±»å‹æ ‡æ³¨ã€‚</p><p>åœ¨ä½¿ç”¨ä¸€æ®µæ—¶é—´åæ„Ÿè§‰ JSDoc å·²ç»ä¸å¤Ÿç”¨äº†ï¼Œæ»¡è¶³ä¸äº†è‡ªå·±çš„éœ€æ±‚äº†ï¼Œå†å¼€å§‹ä½¿ç”¨ tsã€‚</p><p>åŒæ—¶ä¹Ÿè¦å¤šä¸»åŠ¨å»äº†è§£å’Œå­¦ä¹ ä¸€äº› ts çš„ä»£ç ï¼Œä¸ç„¶çš„è¯ï¼Œä¸çŸ¥é“ ts æœ‰å¤šå¥½ï¼Œè‡ªç„¶å°±ä¸ä¼šè§‰å¾— JSDoc ä¸å¤Ÿç”¨ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/38526585&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åœ¨æˆ‘çœ‹æ¥ TypeScript ç›¸å¯¹äº JavaScript ï¼Œé™¤äº†
      
    
    </summary>
    
      <category term="Js" scheme="https://zhanghao-web.github.io/categories/Js/"/>
    
    
      <category term="Ts" scheme="https://zhanghao-web.github.io/tags/Ts/"/>
    
  </entry>
  
  <entry>
    <title>vueä¸­ä¸å¸¸ç”¨çš„APIçš„ä½¿ç”¨æ–¹æ³•æ€»ç»“</title>
    <link href="https://zhanghao-web.github.io/2019/06/13/Vue/vue%E4%B8%AD%E4%B8%8D%E5%B8%B8%E7%94%A8%E7%9A%84API%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/"/>
    <id>https://zhanghao-web.github.io/2019/06/13/Vue/vueä¸­ä¸å¸¸ç”¨çš„APIçš„ä½¿ç”¨æ–¹æ³•æ€»ç»“/</id>
    <published>2019-06-13T05:46:23.000Z</published>
    <updated>2020-01-28T10:04:15.070Z</updated>
    
    <content type="html"><![CDATA[<h2 id="errorHandler"><a href="#errorHandler" class="headerlink" title="errorHandler"></a>errorHandler</h2><p>å®˜ç½‘ä»‹ç»åŠä½¿ç”¨ï¼š</p><p>æŒ‡å®šç»„ä»¶çš„æ¸²æŸ“å’Œè§‚å¯ŸæœŸé—´æœªæ•è·é”™è¯¯çš„å¤„ç†å‡½æ•°ã€‚è¿™ä¸ªå¤„ç†å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå¯è·å–é”™è¯¯ä¿¡æ¯å’Œ Vue å®ä¾‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Vue.config.errorHandler = <span class="function"><span class="keyword">function</span> (<span class="params">err, vm, info</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//å¤„ç†é”™è¯¯ä¿¡æ¯, è¿›è¡Œé”™è¯¯ä¸ŠæŠ¥</span></span><br><span class="line">  <span class="comment">//erré”™è¯¯å¯¹è±¡</span></span><br><span class="line">  <span class="comment">//vm Vueå®ä¾‹</span></span><br><span class="line">  <span class="comment">//`info` æ˜¯ Vue ç‰¹å®šçš„é”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚é”™è¯¯æ‰€åœ¨çš„ç”Ÿå‘½å‘¨æœŸé’©å­</span></span><br><span class="line">  <span class="comment">//åªåœ¨ 2.2.0+ å¯ç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Vue-observable-object"><a href="#Vue-observable-object" class="headerlink" title="Vue.observable( object )"></a>Vue.observable( object )</h2><p>è¿™ä¸ªç›¸å½“äºä¸€ä¸ªç®€å•çš„storeç®¡ç†ï¼Œåœ¨ä¸ç”¨vuexçš„æƒ…å†µä¸‹ï¼Œä¸åŒç»„ä»¶ä¹‹é—´é€šä¿¡å¯ä»¥ç”¨<code>Vue.observeable</code></p><p>å®˜ç½‘ä»‹ç»ï¼š</p><p>è®©ä¸€ä¸ªå¯¹è±¡å¯å“åº”ã€‚Vue å†…éƒ¨ä¼šç”¨å®ƒæ¥å¤„ç† data å‡½æ•°è¿”å›çš„å¯¹è±¡ã€‚</p><p>è¿”å›çš„å¯¹è±¡å¯ä»¥ç›´æ¥ç”¨äºæ¸²æŸ“å‡½æ•°å’Œè®¡ç®—å±æ€§å†…ï¼Œå¹¶ä¸”ä¼šåœ¨å‘ç”Ÿæ”¹å˜æ—¶è§¦å‘ç›¸åº”çš„æ›´æ–°ã€‚ä¹Ÿå¯ä»¥ä½œä¸ºæœ€å°åŒ–çš„è·¨ç»„ä»¶çŠ¶æ€å­˜å‚¨å™¨ï¼Œç”¨äºç®€å•çš„åœºæ™¯ï¼š</p><p>ä½¿ç”¨ï¼š</p><p>åœ¨store.jsä¸­</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">impor vue <span class="keyword">from</span> <span class="string">'vue'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> store = vue.observable(&#123;<span class="attr">count</span>:<span class="number">0</span>&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mutation = &#123;</span><br><span class="line">    setCount(count)&#123;</span><br><span class="line">        store.count = count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç»„ä»¶ä¸­ä½¿ç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"hello"</span>&gt;</span><br><span class="line">    &lt;p @click=<span class="string">"setCount(testCount + 1)"</span>&gt;+&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;p @click="setCount(testCount - 1)"&gt;-&lt;/</span>p&gt;</span><br><span class="line">    &lt;test /&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123;testCount&#125;&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">import test from './</span>test<span class="string">'</span></span><br><span class="line"><span class="string">import &#123; store,  mutation&#125; from '</span>@/store<span class="string">'</span></span><br><span class="line"><span class="string">export default &#123;</span></span><br><span class="line"><span class="string">  name: '</span>HelloWorld<span class="string">',</span></span><br><span class="line"><span class="string">  data () &#123;</span></span><br><span class="line"><span class="string">    return &#123;</span></span><br><span class="line"><span class="string">      msg: '</span>Welcome to Your Vue.js App<span class="string">'</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  components: &#123;</span></span><br><span class="line"><span class="string">    test</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  methods: &#123;</span></span><br><span class="line"><span class="string">    setCount: mutation.setCount</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  computed: &#123;</span></span><br><span class="line"><span class="string">    testCount()&#123;</span></span><br><span class="line"><span class="string">      return store.count</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;!-- Add "scoped" attribute to limit CSS to this component only --&gt;</span></span><br><span class="line"><span class="string">&lt;style scoped&gt;</span></span><br><span class="line"><span class="string">h1, h2 &#123;</span></span><br><span class="line"><span class="string">  font-weight: normal;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">ul &#123;</span></span><br><span class="line"><span class="string">  list-style-type: none;</span></span><br><span class="line"><span class="string">  padding: 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">li &#123;</span></span><br><span class="line"><span class="string">  display: inline-block;</span></span><br><span class="line"><span class="string">  margin: 0 10px;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">a &#123;</span></span><br><span class="line"><span class="string">  color: #42b983;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&lt;/style&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>test ç»„ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;test&#123;&#123;testCount&#125;&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; store &#125; <span class="keyword">from</span> <span class="string">'@/store'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  computed: &#123;</span><br><span class="line">    testCount()&#123;</span><br><span class="line">      <span class="keyword">return</span> store.count</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;style scoped&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;/</span>style&gt;</span><br></pre></td></tr></table></figure><h1 id="errorCaptured-2-5-0æ–°å¢çš„ç”Ÿå‘½å‘¨æœŸé’©å­"><a href="#errorCaptured-2-5-0æ–°å¢çš„ç”Ÿå‘½å‘¨æœŸé’©å­" class="headerlink" title="errorCaptured(2.5.0æ–°å¢çš„ç”Ÿå‘½å‘¨æœŸé’©å­)"></a>errorCaptured(2.5.0æ–°å¢çš„ç”Ÿå‘½å‘¨æœŸé’©å­)</h1><p>å®˜ç½‘ä»‹ç»ï¼š</p><p>å½“æ•è·ä¸€ä¸ªæ¥è‡ªå­å­™ç»„ä»¶çš„é”™è¯¯æ—¶è¢«è°ƒç”¨ã€‚æ­¤é’©å­ä¼šæ”¶åˆ°ä¸‰ä¸ªå‚æ•°ï¼šé”™è¯¯å¯¹è±¡ã€å‘ç”Ÿé”™è¯¯çš„ç»„ä»¶å®ä¾‹ä»¥åŠä¸€ä¸ªåŒ…å«é”™è¯¯æ¥æºä¿¡æ¯çš„å­—ç¬¦ä¸²ã€‚æ­¤é’©å­å¯ä»¥è¿”å› false ä»¥é˜»æ­¢è¯¥é”™è¯¯ç»§ç»­å‘ä¸Šä¼ æ’­ã€‚</p><p>ä¸errorhandlerçš„ä¸åŒä¹‹å¤„ï¼š</p><p>errorCaptured å’Œ errorHandler çš„è§¦å‘æ—¶æœºéƒ½æ˜¯ç›¸åŒçš„ï¼Œä¸åŒçš„æ˜¯ errorCaptured å‘ç”Ÿåœ¨å‰ï¼Œä¸”å¦‚æœæŸä¸ªç»„ä»¶çš„ errorCaptured æ–¹æ³•è¿”å›äº† falseï¼Œé‚£ä¹ˆè¿™ä¸ªå¼‚å¸¸ä¿¡æ¯ä¸ä¼šå†å‘ä¸Šå†’æ³¡ä¹Ÿä¸ä¼šå†è°ƒç”¨ errorHandler æ–¹æ³•</p><h1 id="parent"><a href="#parent" class="headerlink" title="parent"></a>parent</h1><p>å®˜ç½‘ä»‹ç»ï¼š</p><p>æŒ‡å®šå·²åˆ›å»ºçš„å®ä¾‹ä¹‹çˆ¶å®ä¾‹ï¼Œåœ¨ä¸¤è€…ä¹‹é—´å»ºç«‹çˆ¶å­å…³ç³»ã€‚å­å®ä¾‹å¯ä»¥ç”¨ this.$parent è®¿é—®çˆ¶å®ä¾‹ï¼Œå­å®ä¾‹è¢«æ¨å…¥çˆ¶å®ä¾‹çš„ $children æ•°ç»„ä¸­ã€‚</p><p>æ³¨æ„:èŠ‚åˆ¶åœ°ä½¿ç”¨ $parent å’Œ $children - å®ƒä»¬çš„ä¸»è¦ç›®çš„æ˜¯ä½œä¸ºè®¿é—®ç»„ä»¶çš„åº”æ€¥æ–¹æ³•ã€‚æ›´æ¨èç”¨ props å’Œ events å®ç°çˆ¶å­ç»„ä»¶é€šä¿¡</p><p>ä½¿ç”¨:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.$parent.xxx() <span class="comment">//ç›´æ¥åœ¨å­ç»„ä»¶è°ƒç”¨çˆ¶ç»„ä»¶ä¸­æ–¹æ³•</span></span><br></pre></td></tr></table></figure><h1 id="mixin"><a href="#mixin" class="headerlink" title="mixin"></a>mixin</h1><p>å®˜ç½‘ä»‹ç»ï¼š</p><p>mixins é€‰é¡¹æ¥å—ä¸€ä¸ªæ··å…¥å¯¹è±¡çš„æ•°ç»„ã€‚è¿™äº›æ··å…¥å®ä¾‹å¯¹è±¡å¯ä»¥åƒæ­£å¸¸çš„å®ä¾‹å¯¹è±¡ä¸€æ ·åŒ…å«é€‰é¡¹ï¼Œä»–ä»¬å°†åœ¨ Vue.extend() é‡Œæœ€ç»ˆé€‰æ‹©ä½¿ç”¨ç›¸åŒçš„é€‰é¡¹åˆå¹¶é€»è¾‘åˆå¹¶ã€‚ä¸¾ä¾‹ï¼šå¦‚æœä½ çš„æ··å…¥åŒ…å«ä¸€ä¸ªé’©å­è€Œåˆ›å»ºç»„ä»¶æœ¬èº«ä¹Ÿæœ‰ä¸€ä¸ªï¼Œä¸¤ä¸ªå‡½æ•°å°†è¢«è°ƒç”¨ã€‚</p><p>mixinså°±æ˜¯å®šä¹‰ä¸€éƒ¨åˆ†å…¬å…±çš„æ–¹æ³•æˆ–è€…è®¡ç®—å±æ€§,ç„¶åæ··å…¥åˆ°å„ä¸ªç»„ä»¶ä¸­ä½¿ç”¨,æ–¹ä¾¿ç®¡ç†ä¸ç»Ÿä¸€ä¿®æ”¹</p><p>1ã€åœ¨assetsæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªjsæ–‡ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªéœ€è¦æ··å…¥çš„å¯¹è±¡ </span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mixinTest1 = &#123;</span><br><span class="line">    created() &#123;</span><br><span class="line">        <span class="keyword">this</span>.hello();</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        hello() &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'mixinTest1'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>2ã€åœ¨ç»„ä»¶ä¸­ä½¿ç”¨åˆšåˆšåˆ›å»ºçš„æ··å…¥</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;mixinTest1&#125; <span class="keyword">from</span> <span class="string">'./../assets/js/mixin'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    mixins:[mixinTest1],</span><br><span class="line">    name: <span class="string">'hello'</span>,</span><br><span class="line">    data () &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            msg: <span class="string">'Welcome to Your Vue.js App'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ã€å¦‚æœç»„ä»¶ä¸­å®šä¹‰çš„æ–¹æ³•ä¸æ··å…¥å¯¹è±¡ä¸­çš„æ–¹æ³•/å±æ€§ä¸€æ ·,ç»„ä»¶ä¸­çš„ä¼˜å…ˆçº§å¤§äºæ··å…¥å¯¹è±¡ä¸­çš„(æ–¹æ³•ä¼šè°ƒç”¨å¤šæ¬¡)</p><p>4ã€æ··å…¥å¯¹è±¡ä¸­å¯ä»¥å®šä¹‰æŠ½è±¡æ–¹æ³•,ä½¿ç”¨æ··å…¥çš„ç»„ä»¶å¿…é¡»é‡å†™è¯¥æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">methods: &#123;</span><br><span class="line">    handlePlaylist() &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'component must implement handlePlaylist method'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h1 id="provide-inject"><a href="#provide-inject" class="headerlink" title="provide / inject"></a>provide / inject</h1><p>å®˜ç½‘ä»‹ç»ï¼š</p><p>è¿™å¯¹é€‰é¡¹éœ€è¦ä¸€èµ·ä½¿ç”¨ï¼Œä»¥å…è®¸ä¸€ä¸ªç¥–å…ˆç»„ä»¶å‘å…¶æ‰€æœ‰å­å­™åä»£æ³¨å…¥ä¸€ä¸ªä¾èµ–ï¼Œä¸è®ºç»„ä»¶å±‚æ¬¡æœ‰å¤šæ·±ï¼Œå¹¶åœ¨èµ·ä¸Šä¸‹æ¸¸å…³ç³»æˆç«‹çš„æ—¶é—´é‡Œå§‹ç»ˆç”Ÿæ•ˆã€‚å¦‚æœä½ ç†Ÿæ‚‰ Reactï¼Œè¿™ä¸ React çš„ä¸Šä¸‹æ–‡ç‰¹æ€§å¾ˆç›¸ä¼¼ã€‚</p><p>provide é€‰é¡¹åº”è¯¥æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–è¿”å›ä¸€ä¸ªå¯¹è±¡çš„å‡½æ•°ã€‚è¯¥å¯¹è±¡åŒ…å«å¯æ³¨å…¥å…¶å­å­™çš„å±æ€§ã€‚åœ¨è¯¥å¯¹è±¡ä¸­ä½ å¯ä»¥ä½¿ç”¨ ES2015 Symbols ä½œä¸º keyï¼Œä½†æ˜¯åªåœ¨åŸç”Ÿæ”¯æŒ Symbol å’Œ Reflect.ownKeys çš„ç¯å¢ƒä¸‹å¯å·¥ä½œã€‚</p><p>inject é€‰é¡¹åº”è¯¥æ˜¯ï¼š</p><p>ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œæˆ–<br>ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡çš„ key æ˜¯æœ¬åœ°çš„ç»‘å®šåï¼Œvalue æ˜¯ï¼š<br>åœ¨å¯ç”¨çš„æ³¨å…¥å†…å®¹ä¸­æœç´¢ç”¨çš„ key (å­—ç¬¦ä¸²æˆ– Symbol)ï¼Œæˆ–<br>ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„ï¼š<br>from å±æ€§æ˜¯åœ¨å¯ç”¨çš„æ³¨å…¥å†…å®¹ä¸­æœç´¢ç”¨çš„ key (å­—ç¬¦ä¸²æˆ– Symbol)<br>default å±æ€§æ˜¯é™çº§æƒ…å†µä¸‹ä½¿ç”¨çš„ value</p><ul><li>æ³¨æ„ï¼šprovide å’Œ inject ä¸»è¦ä¸ºé«˜é˜¶æ’ä»¶/ç»„ä»¶åº“æä¾›ç”¨ä¾‹ã€‚å¹¶ä¸æ¨èç›´æ¥ç”¨äºåº”ç”¨ç¨‹åºä»£ç ä¸­ã€‚</li></ul><p>æˆ‘ä¹‹å‰ä½¿ç”¨åˆ°<code>provide / inject</code>æ˜¯<strong>æ¨¡æ‹Ÿé¡µé¢æ•°æ®å›åˆ°åˆå§‹çŠ¶æ€</strong>ï¼Œç›¸å½“äºåˆ·æ–°å½“å‰é¡µé¢ï¼Œä½†æ˜¯ç›´æ¥åˆ·æ–°å½“å‰é¡µé¢ä¼šæœ‰å‡ ç§’çš„ç©ºç™½æœŸï¼Œä½“éªŒä¸å¥½ï¼Œæ‰€ä»¥ç”¨åˆ°äº†<code>provide / inject</code></p><p>ä½¿ç”¨æ–¹æ³•ï¼š</p><p>1.ä¿®æ”¹App.vueä»£ç å¦‚ä¸‹å›¾æ‰€ç¤º</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div id=<span class="string">"app"</span>&gt;</span><br><span class="line">        &lt;router-view v-<span class="keyword">if</span>=<span class="string">"isRouterActive"</span>/&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">        name: <span class="string">'App'</span>,</span><br><span class="line">        provide:&#123;</span><br><span class="line">            retrun&#123;</span><br><span class="line">                reload:<span class="keyword">this</span>.reload</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        data()&#123;</span><br><span class="line">            <span class="keyword">return</span>&#123;</span><br><span class="line">                isRouterActive: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line">            reload()&#123;</span><br><span class="line">                <span class="keyword">this</span>.isRouterActive = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">                     <span class="keyword">this</span>.isRouterActive = <span class="literal">true</span>;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡å£°æ˜reloadæ–¹æ³•ï¼Œæ§åˆ¶isRouterAliceå±æ€§true or false æ¥æ§åˆ¶router-viewçš„æ˜¾ç¤ºæˆ–éšè—ï¼Œä»è€Œæ§åˆ¶é¡µé¢çš„å†æ¬¡åŠ è½½</p><p>2.åœ¨éœ€è¦å½“å‰é¡µé¢åˆ·æ–°çš„é¡µé¢ä¸­æ³¨å…¥App.vueç»„ä»¶æä¾›ï¼ˆprovideï¼‰çš„ reload ä¾èµ–ï¼Œç„¶åç›´æ¥ç”¨this.reloadæ¥è°ƒç”¨å°±è¡Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> defalut&#123;</span><br><span class="line">    inject:[<span class="string">'reload'</span>],</span><br><span class="line">    data()&#123;</span><br><span class="line">        <span class="keyword">return</span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods:&#123;</span><br><span class="line">        reloadPage()&#123;</span><br><span class="line">            <span class="keyword">this</span>.reload();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="keep-alive"><a href="#keep-alive" class="headerlink" title="keep-alive"></a>keep-alive</h1><p>å®˜ç½‘ä»‹ç»ï¼š</p><p><code>&lt;keep-alive&gt;</code> åŒ…è£¹åŠ¨æ€ç»„ä»¶æ—¶ï¼Œä¼šç¼“å­˜ä¸æ´»åŠ¨çš„ç»„ä»¶å®ä¾‹ï¼Œè€Œä¸æ˜¯é”€æ¯å®ƒä»¬ã€‚å’Œ <code>&lt;transition&gt;</code> ç›¸ä¼¼ï¼Œ<code>&lt;keep-alive&gt;</code> æ˜¯ä¸€ä¸ªæŠ½è±¡ç»„ä»¶ï¼šå®ƒè‡ªèº«ä¸ä¼šæ¸²æŸ“ä¸€ä¸ª DOM å…ƒç´ ï¼Œä¹Ÿä¸ä¼šå‡ºç°åœ¨çˆ¶ç»„ä»¶é“¾ä¸­ã€‚</p><p>å½“ç»„ä»¶åœ¨ <code>&lt;keep-alive&gt;</code> å†…è¢«åˆ‡æ¢ï¼Œå®ƒçš„ activated å’Œ deactivated è¿™ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°å°†ä¼šè¢«å¯¹åº”æ‰§è¡Œã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;errorHandler&quot;&gt;&lt;a href=&quot;#errorHandler&quot; class=&quot;headerlink&quot; title=&quot;errorHandler&quot;&gt;&lt;/a&gt;errorHandler&lt;/h2&gt;&lt;p&gt;å®˜ç½‘ä»‹ç»åŠä½¿ç”¨ï¼š&lt;/p&gt;
&lt;p&gt;æŒ‡å®šç»„ä»¶çš„æ¸²æŸ“å’Œè§‚å¯ŸæœŸé—´æœªæ•è·é”™è¯¯çš„å¤„ç†å‡½æ•°ã€‚è¿™ä¸ªå¤„ç†å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå¯è·å–é”™è¯¯ä¿¡æ¯å’Œ Vue å®ä¾‹&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Vue.config.errorHandler = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;err, vm, info&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;//å¤„ç†é”™è¯¯ä¿¡æ¯, è¿›è¡Œé”™è¯¯ä¸ŠæŠ¥&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;//erré”™è¯¯å¯¹è±¡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;//vm Vueå®ä¾‹&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;//`info` æ˜¯ Vue ç‰¹å®šçš„é”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚é”™è¯¯æ‰€åœ¨çš„ç”Ÿå‘½å‘¨æœŸé’©å­&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;//åªåœ¨ 2.2.0+ å¯ç”¨&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;Vue-observable-object&quot;&gt;&lt;a href=&quot;#Vue-observable-object&quot; class=&quot;headerlink&quot; title=&quot;Vue.observable( object )&quot;&gt;&lt;/a&gt;Vue.observable( object )&lt;/h2&gt;&lt;p&gt;è¿™ä¸ªç›¸å½“äºä¸€ä¸ªç®€å•çš„storeç®¡ç†ï¼Œåœ¨ä¸ç”¨vuexçš„æƒ…å†µä¸‹ï¼Œä¸åŒç»„ä»¶ä¹‹é—´é€šä¿¡å¯ä»¥ç”¨&lt;code&gt;Vue.observeable&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å®˜ç½‘ä»‹ç»ï¼š&lt;/p&gt;
&lt;p&gt;è®©ä¸€ä¸ªå¯¹è±¡å¯å“åº”ã€‚Vue å†…éƒ¨ä¼šç”¨å®ƒæ¥å¤„ç† data å‡½æ•°è¿”å›çš„å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;è¿”å›çš„å¯¹è±¡å¯ä»¥ç›´æ¥ç”¨äºæ¸²æŸ“å‡½æ•°å’Œè®¡ç®—å±æ€§å†…ï¼Œå¹¶ä¸”ä¼šåœ¨å‘ç”Ÿæ”¹å˜æ—¶è§¦å‘ç›¸åº”çš„æ›´æ–°ã€‚ä¹Ÿå¯ä»¥ä½œä¸ºæœ€å°åŒ–çš„è·¨ç»„ä»¶çŠ¶æ€å­˜å‚¨å™¨ï¼Œç”¨äºç®€å•çš„åœºæ™¯ï¼š&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;p&gt;åœ¨store.jsä¸­&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;impor vue &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;vue&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; store = vue.observable(&amp;#123;&lt;span class=&quot;attr&quot;&gt;count&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; mutation = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    setCount(count)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        store.count = count;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨ç»„ä»¶ä¸­ä½¿ç”¨&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;template&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;div &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt;&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;hello&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;p @click=&lt;span class=&quot;string&quot;&gt;&quot;setCount(testCount + 1)&quot;&lt;/span&gt;&amp;gt;+&amp;lt;&lt;span class=&quot;regexp&quot;&gt;/p&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;regexp&quot;&gt;    &amp;lt;p @click=&quot;setCount(testCount - 1)&quot;&amp;gt;-&amp;lt;/&lt;/span&gt;p&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;test /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;p&amp;gt;&amp;#123;&amp;#123;testCount&amp;#125;&amp;#125;&amp;lt;&lt;span class=&quot;regexp&quot;&gt;/p&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;regexp&quot;&gt;  &amp;lt;/&lt;/span&gt;div&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;&lt;span class=&quot;regexp&quot;&gt;/template&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;regexp&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;regexp&quot;&gt;&amp;lt;script&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;regexp&quot;&gt;import test from &#39;./&lt;/span&gt;test&lt;span class=&quot;string&quot;&gt;&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;import &amp;#123; store,  mutation&amp;#125; from &#39;&lt;/span&gt;@/store&lt;span class=&quot;string&quot;&gt;&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;export default &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;  name: &#39;&lt;/span&gt;HelloWorld&lt;span class=&quot;string&quot;&gt;&#39;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;  data () &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;    return &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;      msg: &#39;&lt;/span&gt;Welcome to Your Vue.js App&lt;span class=&quot;string&quot;&gt;&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;  &amp;#125;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;  components: &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;    test&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;  &amp;#125;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;  methods: &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;    setCount: mutation.setCount&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;  &amp;#125;,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;  computed: &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;    testCount()&amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;      return store.count&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&amp;lt;!-- Add &quot;scoped&quot; attribute to limit CSS to this component only --&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&amp;lt;style scoped&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;h1, h2 &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;  font-weight: normal;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;ul &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;  list-style-type: none;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;  padding: 0;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;li &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;  display: inline-block;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;  margin: 0 10px;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;a &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;  color: #42b983;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&amp;lt;/style&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Vue" scheme="https://zhanghao-web.github.io/categories/Vue/"/>
    
    
      <category term="Vue" scheme="https://zhanghao-web.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>TypeScript é«˜çº§æŠ€å·§</title>
    <link href="https://zhanghao-web.github.io/2019/06/12/Ts/TypeScript-%E9%AB%98%E7%BA%A7%E6%8A%80%E5%B7%A7/"/>
    <id>https://zhanghao-web.github.io/2019/06/12/Ts/TypeScript-é«˜çº§æŠ€å·§/</id>
    <published>2019-06-12T08:10:54.000Z</published>
    <updated>2020-01-28T10:04:15.066Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://juejin.im/post/5cffb431f265da1b7401f466?utm_source=gold_browser_extension" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a></p><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ç”¨äº†ä¸€æ®µæ—¶é—´çš„ typescript ä¹‹åï¼Œæ·±æ„Ÿä¸­å¤§å‹é¡¹ç›®ä¸­ typescript çš„å¿…è¦æ€§ï¼Œå®ƒèƒ½å¤Ÿæå‰åœ¨ç¼–è¯‘æœŸé¿å…è®¸å¤š bugï¼Œå¦‚å¾ˆæ¶å¿ƒçš„æ‹¼å†™é—®é¢˜ã€‚è€Œè¶Šæ¥è¶Šå¤šçš„ package ä¹Ÿå¼€å§‹ä½¿ç”¨ tsï¼Œå­¦ä¹  ts å·²æ˜¯åŠ¿åœ¨å¿…è¡Œã€‚</p><h2 id="01-keyof"><a href="#01-keyof" class="headerlink" title="01 keyof"></a>01 keyof</h2><p><code>keyof</code> ä¸ <code>Object.keys</code> ç•¥æœ‰ç›¸ä¼¼ï¼Œåªä¸è¿‡ <code>keyof</code> å– <code>interface</code> çš„é”®ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">interface Point &#123;</span><br><span class="line">    x: number;</span><br><span class="line">    y: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// type keys = "x" | "y"</span></span><br><span class="line">type keys = keyof Point;</span><br></pre></td></tr></table></figure><p>å‡è®¾æœ‰ä¸€ä¸ª <code>object</code> å¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ typescript å®ç°ä¸€ä¸ª get å‡½æ•°æ¥è·å–å®ƒçš„å±æ€§å€¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">  a: <span class="number">3</span>,</span><br><span class="line">  hello: <span class="string">'world'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">o: object, name: string</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> o[name]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åˆšå¼€å§‹å¯èƒ½ä¼šè¿™ä¹ˆå†™ï¼Œä¸è¿‡å®ƒæœ‰å¾ˆå¤šç¼ºç‚¹<br>1.æ— æ³•ç¡®è®¤è¿”å›ç±»å‹ï¼šè¿™å°†æŸå¤± ts æœ€å¤§çš„ç±»å‹æ ¡éªŒåŠŸèƒ½<br>2.æ— æ³•å¯¹ key åšçº¦æŸï¼šå¯èƒ½ä¼šçŠ¯æ‹¼å†™é”™è¯¯çš„é—®é¢˜</p><p>è¿™æ—¶å¯ä»¥ä½¿ç”¨ <code>keyof</code> æ¥åŠ å¼º <code>get</code> å‡½æ•°çš„ç±»å‹åŠŸèƒ½ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥çœ‹çœ‹ <code>_.get</code> çš„ <code>type</code> æ ‡è®°ä»¥åŠå®ç°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function get&lt;T extends object, K extends keyof T&gt;(o: T, name: K): T[K] &#123;</span><br><span class="line">  <span class="keyword">return</span> o[name]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="02-Partial-amp-Pick"><a href="#02-Partial-amp-Pick" class="headerlink" title="02 Partial &amp; Pick"></a>02 Partial &amp; Pick</h2><p>æ—¢ç„¶äº†è§£äº† <code>keyof</code>ï¼Œå¯ä»¥ä½¿ç”¨å®ƒå¯¹å±æ€§åšä¸€äº›æ‰©å±•ï¼Œ å¦‚å®ç° <code>Partial</code> å’Œ <code>Pick</code>ï¼Œ<code>Pick</code> ä¸€èˆ¬ç”¨åœ¨ <code>_.pick</code> ä¸­</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">type Partial&lt;T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T]?: T[P];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type Pick&lt;T, K extends keyof T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> K]: T[P];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">interface User &#123;</span><br><span class="line">  id: number;</span><br><span class="line">  age: number;</span><br><span class="line">  name: string;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›¸å½“äº: type PartialUser = &#123; id?: number; age?: number; name?: string; &#125;</span></span><br><span class="line">type PartialUser = Partial&lt;User&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›¸å½“äº: type PickUser = &#123; id: number; age: number; &#125;</span></span><br><span class="line">type PickUser = Pick&lt;User, <span class="string">"id"</span> | <span class="string">"age"</span>&gt;</span><br></pre></td></tr></table></figure><h2 id="03-Condition-Type"><a href="#03-Condition-Type" class="headerlink" title="03 Condition Type"></a>03 Condition Type</h2><p>ç±»ä¼¼äº js ä¸­çš„ <code>?:</code> è¿ç®—ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ‰©å±•ä¸€äº›åŸºæœ¬ç±»å‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">T extends U ? X : Y</span><br><span class="line"></span><br><span class="line">type isTrue&lt;T&gt; = T extends <span class="literal">true</span> ? <span class="literal">true</span> : <span class="literal">false</span></span><br><span class="line"><span class="comment">// ç›¸å½“äº type t = false</span></span><br><span class="line">type t = isTrue&lt;number&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›¸å½“äº type t = false</span></span><br><span class="line">type t1 = isTrue&lt;<span class="literal">false</span>&gt;</span><br></pre></td></tr></table></figure><h2 id="04-never-amp-Exclude-amp-Omit"><a href="#04-never-amp-Exclude-amp-Omit" class="headerlink" title="04 never &amp; Exclude &amp; Omit"></a>04 never &amp; Exclude &amp; Omit</h2><p>å®˜æ–¹æ–‡æ¡£å¯¹ <code>never</code> çš„æè¿°å¦‚ä¸‹</p><blockquote><p>the never type represents the type of values that never occur.</p></blockquote><p>ç»“åˆ <code>never</code> ä¸ <code>conditional type</code> å¯ä»¥æ¨å‡ºå¾ˆå¤šæœ‰æ„æ€è€Œä¸”å®ç”¨çš„ç±»å‹ï¼Œæ¯”å¦‚ <code>Omit</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">type Exclude&lt;T, U&gt; = T extends U ? never : T;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›¸å½“äº: type A = 'a'</span></span><br><span class="line">type A = Exclude&lt;<span class="string">'x'</span> | <span class="string">'a'</span>, <span class="string">'x'</span> | <span class="string">'y'</span> | <span class="string">'z'</span>&gt;</span><br></pre></td></tr></table></figure><a id="more"></a><p>ç»“åˆ <code>Exclude</code> å¯ä»¥æ¨å‡º <code>Omit</code> çš„å†™æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">type Omit&lt;T, K extends keyof any&gt; = Pick&lt;T, Exclude&lt;keyof T, K&gt;&gt;;</span><br><span class="line"></span><br><span class="line">interface User &#123;</span><br><span class="line">  id: number;</span><br><span class="line">  age: number;</span><br><span class="line">  name: string;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›¸å½“äº: type PickUser = &#123; age: number; name: string; &#125;</span></span><br><span class="line">type OmitUser = Omit&lt;User, <span class="string">"id"</span>&gt;</span><br></pre></td></tr></table></figure><h2 id="05-typeof"><a href="#05-typeof" class="headerlink" title="05 typeof"></a>05 typeof</h2><p>é¡¾åæ€ä¹‰ï¼Œ<code>typeof</code> ä»£è¡¨å–æŸä¸ªå€¼çš„ <code>type</code>ï¼Œå¯ä»¥ä»ä»¥ä¸‹ç¤ºä¾‹æ¥å±•ç¤ºä»–ä»¬çš„ç”¨æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a: number = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›¸å½“äº: const b: number = 4</span></span><br><span class="line"><span class="keyword">const</span> b: <span class="keyword">typeof</span> a = <span class="number">4</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸€ä¸ªå…¸å‹çš„æœåŠ¡ç«¯é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦æŠŠä¸€äº›å·¥å…·å¡åˆ° <code>context</code> ä¸­ï¼Œå¦‚<code>config</code>ï¼Œ<code>logger</code>ï¼Œ<code>db models</code>, <code>utils</code> ç­‰ï¼Œæ­¤æ—¶å°±ä½¿ç”¨åˆ° <code>typeof</code>ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logger <span class="keyword">from</span> <span class="string">'./logger'</span></span><br><span class="line"><span class="keyword">import</span> utils <span class="keyword">from</span> <span class="string">'./utils'</span></span><br><span class="line"></span><br><span class="line">interface Context extends KoaContect &#123;</span><br><span class="line">  logger: <span class="keyword">typeof</span> logger,</span><br><span class="line">  utils: <span class="keyword">typeof</span> utils</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.use(<span class="function">(<span class="params">ctx: Context</span>) =&gt;</span> &#123;</span><br><span class="line">  ctx.logger.info(<span class="string">'hello, world'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¼šæŠ¥é”™ï¼Œå› ä¸º logger.ts ä¸­æ²¡æœ‰æš´éœ²æ­¤æ–¹æ³•ï¼Œå¯ä»¥æœ€å¤§é™åº¦çš„é¿å…æ‹¼å†™é”™è¯¯</span></span><br><span class="line">  ctx.loger.info(<span class="string">'hello, world'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="06-is"><a href="#06-is" class="headerlink" title="06 is"></a>06 is</h2><p>åœ¨æ­¤ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€ä¸ª koa çš„é”™è¯¯å¤„ç†æµç¨‹ï¼Œä»¥ä¸‹æ˜¯å¯¹ error è¿›è¡Œé›†ä¸­å¤„ç†ï¼Œå¹¶ä¸”æ ‡è¯† code çš„è¿‡ç¨‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> next();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="keyword">let</span> code = <span class="string">'BAD_REQUEST'</span></span><br><span class="line">    <span class="keyword">if</span> (err.isAxiosError) &#123;</span><br><span class="line">      code = <span class="string">`Axios-<span class="subst">$&#123;err.code&#125;</span>`</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (err <span class="keyword">instanceof</span> Sequelize.BaseError) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    ctx.body = &#123;</span><br><span class="line">      code</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>åœ¨ <code>err.code</code> å¤„ï¼Œä¼šç¼–è¯‘å‡ºé”™ï¼Œæç¤º Property â€˜codeâ€™ does not exist on type â€˜Errorâ€™.ts(2339)ã€‚</p><p>æ­¤æ—¶å¯ä»¥ä½¿ç”¨ <code>as AxiosError</code> æˆ–è€… <code>as any</code> æ¥é¿å…æŠ¥é”™ï¼Œä¸è¿‡å¼ºåˆ¶ç±»å‹è½¬æ¢ä¹Ÿä¸å¤Ÿå‹å¥½</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((err <span class="keyword">as</span> AxiosError).isAxiosError) &#123;</span><br><span class="line">  code = <span class="string">`Axios-<span class="subst">$&#123;(err <span class="keyword">as</span> AxiosError).code&#125;</span>`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å¯ä»¥ä½¿ç”¨ is æ¥åˆ¤å®šå€¼çš„ç±»å‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isAxiosError</span> (<span class="params">error: any</span>): <span class="title">error</span> <span class="title">is</span> <span class="title">AxiosError</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> error.isAxiosError</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isAxiosError(err)) &#123;</span><br><span class="line">  code = <span class="string">`Axios-<span class="subst">$&#123;err.code&#125;</span>`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>GraphQL</code> çš„æºç ä¸­ï¼Œæœ‰å¾ˆå¤šè¯¸å¦‚æ­¤ç±»çš„ç”¨æ³•ï¼Œç”¨ä»¥æ ‡è¯†ç±»å‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isType</span>(<span class="params">type: any</span>): <span class="title">type</span> <span class="title">is</span> <span class="title">GraphQLType</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">export</span> <span class="title">function</span> <span class="title">isScalarType</span>(<span class="params">type: any</span>): <span class="title">type</span> <span class="title">is</span> <span class="title">GraphQLScalarType</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">export</span> <span class="title">function</span> <span class="title">isObjectType</span>(<span class="params">type: any</span>): <span class="title">type</span> <span class="title">is</span> <span class="title">GraphQLObjectType</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">export</span> <span class="title">function</span> <span class="title">isInterfaceType</span>(<span class="params">type: any</span>): <span class="title">type</span> <span class="title">is</span> <span class="title">GraphQLInterfaceType</span>;</span></span><br></pre></td></tr></table></figure><h2 id="07-interface-amp-type"><a href="#07-interface-amp-type" class="headerlink" title="07 interface &amp; type"></a>07 interface &amp; type</h2><p>interface ä¸ type çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿå¯ä»¥å‚è€ƒä»¥ä¸‹ stackoverflow çš„é—®é¢˜</p><p><a href="https://stackoverflow.com/questions/37233735/typescript-interfaces-vs-types" target="_blank" rel="noopener">https://stackoverflow.com/questions/37233735/typescript-interfaces-vs-types</a></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œ<code>1</code>interface<code>ä¸</code>type` åŒºåˆ«å¾ˆå°ï¼Œæ¯”å¦‚ä»¥ä¸‹ä¸¤ç§å†™æ³•å·®ä¸å¤š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">interface A &#123;</span><br><span class="line">  a: number;</span><br><span class="line">  b: number;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type B &#123;</span><br><span class="line">  a: number;</span><br><span class="line">  b: number;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ interface å¯ä»¥å¦‚ä¸‹åˆå¹¶å¤šä¸ªï¼Œè€Œ type åªèƒ½ä½¿ç”¨ &amp; ç±»è¿›è¡Œè¿æ¥ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">interface A &#123;</span><br><span class="line">    a: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface A &#123;</span><br><span class="line">    b: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a: A = &#123;</span><br><span class="line">    a: <span class="number">3</span>,</span><br><span class="line">    b: <span class="number">4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="08-Dictionary-amp-Many"><a href="#08-Dictionary-amp-Many" class="headerlink" title="08 Dictionary &amp; Many"></a>08 Dictionary &amp; Many</h2><p>è¿™å‡ ä¸ªè¯­æ³•ç³–æ˜¯ä» <code>lodash</code> çš„ <code>types</code> æºç ä¸­å­¦åˆ°çš„ï¼Œå¹³æ—¶å·¥ä½œä¸­çš„ä½¿ç”¨é¢‘ç‡è¿˜æŒºé«˜ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">interface Dictionary&lt;T&gt; &#123;</span><br><span class="line">  [index: string]: T;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">interface NumericDictionary&lt;T&gt; &#123;</span><br><span class="line">  [index: number]: T;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data:Dictionary&lt;number&gt; = &#123;</span><br><span class="line">  a: <span class="number">3</span>,</span><br><span class="line">  b: <span class="number">4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="09-ä½¿ç”¨-const-enum-ç»´æŠ¤å¸¸é‡è¡¨"><a href="#09-ä½¿ç”¨-const-enum-ç»´æŠ¤å¸¸é‡è¡¨" class="headerlink" title="09 ä½¿ç”¨ const enum ç»´æŠ¤å¸¸é‡è¡¨"></a>09 ä½¿ç”¨ const enum ç»´æŠ¤å¸¸é‡è¡¨</h2><p>ç›¸æ¯”ä½¿ç”¨å­—é¢é‡å¯¹è±¡ç»´æŠ¤å¸¸é‡ï¼Œconst enum å¯ä»¥æä¾›æ›´å®‰å…¨çš„ç±»å‹æ£€æŸ¥</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ object ç»´æŠ¤å¸¸é‡</span></span><br><span class="line"><span class="keyword">const</span> enum TODO_STATUS &#123;</span><br><span class="line">    TODO = <span class="string">'TODO'</span>,</span><br><span class="line">    DONE = <span class="string">'DONE'</span>,</span><br><span class="line">    DOING = <span class="string">'DOING'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ const enum ä¼Ÿåå¸¸é‡</span></span><br><span class="line"><span class="keyword">const</span> enum TODO_STATUS &#123;</span><br><span class="line">    TODO = <span class="string">'TODO'</span>,</span><br><span class="line">    DONE = <span class="string">'DONE'</span>,</span><br><span class="line">    DOING = <span class="string">'DOING'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function todos (status: TODO_STATUS): Todo[];</span><br><span class="line"></span><br><span class="line">todos(TODO_STATUS.TODO)</span><br></pre></td></tr></table></figure><h2 id="10-VS-Code-Tips-amp-Typescript-Command"><a href="#10-VS-Code-Tips-amp-Typescript-Command" class="headerlink" title="10 VS Code Tips &amp; Typescript Command"></a>10 VS Code Tips &amp; Typescript Command</h2><p>ä½¿ç”¨ VS Code æœ‰æ—¶ä¼šå‡ºç°ï¼Œä½¿ç”¨ tsc ç¼–è¯‘æ—¶äº§ç”Ÿçš„é—®é¢˜ä¸ vs code æç¤ºçš„é—®é¢˜ä¸ä¸€è‡´</p><p>æ‰¾åˆ°é¡¹ç›®å³ä¸‹è§’çš„ Typescript å­—æ ·ï¼Œå³ä¾§æ˜¾ç¤ºå®ƒçš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥ç‚¹å‡»é€‰æ‹© Use Workspace Versionï¼Œå®ƒè¡¨ç¤ºä¸é¡¹ç›®ä¾èµ–çš„ typescript ç‰ˆæœ¬ä¸€ç›´ã€‚</p><p>æˆ–è€…ç¼–è¾‘ <code>.vs-code/settings.json</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"typescript.tsdk"</span>: <span class="string">"node_modules/typescript/lib"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="11-Typescript-Roadmap"><a href="#11-Typescript-Roadmap" class="headerlink" title="11 Typescript Roadmap"></a>11 Typescript Roadmap</h2><p>æœ€åä¸€æ¡ä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€æ¡ï¼Œç¿»é˜… Roadmapï¼Œäº†è§£ ts çš„ä¸€äº›æ–°çš„ç‰¹æ€§ä¸ bug ä¿®å¤æƒ…å†µã€‚</p><p><a href="https://github.com/Microsoft/TypeScript/wiki/Roadmap" target="_blank" rel="noopener">Typescript Roadmap</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://juejin.im/post/5cffb431f265da1b7401f466?utm_source=gold_browser_extension&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;ç”¨äº†ä¸€æ®µæ—¶é—´çš„ typescript ä¹‹åï¼Œæ·±æ„Ÿä¸­å¤§å‹é¡¹ç›®ä¸­ typescript çš„å¿…è¦æ€§ï¼Œå®ƒèƒ½å¤Ÿæå‰åœ¨ç¼–è¯‘æœŸé¿å…è®¸å¤š bugï¼Œå¦‚å¾ˆæ¶å¿ƒçš„æ‹¼å†™é—®é¢˜ã€‚è€Œè¶Šæ¥è¶Šå¤šçš„ package ä¹Ÿå¼€å§‹ä½¿ç”¨ tsï¼Œå­¦ä¹  ts å·²æ˜¯åŠ¿åœ¨å¿…è¡Œã€‚&lt;/p&gt;
&lt;h2 id=&quot;01-keyof&quot;&gt;&lt;a href=&quot;#01-keyof&quot; class=&quot;headerlink&quot; title=&quot;01 keyof&quot;&gt;&lt;/a&gt;01 keyof&lt;/h2&gt;&lt;p&gt;&lt;code&gt;keyof&lt;/code&gt; ä¸ &lt;code&gt;Object.keys&lt;/code&gt; ç•¥æœ‰ç›¸ä¼¼ï¼Œåªä¸è¿‡ &lt;code&gt;keyof&lt;/code&gt; å– &lt;code&gt;interface&lt;/code&gt; çš„é”®ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;interface Point &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    x: number;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    y: number;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// type keys = &quot;x&quot; | &quot;y&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;type keys = keyof Point;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å‡è®¾æœ‰ä¸€ä¸ª &lt;code&gt;object&lt;/code&gt; å¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ typescript å®ç°ä¸€ä¸ª get å‡½æ•°æ¥è·å–å®ƒçš„å±æ€§å€¼&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; data = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  a: &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  hello: &lt;span class=&quot;string&quot;&gt;&#39;world&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;get&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;o: object, name: string&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; o[name]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘ä»¬åˆšå¼€å§‹å¯èƒ½ä¼šè¿™ä¹ˆå†™ï¼Œä¸è¿‡å®ƒæœ‰å¾ˆå¤šç¼ºç‚¹&lt;br&gt;1.æ— æ³•ç¡®è®¤è¿”å›ç±»å‹ï¼šè¿™å°†æŸå¤± ts æœ€å¤§çš„ç±»å‹æ ¡éªŒåŠŸèƒ½&lt;br&gt;2.æ— æ³•å¯¹ key åšçº¦æŸï¼šå¯èƒ½ä¼šçŠ¯æ‹¼å†™é”™è¯¯çš„é—®é¢˜&lt;/p&gt;
&lt;p&gt;è¿™æ—¶å¯ä»¥ä½¿ç”¨ &lt;code&gt;keyof&lt;/code&gt; æ¥åŠ å¼º &lt;code&gt;get&lt;/code&gt; å‡½æ•°çš„ç±»å‹åŠŸèƒ½ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥çœ‹çœ‹ &lt;code&gt;_.get&lt;/code&gt; çš„ &lt;code&gt;type&lt;/code&gt; æ ‡è®°ä»¥åŠå®ç°&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;function get&amp;lt;T extends object, K extends keyof T&amp;gt;(o: T, name: K): T[K] &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; o[name]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;02-Partial-amp-Pick&quot;&gt;&lt;a href=&quot;#02-Partial-amp-Pick&quot; class=&quot;headerlink&quot; title=&quot;02 Partial &amp;amp; Pick&quot;&gt;&lt;/a&gt;02 Partial &amp;amp; Pick&lt;/h2&gt;&lt;p&gt;æ—¢ç„¶äº†è§£äº† &lt;code&gt;keyof&lt;/code&gt;ï¼Œå¯ä»¥ä½¿ç”¨å®ƒå¯¹å±æ€§åšä¸€äº›æ‰©å±•ï¼Œ å¦‚å®ç° &lt;code&gt;Partial&lt;/code&gt; å’Œ &lt;code&gt;Pick&lt;/code&gt;ï¼Œ&lt;code&gt;Pick&lt;/code&gt; ä¸€èˆ¬ç”¨åœ¨ &lt;code&gt;_.pick&lt;/code&gt; ä¸­&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;type Partial&amp;lt;T&amp;gt; = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [P &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; keyof T]?: T[P];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;type Pick&amp;lt;T, K extends keyof T&amp;gt; = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [P &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; K]: T[P];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;interface User &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  id: number;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  age: number;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  name: string;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ç›¸å½“äº: type PartialUser = &amp;#123; id?: number; age?: number; name?: string; &amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;type PartialUser = Partial&amp;lt;User&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ç›¸å½“äº: type PickUser = &amp;#123; id: number; age: number; &amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;type PickUser = Pick&amp;lt;User, &lt;span class=&quot;string&quot;&gt;&quot;id&quot;&lt;/span&gt; | &lt;span class=&quot;string&quot;&gt;&quot;age&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;03-Condition-Type&quot;&gt;&lt;a href=&quot;#03-Condition-Type&quot; class=&quot;headerlink&quot; title=&quot;03 Condition Type&quot;&gt;&lt;/a&gt;03 Condition Type&lt;/h2&gt;&lt;p&gt;ç±»ä¼¼äº js ä¸­çš„ &lt;code&gt;?:&lt;/code&gt; è¿ç®—ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ‰©å±•ä¸€äº›åŸºæœ¬ç±»å‹&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;T extends U ? X : Y&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;type isTrue&amp;lt;T&amp;gt; = T extends &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt; ? &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ç›¸å½“äº type t = false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;type t = isTrue&amp;lt;number&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ç›¸å½“äº type t = false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;type t1 = isTrue&amp;lt;&lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;04-never-amp-Exclude-amp-Omit&quot;&gt;&lt;a href=&quot;#04-never-amp-Exclude-amp-Omit&quot; class=&quot;headerlink&quot; title=&quot;04 never &amp;amp; Exclude &amp;amp; Omit&quot;&gt;&lt;/a&gt;04 never &amp;amp; Exclude &amp;amp; Omit&lt;/h2&gt;&lt;p&gt;å®˜æ–¹æ–‡æ¡£å¯¹ &lt;code&gt;never&lt;/code&gt; çš„æè¿°å¦‚ä¸‹&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;the never type represents the type of values that never occur.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç»“åˆ &lt;code&gt;never&lt;/code&gt; ä¸ &lt;code&gt;conditional type&lt;/code&gt; å¯ä»¥æ¨å‡ºå¾ˆå¤šæœ‰æ„æ€è€Œä¸”å®ç”¨çš„ç±»å‹ï¼Œæ¯”å¦‚ &lt;code&gt;Omit&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;type Exclude&amp;lt;T, U&amp;gt; = T extends U ? never : T;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ç›¸å½“äº: type A = &#39;a&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;type A = Exclude&amp;lt;&lt;span class=&quot;string&quot;&gt;&#39;x&#39;&lt;/span&gt; | &lt;span class=&quot;string&quot;&gt;&#39;a&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;x&#39;&lt;/span&gt; | &lt;span class=&quot;string&quot;&gt;&#39;y&#39;&lt;/span&gt; | &lt;span class=&quot;string&quot;&gt;&#39;z&#39;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Js" scheme="https://zhanghao-web.github.io/categories/Js/"/>
    
    
      <category term="Ts" scheme="https://zhanghao-web.github.io/tags/Ts/"/>
    
  </entry>
  
  <entry>
    <title>Nodeå­¦ä¹ (åå››) --Nodeé¡¹ç›®-å•†å“åˆ—è¡¨</title>
    <link href="https://zhanghao-web.github.io/2019/05/25/Node/Node%E5%AD%A6%E4%B9%A0(%E5%8D%81%E5%9B%9B)%20--Node%E9%A1%B9%E7%9B%AE-%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8/"/>
    <id>https://zhanghao-web.github.io/2019/05/25/Node/Nodeå­¦ä¹ (åå››) --Nodeé¡¹ç›®-å•†å“åˆ—è¡¨/</id>
    <published>2019-05-25T09:23:20.000Z</published>
    <updated>2020-01-28T10:04:15.048Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Node-jsé¡¹ç›®ä»‹ç»"><a href="#Node-jsé¡¹ç›®ä»‹ç»" class="headerlink" title="Node.jsé¡¹ç›®ä»‹ç»"></a>Node.jsé¡¹ç›®ä»‹ç»</h1><p>åˆ©ç”¨å­¦åˆ°çš„çŸ¥è¯†ï¼Œå®ç°ä¸€ä¸ªç®€å•ä½†å®ç”¨çš„å°é¡¹ç›®å¦‚ä¸‹ï¼š</p><p>è¿™æ˜¯ä¸€ä¸ªå•†å“åˆ—è¡¨ï¼Œå…·æœ‰å±•ç¤ºå•†å“ä¿¡æ¯ï¼Œæ·»åŠ å•†å“ï¼Œåˆ é™¤å•†å“çš„åŠŸèƒ½ã€‚</p><h2 id="é¡¹ç›®çš„æ–‡ä»¶å¤¹ç»“æ„"><a href="#é¡¹ç›®çš„æ–‡ä»¶å¤¹ç»“æ„" class="headerlink" title="é¡¹ç›®çš„æ–‡ä»¶å¤¹ç»“æ„"></a>é¡¹ç›®çš„æ–‡ä»¶å¤¹ç»“æ„</h2><p>â”œâ”€â”€ package.json<br>â”œâ”€â”€ server.js # æœåŠ¡å™¨ä»£ç <br>â”œâ”€â”€ config # é¡¹ç›®é…ç½®æ–‡ä»¶å¤¹<br>â”‚     â”œâ”€â”€ config.dev.js # å¼€å‘ç¯å¢ƒé…ç½®<br>â”‚     â”œâ”€â”€ config.prod.js # ç”Ÿäº§ç¯å¢ƒé…ç½®<br>â”‚     â”œâ”€â”€ index.js # å¯¼å‡ºå½“å‰æ‰€å¤„ç¯å¢ƒåŠé…ç½®<br>â”œâ”€â”€ libs # é¡¹ç›®å·¥å…·æ–‡ä»¶å¤¹<br>â”‚     â”œâ”€â”€ database.js # è¿æ¥æ•°æ®åº“<br>â”‚     â”œâ”€â”€ http.js # æœåŠ¡å™¨é…ç½®<br>â”‚     â”œâ”€â”€ router.js # å¤„ç†è·¯ç”±<br>â”œâ”€â”€ router # é¡¹ç›®è·¯ç”±é…ç½®æ–‡ä»¶å¤¹<br>â”‚     â”œâ”€â”€ index.js # è¿æ¥æ•°æ®åº“<br>â”‚     â”œâ”€â”€ list.js # è·å–å•†å“åˆ—è¡¨æ¥å£é…ç½®<br>â”‚     â”œâ”€â”€ add.js # å¢åŠ å•†å“æ¥å£é…ç½®<br>â”‚     â”œâ”€â”€ del.js # åˆ é™¤å•†å“æ¥å£é…ç½®<br>â”œâ”€â”€ static # é™æ€èµ„æºæ–‡ä»¶å¤¹<br>â”‚     â”œâ”€â”€ index.html # å‰ç«¯HTMLé¡µé¢<br>â”‚     â”œâ”€â”€ js # å‰ç«¯JavaScriptæ–‡ä»¶å¤¹<br>â”‚     â”œâ”€â”€ css # å‰ç«¯CSSæ–‡ä»¶å¤¹<br>â”‚     â”œâ”€â”€ fonts # å‰ç«¯å­—ä½“æ–‡ä»¶å¤¹<br>â”‚     â”œâ”€â”€ upload # å‰ç«¯ä¸Šä¼ æ–‡ä»¶å¤¹</p><h2 id="åˆ¤æ–­å½“å‰æ‰€å¤„ç¯å¢ƒ"><a href="#åˆ¤æ–­å½“å‰æ‰€å¤„ç¯å¢ƒ" class="headerlink" title="åˆ¤æ–­å½“å‰æ‰€å¤„ç¯å¢ƒ"></a>åˆ¤æ–­å½“å‰æ‰€å¤„ç¯å¢ƒ</h2><p>é€šå¸¸é¡¹ç›®åœ¨å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒè¦é‡‡ç”¨ä¸åŒçš„ï¼ŒæœåŠ¡å™¨ã€è´¦å·ã€åŸŸåã€ç«¯å£ç­‰é…ç½®ï¼Œå¦‚æœç”¨äººå·¥è¿›è¡Œåˆ‡æ¢æ“ä½œéº»çƒ¦ä¸”å®¹æ˜“å‡ºé”™ï¼Œå› æ­¤é€šå¸¸ä½¿ç”¨ç¯å¢ƒå˜é‡è¿›è¡Œåˆ¤æ–­ã€‚</p><p>é¦–å…ˆå¼•å…¥processæ¨¡å—<code>const process=require(&#39;process&#39;)</code>ï¼Œè¯¥æ¨¡å—æä¾›äº†å½“å‰Node.jsè¿›ç¨‹çš„ä¿¡æ¯ã€‚</p><p>1.å¯ä»¥é€šè¿‡process.envç¯å¢ƒå˜é‡è·å–å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒç³»ç»Ÿç­‰å‚æ•°å·®å¼‚ï¼Œå¦‚å¼€å‘ç¯å¢ƒè¿è¡Œåœ¨Windowsç³»ç»Ÿä¸Šï¼Œè€Œç”Ÿäº§ç¯å¢ƒè¿è¡Œåœ¨Linuxç³»ç»Ÿï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨<code>process.env.OS === &#39;Windows_NT&#39;</code>åˆ¤æ–­å½“å‰æ‰€å¤„çš„æ˜¯å¦å¼€å‘ç¯å¢ƒã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mode = process.env.OS === <span class="string">'Windows_NT'</span> ? <span class="string">'env'</span> : <span class="string">'prod'</span></span><br></pre></td></tr></table></figure><p>2.ä¹Ÿå¯ä»¥é€šè¿‡package.jsonä¸­é…ç½®çš„å¯åŠ¨å‘½ä»¤åˆ¤æ–­å¤„äºå¼€å‘è¿˜æ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œå¦‚å¼€å‘ç¯å¢ƒå‘½ä»¤<code>npm start --dev</code>å’Œç”Ÿäº§ç¯å¢ƒå‘½ä»¤<code>npm run build --build</code>ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mode = process.argv[<span class="number">2</span>] === <span class="string">'--dev'</span> ? <span class="string">'env'</span> : <span class="string">'prod'</span></span><br></pre></td></tr></table></figure><h2 id="åˆå§‹åŒ–å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒé…ç½®"><a href="#åˆå§‹åŒ–å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒé…ç½®" class="headerlink" title="åˆå§‹åŒ–å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒé…ç½®"></a>åˆå§‹åŒ–å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒé…ç½®</h2><p>åœ¨/config/index.jsä¸­ï¼Œåˆ¤æ–­æ‰€å¤„çš„ç¯å¢ƒï¼Œå¹¶å°†ç›¸åº”ç¯å¢ƒçš„æ ‡è¯†å’Œå‚æ•°ä½œä¸ºæ¨¡å—å¯¼å‡ºã€‚å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ç›´æ¥å¼•ç”¨ç›¸åº”çš„é…ç½®ä½¿ç”¨ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> process = <span class="built_in">require</span>(<span class="string">'process'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ä»¥é€šè¿‡å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒç³»ç»Ÿç­‰å‚æ•°å·®å¼‚ï¼Œåˆ¤æ–­å¤„äºå“ªä¸ªç¯å¢ƒã€‚</span></span><br><span class="line"><span class="comment">// const mode = process.env.OS === 'Windows_NT' ? 'env' : 'prod'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥é€šè¿‡package.jsonä¸­é…ç½®çš„å¯åŠ¨å‘½ä»¤åˆ¤æ–­å¤„äºå¼€å‘è¿˜æ˜¯ç”Ÿäº§ç¯å¢ƒã€‚</span></span><br><span class="line"><span class="keyword">const</span> mode = process.argv[<span class="number">2</span>] === <span class="string">'--dev'</span> ? <span class="string">'env'</span> : <span class="string">'prod'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode, <span class="comment">// å½“å‰æ‰€å¤„ç¯å¢ƒ</span></span><br><span class="line">  ...(mode === <span class="string">'env'</span> ? <span class="built_in">require</span>(<span class="string">'./config.dev'</span>) : <span class="built_in">require</span>(<span class="string">'./config.prod'</span>))  <span class="comment">// å½“å‰ç¯å¢ƒçš„é…ç½®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1.ä»¥å¼€å‘ç¯å¢ƒä¸ºä¾‹ï¼Œéœ€è¦ä½¿ç”¨çš„é…ç½®ä¸ºæœåŠ¡å™¨åŸŸåã€ç«¯å£å·ã€è´¦å·ã€å¯†ç ã€æ•°æ®åº“åï¼Œä»¥åŠHTTPç«¯å£ã€é™æ€æ–‡ä»¶ç»å¯¹è·¯å¾„ã€ä¸Šä¼ æ–‡ä»¶ä¿å­˜ç»å¯¹è·¯å¾„ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// æ•°æ®åº“é…ç½®</span></span><br><span class="line">  DB_HOST: <span class="string">'localhost'</span>,</span><br><span class="line">  DB_PORT: <span class="number">3306</span>,</span><br><span class="line">  DB_USER: <span class="string">'root'</span>,</span><br><span class="line">  DB_PASS: <span class="string">''</span>,</span><br><span class="line">  DB_NAME: <span class="string">'test'</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// HTTPç«¯å£</span></span><br><span class="line">  HTTP_PORT: <span class="number">8080</span>,</span><br><span class="line">  <span class="comment">// é™æ€æ–‡ä»¶ç»å¯¹è·¯å¾„</span></span><br><span class="line">  HTTP_ROOT: path.resolve(__dirname, <span class="string">'../static/'</span>),</span><br><span class="line">  <span class="comment">// ä¸Šä¼ æ–‡ä»¶ä¿å­˜ç»å¯¹è·¯å¾„</span></span><br><span class="line">  HTTP_UPLOAD: path.resolve(__dirname, <span class="string">'../static/upload'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è¿æ¥æ•°æ®åº“"><a href="#è¿æ¥æ•°æ®åº“" class="headerlink" title="è¿æ¥æ•°æ®åº“"></a>è¿æ¥æ•°æ®åº“</h2><p>åœ¨libæ–‡ä»¶å¤¹ä¸‹ï¼Œåˆ›å»ºdatabase.jsï¼Œç”¨äºè¿æ¥æ•°æ®åº“ã€‚</p><a id="more"></a><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥mysqlå’Œco-mysqlï¼Œç”¨äºè¿æ¥æ•°æ®åº“</span></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>)</span><br><span class="line"><span class="keyword">const</span> coMysql = <span class="built_in">require</span>(<span class="string">'co-mysql'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•å…¥æ•°æ®åº“é…ç½®</span></span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  DB_HOST,</span><br><span class="line">  DB_PORT,</span><br><span class="line">  DB_USER,</span><br><span class="line">  DB_PASS,</span><br><span class="line">  DB_NAME</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">'../config'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. åˆ›å»ºæœåŠ¡å™¨è¿æ¥æ± </span></span><br><span class="line"><span class="keyword">const</span> pool = mysql.createPool(&#123;</span><br><span class="line">  host: DB_HOST,</span><br><span class="line">  port: DB_PORT,</span><br><span class="line">  user: DB_USER,</span><br><span class="line">  password: DB_PASS,</span><br><span class="line">  database: DB_NAME</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ä½¿ç”¨co-mysqlåŒ…è£…è¿æ¥æ± ï¼Œå°†è¿æ¥è½¬æ¢ä¸ºAsync/Awaitå¼‚æ­¥æ–¹å¼</span></span><br><span class="line"><span class="keyword">const</span> connection = coMysql(pool)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. ä½œä¸ºæ¨¡å—å¯¼å‡ºä½¿ç”¨</span></span><br><span class="line"><span class="built_in">module</span>.exports = connection</span><br></pre></td></tr></table></figure><p>åˆ›å»ºæ•°æ®åº“è¿æ¥åï¼Œå¯ä»¥åœ¨server.jsä¸­ï¼Œåˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼Œå¹¶æŸ¥çœ‹item_tableè¡¨çš„æ•°æ®</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> connection = <span class="built_in">require</span>(<span class="string">'./lib/database'</span>)</span><br><span class="line"></span><br><span class="line">;<span class="function">(<span class="params"><span class="keyword">async</span> (</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æŸ¥è¯¢item_tableè¡¨ä¸­çš„æ•°æ®</span></span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> connection.query(<span class="string">`SELECT * FROM item_table`</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(response)</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure><p>è‹¥æ­£å¸¸è¿æ¥ï¼Œå³å¯æ‰“å°æ•°æ®å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ RowDataPacket &#123; <span class="attr">ID</span>: <span class="number">1</span>, <span class="attr">title</span>: <span class="string">'è¿åŠ¨æœ'</span>, <span class="attr">price</span>: <span class="number">299</span>, <span class="attr">count</span>: <span class="number">998</span> &#125; ]ice: <span class="number">199</span>, <span class="attr">count</span>: <span class="number">999</span> &#125;,</span><br><span class="line">  RowDataPacket &#123; <span class="attr">ID</span>: <span class="number">2</span>, <span class="attr">title</span>: <span class="string">'è¿åŠ¨è£¤'</span>, <span class="attr">price</span>: <span class="number">299</span>, <span class="attr">count</span>: <span class="number">998</span> &#125; ]</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºè·¯ç”±"><a href="#åˆ›å»ºè·¯ç”±" class="headerlink" title="åˆ›å»ºè·¯ç”±"></a>åˆ›å»ºè·¯ç”±</h2><p>åœ¨ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ€»æ˜¯è¦é€šè¿‡if elseè¯­å¥æ¥åˆ¤æ–­è¯·æ±‚çš„æ¥å£è·¯å¾„ï¼Œå¹¶è¿›è¡Œç›¸åº”æ“ä½œã€‚</p><p>è¿™æ ·ä¼šæå¤§åœ°é™ä½å¼€å‘æ•ˆç‡ï¼Œä¹Ÿä¸åˆ©äºåæœŸä»£ç ç»´æŠ¤ã€‚</p><p>å› æ­¤ï¼Œé€šå¸¸çš„å¼€å‘ä¸­ï¼Œéƒ½ä¼šä½¿ç”¨è·¯ç”±å¯¹ä¸åŒçš„æ¥å£è¿›è¡Œæ“ä½œã€‚</p><p>ç°åœ¨æˆ‘ä»¬å°±æ¥è‡ªå·±å®ç°ä¸€ä¸ªç®€å•çš„è·¯ç”±ï¼š</p><p><strong>1.å…ˆåˆ›å»ºä¸€ä¸ªrouterå¯¹è±¡ï¼Œç”¨äºå­˜å‚¨è·¯ç”±è¡¨ã€‚å…¶ä¸­æœ‰2ä¸ªå±æ€§ï¼Œåˆ†åˆ«ä¸ºgetã€postï¼Œåˆ†åˆ«ç”¨äºå­˜å‚¨ç›¸åº”getã€postè¯·æ±‚åœ°å€çš„å›è°ƒæ–¹æ³•</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºè·¯ç”±è¡¨</span></span><br><span class="line"><span class="keyword">let</span> router = &#123;</span><br><span class="line">  <span class="comment">// å­˜å‚¨getè¯·æ±‚çš„è·¯ç”±</span></span><br><span class="line">  <span class="keyword">get</span>: &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// å­˜å‚¨postè¯·æ±‚çš„è·¯ç”±</span></span><br><span class="line">  post: &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2. åˆ›å»ºä¸€ä¸ªaddRouteræ–¹æ³•ï¼Œç”¨äºæ·»åŠ è·¯ç”±é…ç½®ï¼Œå‚æ•°methodä¸ºè¯·æ±‚æ–¹æ³•ï¼Œurlä¸ºè¯·æ±‚åœ°å€ï¼Œcallbackä¸ºå¤„ç†è¯¥è¯·æ±‚çš„å›è°ƒå‡½æ•°ã€‚</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ·»åŠ è·¯ç”±çš„æ–¹æ³•ï¼Œmethodä¸ºè¯·æ±‚æ–¹æ³•ï¼Œurlä¸ºè¯·æ±‚åœ°å€ï¼Œcallbackä¸ºå¤„ç†è¯¥è¯·æ±‚çš„å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addRouter</span>(<span class="params">method, url, callback</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ä¸ºä¾¿äºå¤„ç†ï¼Œå°†methodå’Œurlç»Ÿä¸€è½¬æ¢æˆå°å†™</span></span><br><span class="line">  method = method.toLowerCase()</span><br><span class="line">  url = url.toLowerCase()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†å¤„ç†è¯·æ±‚çš„å›è°ƒå‡½æ•°ï¼ŒæŒ‰æ–¹æ³•åå’Œåœ°å€å‚¨å­˜åˆ°è·¯ç”±è¡¨ä¸­</span></span><br><span class="line">  router[method][url] = callback</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3. åˆ›å»ºä¸€ä¸ªfindRouteræ–¹æ³•ï¼Œç”¨äºæŸ¥æ‰¾ç›¸åº”è·¯ç”±çš„å›è°ƒå‡½æ•°ã€‚å‚æ•°methodä¸ºè¯·æ±‚æ–¹æ³•ï¼Œurlä¸ºè¯·æ±‚åœ°å€ï¼Œè¿”å›å¤„ç†è·¯ç”±çš„å›è°ƒå‡½æ•°ã€‚</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŸ¥æ‰¾å¤„ç†è¯·æ±‚çš„å›è°ƒå‡½æ•°çš„æ–¹æ³•ï¼Œmethodä¸ºè¯·æ±‚æ–¹æ³•ï¼Œurlä¸ºè¯·æ±‚åœ°å€ï¼Œè¿”å›å¤„ç†è·¯ç”±çš„å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">findRouter</span>(<span class="params">method, url</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ä¸ºä¾¿äºå¤„ç†ï¼Œå°†methodå’Œurlç»Ÿä¸€è½¬æ¢æˆå°å†™</span></span><br><span class="line">  method = method.toLowerCase()</span><br><span class="line">  url = url.toLowerCase()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ‰¾åˆ°è·¯ç”±å¯¹åº”çš„å›è°ƒå‡½æ•°ï¼Œä¸å­˜åœ¨åˆ™é»˜è®¤è¿”å›null</span></span><br><span class="line">  <span class="keyword">const</span> callback = router[method][url] || <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†å›è°ƒå‡½æ•°è¿”å›</span></span><br><span class="line">  <span class="keyword">return</span> callback</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>4. å°†è·¯ç”±é…ç½®ä½œä¸ºæ¨¡å—å¯¼å‡º</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†æ·»åŠ è·¯ç”±å’ŒæŸ¥æ‰¾è·¯ç”±æ–¹æ³•å¯¼å‡º</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  addRouter,</span><br><span class="line">  findRouter</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºæœåŠ¡å™¨"><a href="#åˆ›å»ºæœåŠ¡å™¨" class="headerlink" title="åˆ›å»ºæœåŠ¡å™¨"></a>åˆ›å»ºæœåŠ¡å™¨</h2><p>åœ¨å®ç°äº†è·¯ç”±ä¹‹åï¼Œå°±å¯ä»¥ä»¥æ­¤ä¸ºåŸºç¡€å®ç°æœåŠ¡å™¨äº†ã€‚</p><p>å®ç°æœåŠ¡å™¨åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><p>1.å¼•å…¥æ‰€éœ€Node.jsæ¨¡å—ã€æœåŠ¡å™¨é…ç½®ã€è·¯ç”±æ¨¡å—<br>2.å°è£…ç»Ÿä¸€å¤„ç†è¯·æ±‚æ•°æ®çš„æ–¹æ³•<br>3.æ¥æ”¶åˆ°çš„è¯·æ±‚åˆ†ä¸ºPOSTè¯·æ±‚ã€GETè¯·æ±‚ï¼ŒåŒºåˆ†å¹¶è¿›è¡Œå¤„ç†<br>4.POSTè¯·æ±‚åˆ†ä¸ºæ•°æ®è¯·æ±‚ã€æ–‡ä»¶ä¸Šä¼ è¯·æ±‚ï¼ŒåŒºåˆ†å¹¶è¿›è¡Œå¤„ç†<br>5.GETè¯·æ±‚åˆ†ä¸ºæ•°æ®è¯·æ±‚ã€è¯»å–æ–‡ä»¶è¯·æ±‚ï¼ŒåŒºåˆ†å¹¶è¿›è¡Œå¤„ç†</p><p>æ¥ä¸‹æ¥ï¼ŒæŒ‰æ­¥éª¤å®ç°æ¯éƒ¨åˆ†ä»£ç ã€‚</p><p><strong>1. å¼•å…¥æ‰€éœ€Node.jsæ¨¡å—ã€æœåŠ¡å™¨é…ç½®ã€è·¯ç”±æ¨¡å—</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥åˆ›å»ºæœåŠ¡å™¨æ‰€éœ€çš„æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>)</span><br><span class="line"><span class="keyword">const</span> zlib = <span class="built_in">require</span>(<span class="string">'zlib'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; Form &#125; = <span class="built_in">require</span>(<span class="string">'multiparty'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•å…¥æœåŠ¡å™¨é…ç½®</span></span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  HTTP_PORT,</span><br><span class="line">  HTTP_ROOT,</span><br><span class="line">  HTTP_UPLOAD</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">'../config'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•å…¥è·¯ç”±æ¨¡å—çš„æŸ¥æ‰¾è·¯ç”±æ–¹æ³•</span></span><br><span class="line"><span class="keyword">const</span> &#123; findRouter &#125; = <span class="built_in">require</span>(<span class="string">'./router'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æœåŠ¡å™¨ä»£ç </span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬é…ç½®çš„ç«¯å£</span></span><br><span class="line">server.listen(HTTP_PORT)</span><br><span class="line"><span class="comment">// æ‰“å°åˆ›å»ºæœåŠ¡å™¨æˆåŠŸä¿¡æ¯</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`Server started at <span class="subst">$&#123;HTTP_PORT&#125;</span>`</span>)</span><br></pre></td></tr></table></figure><p><strong>2. å°è£…ç»Ÿä¸€å¤„ç†è¯·æ±‚æ•°æ®çš„æ–¹æ³•</strong></p><p>è¦å¤„ç†æ‰€æœ‰è¯·æ±‚æ¥å£ï¼Œéœ€è¦çš„å‚æ•°ä¸ºmethodï¼ˆè¯·æ±‚æ–¹æ³•ï¼‰ã€pathnameï¼ˆè¯·æ±‚æ¥å£è·¯å¾„ï¼‰ã€queryï¼ˆqueryæ•°æ®ï¼‰ã€postï¼ˆpostæ•°æ®ï¼‰ã€filesï¼ˆæ–‡ä»¶æ•°æ®ï¼‰ã€‚</p><p>é¦–å…ˆï¼Œæ ¹æ®methodï¼ˆè¯·æ±‚æ–¹æ³•ï¼‰ã€pathnameï¼ˆè¯·æ±‚æ¥å£è·¯å¾„ï¼‰ï¼Œè·å–åœ¨è·¯ç”±é…ç½®æ—¶ï¼Œå·²ç»é…ç½®å¥½çš„ç›¸åº”æ¥å£çš„å›è°ƒå‡½æ•°ã€‚<br>å…¶æ¬¡ï¼Œè‹¥å›è°ƒå‡½æ•°å­˜åœ¨ï¼Œåˆ™ç›´æ¥å°†å‚æ•°ä¼ å…¥å›è°ƒå‡½æ•°å¤„ç†ã€‚<br>æœ€åï¼Œè‹¥å›è°ƒå‡½æ•°ä¸å­˜åœ¨ï¼Œåˆ™é»˜è®¤ä¸ºè¯·æ±‚ä¸€ä¸ªé™æ€æ–‡ä»¶ï¼Œå³å¯å°†æ–‡ä»¶è¯»å–ä¹‹åå‘é€ç»™å‰ç«¯ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥åˆ›å»ºæœåŠ¡å™¨æ‰€éœ€çš„æ¨¡å—</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•å…¥æœåŠ¡å™¨é…ç½®</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•å…¥è·¯ç”±æ¨¡å—çš„æŸ¥æ‰¾è·¯ç”±æ–¹æ³•</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// é€šè¿‡è·¯ç”±å¤„ç†è¯·æ±‚æ•°æ®çš„å…¬å…±æ–¹æ³•</span></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">processData</span>(<span class="params">method, pathname, query, post, files</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> callback = findRouter(method, pathname)  <span class="comment">// è·å–å¤„ç†è¯·æ±‚çš„å›è°ƒå‡½æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è‹¥å›è°ƒå‡½æ•°å­˜åœ¨ï¼Œåˆ™è¡¨ç¤ºè·¯ç”±æœ‰é…ç½®ç›¸åº”çš„æ•°æ®å¤„ç†ï¼Œå³è¯¥è¯·æ±‚ä¸æ˜¯è·å–é™æ€æ–‡ä»¶ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// æ ¹æ®è·¯ç”±å¤„ç†æ¥å£æ•°æ®</span></span><br><span class="line">        <span class="keyword">await</span> callback(res, query, post, files)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="comment">// å‡ºç°é”™è¯¯çš„å¤„ç†</span></span><br><span class="line">        res.writeHead(<span class="number">500</span>)</span><br><span class="line">        res.write(<span class="string">'Internal Server Error'</span>)</span><br><span class="line">        res.end()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// è‹¥å›è°ƒå‡½æ•°ä¸å­˜åœ¨ï¼Œåˆ™è¡¨ç¤ºè¯¥è¯·æ±‚ä¸ºè¯·æ±‚ä¸€ä¸ªé™æ€æ–‡ä»¶ï¼Œå¦‚htmlã€cssã€jsç­‰</span></span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬é…ç½®çš„ç«¯å£</span></span><br><span class="line">server.listen(HTTP_PORT)</span><br><span class="line"><span class="comment">// æ‰“å°åˆ›å»ºæœåŠ¡å™¨æˆåŠŸä¿¡æ¯</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`Server started at <span class="subst">$&#123;HTTP_PORT&#125;</span>`</span>)</span><br></pre></td></tr></table></figure><p><strong>3. æ¥æ”¶åˆ°çš„è¯·æ±‚åˆ†ä¸ºPOSTè¯·æ±‚ã€GETè¯·æ±‚ï¼ŒåŒºåˆ†å¹¶è¿›è¡Œå¤„ç†</strong></p><p>æ ¹æ®è¯·æ±‚çš„methodï¼Œå°†è¯·æ±‚åˆ†ä¸ºPOSTè¯·æ±‚ã€GETè¯·æ±‚ã€‚</p><p>è‹¥ä¸ºPOSTè¯·æ±‚ï¼Œåˆ™éœ€è¦è¿›ä¸€æ­¥åˆ¤æ–­æ˜¯æ™®é€šæ•°æ®è¯·æ±‚ï¼Œè¿˜æ˜¯æ–‡ä»¶è¯·æ±‚ï¼Œå¹¶åˆ†åˆ«è¿›è¡Œå¤„ç†ã€‚</p><p>è€ŒGETè¯·æ±‚ï¼Œåªéœ€è¦å°†æ•°æ®ä¼ å…¥processDataæ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œåœ¨processDataæ–¹æ³•ä¸­ï¼ŒåŒºåˆ†GETè¯·æ±‚è·å–æ•°æ®ï¼Œè¿˜æ˜¯è·å–é™æ€æ–‡ä»¶ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥åˆ›å»ºæœåŠ¡å™¨æ‰€éœ€çš„æ¨¡å—</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•å…¥æœåŠ¡å™¨é…ç½®</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•å…¥è·¯ç”±æ¨¡å—çš„æŸ¥æ‰¾è·¯ç”±æ–¹æ³•</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è§£æè¯·æ±‚æ•°æ®</span></span><br><span class="line">  <span class="comment">// è·å–è¯·æ±‚è·¯å¾„åŠqueryæ•°æ®</span></span><br><span class="line">  <span class="keyword">const</span> method = req.method</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    pathname,</span><br><span class="line">    query</span><br><span class="line">  &#125; = url.parse(req.url, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†POSTè¯·æ±‚</span></span><br><span class="line">  <span class="keyword">if</span> (method === <span class="string">'POST'</span>) &#123;</span><br><span class="line">    <span class="comment">// POSTè¯·æ±‚åˆ†ä¸ºæ•°æ®è¯·æ±‚ã€æ–‡ä»¶ä¸Šä¼ è¯·æ±‚ï¼ŒåŒºåˆ†å¹¶è¿›è¡Œå¤„ç†</span></span><br><span class="line">    ...</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;  <span class="comment">// å¤„ç†GETè¯·æ±‚</span></span><br><span class="line">    <span class="comment">// é€šè¿‡è·¯ç”±å¤„ç†æ•°æ®ï¼Œå› ä¸ºæ­¤æ—¶æ˜¯GETè¯·æ±‚ï¼Œåªæœ‰queryæ•°æ®</span></span><br><span class="line">    processData(method, url, query, &#123;&#125;, &#123;&#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é€šè¿‡è·¯ç”±å¤„ç†è¯·æ±‚æ•°æ®çš„å…¬å…±æ–¹æ³•</span></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">processData</span>(<span class="params">method, pathname, query, post, files</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬é…ç½®çš„ç«¯å£</span></span><br><span class="line">server.listen(HTTP_PORT)</span><br><span class="line"><span class="comment">// æ‰“å°åˆ›å»ºæœåŠ¡å™¨æˆåŠŸä¿¡æ¯</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`Server started at <span class="subst">$&#123;HTTP_PORT&#125;</span>`</span>)</span><br></pre></td></tr></table></figure><p><strong>4. POSTè¯·æ±‚åˆ†ä¸ºæ•°æ®è¯·æ±‚ã€æ–‡ä»¶ä¸Šä¼ è¯·æ±‚ï¼ŒåŒºåˆ†å¹¶è¿›è¡Œå¤„ç†</strong></p><p>åˆ¤æ–­è¯·æ±‚å¤´çš„content-typeä¸º<code>application/x-www-form-urlencoded</code>æ—¶ï¼Œè¡¨ç¤ºè¯¥è¯·æ±‚åªæ˜¯å•çº¯ä¼ è¾“æ•°æ®ï¼Œå¯ä»¥ç›´æ¥å½“åšå­—ç¬¦ä¸²å¤„ç†ã€‚<br>è‹¥è¯·æ±‚å¤´çš„content-typeä¸å¯¹ï¼Œåˆ™è¡¨ç¤ºè¯¥è¯·æ±‚æ˜¯ä¸Šä¼ æ–‡ä»¶ï¼Œå¯ä»¥ç”¨multipartyè¿›è¡Œå¤„ç†ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥åˆ›å»ºæœåŠ¡å™¨æ‰€éœ€çš„æ¨¡å—</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•å…¥æœåŠ¡å™¨é…ç½®</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•å…¥è·¯ç”±æ¨¡å—çš„æŸ¥æ‰¾è·¯ç”±æ–¹æ³•</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è§£æè¯·æ±‚æ•°æ®</span></span><br><span class="line">  <span class="comment">// è·å–è¯·æ±‚è·¯å¾„åŠqueryæ•°æ®</span></span><br><span class="line">  <span class="keyword">const</span> method = req.method</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    pathname,</span><br><span class="line">    query</span><br><span class="line">  &#125; = url.parse(req.url, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†POSTè¯·æ±‚</span></span><br><span class="line">  <span class="keyword">if</span> (method === <span class="string">'POST'</span>) &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®è¯·æ±‚å¤´çš„content-typeå±æ€§å€¼ï¼ŒåŒºåˆ†æ˜¯æ™®é€šPOSTè¯·æ±‚ï¼Œè¿˜æ˜¯æ–‡ä»¶è¯·æ±‚ã€‚</span></span><br><span class="line">    <span class="comment">// content-typeä¸ºapplication/x-www-form-urlencodedæ—¶ï¼Œè¡¨ç¤ºæ˜¯æ™®é€šPOSTè¯·æ±‚</span></span><br><span class="line">    <span class="comment">// æ™®é€šPOSTè¯·æ±‚ç›´æ¥è¿›è¡Œå¤„ç†ï¼Œæ–‡ä»¶è¯·æ±‚ä½¿ç”¨multipartyå¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> (req.headers[<span class="string">'content-type'</span>].startsWith(<span class="string">'application/x-www-form-urlencoded'</span>)) &#123;</span><br><span class="line">      <span class="comment">// æ™®é€šPOSTè¯·æ±‚</span></span><br><span class="line">      <span class="keyword">let</span> arr = []  <span class="comment">// å­˜å‚¨Bufferæ•°æ®</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ¥æ”¶æ•°æ®</span></span><br><span class="line">      req.on(<span class="string">'data'</span>, (buffer) =&gt; &#123;</span><br><span class="line">        arr.push(buffer)</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ•°æ®æ¥æ”¶å®Œæˆ</span></span><br><span class="line">      req.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> data = Buffer.concat(arr)  <span class="comment">// åˆå¹¶æ¥æ”¶åˆ°çš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">const</span> post = querystring.parse(data.toString()) <span class="comment">// å°†æ¥æ”¶åˆ°çš„æ•°æ®è½¬æ¢ä¸ºJSON</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// é€šè¿‡è·¯ç”±å¤„ç†æ•°æ®ï¼Œå› ä¸ºæ­¤æ—¶æ˜¯æ™®é€šPOSTè¯·æ±‚ï¼Œä¸å­˜åœ¨æ–‡ä»¶æ•°æ®</span></span><br><span class="line">        processData(method, pathname, query, post, &#123;&#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// æ–‡ä»¶POSTè¯·æ±‚</span></span><br><span class="line">      <span class="keyword">const</span> form = <span class="keyword">new</span> Form(&#123;</span><br><span class="line">        uploadDir: HTTP_UPLOAD  <span class="comment">// æŒ‡å®šæ–‡ä»¶å­˜å‚¨ç›®å½•</span></span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¤„ç†è¯·æ±‚æ•°æ®</span></span><br><span class="line">      form.parse(req)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> post = &#123;&#125; <span class="comment">// å­˜å‚¨æ•°æ®å‚æ•°</span></span><br><span class="line">      <span class="keyword">let</span> files = &#123;&#125;  <span class="comment">// å­˜å‚¨æ–‡ä»¶æ•°æ®</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// é€šè¿‡fieldäº‹ä»¶å¤„ç†æ™®é€šæ•°æ®</span></span><br><span class="line">      form.on(<span class="string">'field'</span>, (name, value) =&gt; &#123;</span><br><span class="line">        post[name] = value</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// é€šè¿‡fileæ—¶é—´å¤„ç†æ–‡ä»¶æ•°æ®</span></span><br><span class="line">      form.on(<span class="string">'file'</span>, (name, file) =&gt; &#123;</span><br><span class="line">        files[name] = file</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¤„ç†é”™è¯¯</span></span><br><span class="line">      form.on(<span class="string">'error'</span>, (error) =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(error)</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ•°æ®ä¼ è¾“å®Œæˆæ—¶ï¼Œè§¦å‘closeäº‹ä»¶</span></span><br><span class="line">      form.on(<span class="string">'close'</span>, () =&gt; &#123;</span><br><span class="line">        <span class="comment">// é€šè¿‡è·¯ç”±å¤„ç†æ•°æ®ï¼Œå› ä¸ºæ­¤æ—¶æ˜¯POSTæ–‡ä»¶è¯·æ±‚ï¼Œqueryã€postã€filesæ•°æ®éƒ½å­˜åœ¨</span></span><br><span class="line">        processData(method, pathname, query, post, files)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;  <span class="comment">// å¤„ç†GETè¯·æ±‚</span></span><br><span class="line">    <span class="comment">// é€šè¿‡è·¯ç”±å¤„ç†æ•°æ®ï¼Œå› ä¸ºæ­¤æ—¶æ˜¯GETè¯·æ±‚ï¼Œåªæœ‰queryæ•°æ®</span></span><br><span class="line">    processData(method, url, query, &#123;&#125;, &#123;&#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é€šè¿‡è·¯ç”±å¤„ç†è¯·æ±‚æ•°æ®çš„å…¬å…±æ–¹æ³•</span></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">processData</span>(<span class="params">method, pathname, query, post, files</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬é…ç½®çš„ç«¯å£</span></span><br><span class="line">server.listen(HTTP_PORT)</span><br><span class="line"><span class="comment">// æ‰“å°åˆ›å»ºæœåŠ¡å™¨æˆåŠŸä¿¡æ¯</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`Server started at <span class="subst">$&#123;HTTP_PORT&#125;</span>`</span>)</span><br></pre></td></tr></table></figure><p><strong>5. GETè¯·æ±‚åˆ†ä¸ºæ•°æ®è¯·æ±‚ã€è¯»å–æ–‡ä»¶è¯·æ±‚ï¼ŒåŒºåˆ†å¹¶è¿›è¡Œå¤„ç†</strong></p><p>GETè¯·æ±‚å¯ä»¥ç›´æ¥ç”¨<code>processData</code>æ–¹æ³•ç»Ÿä¸€å¤„ç†ï¼Œè‹¥è·¯ç”±ä¸­æœªé…ç½®å¤„ç†æ•°æ®çš„æ–¹æ³•ï¼Œåˆ™è¡¨ç¤ºè¯¥è¯·æ±‚ä¸ºè·å–é™æ€æ–‡ä»¶ï¼Œéœ€è¦è¿›è¡Œå•ç‹¬å¤„ç†ï¼Œå¦åˆ™åªéœ€è¦è°ƒç”¨è·¯ç”±é…ç½®çš„å›è°ƒå‡½æ•°å¤„ç†å³å¯ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥åˆ›å»ºæœåŠ¡å™¨æ‰€éœ€çš„æ¨¡å—</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•å…¥æœåŠ¡å™¨é…ç½®</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•å…¥è·¯ç”±æ¨¡å—çš„æŸ¥æ‰¾è·¯ç”±æ–¹æ³•</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è§£æè¯·æ±‚æ•°æ®</span></span><br><span class="line">  <span class="comment">// è·å–è¯·æ±‚è·¯å¾„åŠqueryæ•°æ®</span></span><br><span class="line">  <span class="keyword">const</span> method = req.method</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    pathname,</span><br><span class="line">    query</span><br><span class="line">  &#125; = url.parse(req.url, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†POSTè¯·æ±‚</span></span><br><span class="line">  <span class="keyword">if</span> (method === <span class="string">'POST'</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;  <span class="comment">// å¤„ç†GETè¯·æ±‚</span></span><br><span class="line">    <span class="comment">// é€šè¿‡è·¯ç”±å¤„ç†æ•°æ®ï¼Œå› ä¸ºæ­¤æ—¶æ˜¯GETè¯·æ±‚ï¼Œåªæœ‰queryæ•°æ®</span></span><br><span class="line">    processData(method, url, query, &#123;&#125;, &#123;&#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é€šè¿‡è·¯ç”±å¤„ç†è¯·æ±‚æ•°æ®çš„å…¬å…±æ–¹æ³•</span></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">processData</span>(<span class="params">method, pathname, query, post, files</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> callback = findRouter(method, pathname)  <span class="comment">// è·å–å¤„ç†è¯·æ±‚çš„å›è°ƒå‡½æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è‹¥å›è°ƒå‡½æ•°å­˜åœ¨ï¼Œåˆ™è¡¨ç¤ºè·¯ç”±æœ‰é…ç½®ç›¸åº”çš„æ•°æ®å¤„ç†ï¼Œå³è¯¥è¯·æ±‚ä¸æ˜¯è·å–é™æ€æ–‡ä»¶ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// æ ¹æ®è·¯ç”±å¤„ç†æ¥å£æ•°æ®</span></span><br><span class="line">        <span class="keyword">await</span> callback(res, query, post, files)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="comment">// å‡ºç°é”™è¯¯çš„å¤„ç†</span></span><br><span class="line">        res.writeHead(<span class="number">500</span>)</span><br><span class="line">        res.write(<span class="string">'Internal Server Error'</span>)</span><br><span class="line">        res.end()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// è‹¥å›è°ƒå‡½æ•°ä¸å­˜åœ¨ï¼Œåˆ™è¡¨ç¤ºè¯¥è¯·æ±‚ä¸ºè¯·æ±‚ä¸€ä¸ªé™æ€æ–‡ä»¶ï¼Œå¦‚htmlã€cssã€jsç­‰</span></span><br><span class="line">      <span class="keyword">const</span> filePath = HTTP_ROOT + pathname</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">      fs.stat(filePath, (error, stat) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (error) &#123;</span><br><span class="line">          <span class="comment">// å‡ºç°é”™è¯¯è¡¨ç¤ºæ–‡ä»¶ä¸å­˜åœ¨</span></span><br><span class="line">          res.writeHead(<span class="number">404</span>)</span><br><span class="line">          res.write(<span class="string">'Not Found'</span>)</span><br><span class="line">          res.end()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// æ–‡ä»¶å­˜åœ¨åˆ™è¿›è¡Œè¯»å–</span></span><br><span class="line">          <span class="comment">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµã€‚</span></span><br><span class="line">          <span class="keyword">const</span> readStream = fs.createReadStream(filePath)</span><br><span class="line"></span><br><span class="line">          <span class="comment">// åˆ›å»ºä¸€ä¸ªGzipå¯¹è±¡ï¼Œç”¨äºå°†æ–‡ä»¶å‹ç¼©æˆ</span></span><br><span class="line">          <span class="keyword">const</span> gz = zlib.createGzip()</span><br><span class="line"></span><br><span class="line">          <span class="comment">// å‘æµè§ˆå™¨å‘é€ç»è¿‡gzipå‹ç¼©çš„æ–‡ä»¶ï¼Œè®¾ç½®å“åº”å¤´ï¼Œå¦åˆ™æµè§ˆå™¨æ— æ³•è¯†åˆ«ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œä¸‹è½½ã€‚</span></span><br><span class="line">          res.setHeader(<span class="string">'content-encoding'</span>, <span class="string">'gzip'</span>)</span><br><span class="line"></span><br><span class="line">          <span class="comment">// å°†è¯»å–çš„å†…å®¹ï¼Œé€šè¿‡gzipå‹ç¼©ä¹‹åï¼Œåœ¨é€šè¿‡ç®¡é“æ¨é€åˆ°resä¸­ï¼Œç”±äºresç»§æ‰¿è‡ªStreamæµï¼Œå› æ­¤ä¹Ÿå¯ä»¥æ¥æ”¶ç®¡é“çš„æ¨é€ã€‚</span></span><br><span class="line">          readStream.pipe(gz).pipe(res)</span><br><span class="line"></span><br><span class="line">          readStream.on(<span class="string">'error'</span>, (error) =&gt; &#123;</span><br><span class="line">            <span class="built_in">console</span>.error(error)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬é…ç½®çš„ç«¯å£</span></span><br><span class="line">server.listen(HTTP_PORT)</span><br><span class="line"><span class="comment">// æ‰“å°åˆ›å»ºæœåŠ¡å™¨æˆåŠŸä¿¡æ¯</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`Server started at <span class="subst">$&#123;HTTP_PORT&#125;</span>`</span>)</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•æœåŠ¡å™¨"><a href="#æµ‹è¯•æœåŠ¡å™¨" class="headerlink" title="æµ‹è¯•æœåŠ¡å™¨"></a>æµ‹è¯•æœåŠ¡å™¨</h2><p>åœ¨server.jsä¸­å¼•å…¥å°è£…çš„httpæ¨¡å—ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'./lib/http'</span>)</span><br></pre></td></tr></table></figure><p>å†ä½¿ç”¨node server.jså¯åŠ¨æœåŠ¡å™¨ï¼Œå°±å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®<code>http://localhost:8080/index.html</code>ï¼Œçœ‹åˆ°htmlé¡µé¢</p><h2 id="æ·»åŠ å„æ¥å£è·¯ç”±é…ç½®"><a href="#æ·»åŠ å„æ¥å£è·¯ç”±é…ç½®" class="headerlink" title="æ·»åŠ å„æ¥å£è·¯ç”±é…ç½®"></a>æ·»åŠ å„æ¥å£è·¯ç”±é…ç½®</h2><p>è·å–å•†å“åˆ—è¡¨è·¯ç”±å›è°ƒå‡½æ•°</p><p>æŸ¥è¯¢<code>item_table</code>è¡¨ä¸­çš„å•†å“æ•°æ®åï¼Œè¿”å›ç»™å‰å°ï¼Œå¹¶å°†å›è°ƒå‡½æ•°ä½œä¸ºæ¨¡å—å¯¼å‡ºã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> connection = <span class="built_in">require</span>(<span class="string">'../lib/database'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">async</span> (res, query, post, files) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// æŸ¥è¯¢å•†å“åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> connection.query(<span class="string">`SELECT * FROM item_table`</span>)</span><br><span class="line"></span><br><span class="line">    res.writeJson(&#123;</span><br><span class="line">      error: <span class="number">0</span>, <span class="comment">// errorä¸º0åˆ™è¡¨ç¤ºæ¥å£æ­£å¸¸</span></span><br><span class="line">      data  <span class="comment">// æŸ¥è¯¢åˆ°çš„å•†å“åˆ—è¡¨æ•°æ®</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(error)</span><br><span class="line">    res.writeJson(&#123;</span><br><span class="line">      error: <span class="number">1</span>, <span class="comment">// errorä¸º1åˆ™è¡¨ç¤ºæ¥å£å‡ºé”™</span></span><br><span class="line">      msg: <span class="string">'æ•°æ®åº“å‡ºé”™'</span> <span class="comment">// æ¥å£çš„é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  res.end()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ å•†å“è·¯ç”±å›è°ƒå‡½æ•°"><a href="#æ·»åŠ å•†å“è·¯ç”±å›è°ƒå‡½æ•°" class="headerlink" title="æ·»åŠ å•†å“è·¯ç”±å›è°ƒå‡½æ•°"></a>æ·»åŠ å•†å“è·¯ç”±å›è°ƒå‡½æ•°</h3><p>åº”ç¦æ­¢queryè¯­å¥ä½¿ç”¨å¦‚ä¸‹å†™æ³•ï¼Œå®¹æ˜“é€ æˆæ³¨å…¥æ”»å‡»ã€‚<br><code>connection.query(INSERT INTO item_table (title, price, count) VALUES(&#39;${title}, ${price} ${count}&#39;))</code><br>æ­¤æ—¶è‹¥ç”¨æˆ·ä¼ å…¥å‚æ•°å¦‚ä¸‹ï¼š</p><p><code>http://localhost:8080/add?title=a&#39;)%3B%20DELETE%20FROM%20item_table%3B%20SELECT%20(1&amp;price=19.8&amp;count=200</code></p><p>å°±ä¼šè®©æœåŠ¡å™¨æ‰§è¡Œä¸€ä¸ªè¿™æ ·çš„è¯­å¥ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO item_table (title, price, count) VALUES(<span class="string">'a'</span>); DELETE FROM item_table; SELECT (<span class="string">'1'</span>, <span class="number">19.8</span>, <span class="number">200</span>)</span><br></pre></td></tr></table></figure><p>å…¶æ„ä¹‰ä¸ºï¼š</p><p>1.æ’å…¥ä¸€ä¸ªè™šå‡æ•°æ®<br>2.åˆ é™¤item_tableè¡¨ä¸­æ‰€æœ‰æ•°æ®<br>3.è¿”å›ä¸€ä¸ªè™šå‡æ•°æ®</p><p>è¿™æ ·å°±ä¼šå¯¼è‡´item_tableè¡¨ä¸­çš„æ‰€æœ‰æ•°æ®è¢«åˆ é™¤ã€‚</p><p>ä¸ºé˜²æ­¢æ³¨å…¥æ”»å‡»ï¼Œå¯ä»¥ä½¿ç”¨å ä½ç¬¦?ä»£æ›¿éœ€è¦æ’å…¥æ•°æ®åº“çš„å‚æ•°ï¼Œç¬¬äºŒä¸ªæ•°ç»„å‚æ•°ä¸­çš„3ä¸ªå€¼ä¼šæŒ‰é¡ºåºå¡«å……å ä½ç¬¦ï¼Œè¯¥æ–¹æ³•å¯ä»¥é¿å…å¤§éƒ¨åˆ†æ³¨å…¥æ”»å‡»ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> connection.query(<span class="string">`INSERT INTO item_table (title, price, count) VALUES(?,?,?)`</span>, [title, price, count])</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> connection = <span class="built_in">require</span>(<span class="string">'../lib/database'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">async</span> (res, query, post, files) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> &#123;</span><br><span class="line">    title,</span><br><span class="line">    price,</span><br><span class="line">    count</span><br><span class="line">  &#125; = post</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ˜¯å¦æœ‰ä¼ å‚</span></span><br><span class="line">  <span class="keyword">if</span> (!title || !price || !count) &#123;</span><br><span class="line">    res.writeJson(&#123;</span><br><span class="line">      error: <span class="number">1</span>,</span><br><span class="line">      msg: <span class="string">'å‚æ•°ä¸åˆæ³•'</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å°†ä»·æ ¼å’Œæ•°é‡è½¬ä¸ºæ•°å­—</span></span><br><span class="line">    price = <span class="built_in">Number</span>(price)</span><br><span class="line">    count = <span class="built_in">Number</span>(count)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­ä»·æ ¼å’Œæ•°é‡æ˜¯å¦éæ•°å­—</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">isNaN</span>(price) || <span class="built_in">isNaN</span>(count)) &#123;</span><br><span class="line">      res.writeJson(&#123;</span><br><span class="line">        error: <span class="number">1</span>,</span><br><span class="line">        msg: <span class="string">'å‚æ•°ä¸åˆæ³•'</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨å ä½ç¬¦?ä»£æ›¿éœ€è¦æ’å…¥æ•°æ®åº“çš„å‚æ•°ï¼Œç¬¬äºŒä¸ªæ•°ç»„å‚æ•°ä¸­çš„3ä¸ªå€¼ä¼šæŒ‰é¡ºåºå¡«å……å ä½ç¬¦ï¼Œè¯¥æ–¹æ³•å¯ä»¥é¿å…å¤§éƒ¨åˆ†æ³¨å…¥æ”»å‡»ã€‚</span></span><br><span class="line">        <span class="keyword">await</span> connection.query(<span class="string">`INSERT INTO item_table (title, price, count) VALUES(?,?,?)`</span>, [title, price, count])</span><br><span class="line"></span><br><span class="line">        res.writeJson(&#123;</span><br><span class="line">          error: <span class="number">0</span>,</span><br><span class="line">          msg: <span class="string">'æ·»åŠ å•†å“æˆåŠŸ'</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(error)</span><br><span class="line">        res.writeJson(&#123;</span><br><span class="line">          error: <span class="number">1</span>,</span><br><span class="line">          msg: <span class="string">'æ•°æ®åº“å†…éƒ¨é”™è¯¯'</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  res.end()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤å•†å“è·¯ç”±å›è°ƒå‡½æ•°"><a href="#åˆ é™¤å•†å“è·¯ç”±å›è°ƒå‡½æ•°" class="headerlink" title="åˆ é™¤å•†å“è·¯ç”±å›è°ƒå‡½æ•°"></a>åˆ é™¤å•†å“è·¯ç”±å›è°ƒå‡½æ•°</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> connection = <span class="built_in">require</span>(<span class="string">'../lib/database'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">async</span> (res, query, post, files) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> ID = query.id</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!ID) &#123;</span><br><span class="line">    res.writeJson(&#123;</span><br><span class="line">      error: <span class="number">1</span>,</span><br><span class="line">      msg: <span class="string">'å‚æ•°ä¸åˆæ³•'</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> connection.query(<span class="string">`DELETE FROM item_table WHERE ID=<span class="subst">$&#123;ID&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">    res.writeJson(&#123;</span><br><span class="line">      error: <span class="number">0</span>,</span><br><span class="line">      msg: <span class="string">'åˆ é™¤æˆåŠŸ'</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  res.end()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ å„æ¥å£è·¯ç”±é…ç½®-1"><a href="#æ·»åŠ å„æ¥å£è·¯ç”±é…ç½®-1" class="headerlink" title="æ·»åŠ å„æ¥å£è·¯ç”±é…ç½®"></a>æ·»åŠ å„æ¥å£è·¯ç”±é…ç½®</h3><p>åœ¨<code>/router/index.js</code>ä¸­ï¼Œå¼•ç”¨å„ä¸ªæ¥å£çš„é…ç½®ï¼Œå¹¶ç”¨addRouteræ–¹æ³•æ·»åŠ åˆ°è·¯ç”±è¡¨ä¸­ï¼Œå³å¯åœ¨æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼ŒæŸ¥æ‰¾è·¯ç”±å¹¶è¿›è¡Œå¤„ç†ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  addRouter</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">'../lib/router'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ è·å–å•†å“åˆ—è¡¨æ¥å£</span></span><br><span class="line">addRouter(<span class="string">'get'</span>, <span class="string">'/list'</span>, <span class="built_in">require</span>(<span class="string">'./list'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ å•†å“æ¥å£</span></span><br><span class="line">addRouter(<span class="string">'post'</span>, <span class="string">'/add'</span>, <span class="built_in">require</span>(<span class="string">'./add'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤å•†å“æ¥å£</span></span><br><span class="line">addRouter(<span class="string">'get'</span>, <span class="string">'/del'</span>, <span class="built_in">require</span>(<span class="string">'./del'</span>))</span><br></pre></td></tr></table></figure><h3 id="åœ¨ä¸»æ¨¡å—ä¸­å¼•ç”¨è·¯ç”±"><a href="#åœ¨ä¸»æ¨¡å—ä¸­å¼•ç”¨è·¯ç”±" class="headerlink" title="åœ¨ä¸»æ¨¡å—ä¸­å¼•ç”¨è·¯ç”±"></a>åœ¨ä¸»æ¨¡å—ä¸­å¼•ç”¨è·¯ç”±</h3><p>åœ¨/server.jsä¸­ï¼Œå¼•ç”¨routeræ¨¡å—ï¼Œå°±å¯ä»¥å®Œæˆæ•´ä¸ªæœåŠ¡ç«¯çš„é…ç½®ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> connection = <span class="built_in">require</span>(<span class="string">'./lib/database'</span>)</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'./lib/http'</span>)</span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">'./router'</span>)</span><br></pre></td></tr></table></figure><h3 id="å®Œæˆå‰ç«¯åŠŸèƒ½"><a href="#å®Œæˆå‰ç«¯åŠŸèƒ½" class="headerlink" title="å®Œæˆå‰ç«¯åŠŸèƒ½"></a>å®Œæˆå‰ç«¯åŠŸèƒ½</h3><p>åœ¨/static/index.htmlä¸­ï¼Œä½¿ç”¨jqueryä¸ºå‰ç«¯é¡µé¢å®ç°å¦‚ä¸‹åŠŸèƒ½ï¼š</p><p>1.æ˜¾ç¤ºå•†å“åˆ—è¡¨<br>2.æ·»åŠ éšæœºåç§°ã€ä»·æ ¼ã€åº“å­˜çš„å•†å“<br>3.åˆ é™¤å¯¹åº”å•†å“</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŸ¥è¯¢å•†å“åˆ—è¡¨çš„æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  $.ajax(&#123;</span><br><span class="line">    url: <span class="string">'/list'</span>,</span><br><span class="line">    dataType: <span class="string">'json'</span></span><br><span class="line">  &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> html = <span class="string">``</span></span><br><span class="line"></span><br><span class="line">    res.data.forEach(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">      html += (</span><br><span class="line">        <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;tr&gt;</span></span><br><span class="line"><span class="string">              &lt;td&gt;<span class="subst">$&#123;item.title&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">              &lt;td&gt;ï¿¥<span class="subst">$&#123;item.price&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">              &lt;td&gt;<span class="subst">$&#123;item.count&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">              &lt;td&gt;</span></span><br><span class="line"><span class="string">                &lt;a data-id="<span class="subst">$&#123;item.ID&#125;</span>" href="#" class="glyphicon glyphicon-trash"&gt;åˆ é™¤&lt;/a&gt;</span></span><br><span class="line"><span class="string">              &lt;/td&gt;</span></span><br><span class="line"><span class="string">            &lt;/tr&gt;</span></span><br><span class="line"><span class="string">          `</span></span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    $(<span class="string">'tbody'</span>).html(html)</span><br><span class="line">  &#125;);</span><br><span class="line">&#125; getList()</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç‚¹å‡»æ·»åŠ æŒ‰é’®ï¼Œéšæœºæ·»åŠ ä¸€ä¸ªå•†å“</span></span><br><span class="line">$(<span class="string">'#addBtn'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  $.ajax(&#123;</span><br><span class="line">    url: <span class="string">'/add'</span>,</span><br><span class="line">    method: <span class="string">'post'</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      title: <span class="string">`test<span class="subst">$&#123;<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">100</span>)&#125;</span>`</span>,</span><br><span class="line">      price: <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">100</span>),</span><br><span class="line">      count: <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">100</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      getList()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç‚¹å‡»åˆ é™¤æŒ‰é’®</span></span><br><span class="line">$(<span class="string">'tbody'</span>).on(<span class="string">'click'</span>, <span class="string">'a'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  $.ajax(&#123;</span><br><span class="line">    url: <span class="string">'/del'</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      id: $(<span class="keyword">this</span>).attr(<span class="string">'data-id'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      getList()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Node-jsé¡¹ç›®ä»‹ç»&quot;&gt;&lt;a href=&quot;#Node-jsé¡¹ç›®ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;Node.jsé¡¹ç›®ä»‹ç»&quot;&gt;&lt;/a&gt;Node.jsé¡¹ç›®ä»‹ç»&lt;/h1&gt;&lt;p&gt;åˆ©ç”¨å­¦åˆ°çš„çŸ¥è¯†ï¼Œå®ç°ä¸€ä¸ªç®€å•ä½†å®ç”¨çš„å°é¡¹ç›®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªå•†å“åˆ—è¡¨ï¼Œå…·æœ‰å±•ç¤ºå•†å“ä¿¡æ¯ï¼Œæ·»åŠ å•†å“ï¼Œåˆ é™¤å•†å“çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&quot;é¡¹ç›®çš„æ–‡ä»¶å¤¹ç»“æ„&quot;&gt;&lt;a href=&quot;#é¡¹ç›®çš„æ–‡ä»¶å¤¹ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;é¡¹ç›®çš„æ–‡ä»¶å¤¹ç»“æ„&quot;&gt;&lt;/a&gt;é¡¹ç›®çš„æ–‡ä»¶å¤¹ç»“æ„&lt;/h2&gt;&lt;p&gt;â”œâ”€â”€ package.json&lt;br&gt;â”œâ”€â”€ server.js # æœåŠ¡å™¨ä»£ç &lt;br&gt;â”œâ”€â”€ config # é¡¹ç›®é…ç½®æ–‡ä»¶å¤¹&lt;br&gt;â”‚     â”œâ”€â”€ config.dev.js # å¼€å‘ç¯å¢ƒé…ç½®&lt;br&gt;â”‚     â”œâ”€â”€ config.prod.js # ç”Ÿäº§ç¯å¢ƒé…ç½®&lt;br&gt;â”‚     â”œâ”€â”€ index.js # å¯¼å‡ºå½“å‰æ‰€å¤„ç¯å¢ƒåŠé…ç½®&lt;br&gt;â”œâ”€â”€ libs # é¡¹ç›®å·¥å…·æ–‡ä»¶å¤¹&lt;br&gt;â”‚     â”œâ”€â”€ database.js # è¿æ¥æ•°æ®åº“&lt;br&gt;â”‚     â”œâ”€â”€ http.js # æœåŠ¡å™¨é…ç½®&lt;br&gt;â”‚     â”œâ”€â”€ router.js # å¤„ç†è·¯ç”±&lt;br&gt;â”œâ”€â”€ router # é¡¹ç›®è·¯ç”±é…ç½®æ–‡ä»¶å¤¹&lt;br&gt;â”‚     â”œâ”€â”€ index.js # è¿æ¥æ•°æ®åº“&lt;br&gt;â”‚     â”œâ”€â”€ list.js # è·å–å•†å“åˆ—è¡¨æ¥å£é…ç½®&lt;br&gt;â”‚     â”œâ”€â”€ add.js # å¢åŠ å•†å“æ¥å£é…ç½®&lt;br&gt;â”‚     â”œâ”€â”€ del.js # åˆ é™¤å•†å“æ¥å£é…ç½®&lt;br&gt;â”œâ”€â”€ static # é™æ€èµ„æºæ–‡ä»¶å¤¹&lt;br&gt;â”‚     â”œâ”€â”€ index.html # å‰ç«¯HTMLé¡µé¢&lt;br&gt;â”‚     â”œâ”€â”€ js # å‰ç«¯JavaScriptæ–‡ä»¶å¤¹&lt;br&gt;â”‚     â”œâ”€â”€ css # å‰ç«¯CSSæ–‡ä»¶å¤¹&lt;br&gt;â”‚     â”œâ”€â”€ fonts # å‰ç«¯å­—ä½“æ–‡ä»¶å¤¹&lt;br&gt;â”‚     â”œâ”€â”€ upload # å‰ç«¯ä¸Šä¼ æ–‡ä»¶å¤¹&lt;/p&gt;
&lt;h2 id=&quot;åˆ¤æ–­å½“å‰æ‰€å¤„ç¯å¢ƒ&quot;&gt;&lt;a href=&quot;#åˆ¤æ–­å½“å‰æ‰€å¤„ç¯å¢ƒ&quot; class=&quot;headerlink&quot; title=&quot;åˆ¤æ–­å½“å‰æ‰€å¤„ç¯å¢ƒ&quot;&gt;&lt;/a&gt;åˆ¤æ–­å½“å‰æ‰€å¤„ç¯å¢ƒ&lt;/h2&gt;&lt;p&gt;é€šå¸¸é¡¹ç›®åœ¨å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒè¦é‡‡ç”¨ä¸åŒçš„ï¼ŒæœåŠ¡å™¨ã€è´¦å·ã€åŸŸåã€ç«¯å£ç­‰é…ç½®ï¼Œå¦‚æœç”¨äººå·¥è¿›è¡Œåˆ‡æ¢æ“ä½œéº»çƒ¦ä¸”å®¹æ˜“å‡ºé”™ï¼Œå› æ­¤é€šå¸¸ä½¿ç”¨ç¯å¢ƒå˜é‡è¿›è¡Œåˆ¤æ–­ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆå¼•å…¥processæ¨¡å—&lt;code&gt;const process=require(&amp;#39;process&amp;#39;)&lt;/code&gt;ï¼Œè¯¥æ¨¡å—æä¾›äº†å½“å‰Node.jsè¿›ç¨‹çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;1.å¯ä»¥é€šè¿‡process.envç¯å¢ƒå˜é‡è·å–å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒç³»ç»Ÿç­‰å‚æ•°å·®å¼‚ï¼Œå¦‚å¼€å‘ç¯å¢ƒè¿è¡Œåœ¨Windowsç³»ç»Ÿä¸Šï¼Œè€Œç”Ÿäº§ç¯å¢ƒè¿è¡Œåœ¨Linuxç³»ç»Ÿï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨&lt;code&gt;process.env.OS === &amp;#39;Windows_NT&amp;#39;&lt;/code&gt;åˆ¤æ–­å½“å‰æ‰€å¤„çš„æ˜¯å¦å¼€å‘ç¯å¢ƒã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; mode = process.env.OS === &lt;span class=&quot;string&quot;&gt;&#39;Windows_NT&#39;&lt;/span&gt; ? &lt;span class=&quot;string&quot;&gt;&#39;env&#39;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&#39;prod&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2.ä¹Ÿå¯ä»¥é€šè¿‡package.jsonä¸­é…ç½®çš„å¯åŠ¨å‘½ä»¤åˆ¤æ–­å¤„äºå¼€å‘è¿˜æ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œå¦‚å¼€å‘ç¯å¢ƒå‘½ä»¤&lt;code&gt;npm start --dev&lt;/code&gt;å’Œç”Ÿäº§ç¯å¢ƒå‘½ä»¤&lt;code&gt;npm run build --build&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; mode = process.argv[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;] === &lt;span class=&quot;string&quot;&gt;&#39;--dev&#39;&lt;/span&gt; ? &lt;span class=&quot;string&quot;&gt;&#39;env&#39;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&#39;prod&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;åˆå§‹åŒ–å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒé…ç½®&quot;&gt;&lt;a href=&quot;#åˆå§‹åŒ–å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒé…ç½®&quot; class=&quot;headerlink&quot; title=&quot;åˆå§‹åŒ–å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒé…ç½®&quot;&gt;&lt;/a&gt;åˆå§‹åŒ–å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒé…ç½®&lt;/h2&gt;&lt;p&gt;åœ¨/config/index.jsä¸­ï¼Œåˆ¤æ–­æ‰€å¤„çš„ç¯å¢ƒï¼Œå¹¶å°†ç›¸åº”ç¯å¢ƒçš„æ ‡è¯†å’Œå‚æ•°ä½œä¸ºæ¨¡å—å¯¼å‡ºã€‚å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ç›´æ¥å¼•ç”¨ç›¸åº”çš„é…ç½®ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; process = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;process&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å¯ä»¥é€šè¿‡å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒç³»ç»Ÿç­‰å‚æ•°å·®å¼‚ï¼Œåˆ¤æ–­å¤„äºå“ªä¸ªç¯å¢ƒã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// const mode = process.env.OS === &#39;Windows_NT&#39; ? &#39;env&#39; : &#39;prod&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ä¹Ÿå¯ä»¥é€šè¿‡package.jsonä¸­é…ç½®çš„å¯åŠ¨å‘½ä»¤åˆ¤æ–­å¤„äºå¼€å‘è¿˜æ˜¯ç”Ÿäº§ç¯å¢ƒã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; mode = process.argv[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;] === &lt;span class=&quot;string&quot;&gt;&#39;--dev&#39;&lt;/span&gt; ? &lt;span class=&quot;string&quot;&gt;&#39;env&#39;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&#39;prod&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;module&lt;/span&gt;.exports = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  mode, &lt;span class=&quot;comment&quot;&gt;// å½“å‰æ‰€å¤„ç¯å¢ƒ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ...(mode === &lt;span class=&quot;string&quot;&gt;&#39;env&#39;&lt;/span&gt; ? &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;./config.dev&#39;&lt;/span&gt;) : &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;./config.prod&#39;&lt;/span&gt;))  &lt;span class=&quot;comment&quot;&gt;// å½“å‰ç¯å¢ƒçš„é…ç½®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;1.ä»¥å¼€å‘ç¯å¢ƒä¸ºä¾‹ï¼Œéœ€è¦ä½¿ç”¨çš„é…ç½®ä¸ºæœåŠ¡å™¨åŸŸåã€ç«¯å£å·ã€è´¦å·ã€å¯†ç ã€æ•°æ®åº“åï¼Œä»¥åŠHTTPç«¯å£ã€é™æ€æ–‡ä»¶ç»å¯¹è·¯å¾„ã€ä¸Šä¼ æ–‡ä»¶ä¿å­˜ç»å¯¹è·¯å¾„ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;module&lt;/span&gt;.exports = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// æ•°æ®åº“é…ç½®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  DB_HOST: &lt;span class=&quot;string&quot;&gt;&#39;localhost&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  DB_PORT: &lt;span class=&quot;number&quot;&gt;3306&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  DB_USER: &lt;span class=&quot;string&quot;&gt;&#39;root&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  DB_PASS: &lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  DB_NAME: &lt;span class=&quot;string&quot;&gt;&#39;test&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// HTTPç«¯å£&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  HTTP_PORT: &lt;span class=&quot;number&quot;&gt;8080&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// é™æ€æ–‡ä»¶ç»å¯¹è·¯å¾„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  HTTP_ROOT: path.resolve(__dirname, &lt;span class=&quot;string&quot;&gt;&#39;../static/&#39;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// ä¸Šä¼ æ–‡ä»¶ä¿å­˜ç»å¯¹è·¯å¾„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  HTTP_UPLOAD: path.resolve(__dirname, &lt;span class=&quot;string&quot;&gt;&#39;../static/upload&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;è¿æ¥æ•°æ®åº“&quot;&gt;&lt;a href=&quot;#è¿æ¥æ•°æ®åº“&quot; class=&quot;headerlink&quot; title=&quot;è¿æ¥æ•°æ®åº“&quot;&gt;&lt;/a&gt;è¿æ¥æ•°æ®åº“&lt;/h2&gt;&lt;p&gt;åœ¨libæ–‡ä»¶å¤¹ä¸‹ï¼Œåˆ›å»ºdatabase.jsï¼Œç”¨äºè¿æ¥æ•°æ®åº“ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Node" scheme="https://zhanghao-web.github.io/categories/Node/"/>
    
    
      <category term="Node" scheme="https://zhanghao-web.github.io/tags/Node/"/>
    
  </entry>
  
  <entry>
    <title>Nodeå­¦ä¹ (åä¸‰) --Streamæµ</title>
    <link href="https://zhanghao-web.github.io/2019/05/06/Node/Node%E5%AD%A6%E4%B9%A0(%E5%8D%81%E4%B8%89)%20--Stream%E6%B5%81/"/>
    <id>https://zhanghao-web.github.io/2019/05/06/Node/Nodeå­¦ä¹ (åä¸‰) --Streamæµ/</id>
    <published>2019-05-06T07:50:06.000Z</published>
    <updated>2020-01-28T10:04:15.047Z</updated>
    
    <content type="html"><![CDATA[<h2 id="File-Systemçš„é—®é¢˜"><a href="#File-Systemçš„é—®é¢˜" class="headerlink" title="File Systemçš„é—®é¢˜"></a>File Systemçš„é—®é¢˜</h2><p>æˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨File Systemæ¨¡å—å¯¹æ–‡ä»¶è¿›è¡Œè¯»å–ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fs.readFile(<span class="string">'./test.txt'</span>, (error, buffer) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (error) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(error)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// è¯»å–æ–‡ä»¶æˆåŠŸ</span></span><br><span class="line">    res.write(buffer)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™æ ·æ“ä½œç®€å•æœ‰æ•ˆï¼Œä½†è¿™ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p><p>1.å ç”¨å†…å­˜<br>ä½¿ç”¨fsè¯»å–æ–‡ä»¶ï¼Œå®ƒæ˜¯ä¸€æ¬¡æ€§å°†æ–‡ä»¶çš„æ‰€æœ‰å†…å®¹è¯»å–åˆ°å†…å­˜ä¸­ï¼Œå†ä¸€æ¬¡æ€§å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œå› æ­¤ä¼šå ç”¨å¤§é‡å†…å­˜ã€‚</p><p>2.èµ„æºä½¿ç”¨æ•ˆç‡ä½<br>ä»ç£ç›˜è¯»å–æ–‡ä»¶æœŸé—´ï¼Œç£ç›˜å¤„äºå¿™ç¢ŒçŠ¶æ€ï¼Œè€Œç½‘ç»œå¤„äºç©ºé—²çŠ¶æ€ã€‚<br>ç£ç›˜è¯»å–å®Œæˆåï¼Œå¼€å§‹å‘é€æ–‡ä»¶æ—¶ï¼Œæƒ…å†µæ­£ç›¸åï¼Œç½‘ç»œå¤„äºå¿™ç¢ŒçŠ¶æ€ï¼Œæ­¤æ—¶ç£ç›˜å´å¤„äºç©ºé—²çŠ¶æ€</p><h2 id="Streamæµ"><a href="#Streamæµ" class="headerlink" title="Streamæµ"></a>Streamæµ</h2><p>ç›¸æ¯”File Systemï¼ŒStreamæµè¯»å–æ–‡ä»¶æ˜¯è¯»ä¸€ä»½ï¼Œå‘ä¸€ä»½ï¼ŒStreamæµçš„å†™å…¥æ“ä½œä¹Ÿæœ‰åŒæ ·ç‰¹ç‚¹ï¼Œå› æ­¤å¯ä»¥è§£å†³File Systemåœ¨ä¸Šé¢æåˆ°çš„2ä¸ªé—®é¢˜ã€‚</p><p>æ¥ä¸‹æ¥å®ç°ä¸€ä¸ªç®€å•çš„æµï¼Œå°†1.txtæ–‡ä»¶çš„å†…å®¹å†™å…¥åˆ°2.txtä¸­ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµã€‚</span></span><br><span class="line"><span class="keyword">const</span> readStream = fs.createReadStream(<span class="string">'./1.txt'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªå¯å†™æµã€‚</span></span><br><span class="line"><span class="keyword">const</span> writeStream = fs.createWriteStream(<span class="string">'./2.txt'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†å¯è¯»æµè¯»å–çš„æ•°æ®ï¼Œé€šè¿‡ç®¡é“pipeæ¨é€åˆ°å†™å…¥æµä¸­ï¼Œå³å¯å°†1.txtçš„å†…å®¹ï¼Œå†™å…¥åˆ°2.txtä¸­ã€‚</span></span><br><span class="line">readStream.pipe(writeStream)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»å–å‡ºç°é”™è¯¯æ—¶ä¼šè§¦å‘erroräº‹ä»¶ã€‚</span></span><br><span class="line">readStream.on(<span class="string">'error'</span>, (error) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(error)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†™å…¥å®Œæˆæ—¶ï¼Œè§¦å‘finishäº‹ä»¶ã€‚</span></span><br><span class="line">writeStream.on(<span class="string">'finish'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'finish'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨Zlibå‹ç¼©æ–‡ä»¶"><a href="#ä½¿ç”¨Zlibå‹ç¼©æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨Zlibå‹ç¼©æ–‡ä»¶"></a>ä½¿ç”¨Zlibå‹ç¼©æ–‡ä»¶</h2><p>å¯ä»¥ä½¿ç”¨Zlibæ¨¡å—ï¼Œé…åˆStreamæµï¼Œå®ç°æ–‡ä»¶å‹ç¼©åŠŸèƒ½ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="comment">// å¼•å…¥zlibæ¨¡å—ï¼Œç”¨äºå®ç°å‹ç¼©åŠŸèƒ½</span></span><br><span class="line"><span class="keyword">const</span> zlib = <span class="built_in">require</span>(<span class="string">'zlib'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµã€‚</span></span><br><span class="line"><span class="keyword">const</span> readStream = fs.createReadStream(<span class="string">'./google.jpg'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªå¯å†™æµã€‚</span></span><br><span class="line"><span class="keyword">const</span> writeStream = fs.createWriteStream(<span class="string">'./google.jpg.gz'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªGzipå¯¹è±¡ï¼Œç”¨äºå°†æ–‡ä»¶å‹ç¼©æˆ.gzæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">const</span> gzip = zlib.createGzip()</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†å¯è¯»æµè¯»å–çš„æ•°æ®ï¼Œå…ˆé€šè¿‡ç®¡é“pipeæ¨é€åˆ°gzipä¸­ï¼Œå†æ¨é€åˆ°å†™å…¥æµä¸­ã€‚</span></span><br><span class="line"><span class="comment">// ä¹Ÿå°±æ˜¯å…ˆå°†å¯è¯»æµçš„æ•°æ®å‹ç¼©ï¼Œå†æ¨é€åˆ°å¯å†™æµä¸­ã€‚</span></span><br><span class="line">readStream.pipe(gzip).pipe(writeStream)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»å–å‡ºç°é”™è¯¯æ—¶ä¼šè§¦å‘erroräº‹ä»¶ã€‚</span></span><br><span class="line">readStream.on(<span class="string">'error'</span>, (error) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(error)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†™å…¥å®Œæˆæ—¶ï¼Œè§¦å‘finishäº‹ä»¶ã€‚</span></span><br><span class="line">writeStream.on(<span class="string">'finish'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'finish'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="ä½¿ç”¨æµä¼ è¾“æ–‡ä»¶åˆ°å‰å°"><a href="#ä½¿ç”¨æµä¼ è¾“æ–‡ä»¶åˆ°å‰å°" class="headerlink" title="ä½¿ç”¨æµä¼ è¾“æ–‡ä»¶åˆ°å‰å°"></a>ä½¿ç”¨æµä¼ è¾“æ–‡ä»¶åˆ°å‰å°</h2><p>å­¦ä¹ äº†æµï¼Œæˆ‘ä»¬å°±å¯ä»¥æ›´åŠ é«˜æ•ˆåœ°å°†æ–‡ä»¶ä¼ è¾“åˆ°å‰å°ï¼š</p><!-- more --><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> zlib = <span class="built_in">require</span>(<span class="string">'zlib'</span>)</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    pathname</span><br><span class="line">  &#125; = url.parse(req.url, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµã€‚</span></span><br><span class="line">  <span class="keyword">const</span> readStream = fs.createReadStream(<span class="string">`./<span class="subst">$&#123;pathname&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ›å»ºä¸€ä¸ªGzipå¯¹è±¡ï¼Œç”¨äºå°†æ–‡ä»¶å‹ç¼©æˆ.gzæ–‡ä»¶</span></span><br><span class="line">  <span class="keyword">const</span> gzip = zlib.createGzip()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†è¯»å–çš„å†…å®¹ï¼Œåœ¨é€šè¿‡ç®¡é“æ¨é€åˆ°resä¸­ï¼Œè¯¥æ–¹æ³•ä¸ç»è¿‡å‹ç¼©</span></span><br><span class="line">  readStream.pipe(res)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†å¯è¯»æµæŠ¥é”™ï¼Œé˜²æ­¢è¯·æ±‚ä¸å­˜åœ¨çš„æ–‡ä»¶</span></span><br><span class="line">  readStream.on(<span class="string">'error'</span>, (error) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(error);</span><br><span class="line">    res.writeHead(<span class="number">404</span>)</span><br><span class="line">    res.write(<span class="string">'Not Found'</span>)</span><br><span class="line">    res.end()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8080</span>)</span><br></pre></td></tr></table></figure><p>ä½†å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œè™½ç„¶å®ç°äº†ä½¿ç”¨æµä¼ è¾“æ–‡ä»¶ï¼Œä½†å¹¶æ²¡æœ‰ç”¨åˆ°gzipå‹ç¼©ï¼Œåœ¨ä¼ è¾“æ—¶è¿˜æ˜¯æ›´å¤šåœ°æ¶ˆè€—ç½‘ç»œèµ„æºï¼Œæ¥ä¸‹æ¥å¯ä»¥å¼•å…¥gzipå‹ç¼©ã€‚</p><h2 id="æ–‡ä»¶ç»è¿‡gzipå‹ç¼©åä¼ è¾“åˆ°å‰å°"><a href="#æ–‡ä»¶ç»è¿‡gzipå‹ç¼©åä¼ è¾“åˆ°å‰å°" class="headerlink" title="æ–‡ä»¶ç»è¿‡gzipå‹ç¼©åä¼ è¾“åˆ°å‰å°"></a>æ–‡ä»¶ç»è¿‡gzipå‹ç¼©åä¼ è¾“åˆ°å‰å°</h2><p>ä½†æ­¤æ—¶å¦‚æœåªæ˜¯ç®€å•çš„ç”¨<code>readStream.pipe(gzip).pipe(res)</code>ä¼ è¾“æ–‡ä»¶ï¼Œæµè§ˆå™¨åœ¨è®¿é—®æ—¶æ— æ³•ç›´æ¥æ‰“å¼€ï¼Œè€Œæ˜¯ä¼šè§¦å‘æ–‡ä»¶ä¸‹è½½ã€‚<br>è¿™æ˜¯å› ä¸ºæœªè®¾ç½®è¯·æ±‚å¤´å±æ€§<code>content-encoding</code>çš„å€¼ï¼Œå¯¼è‡´æµè§ˆå™¨æ— æ³•è¯†åˆ«ç”¨gzipå‹ç¼©è¿‡çš„æ–‡ä»¶ï¼Œè¿™å°±éœ€è¦ä¿®æ”¹è¯·æ±‚å¤´<code>res.setHeader(&#39;content-encoding&#39;, &#39;gzip&#39;)</code>ï¼Œè®©æµè§ˆå™¨å¯ä»¥è¯†åˆ«ã€‚</p><p>è¿™æ ·æµè§ˆå™¨å°±å¯ä»¥æ­£å¸¸æ‰“å¼€æ–‡ä»¶äº†ï¼Œä½†è‹¥æµè§ˆå™¨è®¿é—®çš„æ˜¯ä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œæµè§ˆå™¨ä¼šæŠ¥é”™â€œæ— æ³•è®¿é—®æ­¤ç½‘ç«™â€ï¼Œè¿™æ˜¯å› ä¸ºè¯·æ±‚å¤´å±æ€§<code>content-encoding</code>å·²è¢«è®¾ç½®ä¸ºgzipï¼Œä½†æœåŠ¡ç«¯ä¼ ç»™æµè§ˆå™¨çš„æ˜¯Not Foundå­—ç¬¦ä¸²ï¼Œæµè§ˆå™¨æ— æ³•è¯†åˆ«ã€‚</p><p>æ­¤æ—¶å¯ä»¥ä½¿ç”¨<code>fs.stat</code>æ–¹æ³•ï¼Œå…ˆæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨åˆ™è¿”å›Not Foundï¼Œè‹¥å­˜åœ¨åˆ™ç»§ç»­ä¼ è¾“ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> zlib = <span class="built_in">require</span>(<span class="string">'zlib'</span>)</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    pathname</span><br><span class="line">  &#125; = url.parse(req.url, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„</span></span><br><span class="line">  <span class="keyword">const</span> filepath = <span class="string">`./<span class="subst">$&#123;pathname&#125;</span>`</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">  fs.stat(filepath, (error, stat) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(error);</span><br><span class="line">      res.setHeader(<span class="string">'content-encoding'</span>, <span class="string">'identity'</span>)</span><br><span class="line">      res.writeHead(<span class="number">404</span>)</span><br><span class="line">      res.write(<span class="string">'Not Found'</span>)</span><br><span class="line">      res.end()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµã€‚</span></span><br><span class="line">      <span class="keyword">const</span> readStream = fs.createReadStream(filepath)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ›å»ºä¸€ä¸ªGzipå¯¹è±¡ï¼Œç”¨äºå°†æ–‡ä»¶å‹ç¼©æˆ.gzæ–‡ä»¶</span></span><br><span class="line">      <span class="keyword">const</span> gzip = zlib.createGzip()</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å‘æµè§ˆå™¨å‘é€ç»è¿‡gzipå‹ç¼©çš„æ–‡ä»¶ï¼Œè®¾ç½®å“åº”å¤´ï¼Œå¦åˆ™æµè§ˆå™¨æ— æ³•è¯†åˆ«ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œä¸‹è½½ã€‚</span></span><br><span class="line">      res.setHeader(<span class="string">'content-encoding'</span>, <span class="string">'gzip'</span>)</span><br><span class="line">      <span class="comment">// å°†è¯»å–çš„å†…å®¹ï¼Œé€šè¿‡gzipå‹ç¼©ä¹‹åï¼Œåœ¨é€šè¿‡ç®¡é“æ¨é€åˆ°resä¸­ï¼Œç”±äºresç»§æ‰¿è‡ªStreamæµï¼Œå› æ­¤ä¹Ÿå¯ä»¥æ¥æ”¶ç®¡é“çš„æ¨é€ã€‚</span></span><br><span class="line">      readStream.pipe(gzip).pipe(res)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¤„ç†å¯è¯»æµæŠ¥é”™ï¼Œé˜²æ­¢æ–‡ä»¶ä¸­é€”è¢«åˆ é™¤æˆ–å‡ºé”™ï¼Œå¯¼è‡´æŠ¥é”™ã€‚</span></span><br><span class="line">      readStream.on(<span class="string">'error'</span>, (error) =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(error);</span><br><span class="line">        res.setHeader(<span class="string">'content-encoding'</span>, <span class="string">'identity'</span>)</span><br><span class="line">        res.writeHead(<span class="number">404</span>)</span><br><span class="line">        res.write(<span class="string">'Not Found'</span>)</span><br><span class="line">        res.end()</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8080</span>)</span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨å™¨"><a href="#å¯åŠ¨å™¨" class="headerlink" title="å¯åŠ¨å™¨"></a>å¯åŠ¨å™¨</h2><p>å¸¸ç”¨çš„å¯åŠ¨å™¨æœ‰foreverã€pm2ç­‰ï¼Œå®ƒä»¬ä¸»è¦ç”¨åœ¨é¡¹ç›®éƒ¨ç½²é˜¶æ®µ</p><p>1.ä½¿åº”ç”¨ä¸é—´æ–­è¿è¡Œï¼Œå¦‚æœä¸ä½¿ç”¨å¯åŠ¨å™¨ï¼Œå‘½ä»¤è¡Œçª—å£ä¸€æ—¦å…³é—­ï¼Œæˆ–è€…å‡ºç°æŠ¥é”™ï¼Œåº”ç”¨å°±ä¼šåœæ­¢è¿è¡Œï¼Œå¯åŠ¨å™¨ä¼šå¸®åŠ©åº”ç”¨è‡ªåŠ¨é‡å¯ã€‚<br>2.è‹¥å‡ºç°æœåŠ¡å™¨é‡å¯ï¼Œå¯åŠ¨å™¨ä¼šè‡ªåŠ¨å¯åŠ¨åº”ç”¨ï¼Œä¸éœ€è¦æ‰‹åŠ¨æ“ä½œã€‚</p><p>å¸¸ç”¨çš„å¯åŠ¨å™¨æœ‰<code>foreverã€pm2</code>ç­‰ï¼Œæ¥ä¸‹æ¥ä»‹ç»ä¸€ä¸‹foreverçš„ä½¿ç”¨ã€‚</p><h3 id="forever"><a href="#forever" class="headerlink" title="forever"></a>forever</h3><p>foreveræ–‡æ¡£å¯å‚è€ƒï¼š<a href="https://github.com/foreverjs/forever#readme" target="_blank" rel="noopener">github.com/foreverjs/fâ€¦</a></p><blockquote><p>ä½¿ç”¨foreverå¯åŠ¨ä¸€ä¸ªæœåŠ¡ï¼š</p></blockquote><ul><li>å®‰è£…foreverï¼š<code>npm install forever -g</code></li><li>åœ¨å‘½ä»¤è¡Œè¿è¡Œ<code>forever start server.js</code>ï¼Œæ›¿ä»£<code>node server.js</code>å‘½ä»¤ã€‚</li><li>å‘½ä»¤è¡Œçª—å£æç¤º<code>info: Forever processing file: server.js</code>ï¼Œè¡¨ç¤ºå¯åŠ¨æˆåŠŸï¼Œæ­¤æ—¶å¦‚æœå°†çª—å£å…³é—­ï¼Œåº”ç”¨ç…§æ ·å¯ä»¥è®¿é—®ã€‚</li><li>å¦‚æœéœ€è¦å…³é—­æœåŠ¡ï¼Œå¯ä»¥è¿è¡Œ<code>forever stop server.js</code>ã€‚è¿˜æœ‰ä¸€ä¸ªå‘½ä»¤æ˜¯<code>forever stopall</code>ï¼Œåœæ­¢å…¨éƒ¨åœ¨è¿è¡Œçš„ä»»åŠ¡ï¼Œä½†ä½¿ç”¨è¦æ…é‡ã€‚</li></ul><p>foreverå¯åŠ¨æ—¶ï¼Œè¿˜å¯ä»¥æ·»åŠ ä¸€äº›é…ç½®ï¼Œä¾‹å¦‚<code>forever start xxx.js -l c:/xxx.log -e c:/xxx_err.log -aï¼Œforever start xxx.js</code>è¡¨ç¤ºå¯åŠ¨xxx.jsã€‚</p><p>-l c:/xxx.logè¡¨ç¤ºå°†logä¿¡æ¯è¾“å‡ºåˆ°c:/xxx.logæ–‡ä»¶ã€‚<br>-e c:/xxx_err.logè¡¨ç¤ºå°†é”™è¯¯ä¿¡æ¯è¾“å‡ºåˆ°c:/xxx_err.logæ–‡ä»¶ã€‚<br>-a è¡¨ç¤ºæ–°çš„æ—¥å¿—æ·»åŠ åˆ°æ—§æ—¥å¿—ä¹‹åï¼Œå³ä¿ç•™æ—§æ—¥å¿—ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;File-Systemçš„é—®é¢˜&quot;&gt;&lt;a href=&quot;#File-Systemçš„é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;File Systemçš„é—®é¢˜&quot;&gt;&lt;/a&gt;File Systemçš„é—®é¢˜&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨File Systemæ¨¡å—å¯¹æ–‡ä»¶è¿›è¡Œè¯»å–ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;fs.readFile(&lt;span class=&quot;string&quot;&gt;&#39;./test.txt&#39;&lt;/span&gt;, (error, buffer) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (error) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.error(error)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// è¯»å–æ–‡ä»¶æˆåŠŸ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    res.write(buffer)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™æ ·æ“ä½œç®€å•æœ‰æ•ˆï¼Œä½†è¿™ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼š&lt;/p&gt;
&lt;p&gt;1.å ç”¨å†…å­˜&lt;br&gt;ä½¿ç”¨fsè¯»å–æ–‡ä»¶ï¼Œå®ƒæ˜¯ä¸€æ¬¡æ€§å°†æ–‡ä»¶çš„æ‰€æœ‰å†…å®¹è¯»å–åˆ°å†…å­˜ä¸­ï¼Œå†ä¸€æ¬¡æ€§å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œå› æ­¤ä¼šå ç”¨å¤§é‡å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;2.èµ„æºä½¿ç”¨æ•ˆç‡ä½&lt;br&gt;ä»ç£ç›˜è¯»å–æ–‡ä»¶æœŸé—´ï¼Œç£ç›˜å¤„äºå¿™ç¢ŒçŠ¶æ€ï¼Œè€Œç½‘ç»œå¤„äºç©ºé—²çŠ¶æ€ã€‚&lt;br&gt;ç£ç›˜è¯»å–å®Œæˆåï¼Œå¼€å§‹å‘é€æ–‡ä»¶æ—¶ï¼Œæƒ…å†µæ­£ç›¸åï¼Œç½‘ç»œå¤„äºå¿™ç¢ŒçŠ¶æ€ï¼Œæ­¤æ—¶ç£ç›˜å´å¤„äºç©ºé—²çŠ¶æ€&lt;/p&gt;
&lt;h2 id=&quot;Streamæµ&quot;&gt;&lt;a href=&quot;#Streamæµ&quot; class=&quot;headerlink&quot; title=&quot;Streamæµ&quot;&gt;&lt;/a&gt;Streamæµ&lt;/h2&gt;&lt;p&gt;ç›¸æ¯”File Systemï¼ŒStreamæµè¯»å–æ–‡ä»¶æ˜¯è¯»ä¸€ä»½ï¼Œå‘ä¸€ä»½ï¼ŒStreamæµçš„å†™å…¥æ“ä½œä¹Ÿæœ‰åŒæ ·ç‰¹ç‚¹ï¼Œå› æ­¤å¯ä»¥è§£å†³File Systemåœ¨ä¸Šé¢æåˆ°çš„2ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥å®ç°ä¸€ä¸ªç®€å•çš„æµï¼Œå°†1.txtæ–‡ä»¶çš„å†…å®¹å†™å…¥åˆ°2.txtä¸­ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; fs = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;fs&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// åˆ›å»ºä¸€ä¸ªå¯è¯»æµã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; readStream = fs.createReadStream(&lt;span class=&quot;string&quot;&gt;&#39;./1.txt&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// åˆ›å»ºä¸€ä¸ªå¯å†™æµã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; writeStream = fs.createWriteStream(&lt;span class=&quot;string&quot;&gt;&#39;./2.txt&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å°†å¯è¯»æµè¯»å–çš„æ•°æ®ï¼Œé€šè¿‡ç®¡é“pipeæ¨é€åˆ°å†™å…¥æµä¸­ï¼Œå³å¯å°†1.txtçš„å†…å®¹ï¼Œå†™å…¥åˆ°2.txtä¸­ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;readStream.pipe(writeStream)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// è¯»å–å‡ºç°é”™è¯¯æ—¶ä¼šè§¦å‘erroräº‹ä»¶ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;readStream.on(&lt;span class=&quot;string&quot;&gt;&#39;error&#39;&lt;/span&gt;, (error) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.error(error)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å†™å…¥å®Œæˆæ—¶ï¼Œè§¦å‘finishäº‹ä»¶ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;writeStream.on(&lt;span class=&quot;string&quot;&gt;&#39;finish&#39;&lt;/span&gt;, () =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&#39;finish&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;ä½¿ç”¨Zlibå‹ç¼©æ–‡ä»¶&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨Zlibå‹ç¼©æ–‡ä»¶&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨Zlibå‹ç¼©æ–‡ä»¶&quot;&gt;&lt;/a&gt;ä½¿ç”¨Zlibå‹ç¼©æ–‡ä»¶&lt;/h2&gt;&lt;p&gt;å¯ä»¥ä½¿ç”¨Zlibæ¨¡å—ï¼Œé…åˆStreamæµï¼Œå®ç°æ–‡ä»¶å‹ç¼©åŠŸèƒ½ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; fs = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;fs&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å¼•å…¥zlibæ¨¡å—ï¼Œç”¨äºå®ç°å‹ç¼©åŠŸèƒ½&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; zlib = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;zlib&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// åˆ›å»ºä¸€ä¸ªå¯è¯»æµã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; readStream = fs.createReadStream(&lt;span class=&quot;string&quot;&gt;&#39;./google.jpg&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// åˆ›å»ºä¸€ä¸ªå¯å†™æµã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; writeStream = fs.createWriteStream(&lt;span class=&quot;string&quot;&gt;&#39;./google.jpg.gz&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// åˆ›å»ºä¸€ä¸ªGzipå¯¹è±¡ï¼Œç”¨äºå°†æ–‡ä»¶å‹ç¼©æˆ.gzæ–‡ä»¶&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; gzip = zlib.createGzip()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å°†å¯è¯»æµè¯»å–çš„æ•°æ®ï¼Œå…ˆé€šè¿‡ç®¡é“pipeæ¨é€åˆ°gzipä¸­ï¼Œå†æ¨é€åˆ°å†™å…¥æµä¸­ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ä¹Ÿå°±æ˜¯å…ˆå°†å¯è¯»æµçš„æ•°æ®å‹ç¼©ï¼Œå†æ¨é€åˆ°å¯å†™æµä¸­ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;readStream.pipe(gzip).pipe(writeStream)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// è¯»å–å‡ºç°é”™è¯¯æ—¶ä¼šè§¦å‘erroräº‹ä»¶ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;readStream.on(&lt;span class=&quot;string&quot;&gt;&#39;error&#39;&lt;/span&gt;, (error) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.error(error)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å†™å…¥å®Œæˆæ—¶ï¼Œè§¦å‘finishäº‹ä»¶ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;writeStream.on(&lt;span class=&quot;string&quot;&gt;&#39;finish&#39;&lt;/span&gt;, () =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&#39;finish&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Node" scheme="https://zhanghao-web.github.io/categories/Node/"/>
    
    
      <category term="Node" scheme="https://zhanghao-web.github.io/tags/Node/"/>
    
  </entry>
  
  <entry>
    <title>Nodeå­¦ä¹ (åäºŒ) --ä½¿ç”¨async/awaitå¼‚æ­¥æ“ä½œæ•°æ®åº“</title>
    <link href="https://zhanghao-web.github.io/2019/04/29/Node/Node%E5%AD%A6%E4%B9%A0(%E5%8D%81%E4%BA%8C)%20--%E4%BD%BF%E7%94%A8async-await%E5%BC%82%E6%AD%A5%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    <id>https://zhanghao-web.github.io/2019/04/29/Node/Nodeå­¦ä¹ (åäºŒ) --ä½¿ç”¨async-awaitå¼‚æ­¥æ“ä½œæ•°æ®åº“/</id>
    <published>2019-04-29T07:08:07.000Z</published>
    <updated>2020-01-28T10:04:15.048Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸Šä¸€ç¯‡ä½¿ç”¨Node.jsæ“ä½œæ•°æ®åº“ï¼Œè™½ç„¶èƒ½å®ç°åŠŸèƒ½ï¼Œä½†æ˜¯å¼‚æ­¥æ“ä½œéœ€è¦ä¸æ–­å†™å›è°ƒå‡½æ•°ï¼Œä»£ç ä¸¥é‡å†—ä½™ï¼Œè€Œä¸”é˜…è¯»å›°éš¾ã€‚</p><p>å¯ä»¥ä½¿ç”¨<a href="https://github.com/haoxins/co-mysql" target="_blank" rel="noopener">co-mysql</a>ï¼Œå°†<code>query</code>æ–¹æ³•è¯¥å†™ä¸ºè¿”å›ä¸€ä¸ª<code>Promise</code>ï¼Œå°±å¯ä»¥ä½¿ç”¨<code>async/await</code>è¿›è¡Œå¼‚æ­¥å¤„ç†ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å‚è€ƒä¸€ä¸‹å®ƒçš„æºç ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å®ç°å°†å›è°ƒå‡½æ•°è½¬æ¢ä¸º</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = wrapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> slice = [].slice;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯¥æ¨¡å—å¯¼å‡ºä¸ºä¸€ä¸ªåŒ…è£…å‡½æ•°ï¼Œè¿è¡Œå®ƒçš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå¸¦æœ‰queryæ–¹æ³•çš„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wrapper</span>(<span class="params">client</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// clientå³ä¸ºmysql.createPoolæˆ–mysql.createConnectionæ–¹æ³•åˆ›å»ºçš„è¿æ¥å¯¹è±¡ã€‚</span></span><br><span class="line">  <span class="keyword">var</span> query = client.query;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> o = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  o.query = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// æå–è°ƒç”¨queryæ–¹æ³•æ—¶ï¼Œä¼ å…¥çš„æ‰€æœ‰å‚æ•°ï¼Œå°†å…¶å­˜å…¥ä¸€ä¸ªæ•°ç»„ã€‚</span></span><br><span class="line">    <span class="keyword">var</span> args = slice.call(<span class="built_in">arguments</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªPromiseå¯¹è±¡ï¼Œå®ƒå°†ä½œä¸ºo.queryçš„è¿”å›å€¼ï¼Œè®©å…¶æ”¯æŒasync/awaitæ–¹å¼è°ƒç”¨ã€‚</span></span><br><span class="line">    <span class="keyword">var</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// ä¸ºargså¢åŠ ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå®ƒå°†ä½œä¸ºclient.queryæ–¹æ³•çš„å›è°ƒå‡½æ•°è¿è¡Œï¼Œå®ƒæ¥æ”¶åˆ°ç»“æœæ—¶ï¼Œå°†è¿›è¡Œåˆ¤æ–­è¿è¡Œrejectè¿˜æ˜¯resolve</span></span><br><span class="line">      args.push(<span class="function"><span class="keyword">function</span> (<span class="params">err, rows</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          reject(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          resolve(rows);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ç”¨applyæ–¹æ³•ï¼Œå°†o.queryæ¥æ”¶åˆ°çš„å‚æ•°éƒ½ä¼ ç»™client.queryï¼Œå®ƒå¯ä»¥ç­‰åŒäº</span></span><br><span class="line">      <span class="comment">/* </span></span><br><span class="line"><span class="comment">        client.query(args[0], function(err, rows) &#123;</span></span><br><span class="line"><span class="comment">          if (err) &#123;</span></span><br><span class="line"><span class="comment">            reject(err);</span></span><br><span class="line"><span class="comment">          &#125; else &#123;</span></span><br><span class="line"><span class="comment">            resolve(rows);</span></span><br><span class="line"><span class="comment">          &#125;</span></span><br><span class="line"><span class="comment">        &#125;)</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      query.apply(client, args);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äºæ˜¯ä¸Šä¸€ç¯‡çš„ä»£ç å¯ä»¥è¿›è¡Œå¦‚ä¸‹ä¼˜åŒ–ï¼š<br><a id="more"></a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>)</span><br><span class="line"><span class="keyword">const</span> coMysql = <span class="built_in">require</span>(<span class="string">'co-mysql'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. è¿æ¥æœåŠ¡å™¨</span></span><br><span class="line"><span class="keyword">const</span> pool = mysql.createPool(&#123;</span><br><span class="line">  connectionLimit: <span class="number">10</span>,  <span class="comment">// å»ºç«‹çš„è¿æ¥æ•°é‡ï¼Œé»˜è®¤ä¸º10ä¸ª</span></span><br><span class="line">  host: <span class="string">'localhost'</span>,  <span class="comment">// åœ°å€</span></span><br><span class="line">  port: <span class="number">3306</span>,  <span class="comment">// ç«¯å£ï¼Œä¸ä¼ åˆ™é»˜è®¤3306</span></span><br><span class="line">  user: <span class="string">'root'</span>,  <span class="comment">// ç™»å½•å</span></span><br><span class="line">  password: <span class="string">''</span>,  <span class="comment">// å¯†ç </span></span><br><span class="line">  database: <span class="string">'test'</span>  <span class="comment">// è¿æ¥çš„æ•°æ®åº“</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> connection = coMysql(pool)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* const username = 'lily'</span></span><br><span class="line"><span class="comment">const password = '888888'</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">// å‘æ•°æ®åº“ä¸­æ’å…¥æ•°æ®</span></span><br><span class="line"><span class="comment">connection.query(`INSERT INTO user_table (username, password) VALUES ('$&#123;username&#125;', '$&#123;password&#125;')`, (err, data) =&gt; &#123;</span></span><br><span class="line"><span class="comment">  if (err) &#123;</span></span><br><span class="line"><span class="comment">    console.error(err)</span></span><br><span class="line"><span class="comment">  &#125; else &#123;</span></span><br><span class="line"><span class="comment">    console.log(data)</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">&#125;)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">// æŸ¥è¯¢user_tableè¡¨çš„æ•°æ®</span></span><br><span class="line"><span class="comment">connection.query(`SELECT * FROM User_table`, (err, data) =&gt; &#123;</span></span><br><span class="line"><span class="comment">  if (err) &#123;</span></span><br><span class="line"><span class="comment">    console.error(err)</span></span><br><span class="line"><span class="comment">  &#125; else &#123;</span></span><br><span class="line"><span class="comment">    console.log(data)</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">&#125;) */</span></span><br><span class="line"><span class="comment">// more</span></span><br><span class="line"><span class="comment">// 2. ä¸HTTPæ¨¡å—é…åˆä½¿ç”¨</span></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    pathname,</span><br><span class="line">    query</span><br><span class="line">  &#125; = url.parse(req.url, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (pathname === <span class="string">'/reg'</span>) &#123;</span><br><span class="line">    <span class="comment">// è·å–getè¯·æ±‚æ•°æ®</span></span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      username,</span><br><span class="line">      password</span><br><span class="line">    &#125; = query</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¡éªŒå‚æ•°æ˜¯å¦æ­£ç¡®</span></span><br><span class="line">    <span class="keyword">if</span> (!username || !password) &#123;</span><br><span class="line">      res.write(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">        error: <span class="number">1</span>,</span><br><span class="line">        msg: <span class="string">'ç”¨æˆ·åæˆ–å¯†ç ä¸å¯ä¸ºç©º'</span></span><br><span class="line">      &#125;))</span><br><span class="line">      res.end()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (username.length &gt; <span class="number">32</span>) &#123;</span><br><span class="line">      res.write(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">        error: <span class="number">1</span>,</span><br><span class="line">        msg: <span class="string">'ç”¨æˆ·åçš„é•¿åº¦ä¸å¯è¶…è¿‡32ä½'</span></span><br><span class="line">      &#125;))</span><br><span class="line">      res.end()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (password.length &gt; <span class="number">32</span>) &#123;</span><br><span class="line">      res.write(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">        error: <span class="number">1</span>,</span><br><span class="line">        msg: <span class="string">'å¯†ç çš„é•¿åº¦ä¸å¯è¶…è¿‡32ä½'</span></span><br><span class="line">      &#125;))</span><br><span class="line">      res.end()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  <span class="comment">// æ ¡éªŒé€šè¿‡ï¼Œå¼€å§‹æ³¨å†Œæµç¨‹</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">await</span> connection.query(<span class="string">`SELECT ID FROM User_table WHERE username='<span class="subst">$&#123;username&#125;</span>'`</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (data.length) &#123;</span><br><span class="line">          res.write(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">            error: <span class="number">1</span>,</span><br><span class="line">            msg: <span class="string">'æ­¤ç”¨æˆ·åå·²è¢«å ç”¨'</span></span><br><span class="line">          &#125;))</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// å°†ç”¨æˆ·åå’Œå¯†ç æ’å…¥æ•°æ®åº“</span></span><br><span class="line">          <span class="keyword">await</span> connection.query(<span class="string">`INSERT INTO userddd_table (username, password) VALUES('<span class="subst">$&#123;username&#125;</span>', '<span class="subst">$&#123;password&#125;</span>')`</span>)</span><br><span class="line"></span><br><span class="line">          res.write(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">            error: <span class="number">0</span>,</span><br><span class="line">            msg: <span class="string">'æ³¨å†ŒæˆåŠŸ'</span></span><br><span class="line">          &#125;))</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(error)</span><br><span class="line">        res.writeHead(<span class="number">500</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      res.end()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pathname === <span class="string">'/login'</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = []</span><br><span class="line"></span><br><span class="line">    req.on(<span class="string">'data'</span>, (buffer) =&gt; &#123;</span><br><span class="line">      <span class="comment">// è·å–POSTè¯·æ±‚çš„Bufferæ•°æ®</span></span><br><span class="line">      arr.push(buffer)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    req.on(<span class="string">'end'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="comment">// å°†Bufferæ•°æ®åˆå¹¶</span></span><br><span class="line">      <span class="keyword">let</span> buffer = Buffer.concat(arr)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¤„ç†æ¥æ”¶åˆ°çš„POSTæ•°æ®</span></span><br><span class="line">      <span class="keyword">const</span> post = <span class="built_in">JSON</span>.parse(buffer.toString())</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è·å–postè¯·æ±‚æ•°æ®</span></span><br><span class="line">      <span class="keyword">const</span> &#123;</span><br><span class="line">        username,</span><br><span class="line">        password</span><br><span class="line">      &#125; = post</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢</span></span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">await</span> connection.query(<span class="string">`SELECT username, password FROM User_table WHERE username='<span class="subst">$&#123;username&#125;</span>'`</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!data.length) &#123;</span><br><span class="line">          <span class="comment">// ç”¨æˆ·ä¸å­˜åœ¨</span></span><br><span class="line">          res.write(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">            error: <span class="number">1</span>,</span><br><span class="line">            msg: <span class="string">'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯'</span></span><br><span class="line">          &#125;))</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data[<span class="number">0</span>].password !== password) &#123;</span><br><span class="line">          <span class="comment">// å¯†ç ä¸æ­£ç¡®</span></span><br><span class="line">          res.write(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">            error: <span class="number">1</span>,</span><br><span class="line">            msg: <span class="string">'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯'</span></span><br><span class="line">          &#125;))</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          res.write(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">            error: <span class="number">0</span>,</span><br><span class="line">            msg: <span class="string">'ç™»å½•æˆåŠŸ'</span></span><br><span class="line">          &#125;))</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(error)</span><br><span class="line">        res.writeHead(<span class="number">500</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      res.end()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// è‹¥è¯·æ±‚ä¸ä¸ºæ¥å£ï¼Œåˆ™é»˜è®¤ä¸ºè¯·æ±‚æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (pathname !== <span class="string">'/favicon.ico'</span>) &#123;</span><br><span class="line">      fs.readFile(<span class="string">`.<span class="subst">$&#123;pathname&#125;</span>`</span>, (err, buffer) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          res.writeHead(<span class="number">404</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          res.write(buffer)</span><br><span class="line">        &#125;</span><br><span class="line">        res.end()</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      res.writeHead(<span class="number">404</span>)</span><br><span class="line">      res.end()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8080</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸Šä¸€ç¯‡ä½¿ç”¨Node.jsæ“ä½œæ•°æ®åº“ï¼Œè™½ç„¶èƒ½å®ç°åŠŸèƒ½ï¼Œä½†æ˜¯å¼‚æ­¥æ“ä½œéœ€è¦ä¸æ–­å†™å›è°ƒå‡½æ•°ï¼Œä»£ç ä¸¥é‡å†—ä½™ï¼Œè€Œä¸”é˜…è¯»å›°éš¾ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨&lt;a href=&quot;https://github.com/haoxins/co-mysql&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;co-mysql&lt;/a&gt;ï¼Œå°†&lt;code&gt;query&lt;/code&gt;æ–¹æ³•è¯¥å†™ä¸ºè¿”å›ä¸€ä¸ª&lt;code&gt;Promise&lt;/code&gt;ï¼Œå°±å¯ä»¥ä½¿ç”¨&lt;code&gt;async/await&lt;/code&gt;è¿›è¡Œå¼‚æ­¥å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥å‚è€ƒä¸€ä¸‹å®ƒçš„æºç ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å®ç°å°†å›è°ƒå‡½æ•°è½¬æ¢ä¸º&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;module&lt;/span&gt;.exports = wrapper;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; slice = [].slice;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// è¯¥æ¨¡å—å¯¼å‡ºä¸ºä¸€ä¸ªåŒ…è£…å‡½æ•°ï¼Œè¿è¡Œå®ƒçš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå¸¦æœ‰queryæ–¹æ³•çš„å¯¹è±¡ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;wrapper&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;client&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// clientå³ä¸ºmysql.createPoolæˆ–mysql.createConnectionæ–¹æ³•åˆ›å»ºçš„è¿æ¥å¯¹è±¡ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; query = client.query;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; o = &amp;#123;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  o.query = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// æå–è°ƒç”¨queryæ–¹æ³•æ—¶ï¼Œä¼ å…¥çš„æ‰€æœ‰å‚æ•°ï¼Œå°†å…¶å­˜å…¥ä¸€ä¸ªæ•°ç»„ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; args = slice.call(&lt;span class=&quot;built_in&quot;&gt;arguments&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// åˆ›å»ºä¸€ä¸ªPromiseå¯¹è±¡ï¼Œå®ƒå°†ä½œä¸ºo.queryçš„è¿”å›å€¼ï¼Œè®©å…¶æ”¯æŒasync/awaitæ–¹å¼è°ƒç”¨ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; p = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Promise&lt;/span&gt;(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;resolve, reject&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// ä¸ºargså¢åŠ ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå®ƒå°†ä½œä¸ºclient.queryæ–¹æ³•çš„å›è°ƒå‡½æ•°è¿è¡Œï¼Œå®ƒæ¥æ”¶åˆ°ç»“æœæ—¶ï¼Œå°†è¿›è¡Œåˆ¤æ–­è¿è¡Œrejectè¿˜æ˜¯resolve&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      args.push(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;err, rows&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (err) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          reject(err);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          resolve(rows);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// ç”¨applyæ–¹æ³•ï¼Œå°†o.queryæ¥æ”¶åˆ°çš„å‚æ•°éƒ½ä¼ ç»™client.queryï¼Œå®ƒå¯ä»¥ç­‰åŒäº&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;/* &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;        client.query(args[0], function(err, rows) &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;          if (err) &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;            reject(err);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;          &amp;#125; else &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;            resolve(rows);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;          &amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;        &amp;#125;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;      */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      query.apply(client, args);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; p;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; o;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;äºæ˜¯ä¸Šä¸€ç¯‡çš„ä»£ç å¯ä»¥è¿›è¡Œå¦‚ä¸‹ä¼˜åŒ–ï¼š&lt;br&gt;
    
    </summary>
    
      <category term="Node" scheme="https://zhanghao-web.github.io/categories/Node/"/>
    
    
      <category term="Node" scheme="https://zhanghao-web.github.io/tags/Node/"/>
    
  </entry>
  
  <entry>
    <title>Nodeå­¦ä¹ (åä¸€) --ä½¿ç”¨Nodejsæ“ä½œæ•°æ®åº“</title>
    <link href="https://zhanghao-web.github.io/2019/04/21/Node/Node%E5%AD%A6%E4%B9%A0(%E5%8D%81%E4%B8%80%EF%BC%89--%E4%BD%BF%E7%94%A8Nodejs%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    <id>https://zhanghao-web.github.io/2019/04/21/Node/Nodeå­¦ä¹ (åä¸€ï¼‰--ä½¿ç”¨Nodejsæ“ä½œæ•°æ®åº“/</id>
    <published>2019-04-21T13:51:12.000Z</published>
    <updated>2020-01-28T10:04:15.047Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Nodejsæ“ä½œæ•°æ®åº“"><a href="#Nodejsæ“ä½œæ•°æ®åº“" class="headerlink" title="Nodejsæ“ä½œæ•°æ®åº“"></a>Nodejsæ“ä½œæ•°æ®åº“</h2><p>Nodejsæ“ä½œæ•°æ®åº“éœ€è¦ç”¨åˆ°<code>mysql</code>æ¨¡å—ï¼Œé€šè¿‡<code>npm i mysql -D</code>è¿›è¡Œå®‰è£…ã€‚</p><p>ä¹‹åå¯ä»¥é€šè¿‡<code>mysql.createConnection</code>æ–¹æ³•æ–°å»ºä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼Œéœ€è¦ä¼ å…¥çš„å‚æ•°æœ‰åœ°å€ã€ç«¯å£ã€ç™»å½•åã€å¯†ç ï¼Œä»¥åŠéœ€è¦è¿æ¥çš„æ•°æ®åº“ã€‚</p><p><code>mysql.createConnection</code>ä¼šè¿”å›ä¸€ä¸ª<code>connection</code>å¯¹è±¡ï¼Œå¯ä½¿ç”¨<code>connection.query</code>æ–¹æ³•ï¼Œä¼ å…¥SQLè¯­å¥ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œç›¸åº”æ“ä½œã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. è¿æ¥æœåŠ¡å™¨</span></span><br><span class="line"><span class="keyword">const</span> connection = mysql.createConnection(&#123;</span><br><span class="line">  host: <span class="string">'localhost'</span>,  <span class="comment">// åœ°å€</span></span><br><span class="line">  port: <span class="number">3306</span>,  <span class="comment">// ç«¯å£ï¼Œä¸ä¼ åˆ™é»˜è®¤3306</span></span><br><span class="line">  user: <span class="string">'root'</span>,  <span class="comment">// ç™»å½•å</span></span><br><span class="line">  password: <span class="string">''</span>,  <span class="comment">// å¯†ç </span></span><br><span class="line">  database: <span class="string">'test'</span>  <span class="comment">// è¿æ¥çš„æ•°æ®åº“</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> username = <span class="string">'zzz'</span></span><br><span class="line"><span class="keyword">const</span> password = <span class="string">'888888'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘æ•°æ®åº“ä¸­æ’å…¥æ•°æ®</span></span><br><span class="line">connection.query(<span class="string">`INSERT INTO user_table (username, password) VALUES ('<span class="subst">$&#123;username&#125;</span>', '<span class="subst">$&#123;password&#125;</span>')`</span>, (err, data) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥è¯¢user_tableè¡¨çš„æ•°æ®</span></span><br><span class="line">db.query(<span class="string">`SELECT * FROM User_table`</span>, (err, data) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>INSERTè¯­å¥çš„æ‰“å°çš„æ˜¯æ’å…¥ç»“æœï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">OkPacket &#123;</span><br><span class="line">  fieldCount: <span class="number">0</span>,</span><br><span class="line">  affectedRows: <span class="number">1</span>,</span><br><span class="line">  insertId: <span class="number">8</span>,<span class="comment">// è¿”å›äº†å½“å‰æ’å…¥è¯­å¥çš„idï¼Œå¯ä»¥ç”¨æ¥å‘ŠçŸ¥å‰ç«¯æ’å…¥æ•°æ®çš„id</span></span><br><span class="line">  serverStatus: <span class="number">2</span>,</span><br><span class="line">  warningCount: <span class="number">0</span>,</span><br><span class="line">  message: <span class="string">''</span>,</span><br><span class="line">  protocol41: <span class="literal">true</span>,</span><br><span class="line">  changedRows: <span class="number">0</span> &#125;</span><br></pre></td></tr></table></figure><p>SELECTè¯­å¥çš„æ‰“å°ç»“æœä¸ºæŸ¥è¯¢åˆ°çš„æ‰€æœ‰æ•°æ®ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ RowDataPacket &#123; <span class="attr">ID</span>: <span class="number">1</span>, <span class="attr">username</span>: <span class="string">'lee'</span>, <span class="attr">password</span>: <span class="string">'123456'</span> &#125;,</span><br><span class="line">  RowDataPacket &#123; <span class="attr">ID</span>: <span class="number">3</span>, <span class="attr">username</span>: <span class="string">'chen'</span>, <span class="attr">password</span>: <span class="string">'654321'</span> &#125;,</span><br><span class="line">  RowDataPacket &#123; <span class="attr">ID</span>: <span class="number">8</span>, <span class="attr">username</span>: <span class="string">'zzz'</span>, <span class="attr">password</span>: <span class="string">'888888'</span> &#125; ]</span><br></pre></td></tr></table></figure><p>ä½†<code>mysql.createConnection</code>æ–¹æ³•æœ‰ä¸€ä¸ªç¼ºé™·ï¼Œå°±æ˜¯å®ƒä¸€æ¬¡åªèƒ½åˆ›å»ºä¸€ä¸ªè¿æ¥ï¼Œä¸€æ—¦æœ‰å¤šä¸ªç”¨æˆ·åŒæ—¶è¯·æ±‚ï¼Œå°±ä¼šé€ æˆè¯·æ±‚æ’é˜Ÿç­‰å¾…ã€‚</p><p>å› æ­¤ä¸ºäº†æé«˜æ€§èƒ½ï¼Œå¯ä»¥æ”¹ç”¨<code>mysql.createPool</code>æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªè¿æ¥æ± ï¼Œå®ƒå¯ä»¥åˆ›å»ºnä¸ªä¸æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥ï¼Œéœ€è¦ä½¿ç”¨æ—¶ï¼Œå¯ä»¥è‡ªåŠ¨ä»ä¸­é€‰å–ä¸€ä¸ªç©ºé—²çš„è¿æ¥ä½¿ç”¨ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> connection = mysql.createPool(&#123;</span><br><span class="line">  connectionLimit: <span class="number">10</span>,  <span class="comment">// å»ºç«‹çš„è¿æ¥æ•°é‡ï¼Œé»˜è®¤ä¸º10ä¸ª</span></span><br><span class="line">  host: <span class="string">'localhost'</span>,  <span class="comment">// åœ°å€</span></span><br><span class="line">  port: <span class="number">3306</span>,  <span class="comment">// ç«¯å£ï¼Œä¸ä¼ åˆ™é»˜è®¤3306</span></span><br><span class="line">  user: <span class="string">'root'</span>,  <span class="comment">// ç™»å½•å</span></span><br><span class="line">  password: <span class="string">''</span>,  <span class="comment">// å¯†ç </span></span><br><span class="line">  database: <span class="string">'test'</span>  <span class="comment">// è¿æ¥çš„æ•°æ®åº“</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="ä¸HTTPæ¨¡å—é…åˆå®ç°æ¥å£"><a href="#ä¸HTTPæ¨¡å—é…åˆå®ç°æ¥å£" class="headerlink" title="ä¸HTTPæ¨¡å—é…åˆå®ç°æ¥å£"></a>ä¸HTTPæ¨¡å—é…åˆå®ç°æ¥å£</h2><p>å®Œæˆäº†åŸºæœ¬æ“ä½œåï¼Œå°±å¯ä»¥å®ç°ä¸€ä¸ªå®Œæ•´çš„æ³¨å†Œã€ç™»å½•æµç¨‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. è¿æ¥æœåŠ¡å™¨</span></span><br><span class="line"><span class="keyword">const</span> connection = mysql.createPool(&#123;</span><br><span class="line">  connectionLimit: <span class="number">10</span>,  <span class="comment">// å»ºç«‹çš„è¿æ¥æ•°é‡ï¼Œé»˜è®¤ä¸º10ä¸ª</span></span><br><span class="line">  host: <span class="string">'localhost'</span>,  <span class="comment">// åœ°å€</span></span><br><span class="line">  port: <span class="number">3306</span>,  <span class="comment">// ç«¯å£ï¼Œä¸ä¼ åˆ™é»˜è®¤3306</span></span><br><span class="line">  user: <span class="string">'root'</span>,  <span class="comment">// ç™»å½•å</span></span><br><span class="line">  password: <span class="string">''</span>,  <span class="comment">// å¯†ç </span></span><br><span class="line">  database: <span class="string">'test'</span>  <span class="comment">// è¿æ¥çš„æ•°æ®åº“</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ä¸HTTPæ¨¡å—é…åˆä½¿ç”¨</span></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    pathname,</span><br><span class="line">    query</span><br><span class="line">  &#125; = url.parse(req.url, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (pathname === <span class="string">'/reg'</span>) &#123;</span><br><span class="line">    <span class="comment">// è·å–getè¯·æ±‚æ•°æ®</span></span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      username,</span><br><span class="line">      password</span><br><span class="line">    &#125; = query</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¡éªŒå‚æ•°æ˜¯å¦æ­£ç¡®</span></span><br><span class="line">    <span class="keyword">if</span> (!username || !password) &#123;</span><br><span class="line">      res.write(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">        error: <span class="number">1</span>,</span><br><span class="line">        msg: <span class="string">'ç”¨æˆ·åæˆ–å¯†ç ä¸å¯ä¸ºç©º'</span></span><br><span class="line">      &#125;))</span><br><span class="line">      res.end()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (username.length &gt; <span class="number">32</span>) &#123;</span><br><span class="line">      res.write(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">        error: <span class="number">1</span>,</span><br><span class="line">        msg: <span class="string">'ç”¨æˆ·åçš„é•¿åº¦ä¸å¯è¶…è¿‡32ä½'</span></span><br><span class="line">      &#125;))</span><br><span class="line">      res.end()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (password.length &gt; <span class="number">32</span>) &#123;</span><br><span class="line">      res.write(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">        error: <span class="number">1</span>,</span><br><span class="line">        msg: <span class="string">'å¯†ç çš„é•¿åº¦ä¸å¯è¶…è¿‡32ä½'</span></span><br><span class="line">      &#125;))</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  <span class="comment">// æ ¡éªŒé€šè¿‡ï¼Œå¼€å§‹æ³¨å†Œæµç¨‹</span></span><br><span class="line">      <span class="comment">// æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨</span></span><br><span class="line">      connection.query(<span class="string">`SELECT ID FROM User_table WHERE username='<span class="subst">$&#123;username&#125;</span>'`</span>, (err, data) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          res.writeHead(<span class="number">500</span>)</span><br><span class="line">          res.end()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (data.length) &#123;</span><br><span class="line">            res.write(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">              error: <span class="number">1</span>,</span><br><span class="line">              msg: <span class="string">'æ­¤ç”¨æˆ·åå·²è¢«å ç”¨'</span></span><br><span class="line">            &#125;))</span><br><span class="line">            res.end()</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å°†ç”¨æˆ·åå’Œå¯†ç æ’å…¥æ•°æ®åº“</span></span><br><span class="line">            connection.query(<span class="string">`INSERT INTO user_table (username, password) VALUES('<span class="subst">$&#123;username&#125;</span>', '<span class="subst">$&#123;password&#125;</span>')`</span>, (err, data) =&gt; &#123;</span><br><span class="line">              <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                res.writeHead(<span class="number">500</span>)</span><br><span class="line">                res.end()</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                res.write(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">                  error: <span class="number">0</span>,</span><br><span class="line">                  msg: <span class="string">'æ³¨å†ŒæˆåŠŸ'</span></span><br><span class="line">                &#125;))</span><br><span class="line">                res.end()</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pathname === <span class="string">'/login'</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = []</span><br><span class="line"></span><br><span class="line">    req.on(<span class="string">'data'</span>, (buffer) =&gt; &#123;</span><br><span class="line">      <span class="comment">// è·å–POSTè¯·æ±‚çš„Bufferæ•°æ®</span></span><br><span class="line">      arr.push(buffer)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    req.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">      <span class="comment">// å°†Bufferæ•°æ®åˆå¹¶</span></span><br><span class="line">      <span class="keyword">let</span> buffer = Buffer.concat(arr)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¤„ç†æ¥æ”¶åˆ°çš„POSTæ•°æ®</span></span><br><span class="line">      <span class="keyword">const</span> post = <span class="built_in">JSON</span>.parse(buffer.toString())</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è·å–postè¯·æ±‚æ•°æ®</span></span><br><span class="line">      <span class="keyword">const</span> &#123;</span><br><span class="line">        username,</span><br><span class="line">        password</span><br><span class="line">      &#125; = post</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢</span></span><br><span class="line">      connection.query(<span class="string">`SELECT username, password FROM User_table WHERE username='<span class="subst">$&#123;username&#125;</span>'`</span>, (err, data) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          <span class="built_in">console</span>.error(err)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (!data.length) &#123;</span><br><span class="line">            <span class="comment">// ç”¨æˆ·ä¸å­˜åœ¨</span></span><br><span class="line">            res.write(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">              error: <span class="number">1</span>,</span><br><span class="line">              msg: <span class="string">'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯'</span></span><br><span class="line">            &#125;))</span><br><span class="line">            res.end()</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data[<span class="number">0</span>].password !== password) &#123;</span><br><span class="line">            <span class="comment">// å¯†ç ä¸æ­£ç¡®</span></span><br><span class="line">            res.write(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">              error: <span class="number">1</span>,</span><br><span class="line">              msg: <span class="string">'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯'</span></span><br><span class="line">            &#125;))</span><br><span class="line">            res.end()</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.write(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">              error: <span class="number">0</span>,</span><br><span class="line">              msg: <span class="string">'ç™»å½•æˆåŠŸ'</span></span><br><span class="line">            &#125;))</span><br><span class="line">            res.end()</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// è‹¥è¯·æ±‚ä¸ä¸ºæ¥å£ï¼Œåˆ™é»˜è®¤ä¸ºè¯·æ±‚æ–‡ä»¶</span></span><br><span class="line">    fs.readFile(<span class="string">`.<span class="subst">$&#123;pathname&#125;</span>`</span>, (err, buffer) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        res.writeHead(<span class="number">404</span>)</span><br><span class="line">        res.write(buffer)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.write(buffer)</span><br><span class="line">      &#125;</span><br><span class="line">      res.end()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8080</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Nodejsæ“ä½œæ•°æ®åº“&quot;&gt;&lt;a href=&quot;#Nodejsæ“ä½œæ•°æ®åº“&quot; class=&quot;headerlink&quot; title=&quot;Nodejsæ“ä½œæ•°æ®åº“&quot;&gt;&lt;/a&gt;Nodejsæ“ä½œæ•°æ®åº“&lt;/h2&gt;&lt;p&gt;Nodejsæ“ä½œæ•°æ®åº“éœ€è¦ç”¨åˆ°&lt;code&gt;mysql&lt;/code&gt;æ¨¡å—ï¼Œé€šè¿‡&lt;code&gt;npm i mysql -D&lt;/code&gt;è¿›è¡Œå®‰è£…ã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹åå¯ä»¥é€šè¿‡&lt;code&gt;mysql.createConnection&lt;/code&gt;æ–¹æ³•æ–°å»ºä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼Œéœ€è¦ä¼ å…¥çš„å‚æ•°æœ‰åœ°å€ã€ç«¯å£ã€ç™»å½•åã€å¯†ç ï¼Œä»¥åŠéœ€è¦è¿æ¥çš„æ•°æ®åº“ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;mysql.createConnection&lt;/code&gt;ä¼šè¿”å›ä¸€ä¸ª&lt;code&gt;connection&lt;/code&gt;å¯¹è±¡ï¼Œå¯ä½¿ç”¨&lt;code&gt;connection.query&lt;/code&gt;æ–¹æ³•ï¼Œä¼ å…¥SQLè¯­å¥ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œç›¸åº”æ“ä½œã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; mysql = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;mysql&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 1. è¿æ¥æœåŠ¡å™¨&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; connection = mysql.createConnection(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  host: &lt;span class=&quot;string&quot;&gt;&#39;localhost&#39;&lt;/span&gt;,  &lt;span class=&quot;comment&quot;&gt;// åœ°å€&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  port: &lt;span class=&quot;number&quot;&gt;3306&lt;/span&gt;,  &lt;span class=&quot;comment&quot;&gt;// ç«¯å£ï¼Œä¸ä¼ åˆ™é»˜è®¤3306&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  user: &lt;span class=&quot;string&quot;&gt;&#39;root&#39;&lt;/span&gt;,  &lt;span class=&quot;comment&quot;&gt;// ç™»å½•å&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  password: &lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;,  &lt;span class=&quot;comment&quot;&gt;// å¯†ç &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  database: &lt;span class=&quot;string&quot;&gt;&#39;test&#39;&lt;/span&gt;  &lt;span class=&quot;comment&quot;&gt;// è¿æ¥çš„æ•°æ®åº“&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; username = &lt;span class=&quot;string&quot;&gt;&#39;zzz&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; password = &lt;span class=&quot;string&quot;&gt;&#39;888888&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å‘æ•°æ®åº“ä¸­æ’å…¥æ•°æ®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;connection.query(&lt;span class=&quot;string&quot;&gt;`INSERT INTO user_table (username, password) VALUES (&#39;&lt;span class=&quot;subst&quot;&gt;$&amp;#123;username&amp;#125;&lt;/span&gt;&#39;, &#39;&lt;span class=&quot;subst&quot;&gt;$&amp;#123;password&amp;#125;&lt;/span&gt;&#39;)`&lt;/span&gt;, (err, data) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (err) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.error(err)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(data)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// æŸ¥è¯¢user_tableè¡¨çš„æ•°æ®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;db.query(&lt;span class=&quot;string&quot;&gt;`SELECT * FROM User_table`&lt;/span&gt;, (err, data) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (err) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.error(err)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(data)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;INSERTè¯­å¥çš„æ‰“å°çš„æ˜¯æ’å…¥ç»“æœï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;OkPacket &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  fieldCount: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  affectedRows: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  insertId: &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;,	&lt;span class=&quot;comment&quot;&gt;// è¿”å›äº†å½“å‰æ’å…¥è¯­å¥çš„idï¼Œå¯ä»¥ç”¨æ¥å‘ŠçŸ¥å‰ç«¯æ’å…¥æ•°æ®çš„id&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  serverStatus: &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  warningCount: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  message: &lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  protocol41: &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  changedRows: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;SELECTè¯­å¥çš„æ‰“å°ç»“æœä¸ºæŸ¥è¯¢åˆ°çš„æ‰€æœ‰æ•°æ®ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[ RowDataPacket &amp;#123; &lt;span class=&quot;attr&quot;&gt;ID&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;attr&quot;&gt;username&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&#39;lee&#39;&lt;/span&gt;, &lt;span class=&quot;attr&quot;&gt;password&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&#39;123456&#39;&lt;/span&gt; &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  RowDataPacket &amp;#123; &lt;span class=&quot;attr&quot;&gt;ID&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;attr&quot;&gt;username&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&#39;chen&#39;&lt;/span&gt;, &lt;span class=&quot;attr&quot;&gt;password&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&#39;654321&#39;&lt;/span&gt; &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  RowDataPacket &amp;#123; &lt;span class=&quot;attr&quot;&gt;ID&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;, &lt;span class=&quot;attr&quot;&gt;username&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&#39;zzz&#39;&lt;/span&gt;, &lt;span class=&quot;attr&quot;&gt;password&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&#39;888888&#39;&lt;/span&gt; &amp;#125; ]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä½†&lt;code&gt;mysql.createConnection&lt;/code&gt;æ–¹æ³•æœ‰ä¸€ä¸ªç¼ºé™·ï¼Œå°±æ˜¯å®ƒä¸€æ¬¡åªèƒ½åˆ›å»ºä¸€ä¸ªè¿æ¥ï¼Œä¸€æ—¦æœ‰å¤šä¸ªç”¨æˆ·åŒæ—¶è¯·æ±‚ï¼Œå°±ä¼šé€ æˆè¯·æ±‚æ’é˜Ÿç­‰å¾…ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ä¸ºäº†æé«˜æ€§èƒ½ï¼Œå¯ä»¥æ”¹ç”¨&lt;code&gt;mysql.createPool&lt;/code&gt;æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªè¿æ¥æ± ï¼Œå®ƒå¯ä»¥åˆ›å»ºnä¸ªä¸æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥ï¼Œéœ€è¦ä½¿ç”¨æ—¶ï¼Œå¯ä»¥è‡ªåŠ¨ä»ä¸­é€‰å–ä¸€ä¸ªç©ºé—²çš„è¿æ¥ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; connection = mysql.createPool(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  connectionLimit: &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;,  &lt;span class=&quot;comment&quot;&gt;// å»ºç«‹çš„è¿æ¥æ•°é‡ï¼Œé»˜è®¤ä¸º10ä¸ª&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  host: &lt;span class=&quot;string&quot;&gt;&#39;localhost&#39;&lt;/span&gt;,  &lt;span class=&quot;comment&quot;&gt;// åœ°å€&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  port: &lt;span class=&quot;number&quot;&gt;3306&lt;/span&gt;,  &lt;span class=&quot;comment&quot;&gt;// ç«¯å£ï¼Œä¸ä¼ åˆ™é»˜è®¤3306&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  user: &lt;span class=&quot;string&quot;&gt;&#39;root&#39;&lt;/span&gt;,  &lt;span class=&quot;comment&quot;&gt;// ç™»å½•å&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  password: &lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;,  &lt;span class=&quot;comment&quot;&gt;// å¯†ç &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  database: &lt;span class=&quot;string&quot;&gt;&#39;test&#39;&lt;/span&gt;  &lt;span class=&quot;comment&quot;&gt;// è¿æ¥çš„æ•°æ®åº“&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Node" scheme="https://zhanghao-web.github.io/categories/Node/"/>
    
    
      <category term="Node" scheme="https://zhanghao-web.github.io/tags/Node/"/>
    
  </entry>
  
  <entry>
    <title>Nodeå­¦ä¹ (å) --æ•°æ®åº“å…¥é—¨</title>
    <link href="https://zhanghao-web.github.io/2019/04/21/Node/Node%E5%AD%A6%E4%B9%A0(%E5%8D%81)%20--%E6%95%B0%E6%8D%AE%E5%BA%93%E5%85%A5%E9%97%A8/"/>
    <id>https://zhanghao-web.github.io/2019/04/21/Node/Nodeå­¦ä¹ (å) --æ•°æ®åº“å…¥é—¨/</id>
    <published>2019-04-21T13:43:12.000Z</published>
    <updated>2020-01-28T10:04:15.046Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ•°æ®åº“çš„åˆ†ç±»"><a href="#æ•°æ®åº“çš„åˆ†ç±»" class="headerlink" title="æ•°æ®åº“çš„åˆ†ç±»"></a>æ•°æ®åº“çš„åˆ†ç±»</h2><p>1.<strong>æ–‡ä»¶æ•°æ®åº“</strong> å®ƒçš„ä¼˜ç‚¹æ˜¯ï¼šæ•°æ®ä¿å­˜åœ¨å•ä¸€æ–‡ä»¶ä¸­ï¼Œå› æ­¤éƒ¨ç½²ååˆ†æ–¹ä¾¿ï¼Œå¸¸ç”¨æ¥åµŒå…¥åˆ°APPä¸­ä¿å­˜æ•°æ®ï¼Œä»¥åŠæ‰‹æœºä¸­çš„çŸ­ä¿¡ã€é€šè¯è®°å½•ç­‰ã€‚</p><p>å¸¸ç”¨çš„æœ‰SQLiteã€Accessç­‰ã€‚</p><p>2.<strong>å…³ç³»å‹æ•°æ®åº“</strong> å…³ç³»å‹æ•°æ®åº“çš„åŠŸèƒ½å¼ºå¤§ï¼Œé€‚ç”¨åœºæ™¯ä¸°å¯Œï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯æ•°æ®ä¹‹é—´äº’ç›¸æ˜¯å…³è”çš„ã€‚</p><p>æ¯”å¦‚æ·˜å®ï¼Œä¸€ä¸ªç”¨æˆ·ä¸‹æœ‰ä¸ªäººä¿¡æ¯ã€è®¢å•ä¿¡æ¯ã€èŠå¤©è®°å½•ç­‰ï¼Œå¯ä»¥åˆ†åˆ«å­˜å‚¨åœ¨ä¸åŒè¡¨ä¸­ï¼Œé€šè¿‡ç”¨æˆ·IDç›¸äº’å…³è”èµ·æ¥ã€‚ä½†å®ƒçš„æ€§èƒ½ä¸æ˜¯æœ€å¼ºçš„ã€‚</p><p>å¸¸ç”¨æœ‰SQLã€‚</p><p>3.<strong>åˆ†å¸ƒå¼æ•°æ®åº“</strong> å®ƒçš„ç‰¹ç‚¹æ˜¯å¯ä»¥å®‰è£…åœ¨å¤šå°æœºå™¨ä¸Šï¼Œå¯ä»¥å°†æŸ¥è¯¢ç­‰æ“ä½œåˆ†æ•£å¼€ï¼Œåˆç†åˆ©ç”¨æœåŠ¡å™¨èµ„æºã€‚</p><p>è¿˜å¯ä»¥å°†æ•°æ®è®¾ç½®å¤šä¸ªå¤‡ä»½ï¼Œä¸€æ—¦å…¶ä¸­ä¸€å°æœåŠ¡å™¨å¼‚å¸¸ï¼Œå¯ä»¥ç”±å…¶ä»–æœåŠ¡å™¨åŒæ­¥æ•°æ®ã€‚</p><p>å¸¸ç”¨çš„æœ‰MongoDBã€‚</p><p>4.<strong>NoSQL</strong> å®ƒåªèƒ½æ”¯æŒç®€å•æŸ¥è¯¢ï¼Œä½†æ€§èƒ½å¼ºäºå…³ç³»å‹æ•°æ®åº“ï¼Œå¸¸ç”¨æ¥åšæ¥å£ã€æ•°æ®ç¼“å­˜ç­‰ã€‚</p><p>å¸¸ç”¨çš„æœ‰MongoDBã€Memcachedã€Redisç­‰ã€‚</p><h2 id="SQLè¯­å¥"><a href="#SQLè¯­å¥" class="headerlink" title="SQLè¯­å¥"></a>SQLè¯­å¥</h2><p>ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€(Structured Query Language)ç®€ç§°SQLï¼Œå®ƒä¸»è¦ç”¨æ¥å­˜å–ã€æŸ¥è¯¢ã€æ›´æ–°å’Œç®¡ç†å…³ç³»æ•°æ®åº“ç³»ç»Ÿã€‚</p><p>SQL åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šæ•°æ®å®šä¹‰è¯­è¨€ (DDL)å’Œæ•°æ®æ“ä½œè¯­è¨€ (DML) ã€‚</p><h2 id="DDLè¯­å¥"><a href="#DDLè¯­å¥" class="headerlink" title="DDLè¯­å¥"></a>DDLè¯­å¥</h2><p>CREATE DATABASE - åˆ›å»ºæ–°æ•°æ®åº“<br>ALTER DATABASE - ä¿®æ”¹æ•°æ®åº“<br>CREATE TABLE - åˆ›å»ºæ–°è¡¨<br>ALTER TABLE - å˜æ›´ï¼ˆæ”¹å˜ï¼‰æ•°æ®åº“è¡¨<br>DROP TABLE - åˆ é™¤è¡¨<br>CREATE INDEX - åˆ›å»ºç´¢å¼•ï¼ˆæœç´¢é”®ï¼‰<br>DROP INDEX - åˆ é™¤ç´¢å¼•</p><h2 id="DDMè¯­å¥"><a href="#DDMè¯­å¥" class="headerlink" title="DDMè¯­å¥"></a>DDMè¯­å¥</h2><p>æ•°æ®æ“ä½œè¯­è¨€ (DML) æ˜¯æœ€å¸¸ç”¨çš„æ“ä½œï¼Œå³å¢åˆ æ”¹æŸ¥ï¼Œå®ƒåŒ…æ‹¬å¦‚ä¸‹éƒ¨åˆ†ï¼š</p><p>1.å¢INSERT INTO - å‘æ•°æ®åº“è¡¨ä¸­æ’å…¥æ•°æ®<br>INSERT INTO &lt;è¡¨&gt; (å­—æ®µ, â€¦) VALUES(å€¼, â€¦);<br>INSERT INTO user_table (username, password) VALUES(â€˜leeâ€™, â€˜123456â€™);<br>åœ¨user_tableè¡¨ä¸­æ’å…¥ä¸€æ¡æ•°æ®ã€‚</p><p>2.åˆ DELETE - ä»æ•°æ®åº“è¡¨ä¸­åˆ é™¤æ•°æ®<br>DELETE FROM &lt;è¡¨&gt; WHERE æ¡ä»¶;<br>DELETE FROM user_table WHERE ID=2;<br>åˆ é™¤user_tableè¡¨ä¸­IDä¸º2çš„é¡¹ç›®ã€‚</p><p>3.æ”¹UPDATE - æ›´æ–°æ•°æ®åº“è¡¨ä¸­çš„æ•°æ®<br>UPDATE &lt;è¡¨&gt; SET å­—æ®µ=æ–°å€¼,å­—æ®µ=æ–°å€¼,â€¦ WHERE æ¡ä»¶;<br>UPDATE user_table SET password=â€™888888â€™, username=â€™chenâ€™ WHERE ID=1;<br>å°†user_tableè¡¨ä¸­IDä¸º1çš„ç”¨æˆ·åå’Œå¯†ç æ›´æ–°ã€‚</p><p>4.æŸ¥SELECT - ä»æ•°æ®åº“è¡¨ä¸­è·å–æ•°æ®<br>SELECT å­—æ®µåˆ—è¡¨ FROM &lt;è¡¨&gt; WHERE æ¡ä»¶ ORDER BY å­—æ®µ LIMIT 30,30;<br>SELECT ID FROM user_table WHERE username=â€˜leeâ€™ ORDER BY ID ASC LIMIT 0,10;<br>æŸ¥è¯¢user_tableè¡¨ä¸­usernameä¸ºleeçš„ç”¨æˆ·çš„IDï¼Œå–0~10ä¸ªï¼ŒæŒ‰å‡åºæ’åˆ—ã€‚</p><h2 id="æ•°æ®åº“ç´¢å¼•"><a href="#æ•°æ®åº“ç´¢å¼•" class="headerlink" title="æ•°æ®åº“ç´¢å¼•"></a>æ•°æ®åº“ç´¢å¼•</h2><p>æ•°æ®åº“çš„ç´¢å¼•éœ€è¦ä½œç”¨æ˜¯æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œå¦å¤–è¿˜å¯ä»¥å¯¹æ•°æ®è¿›è¡Œé™åˆ¶ï¼Œå¦‚é™åˆ¶ä¸ºâ€œå”¯ä¸€â€ã€‚</p><p>ç´¢å¼•çš„ç±»å‹æœ‰å››ç§ï¼Œå¦‚ä¸‹ï¼š</p><p>1.ä¸»é”®</p><p>å…·æœ‰â€œå”¯ä¸€â€å’Œâ€œç´¢å¼•â€çš„åŒé‡ä¼˜ç‚¹ã€‚</p><p>2.å”¯ä¸€</p><p>å®šä¹‰å­—æ®µä¸ºå”¯ä¸€ï¼Œå³ä¸å¯é‡å¤ã€‚</p><p>3.ç´¢å¼•</p><p>ä¼˜ç‚¹ï¼šæé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œç›¸å½“äºä¹¦çš„ç›®å½•ã€‚</p><p>ç¼ºç‚¹ï¼šé™ä½å¢ã€åˆ ã€æ”¹çš„æ€§èƒ½ï¼Œå› ä¸ºè¿™äº›æ“ä½œå¯èƒ½ä¼šè§¦å‘æ•°æ®åº“æ•´ç†ã€é‡å»ºç´¢å¼•ã€‚å¦å¤–ï¼Œç´¢å¼•ä¹Ÿä¼šå ç”¨ç£ç›˜ç©ºé—´ã€‚</p><p>4.å…¨æ–‡ç´¢å¼•</p><p>é€‚åˆæ–‡æœ¬æœç´¢ï¼Œå¸¸ç”¨åœ¨æœç´¢å¼•æ“ä¸­ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;æ•°æ®åº“çš„åˆ†ç±»&quot;&gt;&lt;a href=&quot;#æ•°æ®åº“çš„åˆ†ç±»&quot; class=&quot;headerlink&quot; title=&quot;æ•°æ®åº“çš„åˆ†ç±»&quot;&gt;&lt;/a&gt;æ•°æ®åº“çš„åˆ†ç±»&lt;/h2&gt;&lt;p&gt;1.&lt;strong&gt;æ–‡ä»¶æ•°æ®åº“&lt;/strong&gt; å®ƒçš„ä¼˜ç‚¹æ˜¯ï¼šæ•°æ®ä¿å­˜åœ¨å•ä¸€æ–‡ä»¶ä¸­ï¼Œå› æ­¤éƒ¨ç½²ååˆ†æ–¹ä¾¿ï¼Œå¸¸ç”¨æ¥
      
    
    </summary>
    
      <category term="Node" scheme="https://zhanghao-web.github.io/categories/Node/"/>
    
    
      <category term="Node" scheme="https://zhanghao-web.github.io/tags/Node/"/>
    
  </entry>
  
  <entry>
    <title>Nodeå­¦ä¹ (ä¹)--Websocket</title>
    <link href="https://zhanghao-web.github.io/2019/04/20/Node/Node%E5%AD%A6%E4%B9%A0(%E4%B9%9D)%20--Websocket/"/>
    <id>https://zhanghao-web.github.io/2019/04/20/Node/Nodeå­¦ä¹ (ä¹) --Websocket/</id>
    <published>2019-04-20T01:45:03.000Z</published>
    <updated>2020-01-28T10:04:15.045Z</updated>
    
    <content type="html"><![CDATA[<h1 id="WebSocketçš„ä¼˜åŠ¿"><a href="#WebSocketçš„ä¼˜åŠ¿" class="headerlink" title="WebSocketçš„ä¼˜åŠ¿"></a>WebSocketçš„ä¼˜åŠ¿</h1><p>1.æ€§èƒ½é«˜ã€‚</p><p>æ ¹æ®æµ‹è¯•ç¯å¢ƒæ•°æ®çš„ä¸åŒï¼Œå¤§çº¦ä¼šæ¯”æ™®é€šAjaxè¯·æ±‚é«˜2-10å€ã€‚ HTTPæ˜¯æ–‡æœ¬åè®®ï¼Œæ•°æ®é‡æ¯”è¾ƒå¤§ã€‚</p><p>è€ŒWebSocketæ˜¯åŸºäºäºŒè¿›åˆ¶çš„åè®®ï¼Œåœ¨å»ºç«‹è¿æ¥æ—¶ç”¨çš„è™½ç„¶æ˜¯æ–‡æœ¬æ•°æ®ï¼Œä½†ä¹‹åä¼ è¾“çš„éƒ½æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œå› æ­¤æ€§èƒ½æ¯”Ajaxè¯·æ±‚é«˜ã€‚</p><p>2.åŒå‘é€šä¿¡ã€‚</p><p>å¦‚æœæ˜¯æ™®é€šAjaxè¯·æ±‚ï¼Œéœ€è¦å®æ—¶è·å–æ•°æ®ï¼Œåªèƒ½ç”¨è®¡æ—¶å™¨å®šæ—¶å‘é€è¯·æ±‚ï¼Œè¿™æ ·ä¼šæµªè´¹æœåŠ¡å™¨èµ„æºå’Œæµé‡ã€‚</p><p>è€Œé€šè¿‡WebSocketï¼ŒæœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨å‘å‰ç«¯å‘é€ä¿¡æ¯ã€‚</p><p>3.å®‰å…¨æ€§é«˜</p><p>ç”±äºWebSocketå‡ºç°è¾ƒæ™šï¼Œç›¸æ¯”HTTPåè®®ï¼Œåœ¨å®‰å…¨æ€§ä¸Šè€ƒè™‘çš„æ›´åŠ å……åˆ†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œå°è¯•ç”¨<code>Socket.io</code>å»ºç«‹ä¸€ä¸ªåŸºäºWebSocketçš„åŒå‘é€šä¿¡ã€‚</p><h2 id="Socket-io"><a href="#Socket-io" class="headerlink" title="Socket.io"></a>Socket.io</h2><p><code>Socket.io</code>æ˜¯åœ¨ä½¿ç”¨WebSocketæ—¶çš„ä¸€ä¸ªå¸¸ç”¨åº“ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ¤æ–­åœ¨æ”¯æŒWebSocketçš„æµè§ˆå™¨ä¸­ä½¿ç”¨WebSocketï¼Œåœ¨å…¶ä»–æµè§ˆå™¨ä¸­ï¼Œä¼šä½¿ç”¨å¦‚flashç­‰æ–¹å¼å®Œæˆé€šä¿¡ã€‚</p><p>1.æ“ä½œç®€å•<br>2.å…¼å®¹ä½ç«¯æµè§ˆå™¨ï¼Œå¦‚IE6<br>3.è‡ªåŠ¨è¿›è¡Œæ•°æ®è§£æ<br>4.è‡ªåŠ¨é‡è¿ è‹¥å‡ºç°è¿æ¥æ–­å¼€çš„æƒ…å†µï¼ŒWebSocketä¼šè¿›è¡Œè‡ªåŠ¨é‡è¿ã€‚</p><h2 id="ä½¿ç”¨Socket-ioå»ºç«‹ä¸€ä¸ªWebSocketåº”ç”¨"><a href="#ä½¿ç”¨Socket-ioå»ºç«‹ä¸€ä¸ªWebSocketåº”ç”¨" class="headerlink" title="ä½¿ç”¨Socket.ioå»ºç«‹ä¸€ä¸ªWebSocketåº”ç”¨"></a>ä½¿ç”¨Socket.ioå»ºç«‹ä¸€ä¸ªWebSocketåº”ç”¨</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. å»ºç«‹HTTPæœåŠ¡å™¨ã€‚</span></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8080</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. å»ºç«‹WebSocketï¼Œè®©socket.ioç›‘å¬HTTPæœåŠ¡å™¨ï¼Œä¸€æ—¦å‘ç°æ˜¯WebSocketè¯·æ±‚ï¼Œåˆ™ä¼šè‡ªåŠ¨è¿›è¡Œå¤„ç†ã€‚</span></span><br><span class="line"><span class="keyword">const</span> ws = io.listen(server)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å»ºç«‹è¿æ¥å®Œæˆåï¼Œè§¦å‘connectionäº‹ä»¶ã€‚</span></span><br><span class="line"><span class="comment">// è¯¥äº‹ä»¶ä¼šè¿”å›ä¸€ä¸ªsocketå¯¹è±¡ï¼ˆhttps://socket.io/docs/server-api/#Socketï¼‰ï¼Œå¯ä»¥åˆ©ç”¨socketå¯¹è±¡è¿›è¡Œå‘é€ã€æ¥æ”¶æ•°æ®æ“ä½œã€‚</span></span><br><span class="line">ws.on(<span class="string">'connection'</span>, (socket) =&gt; &#123;</span><br><span class="line">  <span class="comment">// æ ¹æ®äº‹ä»¶åï¼Œå‘å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œæ•°æ®æ•°é‡ä¸é™ã€‚</span></span><br><span class="line">  socket.emit(<span class="string">'msg'</span>, <span class="string">'æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ç¬¬ä¸€æ¡'</span>, <span class="string">'æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ç¬¬äºŒæ¡'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ ¹æ®äº‹ä»¶åæ¥æ”¶å®¢æˆ·ç«¯è¿”å›çš„æ•°æ®</span></span><br><span class="line">  socket.on(<span class="string">'msg'</span>, (...msgs) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(msgs)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½¿ç”¨è®¡æ—¶å™¨å‘å®¢æˆ·ç«¯å‘é€æ•°æ®</span></span><br><span class="line">  setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    socket.emit(<span class="string">'timer'</span>, <span class="keyword">new</span> <span class="built_in">Date</span>().getTime())</span><br><span class="line">  &#125;, <span class="number">500</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- å¼•ç”¨Socket.ioçš„å®¢æˆ·ç«¯jsæ–‡ä»¶ï¼Œç”±äºSocket.ioå·²åœ¨æœåŠ¡ç«¯ç›‘å¬äº†HTTPæœåŠ¡å™¨çš„è¯·æ±‚ï¼Œä¸€æ—¦æ”¶åˆ°å¯¹è¯¥æ–‡ä»¶çš„è¯·æ±‚ï¼Œåˆ™ä¼šè‡ªåŠ¨è¿”å›è¯¥æ–‡ä»¶ï¼Œä¸éœ€è¦å¼€å‘äººå‘˜é…ç½®ã€‚ --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- è¯¥æ–‡ä»¶åœ¨æœåŠ¡ç«¯çš„ä½ç½®ä¸º/node_modules/socket.io/node_modules/socket.io-client/dist/socket.io.js --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://localhost:8080/socket.io/socket.io.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="comment">// ä¸æœåŠ¡å™¨å»ºç«‹WebSocketè¿æ¥ï¼Œè¯¥è¿æ¥ä¸ºwsåè®®ï¼Œsocket.ioä¸éœ€è¦æ‹…å¿ƒè·¨åŸŸé—®é¢˜ã€‚</span></span></span><br><span class="line"><span class="actionscript">    <span class="keyword">const</span> socket = io.connect(<span class="string">'ws://localhost:8080/'</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// æ ¹æ®äº‹ä»¶åï¼Œå‘æœåŠ¡ç«¯å‘é€æ•°æ®ï¼Œæ•°æ®æ•°é‡ä¸é™ã€‚</span></span></span><br><span class="line"><span class="actionscript">    socket.emit(<span class="string">'msg'</span>, <span class="string">'å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€æ•°æ®ç¬¬ä¸€æ¡'</span>, <span class="string">'å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€æ•°æ®ç¬¬äºŒæ¡'</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// æ ¹æ®äº‹ä»¶åæ¥æ”¶æœåŠ¡ç«¯è¿”å›çš„æ•°æ®</span></span></span><br><span class="line"><span class="actionscript">    socket.on(<span class="string">'msg'</span>, (...msgs) =&gt; &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(msgs)</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// æ¥æ”¶æœåŠ¡ç«¯é€šè¿‡è®¡æ—¶å™¨å‘é€æ¥çš„æ•°æ®</span></span></span><br><span class="line"><span class="actionscript">    socket.on(<span class="string">'timer'</span>, (time) =&gt; &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(time)</span></span><br><span class="line">    &#125;)</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>ç”¨æµè§ˆå™¨æ‰“å¼€index.htmlï¼Œå³å¯åœ¨æ§åˆ¶å°çœ‹åˆ°æ‰“å°çš„æ¶ˆæ¯ã€‚</p><h1 id="åŸç”Ÿå®ç°WebSocketåº”ç”¨"><a href="#åŸç”Ÿå®ç°WebSocketåº”ç”¨" class="headerlink" title="åŸç”Ÿå®ç°WebSocketåº”ç”¨"></a>åŸç”Ÿå®ç°WebSocketåº”ç”¨</h1><p>ä¸Šé¢ä½¿ç”¨äº†Socket.ioå®ç°WebSocketï¼Œä¹Ÿæ˜¯å¼€å‘ä¸­å¸¸ç”¨çš„æ–¹å¼ã€‚</p><p>ä½†è¿™æ ·ä¸åˆ©äºäº†è§£å…¶åŸç†ï¼Œè¿™é‡Œä½¿ç”¨Nodejsçš„Netæ¨¡å—å’ŒWebç«¯çš„WebSocket APIå®ç°WebSocketæœåŠ¡å™¨ã€‚</p><h2 id="æœåŠ¡ç«¯åˆ›å»ºä¸€ä¸ªNetæœåŠ¡å™¨"><a href="#æœåŠ¡ç«¯åˆ›å»ºä¸€ä¸ªNetæœåŠ¡å™¨" class="headerlink" title="æœåŠ¡ç«¯åˆ›å»ºä¸€ä¸ªNetæœåŠ¡å™¨"></a>æœåŠ¡ç«¯åˆ›å»ºä¸€ä¸ªNetæœåŠ¡å™¨</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥netæ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨netæ¨¡å—åˆ›å»ºæœåŠ¡å™¨ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªåŸå§‹çš„socketå¯¹è±¡ï¼Œä¸Socket.ioçš„socketå¯¹è±¡ä¸åŒã€‚</span></span><br><span class="line"><span class="keyword">const</span> server = net.createServer(<span class="function">(<span class="params">socket</span>) =&gt;</span> &#123;</span><br><span class="line">  </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8080</span>)</span><br></pre></td></tr></table></figure><h2 id="Webç«¯åˆ›å»ºä¸€ä¸ªWebSocketé“¾æ¥"><a href="#Webç«¯åˆ›å»ºä¸€ä¸ªWebSocketé“¾æ¥" class="headerlink" title="Webç«¯åˆ›å»ºä¸€ä¸ªWebSocketé“¾æ¥"></a>Webç«¯åˆ›å»ºä¸€ä¸ªWebSocketé“¾æ¥</h2><p>åˆ›å»ºä¸€ä¸ªWebSocketè¿æ¥ï¼Œæ­¤æ—¶æ§åˆ¶å°çš„Networkæ¨¡å—å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå¤„äºpendingçŠ¶æ€çš„HTTPè¿æ¥ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2019/3/13/16977a451448747d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="socket"></p><p>è¿™ä¸ªè¿æ¥æ˜¯ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œä¸æ™®é€šHTTPè¯·æ±‚çš„è¯·æ±‚ä½ å¤´ç›¸æ¯”ï¼Œå¢åŠ äº†ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>Sec-WebSocket-Extensions: permessage-deflate; client_max_window_bits  // æ‰©å±•ä¿¡æ¯</li><li>Sec-WebSocket-Key: O3PKSb95qaSB7/+XfaTg7Q== // å‘é€ä¸€ä¸ªKeyåˆ°æœåŠ¡ç«¯ï¼Œç”¨äºæ ¡éªŒæœåŠ¡ç«¯æ˜¯å¦æ”¯æŒWebSocket</li><li>Sec-WebSocket-Version: 13 // WebSocketç‰ˆæœ¬</li><li>Upgrade: websocket  // å‘ŠçŸ¥æœåŠ¡å™¨é€šä¿¡åè®®å°†ä¼šå‡çº§åˆ°WebSocketè‹¥æœåŠ¡å™¨æ”¯æŒåˆ™ç»§ç»­ä¸‹ä¸€æ­¥</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">'ws://localhost:8080/'</span>)</span><br></pre></td></tr></table></figure><h2 id="æœåŠ¡ç«¯ä½¿ç”¨socket-onceï¼Œè§¦å‘ä¸€æ¬¡dataäº‹ä»¶å¤„ç†HTTPè¯·æ±‚å¤´æ•°æ®"><a href="#æœåŠ¡ç«¯ä½¿ç”¨socket-onceï¼Œè§¦å‘ä¸€æ¬¡dataäº‹ä»¶å¤„ç†HTTPè¯·æ±‚å¤´æ•°æ®" class="headerlink" title="æœåŠ¡ç«¯ä½¿ç”¨socket.onceï¼Œè§¦å‘ä¸€æ¬¡dataäº‹ä»¶å¤„ç†HTTPè¯·æ±‚å¤´æ•°æ®"></a>æœåŠ¡ç«¯ä½¿ç”¨socket.onceï¼Œè§¦å‘ä¸€æ¬¡dataäº‹ä»¶å¤„ç†HTTPè¯·æ±‚å¤´æ•°æ®</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">socket.once(<span class="string">'data'</span>, (buffer) =&gt; &#123;</span><br><span class="line">  <span class="comment">// æ¥æ”¶åˆ°HTTPè¯·æ±‚å¤´æ•°æ®</span></span><br><span class="line">  <span class="keyword">const</span> str = buffer.toString()</span><br><span class="line">  <span class="built_in">console</span>.log(str)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æ‰“å°ç»“æœå¦‚ä¸‹:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/<span class="number">1.1</span></span><br><span class="line">Host: localhost:<span class="number">8080</span></span><br><span class="line">Connection: Upgrade</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Upgrade: websocket</span><br><span class="line">Origin: file:<span class="comment">//</span></span><br><span class="line">Sec-WebSocket-Version: <span class="number">13</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML,</span><br><span class="line">like Gecko) Chrome/<span class="number">72.0</span><span class="number">.3626</span><span class="number">.121</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: zh-CN,zh;q=<span class="number">0.9</span></span><br><span class="line">Cookie: _ga=GA1<span class="number">.1</span><span class="number">.1892261700</span><span class="number">.1545540050</span>; _gid=GA1<span class="number">.1</span><span class="number">.774798563</span><span class="number">.1552221410</span>; io=<span class="number">7</span>X0VY8jhwRTdRHBfAAAB</span><br><span class="line">Sec-WebSocket-Key: JStOineTIKaQskxefzer7Q==</span><br><span class="line">Sec-WebSocket-Extensions: permessage-deflate; client_max_window_bits</span><br></pre></td></tr></table></figure><p>å°†å›è½¦ç¬¦è½¬æ¢ä¸º\r\næ˜¾ç¤ºï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/<span class="number">1.1</span>\r\nHost: localhost:<span class="number">8080</span>\r\nConnection: Upgrade\r\nPragma: no-cache\r\nCache-Control: no-cache\r\nUpgrade: websocket\r\nOrigin: file:<span class="comment">//\r\nSec-WebSocket-Version: 13\r\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36\r\nAccept-Encoding: gzip, deflate, br\r\nAccept-Language: zh-CN,zh;q=0.9\r\nCookie: _ga=GA1.1.1892261700.1545540050; _gid=GA1.1.774798563.1552221410; io=7X0VY8jhwRTdRHBfAAAB\r\nSec-WebSocket-Key: dRB1xDJ/vV+IAGnG7TscNQ==\r\nSec-WebSocket-Extensions: permessage-deflate; client_max_window_bits\r\n\r\n</span></span><br></pre></td></tr></table></figure><h2 id="å°†è¯·æ±‚å¤´å­—ç¬¦ä¸²è½¬ä¸ºå¯¹è±¡"><a href="#å°†è¯·æ±‚å¤´å­—ç¬¦ä¸²è½¬ä¸ºå¯¹è±¡" class="headerlink" title="å°†è¯·æ±‚å¤´å­—ç¬¦ä¸²è½¬ä¸ºå¯¹è±¡"></a>å°†è¯·æ±‚å¤´å­—ç¬¦ä¸²è½¬ä¸ºå¯¹è±¡</h2><p>åˆ›å»ºä¸€ä¸ªparseHeaderæ–¹æ³•å¤„ç†è¯·æ±‚å¤´ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseHeader</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å°†è¯·æ±‚å¤´æ•°æ®æŒ‰å›è½¦ç¬¦åˆ‡å‰²ä¸ºæ•°ç»„ï¼Œå¾—åˆ°æ¯ä¸€è¡Œæ•°æ®</span></span><br><span class="line">  <span class="keyword">let</span> arr = str.split(<span class="string">'\r\n'</span>).filter(<span class="function"><span class="params">item</span> =&gt;</span> item)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç¬¬ä¸€è¡Œæ•°æ®ä¸ºGET / HTTP/1.1ï¼Œå¯ä»¥ä¸¢å¼ƒã€‚</span></span><br><span class="line">  arr.shift()</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(arr)</span><br><span class="line">  <span class="comment">/* </span></span><br><span class="line"><span class="comment">    å¤„ç†ç»“æœä¸ºï¼š</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    [ 'Host: localhost:8080',</span></span><br><span class="line"><span class="comment">      'Connection: Upgrade',</span></span><br><span class="line"><span class="comment">      'Pragma: no-cache',</span></span><br><span class="line"><span class="comment">      'Cache-Control: no-cache',</span></span><br><span class="line"><span class="comment">      'Upgrade: websocket',</span></span><br><span class="line"><span class="comment">      'Origin: file://',</span></span><br><span class="line"><span class="comment">      'Sec-WebSocket-Version: 13',</span></span><br><span class="line"><span class="comment">      'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36',</span></span><br><span class="line"><span class="comment">      'Accept-Encoding: gzip, deflate, br',</span></span><br><span class="line"><span class="comment">      'Accept-Language: zh-CN,zh;q=0.9',</span></span><br><span class="line"><span class="comment">      'Cookie: _ga=GA1.1.1892261700.1545540050; _gid=GA1.1.774798563.1552221410; io=7X0VY8jhwRTdRHBfAAAB',</span></span><br><span class="line"><span class="comment">      'Sec-WebSocket-Key: jqxd7P0Xx9TGkdMfogptRw==',</span></span><br><span class="line"><span class="comment">      'Sec-WebSocket-Extensions: permessage-deflate; client_max_window_bits' ]</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> headers = &#123;&#125;  <span class="comment">// å­˜å‚¨æœ€ç»ˆå¤„ç†çš„æ•°æ®</span></span><br><span class="line"></span><br><span class="line">  arr.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// éœ€è¦ç”¨":"å°†æ•°ç»„åˆ‡å‰²æˆkeyå’Œvalue</span></span><br><span class="line">    <span class="keyword">let</span> [name, value] = item.split(<span class="string">':'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å»é™¤æ— ç”¨çš„ç©ºæ ¼ï¼Œå°†å±æ€§åè½¬ä¸ºå°å†™</span></span><br><span class="line">    name = name.replace(<span class="regexp">/^\s|\s+$/g</span>, <span class="string">''</span>).toLowerCase()</span><br><span class="line">    value = value.replace(<span class="regexp">/^\s|\s+$/g</span>, <span class="string">''</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æ‰€æœ‰çš„è¯·æ±‚å¤´å±æ€§</span></span><br><span class="line">    headers[name] = value</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> headers</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å°ç»“æœå¦‚ä¸‹:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attr">host</span>: <span class="string">'localhost'</span>,</span><br><span class="line">  connection: <span class="string">'Upgrade'</span>,</span><br><span class="line">  pragma: <span class="string">'no-cache'</span>,</span><br><span class="line">  <span class="string">'cache-control'</span>: <span class="string">'no-cache'</span>,</span><br><span class="line">  upgrade: <span class="string">'websocket'</span>,</span><br><span class="line">  origin: <span class="string">'file'</span>,</span><br><span class="line">  <span class="string">'sec-websocket-version'</span>: <span class="string">'13'</span>,</span><br><span class="line">  <span class="string">'user-agent'</span>:</span><br><span class="line">   <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36'</span>,</span><br><span class="line">  <span class="string">'accept-encoding'</span>: <span class="string">'gzip, deflate, br'</span>,</span><br><span class="line">  <span class="string">'accept-language'</span>: <span class="string">'zh-CN,zh;q=0.9'</span>,</span><br><span class="line">  cookie:</span><br><span class="line">   <span class="string">'_ga=GA1.1.1892261700.1545540050; _gid=GA1.1.585339125.1552405260'</span>,</span><br><span class="line">  <span class="string">'sec-websocket-key'</span>: <span class="string">'TipyPZNW+KNvV3fePNpriw=='</span>,</span><br><span class="line">  <span class="string">'sec-websocket-extensions'</span>: <span class="string">'permessage-deflate; client_max_window_bits'</span> &#125;</span><br></pre></td></tr></table></figure><h2 id="æ ¹æ®è¯·æ±‚å¤´å‚æ•°ï¼Œåˆ¤æ–­æ˜¯å¦WebSocketè¯·æ±‚"><a href="#æ ¹æ®è¯·æ±‚å¤´å‚æ•°ï¼Œåˆ¤æ–­æ˜¯å¦WebSocketè¯·æ±‚" class="headerlink" title="æ ¹æ®è¯·æ±‚å¤´å‚æ•°ï¼Œåˆ¤æ–­æ˜¯å¦WebSocketè¯·æ±‚"></a>æ ¹æ®è¯·æ±‚å¤´å‚æ•°ï¼Œåˆ¤æ–­æ˜¯å¦WebSocketè¯·æ±‚</h2><p>æ ¹æ®<code>headers[&#39;upgrade&#39;] !== &#39;websocket&#39;</code>ï¼Œåˆ¤æ–­è¯¥HTTPè¿æ¥æ˜¯å¦å¯å‡çº§ä¸ºWebSocketï¼Œè‹¥å¯ä»¥å‡çº§ï¼Œè¡¨ç¤ºä¸ºWebSocketè¯·æ±‚ã€‚<br>æ ¹æ®<code>headers[&#39;sec-websocket-version&#39;] !== &#39;13&#39;</code>ï¼Œåˆ¤æ–­WebSocketçš„ç‰ˆæœ¬æ˜¯å¦ä¸º13ï¼Œä»¥å…å› ä¸ºç‰ˆæœ¬ä¸åŒå‡ºç°å…¼å®¹é—®é¢˜ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">socket.once(<span class="string">'data'</span>, (buffer) =&gt; &#123;</span><br><span class="line">  <span class="comment">// æ¥æ”¶åˆ°HTTPè¯·æ±‚å¤´æ•°æ®</span></span><br><span class="line">  <span class="keyword">const</span> str = buffer.toString()</span><br><span class="line">  <span class="built_in">console</span>.log(str)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4. å°†è¯·æ±‚å¤´æ•°æ®è½¬ä¸ºå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">const</span> headers = parseHeader(str)</span><br><span class="line">  <span class="built_in">console</span>.log(headers)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 5. åˆ¤æ–­è¯·æ±‚æ˜¯å¦ä¸ºWebSocketè¿æ¥</span></span><br><span class="line">  <span class="keyword">if</span> (headers[<span class="string">'upgrade'</span>] !== <span class="string">'websocket'</span>) &#123;</span><br><span class="line">    <span class="comment">// è‹¥å½“å‰è¯·æ±‚ä¸æ˜¯WebSocketè¿æ¥ï¼Œåˆ™å…³é—­è¿æ¥</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'éWebSocketè¿æ¥'</span>)</span><br><span class="line">    socket.end()</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (headers[<span class="string">'sec-websocket-version'</span>] !== <span class="string">'13'</span>) &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­WebSocketç‰ˆæœ¬æ˜¯å¦ä¸º13ï¼Œé˜²æ­¢æ˜¯å…¶ä»–ç‰ˆæœ¬ï¼Œé€ æˆå…¼å®¹é”™è¯¯</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'WebSocketç‰ˆæœ¬é”™è¯¯'</span>)</span><br><span class="line">    socket.end()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// è¯·æ±‚ä¸ºWebSocketè¿æ¥æ—¶ï¼Œè¿›ä¸€æ­¥å¤„ç†</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="æ ¡éªŒSec-WebSocket-Keyï¼Œå®Œæˆè¿æ¥"><a href="#æ ¡éªŒSec-WebSocket-Keyï¼Œå®Œæˆè¿æ¥" class="headerlink" title="æ ¡éªŒSec-WebSocket-Keyï¼Œå®Œæˆè¿æ¥"></a>æ ¡éªŒSec-WebSocket-Keyï¼Œå®Œæˆè¿æ¥</h2><p>æ ¹æ®åè®®è§„å®šçš„æ–¹å¼ï¼Œå‘å‰ç«¯è¿”å›ä¸€ä¸ªè¯·æ±‚å¤´ï¼Œå®Œæˆå»ºç«‹WebSocketè¿æ¥çš„è¿‡ç¨‹ã€‚</p><p>è‹¥å®¢æˆ·ç«¯æ ¡éªŒç»“æœæ­£ç¡®ï¼Œåœ¨æ§åˆ¶å°çš„Networkæ¨¡å—å¯ä»¥çœ‹åˆ°HTTPè¯·æ±‚çš„çŠ¶æ€ç å˜ä¸º101 Switching Protocolsï¼ŒåŒæ—¶å®¢æˆ·ç«¯çš„ws.onopenäº‹ä»¶è¢«è§¦å‘ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2019/3/13/16977a4514369b43?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="console"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">socket.once(<span class="string">'data'</span>, (buffer) =&gt; &#123;</span><br><span class="line">  <span class="comment">// æ¥æ”¶åˆ°HTTPè¯·æ±‚å¤´æ•°æ®</span></span><br><span class="line">  <span class="keyword">const</span> str = buffer.toString()</span><br><span class="line">  <span class="built_in">console</span>.log(str)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4. å°†è¯·æ±‚å¤´æ•°æ®è½¬ä¸ºå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">const</span> headers = parseHeader(str)</span><br><span class="line">  <span class="built_in">console</span>.log(headers)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 5. åˆ¤æ–­è¯·æ±‚æ˜¯å¦ä¸ºWebSocketè¿æ¥</span></span><br><span class="line">  <span class="keyword">if</span> (headers[<span class="string">'upgrade'</span>] !== <span class="string">'websocket'</span>) &#123;</span><br><span class="line">    <span class="comment">// è‹¥å½“å‰è¯·æ±‚ä¸æ˜¯WebSocketè¿æ¥ï¼Œåˆ™å…³é—­è¿æ¥</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'éWebSocketè¿æ¥'</span>)</span><br><span class="line">    socket.end()</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (headers[<span class="string">'sec-websocket-version'</span>] !== <span class="string">'13'</span>) &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­WebSocketç‰ˆæœ¬æ˜¯å¦ä¸º13ï¼Œé˜²æ­¢æ˜¯å…¶ä»–ç‰ˆæœ¬ï¼Œé€ æˆå…¼å®¹é”™è¯¯</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'WebSocketç‰ˆæœ¬é”™è¯¯'</span>)</span><br><span class="line">    socket.end()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 6. æ ¡éªŒSec-WebSocket-Keyï¼Œå®Œæˆè¿æ¥</span></span><br><span class="line">      <span class="comment">/* </span></span><br><span class="line"><span class="comment">        åè®®ä¸­è§„å®šçš„æ ¡éªŒç”¨GUIDï¼Œå¯å‚è€ƒå¦‚ä¸‹é“¾æ¥ï¼š</span></span><br><span class="line"><span class="comment">        https://tools.ietf.org/html/rfc6455#section-5.5.2</span></span><br><span class="line"><span class="comment">        https://stackoverflow.com/questions/13456017/what-does-258eafa5-e914-47da-95ca-c5ab0dc85b11-means-in-websocket-protocol</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      <span class="keyword">const</span> GUID = <span class="string">'258EAFA5-E914-47DA-95CA-C5AB0DC85B11'</span></span><br><span class="line">      <span class="keyword">const</span> key = headers[<span class="string">'sec-websocket-key'</span>]</span><br><span class="line">      <span class="keyword">const</span> hash = crypto.createHash(<span class="string">'sha1'</span>)  <span class="comment">// åˆ›å»ºä¸€ä¸ªç­¾åç®—æ³•ä¸ºsha1çš„å“ˆå¸Œå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">      hash.update(<span class="string">`<span class="subst">$&#123;key&#125;</span><span class="subst">$&#123;GUID&#125;</span>`</span>)  <span class="comment">// å°†keyå’ŒGUIDè¿æ¥åï¼Œæ›´æ–°åˆ°hash</span></span><br><span class="line">      <span class="keyword">const</span> result = hash.digest(<span class="string">'base64'</span>) <span class="comment">// ç”Ÿæˆbase64å­—ç¬¦ä¸²</span></span><br><span class="line">  <span class="keyword">const</span> header = <span class="string">`HTTP/1.1 101 Switching Protocols\r\nUpgrade: websocket\r\nConnection: Upgrade\r\nSec-Websocket-Accept: <span class="subst">$&#123;result&#125;</span>\r\n\r\n`</span> <span class="comment">// ç”Ÿæˆä¾›å‰ç«¯æ ¡éªŒç”¨çš„è¯·æ±‚å¤´</span></span><br><span class="line"></span><br><span class="line">      socket.write(header)  <span class="comment">// è¿”å›HTTPå¤´ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯æ ¡éªŒç»“æœï¼ŒHTTPçŠ¶æ€ç 101è¡¨ç¤ºåˆ‡æ¢åè®®ï¼šhttps://httpstatuses.com/101ã€‚</span></span><br><span class="line">      <span class="comment">// è‹¥å®¢æˆ·ç«¯æ ¡éªŒç»“æœæ­£ç¡®ï¼Œåœ¨æ§åˆ¶å°çš„Networkæ¨¡å—å¯ä»¥çœ‹åˆ°HTTPè¯·æ±‚çš„çŠ¶æ€ç å˜ä¸º101 Switching Protocolsï¼ŒåŒæ—¶å®¢æˆ·ç«¯çš„ws.onopenäº‹ä»¶è¢«è§¦å‘ã€‚</span></span><br><span class="line">      <span class="built_in">console</span>.log(header)</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// å¤„ç†èŠå¤©æ•°æ®</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h2 id="å»ºç«‹è¿æ¥åï¼Œé€šè¿‡dataäº‹ä»¶æ¥æ”¶å®¢æˆ·ç«¯çš„æ•°æ®å¹¶å¤„ç†"><a href="#å»ºç«‹è¿æ¥åï¼Œé€šè¿‡dataäº‹ä»¶æ¥æ”¶å®¢æˆ·ç«¯çš„æ•°æ®å¹¶å¤„ç†" class="headerlink" title="å»ºç«‹è¿æ¥åï¼Œé€šè¿‡dataäº‹ä»¶æ¥æ”¶å®¢æˆ·ç«¯çš„æ•°æ®å¹¶å¤„ç†"></a>å»ºç«‹è¿æ¥åï¼Œé€šè¿‡dataäº‹ä»¶æ¥æ”¶å®¢æˆ·ç«¯çš„æ•°æ®å¹¶å¤„ç†</h2><p>è¿æ¥å¼€å§‹åï¼Œå¯ä»¥åœ¨æ§åˆ¶å°çš„Networkæ¨¡å—çœ‹åˆ°ï¼Œè¯¥è¿æ¥ä¼šä¸€ç›´ä¿ç•™åœ¨pendingçŠ¶æ€ï¼Œç›´åˆ°è¿æ¥æ–­å¼€ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2019/3/13/16977a4524cc9dca?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="console1"></p><p>æ­¤æ—¶å¯ä»¥é€šè¿‡dataäº‹ä»¶å¤„ç†å®¢æˆ·ç«¯çš„æ•°æ®ï¼Œä½†æ­¤æ—¶åŒæ–¹é€šä¿¡çš„æ•°æ®ä¸ºäºŒè¿›åˆ¶ï¼Œéœ€è¦æŒ‰ç…§å…¶æ ¼å¼è¿›è¡Œå¤„ç†åæ‰å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚</p><p>æ ¼å¼å¦‚ä¸‹ï¼š</p><p><img src="https://user-gold-cdn.xitu.io/2019/3/13/16977a45146a18d6?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="console2"></p><p>å¤„ç†æ”¶åˆ°çš„æ•°æ®ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decodeWsFrame</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> start = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> frame = &#123;</span><br><span class="line">    isFinal: (data[start] &amp; <span class="number">0x80</span>) === <span class="number">0x80</span>,</span><br><span class="line">    opcode: data[start++] &amp; <span class="number">0xF</span>,</span><br><span class="line">    masked: (data[start] &amp; <span class="number">0x80</span>) === <span class="number">0x80</span>,</span><br><span class="line">    payloadLen: data[start++] &amp; <span class="number">0x7F</span>,</span><br><span class="line">    maskingKey: <span class="string">''</span>,</span><br><span class="line">    payloadData: <span class="literal">null</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (frame.payloadLen === <span class="number">126</span>) &#123;</span><br><span class="line">    frame.payloadLen = (data[start++] &lt;&lt; <span class="number">8</span>) + data[start++];</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (frame.payloadLen === <span class="number">127</span>) &#123;</span><br><span class="line">    frame.payloadLen = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">7</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">      frame.payloadLen += (data[start++] &lt;&lt; (i * <span class="number">8</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (frame.payloadLen) &#123;</span><br><span class="line">    <span class="keyword">if</span> (frame.masked) &#123;</span><br><span class="line">      <span class="keyword">const</span> maskingKey = [</span><br><span class="line">        data[start++],</span><br><span class="line">        data[start++],</span><br><span class="line">        data[start++],</span><br><span class="line">        data[start++]</span><br><span class="line">      ];</span><br><span class="line"></span><br><span class="line">      frame.maskingKey = maskingKey;</span><br><span class="line"></span><br><span class="line">      frame.payloadData = data</span><br><span class="line">        .slice(start, start + frame.payloadLen)</span><br><span class="line">        .map(<span class="function">(<span class="params">byte, idx</span>) =&gt;</span> byte ^ maskingKey[idx % <span class="number">4</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      frame.payloadData = data.slice(start, start + frame.payloadLen);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.dir(frame)</span><br><span class="line">  <span class="keyword">return</span> frame;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤„ç†å‘å‡ºçš„æ•°æ®ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encodeWsFrame</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> isFinal = data.isFinal !== <span class="literal">undefined</span> ? data.isFinal : <span class="literal">true</span>,</span><br><span class="line">    opcode = data.opcode !== <span class="literal">undefined</span> ? data.opcode : <span class="number">1</span>,</span><br><span class="line">    payloadData = data.payloadData ? Buffer.from(data.payloadData) : <span class="literal">null</span>,</span><br><span class="line">    payloadLen = payloadData ? payloadData.length : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> frame = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isFinal) frame.push((<span class="number">1</span> &lt;&lt; <span class="number">7</span>) + opcode);</span><br><span class="line">  <span class="keyword">else</span> frame.push(opcode);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (payloadLen &lt; <span class="number">126</span>) &#123;</span><br><span class="line">    frame.push(payloadLen);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (payloadLen &lt; <span class="number">65536</span>) &#123;</span><br><span class="line">    frame.push(<span class="number">126</span>, payloadLen &gt;&gt; <span class="number">8</span>, payloadLen &amp; <span class="number">0xFF</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    frame.push(<span class="number">127</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">7</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">      frame.push((payloadLen &amp; (<span class="number">0xFF</span> &lt;&lt; (i * <span class="number">8</span>))) &gt;&gt; (i * <span class="number">8</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  frame = payloadData ? Buffer.concat([Buffer.from(frame), payloadData]) : Buffer.from(frame);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.dir(decodeWsFrame(frame));</span><br><span class="line">  <span class="keyword">return</span> frame;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹èŠå¤©æ•°æ®è¿›è¡Œå¤„ç†ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">socket.once(<span class="string">'data'</span>, (buffer) =&gt; &#123;</span><br><span class="line">  <span class="comment">// æ¥æ”¶åˆ°HTTPè¯·æ±‚å¤´æ•°æ®</span></span><br><span class="line">  <span class="keyword">const</span> str = buffer.toString()</span><br><span class="line">  <span class="built_in">console</span>.log(str)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4. å°†è¯·æ±‚å¤´æ•°æ®è½¬ä¸ºå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">const</span> headers = parseHeader(str)</span><br><span class="line">  <span class="built_in">console</span>.log(headers)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 5. åˆ¤æ–­è¯·æ±‚æ˜¯å¦ä¸ºWebSocketè¿æ¥</span></span><br><span class="line">  <span class="keyword">if</span> (headers[<span class="string">'upgrade'</span>] !== <span class="string">'websocket'</span>) &#123;</span><br><span class="line">    <span class="comment">// è‹¥å½“å‰è¯·æ±‚ä¸æ˜¯WebSocketè¿æ¥ï¼Œåˆ™å…³é—­è¿æ¥</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'éWebSocketè¿æ¥'</span>)</span><br><span class="line">    socket.end()</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (headers[<span class="string">'sec-websocket-version'</span>] !== <span class="string">'13'</span>) &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­WebSocketç‰ˆæœ¬æ˜¯å¦ä¸º13ï¼Œé˜²æ­¢æ˜¯å…¶ä»–ç‰ˆæœ¬ï¼Œé€ æˆå…¼å®¹é”™è¯¯</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'WebSocketç‰ˆæœ¬é”™è¯¯'</span>)</span><br><span class="line">    socket.end()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 6. æ ¡éªŒSec-WebSocket-Keyï¼Œå®Œæˆè¿æ¥</span></span><br><span class="line">      <span class="comment">/* </span></span><br><span class="line"><span class="comment">        åè®®ä¸­è§„å®šçš„æ ¡éªŒç”¨GUIDï¼Œå¯å‚è€ƒå¦‚ä¸‹é“¾æ¥ï¼š</span></span><br><span class="line"><span class="comment">        https://tools.ietf.org/html/rfc6455#section-5.5.2</span></span><br><span class="line"><span class="comment">        https://stackoverflow.com/questions/13456017/what-does-258eafa5-e914-47da-95ca-c5ab0dc85b11-means-in-websocket-protocol</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      <span class="keyword">const</span> GUID = <span class="string">'258EAFA5-E914-47DA-95CA-C5AB0DC85B11'</span></span><br><span class="line">      <span class="keyword">const</span> key = headers[<span class="string">'sec-websocket-key'</span>]</span><br><span class="line">      <span class="keyword">const</span> hash = crypto.createHash(<span class="string">'sha1'</span>)  <span class="comment">// åˆ›å»ºä¸€ä¸ªç­¾åç®—æ³•ä¸ºsha1çš„å“ˆå¸Œå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">      hash.update(<span class="string">`<span class="subst">$&#123;key&#125;</span><span class="subst">$&#123;GUID&#125;</span>`</span>)  <span class="comment">// å°†keyå’ŒGUIDè¿æ¥åï¼Œæ›´æ–°åˆ°hash</span></span><br><span class="line">      <span class="keyword">const</span> result = hash.digest(<span class="string">'base64'</span>) <span class="comment">// ç”Ÿæˆbase64å­—ç¬¦ä¸²</span></span><br><span class="line">  <span class="keyword">const</span> header = <span class="string">`HTTP/1.1 101 Switching Protocols\r\nUpgrade: websocket\r\nConnection: Upgrade\r\nSec-Websocket-Accept: <span class="subst">$&#123;result&#125;</span>\r\n\r\n`</span> <span class="comment">// ç”Ÿæˆä¾›å‰ç«¯æ ¡éªŒç”¨çš„è¯·æ±‚å¤´</span></span><br><span class="line"></span><br><span class="line">      socket.write(header)  <span class="comment">// è¿”å›HTTPå¤´ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯æ ¡éªŒç»“æœï¼ŒHTTPçŠ¶æ€ç 101è¡¨ç¤ºåˆ‡æ¢åè®®ï¼šhttps://httpstatuses.com/101ã€‚</span></span><br><span class="line">      <span class="comment">// è‹¥å®¢æˆ·ç«¯æ ¡éªŒç»“æœæ­£ç¡®ï¼Œåœ¨æ§åˆ¶å°çš„Networkæ¨¡å—å¯ä»¥çœ‹åˆ°HTTPè¯·æ±‚çš„çŠ¶æ€ç å˜ä¸º101 Switching Protocolsï¼ŒåŒæ—¶å®¢æˆ·ç«¯çš„ws.onopenäº‹ä»¶è¢«è§¦å‘ã€‚</span></span><br><span class="line">      <span class="built_in">console</span>.log(header)</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 7. å»ºç«‹è¿æ¥åï¼Œé€šè¿‡dataäº‹ä»¶æ¥æ”¶å®¢æˆ·ç«¯çš„æ•°æ®å¹¶å¤„ç†</span></span><br><span class="line">      socket.on(<span class="string">'data'</span>, (buffer) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> data = decodeWsFrame(buffer)</span><br><span class="line">        <span class="built_in">console</span>.log(data)</span><br><span class="line">        <span class="built_in">console</span>.log(data.payloadData &amp;&amp; data.payloadData.toString())</span><br><span class="line"></span><br><span class="line">        <span class="comment">// opcodeä¸º8ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯å‘èµ·äº†æ–­å¼€è¿æ¥</span></span><br><span class="line">        <span class="keyword">if</span> (data.opcode === <span class="number">8</span>) &#123;</span><br><span class="line">          socket.end()  <span class="comment">// ä¸å®¢æˆ·ç«¯æ–­å¼€è¿æ¥</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// æ¥æ”¶åˆ°å®¢æˆ·ç«¯æ•°æ®æ—¶çš„å¤„ç†ï¼Œæ­¤å¤„é»˜è®¤ä¸ºè¿”å›æ¥æ”¶åˆ°çš„æ•°æ®ã€‚</span></span><br><span class="line">          socket.write(encodeWsFrame(&#123; <span class="attr">payloadData</span>: <span class="string">`æœåŠ¡ç«¯æ¥æ”¶åˆ°çš„æ¶ˆæ¯ä¸ºï¼š<span class="subst">$&#123;data.payloadData ? data.payloadData.toString() : <span class="string">''</span>&#125;</span>`</span> &#125;))</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œä¸€ä¸ªç®€å•çš„åŸºäºWebSocketçš„èŠå¤©åº”ç”¨å°±åˆ›å»ºå®Œæˆäº†ï¼Œåœ¨å¯åŠ¨æœåŠ¡å™¨åï¼Œå¯ä»¥æ‰“å¼€index.htmlçœ‹åˆ°æ•ˆæœã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;WebSocketçš„ä¼˜åŠ¿&quot;&gt;&lt;a href=&quot;#WebSocketçš„ä¼˜åŠ¿&quot; class=&quot;headerlink&quot; title=&quot;WebSocketçš„ä¼˜åŠ¿&quot;&gt;&lt;/a&gt;WebSocketçš„ä¼˜åŠ¿&lt;/h1&gt;&lt;p&gt;1.æ€§èƒ½é«˜ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®æµ‹è¯•ç¯å¢ƒæ•°æ®çš„ä¸åŒï¼Œå¤§çº¦ä¼šæ¯”æ™®é€šAjaxè¯·æ±‚é«˜2-10å€ã€‚ HTTPæ˜¯æ–‡æœ¬åè®®ï¼Œæ•°æ®é‡æ¯”è¾ƒå¤§ã€‚&lt;/p&gt;
&lt;p&gt;è€ŒWebSocketæ˜¯åŸºäºäºŒè¿›åˆ¶çš„åè®®ï¼Œåœ¨å»ºç«‹è¿æ¥æ—¶ç”¨çš„è™½ç„¶æ˜¯æ–‡æœ¬æ•°æ®ï¼Œä½†ä¹‹åä¼ è¾“çš„éƒ½æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œå› æ­¤æ€§èƒ½æ¯”Ajaxè¯·æ±‚é«˜ã€‚&lt;/p&gt;
&lt;p&gt;2.åŒå‘é€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ˜¯æ™®é€šAjaxè¯·æ±‚ï¼Œéœ€è¦å®æ—¶è·å–æ•°æ®ï¼Œåªèƒ½ç”¨è®¡æ—¶å™¨å®šæ—¶å‘é€è¯·æ±‚ï¼Œè¿™æ ·ä¼šæµªè´¹æœåŠ¡å™¨èµ„æºå’Œæµé‡ã€‚&lt;/p&gt;
&lt;p&gt;è€Œé€šè¿‡WebSocketï¼ŒæœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨å‘å‰ç«¯å‘é€ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;3.å®‰å…¨æ€§é«˜&lt;/p&gt;
&lt;p&gt;ç”±äºWebSocketå‡ºç°è¾ƒæ™šï¼Œç›¸æ¯”HTTPåè®®ï¼Œåœ¨å®‰å…¨æ€§ä¸Šè€ƒè™‘çš„æ›´åŠ å……åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œå°è¯•ç”¨&lt;code&gt;Socket.io&lt;/code&gt;å»ºç«‹ä¸€ä¸ªåŸºäºWebSocketçš„åŒå‘é€šä¿¡ã€‚&lt;/p&gt;
&lt;h2 id=&quot;Socket-io&quot;&gt;&lt;a href=&quot;#Socket-io&quot; class=&quot;headerlink&quot; title=&quot;Socket.io&quot;&gt;&lt;/a&gt;Socket.io&lt;/h2&gt;&lt;p&gt;&lt;code&gt;Socket.io&lt;/code&gt;æ˜¯åœ¨ä½¿ç”¨WebSocketæ—¶çš„ä¸€ä¸ªå¸¸ç”¨åº“ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ¤æ–­åœ¨æ”¯æŒWebSocketçš„æµè§ˆå™¨ä¸­ä½¿ç”¨WebSocketï¼Œåœ¨å…¶ä»–æµè§ˆå™¨ä¸­ï¼Œä¼šä½¿ç”¨å¦‚flashç­‰æ–¹å¼å®Œæˆé€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;1.æ“ä½œç®€å•&lt;br&gt;2.å…¼å®¹ä½ç«¯æµè§ˆå™¨ï¼Œå¦‚IE6&lt;br&gt;3.è‡ªåŠ¨è¿›è¡Œæ•°æ®è§£æ&lt;br&gt;4.è‡ªåŠ¨é‡è¿ è‹¥å‡ºç°è¿æ¥æ–­å¼€çš„æƒ…å†µï¼ŒWebSocketä¼šè¿›è¡Œè‡ªåŠ¨é‡è¿ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ä½¿ç”¨Socket-ioå»ºç«‹ä¸€ä¸ªWebSocketåº”ç”¨&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨Socket-ioå»ºç«‹ä¸€ä¸ªWebSocketåº”ç”¨&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨Socket.ioå»ºç«‹ä¸€ä¸ªWebSocketåº”ç”¨&quot;&gt;&lt;/a&gt;ä½¿ç”¨Socket.ioå»ºç«‹ä¸€ä¸ªWebSocketåº”ç”¨&lt;/h2&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; http = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;http&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; io = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;socket.io&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 1. å»ºç«‹HTTPæœåŠ¡å™¨ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; server = http.createServer(&lt;span class=&quot;function&quot;&gt;(&lt;span class=&quot;params&quot;&gt;req, res&lt;/span&gt;) =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;server.listen(&lt;span class=&quot;number&quot;&gt;8080&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 2. å»ºç«‹WebSocketï¼Œè®©socket.ioç›‘å¬HTTPæœåŠ¡å™¨ï¼Œä¸€æ—¦å‘ç°æ˜¯WebSocketè¯·æ±‚ï¼Œåˆ™ä¼šè‡ªåŠ¨è¿›è¡Œå¤„ç†ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; ws = io.listen(server)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å»ºç«‹è¿æ¥å®Œæˆåï¼Œè§¦å‘connectionäº‹ä»¶ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// è¯¥äº‹ä»¶ä¼šè¿”å›ä¸€ä¸ªsocketå¯¹è±¡ï¼ˆhttps://socket.io/docs/server-api/#Socketï¼‰ï¼Œå¯ä»¥åˆ©ç”¨socketå¯¹è±¡è¿›è¡Œå‘é€ã€æ¥æ”¶æ•°æ®æ“ä½œã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ws.on(&lt;span class=&quot;string&quot;&gt;&#39;connection&#39;&lt;/span&gt;, (socket) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// æ ¹æ®äº‹ä»¶åï¼Œå‘å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œæ•°æ®æ•°é‡ä¸é™ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  socket.emit(&lt;span class=&quot;string&quot;&gt;&#39;msg&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ç¬¬ä¸€æ¡&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ç¬¬äºŒæ¡&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// æ ¹æ®äº‹ä»¶åæ¥æ”¶å®¢æˆ·ç«¯è¿”å›çš„æ•°æ®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  socket.on(&lt;span class=&quot;string&quot;&gt;&#39;msg&#39;&lt;/span&gt;, (...msgs) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(msgs)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// ä½¿ç”¨è®¡æ—¶å™¨å‘å®¢æˆ·ç«¯å‘é€æ•°æ®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  setInterval(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    socket.emit(&lt;span class=&quot;string&quot;&gt;&#39;timer&#39;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Date&lt;/span&gt;().getTime())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;, &lt;span class=&quot;number&quot;&gt;500&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;lt;!DOCTYPE &lt;span class=&quot;meta-keyword&quot;&gt;html&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;html&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;lang&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;en&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;head&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;meta&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;charset&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;meta&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;viewport&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;content&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;width=device-width, initial-scale=1.0&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;meta&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;http-equiv&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;X-UA-Compatible&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;content&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;ie=edge&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;title&lt;/span&gt;&amp;gt;&lt;/span&gt;Document&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;title&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;head&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;body&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;&amp;lt;!-- å¼•ç”¨Socket.ioçš„å®¢æˆ·ç«¯jsæ–‡ä»¶ï¼Œç”±äºSocket.ioå·²åœ¨æœåŠ¡ç«¯ç›‘å¬äº†HTTPæœåŠ¡å™¨çš„è¯·æ±‚ï¼Œä¸€æ—¦æ”¶åˆ°å¯¹è¯¥æ–‡ä»¶çš„è¯·æ±‚ï¼Œåˆ™ä¼šè‡ªåŠ¨è¿”å›è¯¥æ–‡ä»¶ï¼Œä¸éœ€è¦å¼€å‘äººå‘˜é…ç½®ã€‚ --&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;&amp;lt;!-- è¯¥æ–‡ä»¶åœ¨æœåŠ¡ç«¯çš„ä½ç½®ä¸º/node_modules/socket.io/node_modules/socket.io-client/dist/socket.io.js --&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;src&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://localhost:8080/socket.io/socket.io.js&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;actionscript&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// ä¸æœåŠ¡å™¨å»ºç«‹WebSocketè¿æ¥ï¼Œè¯¥è¿æ¥ä¸ºwsåè®®ï¼Œsocket.ioä¸éœ€è¦æ‹…å¿ƒè·¨åŸŸé—®é¢˜ã€‚&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;actionscript&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; socket = io.connect(&lt;span class=&quot;string&quot;&gt;&#39;ws://localhost:8080/&#39;&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;actionscript&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// æ ¹æ®äº‹ä»¶åï¼Œå‘æœåŠ¡ç«¯å‘é€æ•°æ®ï¼Œæ•°æ®æ•°é‡ä¸é™ã€‚&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;actionscript&quot;&gt;    socket.emit(&lt;span class=&quot;string&quot;&gt;&#39;msg&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€æ•°æ®ç¬¬ä¸€æ¡&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€æ•°æ®ç¬¬äºŒæ¡&#39;&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;actionscript&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// æ ¹æ®äº‹ä»¶åæ¥æ”¶æœåŠ¡ç«¯è¿”å›çš„æ•°æ®&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;actionscript&quot;&gt;    socket.on(&lt;span class=&quot;string&quot;&gt;&#39;msg&#39;&lt;/span&gt;, (...msgs) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;javascript&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(msgs)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;actionscript&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// æ¥æ”¶æœåŠ¡ç«¯é€šè¿‡è®¡æ—¶å™¨å‘é€æ¥çš„æ•°æ®&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;actionscript&quot;&gt;    socket.on(&lt;span class=&quot;string&quot;&gt;&#39;timer&#39;&lt;/span&gt;, (time) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;javascript&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(time)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;body&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;html&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Node" scheme="https://zhanghao-web.github.io/categories/Node/"/>
    
    
      <category term="Node" scheme="https://zhanghao-web.github.io/tags/Node/"/>
    
  </entry>
  
  <entry>
    <title>Nodeå­¦ä¹ (å…«)--Ajaxè·¨åŸŸ</title>
    <link href="https://zhanghao-web.github.io/2019/04/20/Node/Node%E5%AD%A6%E4%B9%A0(%E5%85%AB)%20--Ajax%E8%B7%A8%E5%9F%9F/"/>
    <id>https://zhanghao-web.github.io/2019/04/20/Node/Nodeå­¦ä¹ (å…«) --Ajaxè·¨åŸŸ/</id>
    <published>2019-04-20T01:41:27.000Z</published>
    <updated>2020-01-28T10:04:15.046Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Ajaxè·¨åŸŸé—®é¢˜çš„äº§ç”ŸåŸå› "><a href="#Ajaxè·¨åŸŸé—®é¢˜çš„äº§ç”ŸåŸå› " class="headerlink" title="Ajaxè·¨åŸŸé—®é¢˜çš„äº§ç”ŸåŸå› "></a>Ajaxè·¨åŸŸé—®é¢˜çš„äº§ç”ŸåŸå› </h2><p>Ajaxè¯·æ±‚æ— æ³•è·¨åŸŸï¼Œåœ¨å‰ç«¯å¼€å‘ä¸­æ˜¯ä¸ªå¸¸è§é—®é¢˜ï¼Œå®ƒçš„äº§ç”ŸåŸå› æ˜¯ï¼Œ<strong>åœ¨æµè§ˆå™¨æ¥æ”¶æœåŠ¡ç«¯è¿”å›æ•°æ®æ—¶ï¼Œä¼šæ£€æŸ¥è¯¥æ•°æ®æ˜¯å¦å’Œå½“å‰å‘èµ·è¯·æ±‚çš„ç½‘å€åœ¨åŒä¸€åŸŸåä¸‹ã€‚è‹¥ä¸æ˜¯ï¼Œåˆ™ä¼šä¸¢å¼ƒè¯¥æ•°æ®ï¼Œå¹¶è¿”å›ä¸€ä¸ªè·¨åŸŸé”™è¯¯</strong>ã€‚</p><blockquote><p>åœ¨Ajaxè¯·æ±‚ä¸­ï¼Œéµå¾ªå¦‚ä¸‹æµç¨‹ï¼š<br>ç½‘é¡µæäº¤ä¸€ä¸ªAjaxè¯·æ±‚åˆ°æµè§ˆå™¨ï¼Œæµè§ˆå™¨å°†è¯·æ±‚å‘è‡³æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œè¿”å›å“åº”æ•°æ®ç»™æµè§ˆå™¨ï¼ˆæœåŠ¡å™¨é€šå¸¸ä¸ä¼šå¯¹åŸŸåè¿›è¡ŒåŒºåˆ†ï¼‰ï¼Œæµè§ˆå™¨æ¥æ”¶åˆ°å“åº”æ•°æ®æ—¶ï¼Œæ£€æµ‹è¿”å›æ•°æ®çš„åŸŸåæ˜¯å¦å’Œå½“å‰é¡µé¢åŸŸåç›¸åŒï¼Œè‹¥ç›¸åŒåˆ™å°†æ•°æ®è¿”å›ç»™ç½‘é¡µï¼Œä¸åŒåˆ™ä¸¢å¼ƒæ•°æ®ã€‚</p></blockquote><h2 id="Ajaxè·¨åŸŸçš„å¤„ç†æ–¹æ³•"><a href="#Ajaxè·¨åŸŸçš„å¤„ç†æ–¹æ³•" class="headerlink" title="Ajaxè·¨åŸŸçš„å¤„ç†æ–¹æ³•"></a>Ajaxè·¨åŸŸçš„å¤„ç†æ–¹æ³•</h2><p>æ—¢ç„¶è·¨åŸŸé—®é¢˜çš„äº§ç”ŸåŸå› åœ¨äºæµè§ˆå™¨çš„é™åˆ¶ï¼Œé‚£ä¹ˆç½‘é¡µç«¯åœ¨è¯·æ±‚æ—¶æ— æ³•ä¸»åŠ¨è§„é¿ï¼Œæ­¤æ—¶å°±éœ€è¦æœåŠ¡ç«¯è¿›è¡Œå¤„ç†ã€‚</p><p>æœåŠ¡ç«¯åªéœ€è¦åœ¨å“åº”Ajaxè¯·æ±‚æ—¶ï¼Œåœ¨è¯·æ±‚å¤´ä¸­åŠ å…¥ä¸€ä¸ª<code>Access-Control-Allow-Origin</code>å±æ€§ï¼Œå¹¶è®¾ç½®ä¸º<code>*</code>ï¼ˆè¡¨ç¤ºå…¨éƒ¨åŸŸåï¼‰æˆ–è€…å½“å‰åŸŸåå°±å¯ä»¥è®©æµè§ˆå™¨ä¸å†è¿›è¡Œé™åˆ¶.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.headers.origin)</span><br><span class="line">  res.setHeader(<span class="string">'Access-Control-Allow-Origin'</span>, <span class="string">'*'</span>)</span><br><span class="line">  res.write(<span class="string">`&#123;"resultCode": "0000", "msg": "success"&#125;`</span>)</span><br><span class="line">  res.end()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8080</span>)</span><br></pre></td></tr></table></figure><p>å½“ç„¶åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä¸å¯ä»¥ç®€å•åœ°è®¾ç½®<code>res.setHeader(&#39;Access-Control-Allow-Origin&#39;, &#39;*&#39;)</code>ï¼Œè€Œæ˜¯è¦é€šè¿‡<code>req.headers.origin</code>åˆ¤æ–­å‘èµ·è¯·æ±‚çš„åŸŸåæ˜¯å¦åˆæ³•ï¼Œå†è®¾ç½®<code>Access-Control-Allow-Origin</code>å±æ€§ï¼Œä»¥å…å‡ºç°å®‰å…¨é—®é¢˜ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Ajaxè·¨åŸŸé—®é¢˜çš„äº§ç”ŸåŸå› &quot;&gt;&lt;a href=&quot;#Ajaxè·¨åŸŸé—®é¢˜çš„äº§ç”ŸåŸå› &quot; class=&quot;headerlink&quot; title=&quot;Ajaxè·¨åŸŸé—®é¢˜çš„äº§ç”ŸåŸå› &quot;&gt;&lt;/a&gt;Ajaxè·¨åŸŸé—®é¢˜çš„äº§ç”ŸåŸå› &lt;/h2&gt;&lt;p&gt;Ajaxè¯·æ±‚æ— æ³•è·¨åŸŸï¼Œåœ¨å‰ç«¯å¼€å‘ä¸­æ˜¯ä¸ªå¸¸è§é—®é¢˜ï¼Œå®ƒçš„
      
    
    </summary>
    
      <category term="Node" scheme="https://zhanghao-web.github.io/categories/Node/"/>
    
    
      <category term="Node" scheme="https://zhanghao-web.github.io/tags/Node/"/>
    
  </entry>
  
</feed>
